{"version":3,"sources":["serviceWorker.js","store/reducers/auth.js","store/actionTypes.js","models/createArcs.js","models/polygonOffset.js","dataParsers/parser.js","store/reducers/app.js","models/model.js","models/layer.js","models/layers.js","store/reducers/layers.js","store/reducers/mouse.js","store/reducers/measureShapesTool.js","store/reducers/cloudStorage.js","store/reducers/upload.js","store/reducer.js","middleware/log.js","models/job.js","dataParsers/parseJSON.js","middleware/pasteData.js","middleware/stageController.js","middleware/skeleton_recognition.js","axios-database.js","store/actions/appActions.js","store/actions/layersActions.js","store/actions/cloudStorageActions.js","components/UI/Button/Button.js","components/UI/ButtonSeparator/ButtonSeparator.js","components/MainComponent/ToolbarComponent/ToolbarComponent.js","models/stage.js","store/actions/stageActions.js","components/MainComponent/CanvasComponent/CanvasComponent.js","components/Layout/StatusComponent/StatusComponent.js","components/MainComponent/GraphicsComponent/stageComponent.js","models/graphics.js","models/utils.js","components/MainComponent/GraphicsComponent/graphics/shapeComponent.js","components/MainComponent/GraphicsComponent/graphics/imageComponent.js","components/MainComponent/GraphicsComponent/layerComponent.js","components/MainComponent/GraphicsComponent/domelements/labelComponent.js","components/MainComponent/GraphicsComponent/LabelsLayerComponent/labelsLayerComponent.js","components/MainComponent/GraphicsComponent/domelements/VertexLabel/VertexLabel.js","components/MainComponent/GraphicsComponent/graphics/vertexComponent.js","components/MainComponent/GraphicsComponent/graphics/verticesComponent.js","components/MainComponent/GraphicsComponent/verticesLayerComponent.js","components/MainComponent/GraphicsComponent/layersComponent.js","tools/measurePointsTool.js","tools/measureShapesTool.js","tools/displayCoordsTool.js","components/UI/Modal.js","components/UI/ModalPopup/ModalPopup.js","components/AboutPopup/AboutPopup.js","dataParsers/createXML.js","components/DownloadPopup/DownloadPopup.js","components/UI/SnackbarRoot.js","components/UI/Snackbar/Snackbar.js","dataParsers/parserXML.js","dataParsers/parserODB.js","dataParsers/parsePGM.js","dataParsers/parseCSV.js","dataParsers/parseTXT.js","store/actions/upload.js","components/UploadPopup/UploadPopup.js","components/Constructions/CloudDocument.js","containers/MainComponent/MainComponent.js","components/LayersList/LayerListToolbar/LayerListToolbar.js","components/LayersList/LayerEditForm/LayerEditForm.js","components/LayersList/LayerListElement/LayerListElement.js","containers/LayerList/LayersList.js","components/Layout/AsideComponent/AsideComponent.js","AppBody.js","components/Layout/HeaderComponent/HeaderComponent.js","components/Constructions/Demo.js","components/Constructions/SkeletonRecognition.js","models/collisionDistance.js","components/Constructions/CollisionDemo.js","components/UI/Spinner/Spinner.js","store/actions/auth.js","App.js","index.js","components/UI/Button/Button.module.css","components/UploadPopup/UploadPopup.module.css","components/LayersList/LayerListElement/LayerListElement.module.css","components/UI/ButtonSeparator/ButtonSeparator.module.css","components/MainComponent/ToolbarComponent/ToolbarComponent.module.css","components/UI/ModalPopup/ModalPopup.module.css","containers/LayerList/LayersList.module.css","components/Layout/HeaderComponent/HeaderComponent.module.css","components/UI/Spinner/Spinner.module.css","components/MainComponent/CanvasComponent/CanvasComponent.module.css","components/Layout/StatusComponent/StatusComponent.module.css","components/MainComponent/GraphicsComponent/LabelsLayerComponent/labelsLayer.module.css","components/MainComponent/GraphicsComponent/domelements/VertexLabel/VertexLabel.module.css","components/AboutPopup/AboutPopup.module.css","components/DownloadPopup/DownloadPopup.module.css","components/UI/Snackbar/Snackbar.module.css","containers/MainComponent/MainComponent.module.css","components/LayersList/LayerListToolbar/LayerListToolbar.module.css","components/LayersList/LayerEditForm/LayerEditForm.module.css","components/Layout/AsideComponent/AsideComponent.module.css"],"names":["Boolean","window","location","hostname","match","initialState","token","userId","username","error","loading","auth","state","arguments","length","undefined","action","type","Object","objectSpread","arcSE","center","start","end","counterClockwise","startAngle","vector","slope","endAngle","Utils","EQ","Math","PI","r","Arc","Flatten","BooleanOperations","BOOLEAN_UNION","unify","subtract","addToIntPoints","getSortedArray","splitByIntersections","removeNotRelevantChains","removeOldFaces","restoreFaces","offsetArc","arc","value","arc_cap1","arc_cap2","w","abs","polygon","Polygon","arc_outer","clone","sweep","arcStartSweep","arcEndSweep","arc_inner","pc","CW","CCW","Segment","addFace","toConsumableArray","faces","setArcLength","ips","Face","getSelfIntersections","edges","slice","edge_cap1","edge_cap2","int_points","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","Symbol","iterator","next","done","pt","err","return","int_points_sorted","bv","OUTSIDE","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","int_point","edge_before","edge_after","INSIDE","num","prev","orientation","ORIENTATION","reverse","offsetSegment","seg","v_seg_unit","x","y","normalize","v_left","rotate90CCW","multiply","v_right","rotate90CW","seg_left","translate","seg_right","cap1","cap2","Parser","classCallCheck","this","createClass","key","str","arrayOfLines","watchArray","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","line","push","substring","indexOf","pointArr","split","point","Point","parseInt","label","termArr","psArr","ps","peArr","pe","pcArr","Circle","pllArr","xmin","ymin","width","height","box","Box","segment","i","search","nedgesStr","nedges","j","parseToSegment","parseToArc","points","shape","shapes","parseToPoint","parseToCircle","parseToRectangle","parseToODBLine","parseToODBArc","parseToPolygon","size","parseToShapes","parseToPoints","unitsList","name","decimals","divisor","defaultAppState","title","version","process","build","units","parser","widthOn","displayVertices","displayLabels","measurePointsActive","zoomFactor","originX","originY","showAboutPopup","importDataToNewLayer","showSkeletonRecognitionButton","applySkeletonRecognition","stage","showSpinner","showLayerList","showDownloadPopup","showUploadPopup","app","assign","resolution","origin","curUnitsId","findIndex","newUnits","defaultStyle","strokeStyle","stroke","fill","alpha","Model","geom","style","model","Layer","color","displayed","edited","affected","layer","newShape","add","JSON","stringify","merge","xmax","ymax","colors","Layers","layers","getNewName","defaultName","inc","comparator","find","lay","currentAffectedLayer","getAffected","_loop","col","_colors","_i","index","l","newLayers","filter","getNextColor","sort","l1","l2","name1","toUpperCase","name2","map","toJSON","newLayer","affectedLayer","affectedLayerId","concat","delete","setAffected","toggleDisplayed","setEdited","setNameAndTitle","nextLayer","newCurLayer","newNextLayer","defaultMouseState","startX","startY","touchPoints","mouse","x1","y1","x2","y2","defaultMeasureShapesTool","measureShapesActive","measureShapesFirstClick","hoveredShape","firstMeasuredShape","secondMeasuredShape","firstMeasuredLayer","secondMeasuredLayer","distance","shortestSegment","is_mobile","mobilecheck","measureShapesTool","shape1","shape2","_Flatten$Distance$dis","Distance","_Flatten$Distance$dis2","slicedToArray","documentDefaultState","id","owner","lastUpdated","cloudStorageDefaultState","document","documentsList","cloudStorage","_state$documentsList","_action$id","newList","objectWithoutProperties","_toPropertyKey","stateDocumentsList","actionDocumentsList","keys","hasOwnProperty","isUpToDate","defaultState","uploadStarted","uploadCompleted","uploadedFiles","upload","reducer","combineReducers","log","_ref","getState","dispatch","console","Job","filename","profiles","materials","get","b","parseJSONShape","jsonShape","parseJSON","jsonArray","job","parse","e","Error","Array","faceArray","Image","uri","pasteData","data","items","getAsString","string","shapesArray","message","stageController","resize","panByMouseStart","dx","dy","panByMouseMove","panByMouseStop","isNaN","panToCoordinate","zoomToLimits","bIn","delta","zoomByMouse","removeAllChildren","removeAllListeners","zoomByPinchStart","distStart","sqrt","ratio","zoomByPinchMove","zoomByPinchStop","Algorithmia","skeleton_recognition","currentLayer","input","nx","ny","client","algo","pipe","then","output","result","row","instance","axios","create","baseURL","setHomeView","addNewLayer","toggleDisplayLayer","documents","values","button","props","iconStyle","classes","IconTrigger","active","IconModeActive","IconModeNotActive","buttonStyle","mobileOnly","react_default","a","createElement","onClick","className","lib_default","iconName","buttonSeparator","ButtonSeparator","IconSeparator","ToolbarComponent","Button","onShowUploadPopupPressed","onLayerListButtonClicked","onClearAllButtonClicked","onShowDownloadPopupPressed","onHomeButtonPressed","onPanByDragPressed","onMeasurePointsButtonPressed","onMeasureBetweenShapesButtonPressed","onToggleWidthModePressed","onToggleVerticesPressed","onToggleLabelsPressed","onSkeletonRecognitionButtonPressed","onUnitClicked","onShowAboutPopupPressed","Component","Stage","canvas","_this","possibleConstructorReturn","getPrototypeOf","call","Touch","enable","assertThisInitialized","mouseMoveOutside","enableMouseOver","clientWidth","clientHeight","oldOrigin","oldZoomFactor","pinchAnchorX","pinchAnchorY","pinchStarted","addChild","scalar","scalingFactor","canvasX","canvasY","worldX","worldY","W2C_X","W2C_Y","newOrigin","deltaX","deltaY","curRatio","min","max","focusX","focusY","C2W_X","C2W_Y","zoomIn","zoomOut","newFocusX","newFocusY","panBy","zoom","getContext","clearRect","minX","minY","maxX","maxY","CreatejsStage","handleMouseWheelMove","CanvasComponent","canvasElement","React","createRef","handleMouseMove","event","focus","nativeEvent","touches","clientX","target","offsetLeft","clientY","offsetTop","handlePinchMove","stageX","stageY","handleMouseDown","handlePinchDown","handleMouseUp","stopPropagation","preventDefault","handlePinchUp","handleMouseLeave","blur","body","handleMouseWheel","detail","wheelDelta","offsetX","offsetY","handleMouseWheelFox","layerX","layerY","handlePaste","current","on","addEventListener","passive","registerStage","tabIndex","ref","styles","connect","actions","StatusComponent","StageComponent","setTransform","update","onStageUnmounted","Fragment","children","graphics","radius","Graphics","beginFill","command","circle","drawCircle","graphics_point","ignoreScale","setStrokeStyle","beginStroke","moveTo","lineTo","endStroke","graphics_segment","graphics_arc","graphics_circle","drawRect","graphics_box","face","setGraphicsFace","graphics_polygon","setGraphicsEdge","edge","setGraphicsEdgeSegment","setGraphicsEdgeArc","first","is_equal","obj1","obj2","equal","_Object$keys","format","toFixed","ShapeComponent","_Component","params","handleMouseOver","onMouseOver","handleMouseOut","onMouseOut","handleClick","Shape","inherits","hovered","selected","aperture","isEmpty","redraw","nextProps","nextState","off","removeChild","clear","ImageComponent","_getPrototypeOf2","_len","args","_key","apply","bitmap","image","naturalWidth","naturalHeight","scaleX","scaleY","tx","ty","regX","regY","_this2","img","onload","Bitmap","onImageLoaded","setAttribute","src","loadImage","LayerComponent","forceUpdate","imageComponent_ImageComponent","shapeComponent_ShapeComponent","handleMouseRollOverShape","handleMouseRollOutShape","handleClickOnShape","labelComponent","left","top","position","LabelComponent","trim","domelements_labelComponent","VertexLabel","vertex","VertexComponent","shadow","Shadow","setState","mouseEnabled","domelements_VertexLabel_VertexLabel","VerticesComponent","vertices","vertexComponent","verticesComponent","LayersComponent","layerComponent","LabelsLayerComponent_labelsLayerComponent","GraphicsComponent_verticesLayerComponent","MeasurePointsTool","measureCanvas","measureStage","endX","endY","measureStarted","cursor","draw","context","textX","textY","textWidth","backX","backY","pllX","pllY","W2C_Scalar","beginPath","rect","lineWidth","text","measurement","font","measureText","textAlign","fillStyle","globalAlpha","fillRect","textHeight","fillText","dist","removeAllEventListeners","mainCanvas","MeasureShapesTool","labelShape","Text","unscale","redrawLabel","DisplayCoordsTool","coordX","coordY","backgroundColor","opacity","margin","padding","modalRoot","getElementById","Modal","el","appendChild","ReactDOM","createPortal","ModalPopup","onBackDropClicked","ev","closePopup","handleKeyDown","code","elementDrag","dragX","dragY","element","closeDragElement","onmouseup","onmousemove","dragMouseDown","removeEventListener","showPopup","UI_Modal","BackDrop","onMouseDown","header","AboutPopup","UI_ModalPopup_ModalPopup","toggleAboutPopup","href","pointToXMLString","xw","startElement","writeAttribute","endElement","segmentToXMLString","arcToXMLString","round","circleToXMLString","polygonToXMlString","createXMLString","XMLWriter","startDocument","endDocument","toString","DownloadPopup","downloadData","xmlString","encodeURIComponent","download","snackbarRoot","SnackbarRoot","Snackbar","display","onAnimationEnd","UI_SnackbarRoot","parseEdges","edgesXML","_Array$from","from","getAttribute","parsePolygon","polygonsXML","islands","getElementsByTagName","_i2","_Array$from2","holes","_i3","_Array$from3","parseSegment","segmentXML","parseCurve","curveXML","parsePoint","pointXML","parseImage","imageXML","inch2pixels","mils2pixels","InchToPixels","Number","MilsToPixels","lines","terms","end_of_face","parseLine","apertures","ap_value","parseArc","pgmResolution","microns2pixels","sizeX","toPixels","micron2pixels","micronToPixels","parseTXT","readAsText","reader","file","files","promise","Promise","resolve","reject","theFile","namesplitted","extension","xmlDoc","DOMParser","parseFromString","titles","firstChild","nodeValue","profilesXML","_i4","_Array$from4","materialXML","_i5","_Array$from5","segmentsXML","_i6","_Array$from6","curvesXML","_i7","_Array$from7","curve","pointsXML","_i8","_Array$from8","imagesXML","_i9","_Array$from9","parseXML","px","py","parseCSV","substr","polarity","odbLine","odbArc","ap_key","parseODB","readAsImage","yStr","xStr","readAsDataURL","readFile","FileReader","readFiles","promises","all","filesUploadCompleted","catch","alert","UploadPopup","inputElement","clipboardWindowRef","clipboardWindowWidth","clipboardWindowHeight","dragOver","clipboardData","openFilesButtonClicked","click","pasteHandler","onPaste","dropHandler","dataTransfer","kind","getAsFile","dragOverHandler","dragLeaveHandler","filesSelectedHandler","File","FileList","initUploadState","pX","pY","snackbarMessage","newFilesNum","UploadTarget","UploadTargetDragOver","UploadTargetDragLeave","paddingLeft","paddingRight","paddingTop","paddingBottom","onDrop","onDragOverCapture","onDragLeaveCapture","multiple","onChange","UI_Snackbar_Snackbar","CloudDocument","fetchDocumentFromDatabase","firstLayer","docUrl","geomUrl","responses","layerData","layerActions","requestFetchDocumentFromDatabaseSucceed","appActions","cloudActions","MainComponent","onSaveDocumentButtonClicked","dataURL","toDataURL","payload","Date","toLocaleDateString","toLocaleTimeString","updateDocumentInDatabase","addDocumentToDatabase","history","clearCurrentDocument","clearAllLayers","toggleWidthMode","toggleDisplayVertices","onresize","resizeStage","handleKeyUp","displayCoordsTool","tools_displayCoordsTool","measurePointsTool","tools_measurePointsTool","measuredLayersDisplayed","tools_measureShapesTool","MainComponent_ToolbarComponent_ToolbarComponent","togglePanByDrag","toggleMeasureBetweenPoints","toggleMeasureBetweenShapes","toggleDisplayLabels","toggleUnits","toggleLayerList","toggleDownloadPopup","toggleUploadPopup","MainComponent_CanvasComponent_CanvasComponent","stageComponent","destroyStage","layersComponent","Layout_StatusComponent_StatusComponent","components_AboutPopup_AboutPopup","components_DownloadPopup_DownloadPopup","components_UploadPopup_UploadPopup","pasteDataFromBuffer","react_router","path","component","ownProps","post","response","layersJSON","geomPayload","registerDocumentAddedToDatabase","now","put","url","geomId","reponse","LayerListToolbar","onAddLayerButtonClicked","onEditLayerButtonClicked","onDeleteLayerButtonClicked","onSortLayersButtonClicked","LayerEditForm","onSubmitLayerEditForm","currentTarget","setFocus","onSubmit","onMouseMove","defaultValue","cols","rows","onEscapeLayerEditForm","parent","LayerListElement","activeElement","nodeName","elem","refs","layerName","hex","g","percent","replace","rgba","bgcolor","layerNameOpacity","onLayerClicked","onDoubleClick","onLayerDoubleClicked","LayerSelectionBox","onAffectedBoxClicked","LayerSelectionMark","LayerNameBox","LayersList_LayerEditForm_LayerEditForm","LayersList","parentElement","setAffectedNextLayer","setAffectedPrevLayer","onLayerListClicked","LayersList_LayerListToolbar_LayerListToolbar","maxHeight","LayersList_LayerListElement_LayerListElement","AsideComponent","updateDocumentName","containers_MainComponent_MainComponent","onManageCloudStorageButtonClicked","LayerList_LayersList","Layout_AsideComponent_AsideComponent","withRouter","pathname","Demo","resp","panAndZoomToShape","asyncOperationEnded","asyncOperationStarted","SkeletonRecognition","CollisionDistance","polygon1","polygon2","collision_distance","POSITIVE_INFINITY","_arr","edge2polygon","edge2","shapeBox","NEGATIVE_INFINITY","resp_edges","edge1","segment2segment","segment2arc","arc2arc","intersections","Line","Vector","intersect","ip","_point$distanceTo","distanceTo","_point$distanceTo2","segment1","segment2","point2shape","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","v_s","_v_n","v","tangent_point","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","arc1","arc2","arc_enlarged","_arc1$distanceTo","translateArc","_arc1$distanceTo2","dist_tmp","EQ_0","GE","arc_reduced","_arc1$distanceTo3","_arc1$distanceTo4","LT","_arc1$distanceTo5","_arc1$distanceTo6","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","vec","arc_tmp","newPolygon","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","arc_trans","CollisionDemo","collision","polygon3","applyCollisionDemo","spinner","Loader","authSucceed","authFailed","logout","localStorage","removeItem","checkAuthTimeout","expirationTime","setTimeout","email","getItem","password","logIn","authData","returnSecureToken","setItem","expirationDate","getTime","expiresIn","idToken","localId","queryParams","authSetUsername","App","authCheckState","Layout_HeaderComponent_HeaderComponent","isAuthenticated","AppBody","exact","Spinner","timeLeft","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","render","es","react_router_dom","basename","src_App_0","navigator","serviceWorker","ready","registration","unregister","module","exports","DrawerButton","fadeIn","Layer-displayed","Layer-undisplayed","App-toolbar","App-toolbar-units","App-layers","App-layers-displayed","App-header","App-header-documents-page","load2","App-canvas","App-status-bar","LabelsLayer","Open","Close","fadeInOut","Main-content","Layer-list-toolbar","Layer-edit-form","App-aside"],"mappings":"kNAUoBA,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,uECdAC,EAAe,CACjBC,MAAO,KACPC,OAAQ,KACRC,SAAU,KACVC,MAAO,KACPC,SAAS,GA8CEC,EA3CF,WAAgC,IAA/BC,EAA+BC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAzBR,EAAcW,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EACzC,OAAQC,EAAOC,MACX,ICiF8B,yBDhF1B,OAAOC,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIH,MAAO,KACPC,SAAS,IAEjB,IC4E8B,yBD3E1B,OAAOQ,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIH,MAAO,KACPH,MAAOU,EAAOV,MACdC,OAAQS,EAAOT,OACfC,SAAUQ,EAAOR,SACjBE,SAAS,IAEjB,ICoE6B,wBDnEzB,OAAOQ,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIH,MAAOO,EAAOP,MACdH,MAAO,KACPC,OAAQ,KACRC,SAAU,KACVE,SAAS,IAEjB,IC4D6B,wBD3DzB,OAAOQ,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIN,MAAO,KACPC,OAAQ,KACRC,SAAU,OAElB,ICsDmC,6BDrD/B,OAAOU,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIJ,SAAUQ,EAAOR,WAEzB,QACI,OAAOI,gCE/CZ,SAASQ,EAAMC,EAAQC,EAAOC,EAAKC,GACtC,IAAIC,EAAaC,YAAOL,EAAOC,GAAOK,MAClCC,EAAWF,YAAOL,EAAQE,GAAKI,MAC/BE,IAAMC,GAAGL,EAAYG,KACrBA,GAAY,EAAEG,KAAKC,GACnBR,GAAmB,GAEvB,IAAIS,EAAIP,YAAOL,EAAQC,GAAOR,OAE9B,OAAO,IAAIoB,IAAIb,EAAQY,EAAGR,EAAYG,EAAUJ,SCDXW,IAAQC,kBAAzBC,KAAjBC,QAAOC,WAAUF,iBACuCF,IAAQC,kBAAhEI,mBAAgBC,mBAAgBC,2BACyBP,IAAQC,kBAAjEO,4BAAyBC,mBAAgBC,iBA4CzC,SAASC,EAAUC,EAAKC,GAE3B,IAIIC,EAASC,EAJTC,EAAIpB,KAAKqB,IAAIJ,GAGbK,EAAU,IAAIC,IAGdC,EAAYR,EAAIS,QACpBD,EAAUtB,EAAIc,EAAId,EAAIkB,EAEtBF,EDrDG,SAAuB5B,EAAQC,EAAOmC,EAAOjC,GAChD,IAAIC,EAAaC,YAAOL,EAAOC,GAAOK,MAClCC,EAAWH,EAAagC,EACxB5B,IAAMC,GAAGL,EAAYG,KACrBA,GAAY,EAAEG,KAAKC,GACnBR,GAAmB,GAEvB,IAAIS,EAAIP,YAAOL,EAAQC,GAAOR,OAE9B,OAAO,IAAIoB,IAAIb,EAAQY,EAAGR,EAAYG,EAAUJ,GC4CrCkC,CAAcX,EAAIxB,IAAKgC,EAAUhC,IAAKQ,KAAKC,GAAIe,EAAIvB,kBAC9D0B,ED1CG,SAAqB7B,EAAQE,EAAKkC,EAAOjC,GAC5C,IAAII,EAAWF,YAAOL,EAAOE,GAAKI,MAC9BF,EAAaG,EAAW6B,EACxB5B,IAAMC,GAAGL,EAAYG,KACrBA,GAAY,EAAEG,KAAKC,GACnBR,GAAmB,GAEvB,IAAIS,EAAIP,YAAOL,EAAQE,GAAKT,OAE5B,OAAO,IAAIoB,IAAIb,EAAQY,EAAGR,EAAYG,EAAUJ,GCiCrCmC,CAAYZ,EAAIzB,MAAOiC,EAAUjC,MAAOS,KAAKC,GAAIe,EAAIvB,kBAEhE,IAAIoC,OAAY7C,EAEZ6C,EADAb,EAAId,EAAIkB,EACI,IAAIjB,IAAIa,EAAIc,GAAId,EAAId,EAAIkB,EAAGJ,EAAInB,SAAUmB,EAAItB,WACrDsB,EAAIvB,mBAAqBsC,IAAKC,IAAMD,KAI5B,IAAIE,IAAQf,EAAS1B,IAAK2B,EAAS5B,OAGnD+B,EAAQY,QAAQ,CAACV,EAAWN,EAAUW,EAAWV,IACjDhC,OAAAgD,EAAA,EAAAhD,CAAImC,EAAQc,OAAO,GAAGC,eAGtB,IAAIC,EAAMC,IAAKC,qBAAqBrD,OAAAgD,EAAA,EAAAhD,CAAImC,EAAQc,OAAO,GAAId,EAAQmB,OAAO,GAG1EH,EAAMA,EAAII,MAAM,EAAEJ,EAAIvD,OAAO,GAE7B,IACI4D,EACAC,EAFAC,EAAa,GAIjBF,EAAYxD,OAAAgD,EAAA,EAAAhD,CAAImC,EAAQmB,OAAO,GAC/BG,EAAYzD,OAAAgD,EAAA,EAAAhD,CAAImC,EAAQmB,OAAO,GAtCG,IAAAK,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAwClC,QAAAiE,EAAAC,EAAeZ,EAAfa,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAoB,KAAXS,EAAWN,EAAAhC,MAChBR,EAAekC,EAAWY,EAAIV,GAC9BpC,EAAemC,EAAWW,EAAIV,IA1CA,MAAAW,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GA8ClC,IAAIU,EAAoBhD,EAAemC,GACvClC,EAAqBW,EAASoC,GAI9B,IAAIC,EAAKC,IAnDyBC,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAoDlC,QAAAgF,EAAAC,EAAsBP,EAAtBP,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAAyC,KAAhCK,EAAgCF,EAAA/C,MACrCiD,EAAUC,YAAYR,GAAKA,EAC3BO,EAAUE,WAAWT,GAAMA,IAAOC,IAAUS,IAAST,IACrDD,EAAKO,EAAUE,WAAWT,IAvDI,MAAAH,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GA4DlCnD,EAAwBU,EADfhB,EAC4BoD,GAAmB,GAIxD,IAEQS,EACAC,EAHJE,EAAMzB,EAAW9D,OACjBuF,EAAM,IAINH,EAAcT,EAAkB,GAAGS,YACnCC,EAAaV,EAAkBY,EAAI,GAAGF,WACtCD,EAAYd,KAAOe,EACnBA,EAAWG,KAAOJ,EAGlBT,EAAkB,GAAGU,WAAaV,EAAkBY,EAAI,GAAGF,WAC3DV,EAAkBY,EAAI,GAAGH,YAAcT,EAAkB,GAAGS,YAEhD,IAARG,IAEAH,EAAcT,EAAkB,GAAGS,YACnCC,EAAaV,EAAkB,GAAGU,WAClCD,EAAYd,KAAOe,EACnBA,EAAWG,KAAOJ,EAGlBT,EAAkB,GAAGU,WAAaV,EAAkB,GAAGU,WACvDV,EAAkB,GAAGS,YAAcT,EAAkB,GAAGS,aAI5DtD,EAAeS,EAASuB,GAExB/B,EAAaQ,EAASuB,EAAYA,IAOtC,OAJY1D,OAAAgD,EAAA,EAAAhD,CAAImC,EAAQc,OAAO,GACrBoC,gBAAkBC,IAAYzC,KACpCV,EAAQoD,UAELpD,EAGJ,SAASqD,EAAcC,EAAK3D,GAC/B,IAAIG,EAAIpB,KAAKqB,IAAIJ,GAEbK,EAAU,IAAIC,IAEdsD,EADQlF,YAAOiF,EAAIpF,IAAIsF,EAAEF,EAAIrF,MAAMuF,EAAGF,EAAIpF,IAAIuF,EAAEH,EAAIrF,MAAMwF,GACvCC,YACnBC,EAASJ,EAAWK,cAAcC,SAAS/D,GAC3CgE,EAAUP,EAAWQ,aAAaF,SAAS/D,GAC3CkE,EAAWV,EAAIW,UAAUN,GACzBO,EAAYZ,EAAIW,UAAUH,GAASV,UACnCe,EAAOpG,EAAMuF,EAAIpF,IAAK8F,EAAS9F,IAAKgG,EAAUjG,MAAOwC,KACrD2D,EAAOrG,EAAMuF,EAAIrF,MAAOiG,EAAUhG,IAAK8F,EAAS/F,MAAOwC,KAG3D,OADAT,EAAQY,QAAQ,CAACoD,EAAUG,EAAMD,EAAWE,IACrCpE,EC5HJ,IAAMqE,EAAb,oBAAAA,IAAAxG,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAF,GAAA,OAAAxG,OAAA2G,EAAA,EAAA3G,CAAAwG,EAAA,EAAAI,IAAA,oBAAA9E,MAAA,SACsB+E,GACd,IAAIC,EAAeD,EAAI3H,MAAM,aACzB6H,EAAa,GAFEC,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAGnB,QAAAsH,EAAAC,EAAiBN,EAAjB9C,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA+B,KAAtBK,EAAsBF,EAAArF,MAC3BiF,EAAWO,KAAKD,EAAKE,UAAUF,EAAKG,QAAQ,QAJ7B,MAAAnD,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAMnB,OAAOH,IAPf,CAAAH,IAAA,eAAA9E,MAAA,SAUiBuF,GACT,IACII,EADUJ,EAAKnI,MAAM,eAAe,GACjBwI,MAAM,KAAK,GAAGA,MAAM,KACvCC,EAAQ,IAAIC,IAAMC,SAASJ,EAAS,GAAG,IAAKI,SAASJ,EAAS,GAAG,KAErE,OADAE,EAAMG,MAAQT,EAAKK,MAAM,OAAO,GACzBC,IAff,CAAAf,IAAA,iBAAA9E,MAAA,SAkBmBuF,GACX,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBM,EAAQD,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCO,EAAK,IAAIL,IAAMC,SAASG,EAAM,GAAG,IAAKH,SAASG,EAAM,GAAG,KAExDE,EAAQH,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCS,EAAK,IAAIP,IAAMC,SAASK,EAAM,GAAG,IAAKL,SAASK,EAAM,GAAG,KAE5D,OAAO,IAAIpF,IAAQmF,EAAIE,KA5B/B,CAAAvB,IAAA,aAAA9E,MAAA,SA+BeuF,GACP,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBM,EAAQD,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCO,EAAK,IAAIL,IAAMC,SAASG,EAAM,GAAG,IAAKH,SAASG,EAAM,GAAG,KAExDE,EAAQH,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCS,EAAK,IAAIP,IAAMC,SAASK,EAAM,GAAG,IAAKL,SAASK,EAAM,GAAG,KAExDE,EAAQL,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvC/E,EAAK,IAAIiF,IAAMC,SAASO,EAAM,GAAG,IAAKP,SAASO,EAAM,GAAG,KAGxD9H,EAA6B,MADrByH,EAAQ,GAAGL,MAAM,KAAK,GAG9BnH,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAE1BQ,IAAQN,MAAMC,GAAGL,EAAYG,KAE7BA,EAAWJ,EAAmBI,EAAW,EAAEG,KAAKC,GAAKJ,EAAW,EAAEG,KAAKC,IAE3E,IAAIC,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEvB,OAAO,IAAIoB,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,KAxDpD,CAAAsG,IAAA,gBAAA9E,MAAA,SA2DkBuF,GACV,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBU,EAAQL,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvC/E,EAAK,IAAIiF,IAAMC,SAASO,EAAM,GAAG,IAAKP,SAASO,EAAM,GAAG,KACxDrH,EAAI8G,SAASE,EAAQ,GAAGL,MAAM,KAAK,GAAG,IAI1C,OAAO,IAAIW,IAAO1F,EAAI5B,KArE9B,CAAA6F,IAAA,mBAAA9E,MAAA,SAwEqBuF,GACb,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBY,EAASP,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACxCa,EAAOV,SAASS,EAAO,GAAG,IAC1BE,EAAOX,SAASS,EAAO,GAAG,IAC1BG,EAAQZ,SAASE,EAAQ,GAAGL,MAAM,KAAK,GAAG,IAC1CgB,EAASb,SAASE,EAAQ,GAAGL,MAAM,KAAK,GAAG,IAE3CiB,EAAM,IAAIC,IAAIL,EAAMC,EAAMD,EAAOE,EAAOD,EAAOE,GAC/CvG,EAAU,IAAIC,IAElB,OADAD,EAAQY,QAAQ4F,GACTxG,IArFf,CAAAyE,IAAA,iBAAA9E,MAAA,SAyFmBuF,GACX,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBM,EAAQD,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCO,EAAK,IAAIL,IAAMC,SAASG,EAAM,GAAG,IAAKH,SAASG,EAAM,GAAG,KAExDE,EAAQH,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCS,EAAK,IAAIP,IAAMC,SAASK,EAAM,GAAG,IAAKL,SAASK,EAAM,GAAG,KAExDjG,EAAI4F,SAASE,EAAQ,GAAGL,MAAM,KAAK,GAAG,IAEtCmB,EAAU,IAAI/F,IAAQmF,EAAIE,GAG9B,OAFclG,EAAI,EAAIuD,EAAcqD,EAAS5G,GAAK,IAAIG,MAtG9D,CAAAwE,IAAA,gBAAA9E,MAAA,SA2GkBuF,GACV,IACIU,EADUV,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KAExBM,EAAQD,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCO,EAAK,IAAIL,IAAMC,SAASG,EAAM,GAAG,IAAKH,SAASG,EAAM,GAAG,KAExDE,EAAQH,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvCS,EAAK,IAAIP,IAAMC,SAASK,EAAM,GAAG,IAAKL,SAASK,EAAM,GAAG,KAExDE,EAAQL,EAAQ,GAAGL,MAAM,KAAK,GAAGA,MAAM,KACvC/E,EAAK,IAAIiF,IAAMC,SAASO,EAAM,GAAG,IAAKP,SAASO,EAAM,GAAG,KAGxD9H,EAA6B,MADrByH,EAAQ,GAAGL,MAAM,KAAK,GAG9BnH,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAE1BQ,IAAQN,MAAMC,GAAGL,EAAYG,KAE7BA,EAAWJ,EAAmBI,EAAW,EAAEG,KAAKC,GAAKJ,EAAW,EAAEG,KAAKC,IAE3E,IAAIC,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEnBiC,EAAM,IAAIb,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,GAE3C2B,EAAI4F,SAASE,EAAQ,GAAGL,MAAM,KAAK,GAAG,IAI1C,OAFczF,EAAI,EAAIL,EAAUC,EAAKI,GAAK,IAAIG,MAxItD,CAAAwE,IAAA,iBAAA9E,MAAA,SA6ImB+E,GAKX,IAJA,IAAI1E,EAAU,IAAIC,IAEd0E,EAAeD,EAAI3H,MAAM,aAEpB4J,EAAE,EAAGA,EAAIhC,EAAalH,OAAQkJ,IAAK,CACxC,IAAIzB,EAAOP,EAAagC,GACxB,GAAIzB,EAAK0B,OAAO,wBAA0B,EAAG,CASzC,IARA,IAGIC,EAHU3B,EAAKnI,MAAM,eAAe,GAClBwI,MAAM,KACH,GACEA,MAAM,KAAK,GAClCuB,EAASpB,SAASmB,EAAU,IAG5B1F,EAAQ,GACH4F,EAAEJ,EAAE,EAAGI,EAAIJ,EAAE,EAAEG,EAAQC,IAK5B,IAJA7B,EAAOP,EAAaoC,IAIXH,OAAO,kBAAoB,EAAG,CACnC,IAAIF,EAAUnC,KAAKyC,eAAe9B,GAClC/D,EAAMgE,KAAKuB,QAEV,GAAIxB,EAAK0B,OAAO,oBAAsB,EAAG,CAC1C,IAAIlH,EAAM6E,KAAK0C,WAAW/B,GAC1B/D,EAAMgE,KAAKzF,GAGnBM,EAAQY,QAAQO,IAGxB,OAAOnB,IA9Kf,CAAAyE,IAAA,gBAAA9E,MAAA,SAiLkB+E,GACV,IAAIwC,EAAS,GACTvC,EAAeD,EAAI3H,MAAM,aAFdyE,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAGf,QAAAiE,EAAAC,EAAiB+C,EAAjB9C,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA+B,KAAtB0D,EAAsBvD,EAAAhC,MAC3B,GAAIuF,EAAK0B,OAAO,gBAAkB,EAAG,CACjC,IACItB,EADUJ,EAAKnI,MAAM,eAAe,GACjBwI,MAAM,KAAK,GAAGA,MAAM,KACvCC,EAAQ,IAAIC,IAAMC,SAASJ,EAAS,GAAG,IAAKI,SAASJ,EAAS,GAAG,KACrEE,EAAMG,MAAQT,EAAKK,MAAM,OAAO,GAChC2B,EAAO/B,KAAKK,KATL,MAAAtD,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAYf,OAAOwF,IA7Lf,CAAAzC,IAAA,gBAAA9E,MAAA,SAgMkB+E,GACV,IACIyC,EADAC,EAAS,GAETzC,EAAeD,EAAI3H,MAAM,aAHdwF,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAIf,QAAAgF,EAAAC,EAAiBgC,EAAjB9C,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAA+B,KAAtB2C,EAAsBxC,EAAA/C,MACvBuF,EAAK0B,OAAO,gBAAkB,EAC9BO,EAAQ5C,KAAK8C,aAAanC,GAErBA,EAAK0B,OAAO,eAAiB,EAClCO,EAAQ5C,KAAKyC,eAAe9B,GAEvBA,EAAK0B,OAAO,iBAAmB,EACpCO,EAAQ5C,KAAK0C,WAAW/B,GAEnBA,EAAK0B,OAAO,kBAAoB,EACrCO,EAAQ5C,KAAK+C,cAAcpC,GAEtBA,EAAK0B,OAAO,gBAAkB,EACnCO,EAAQ5C,KAAKgD,iBAAiBrC,GAEzBA,EAAK0B,OAAO,gBAAkB,EACnCO,EAAQ5C,KAAKiD,eAAetC,GAEvBA,EAAK0B,OAAO,eAAiB,IAClCO,EAAQ5C,KAAKkD,cAAcvC,IAE/BkC,EAAOjC,KAAKgC,IA1BD,MAAAjF,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GA4Bf,OAAO2E,IA5Nf,CAAA3C,IAAA,QAAA9E,MAAA,SA+NU+E,GAEF,IAAI1E,EAAUuE,KAAKmD,eAAehD,GAClC,GAAI1E,EAAQmB,MAAMwG,KAAO,GAAK3H,EAAQc,MAAM6G,KAAO,EAC/C,MAAO,CAAC3H,GAIZ,IAAIoH,EAAS7C,KAAKqD,cAAclD,GAChC,GAAI0C,EAAO3J,OAAS,EAChB,OAAO2J,EAIX,IAAIF,EAAS3C,KAAKsD,cAAcnD,GAChC,OAAIwC,EAAOzJ,OAAS,EACTyJ,OADX,MA9OR7C,EAAA,GC9CMyD,EAAY,CACd,CACIC,KAAM,SACNC,SAAU,EACVC,QAAS,GAEb,CACIF,KAAM,OACNC,SAAU,EACVC,QAAS,QAEb,CACIF,KAAM,KACNC,SAAU,EACVC,QAAS,MAGXC,EAAkB,CACpBC,MAAO,eACPC,QAASC,QACTC,MAAO,GACPC,MAAO,SACPP,SAAU,EACVC,QAAS,EAETO,OAAQ,IAAInE,EACZoE,SAAS,EACTC,iBAAiB,EACjBC,eAAe,EACfC,qBAAqB,EACrBC,gBAAYnL,EACZoL,aAASpL,EACTqL,aAASrL,EACTsL,gBAAgB,EAChBC,sBAAsB,EACtBC,+BAA+B,EAC/BC,0BAA0B,EAC1BC,MAAO,KACPC,aAAa,EACbC,eAAe,EACfC,mBAAmB,EACnBC,iBAAiB,GA8HNC,EA3HH,WAAqC,IAApClM,EAAoCC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAA5B0K,EAAiBvK,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EAC7C,OAAQC,EAAOC,MACX,IJ9CyB,oBI+CrB,OAAOC,OAAO6L,OAAO,GAAInM,EAAO,CAC5B6L,MAAOzL,EAAOyL,MACdP,WAAYlL,EAAOyL,MAAMP,WAAalL,EAAOyL,MAAMO,WACnDb,QAASnL,EAAOyL,MAAMQ,OAAOpG,EAC7BuF,QAASpL,EAAOyL,MAAMQ,OAAOnG,IAGrC,IJlDuB,kBImDnB,OAAO5F,OAAO6L,OAAO,GAAInM,EAAO,CAC5B6L,MAAO,KACPP,gBAAYnL,EACZoL,aAASpL,EACTqL,aAASrL,IAGjB,IJpCiC,4BIqCjC,IJzB6B,wBI0B7B,IJ/B4B,uBIgCxB,OAAOG,OAAO6L,OAAO,GAAInM,EAAO,CAC5BsL,WAAYlL,EAAOyL,MAAMP,WAAalL,EAAOyL,MAAMO,WACnDb,QAASnL,EAAOyL,MAAMQ,OAAOpG,EAC7BuF,QAASpL,EAAOyL,MAAMQ,OAAOnG,IAErC,IJ/C4B,uBIgDxB,OAAO5F,OAAO6L,OAAO,GAAInM,EAAO,CAC5BuL,QAASnL,EAAOyL,MAAMQ,OAAOpG,EAC7BuF,QAASpL,EAAOyL,MAAMQ,OAAOnG,IAErC,IJ5D4B,uBI6DxB,IAAIoG,EAAa/B,EAAUgC,UAAU,SAAAvB,GAAK,OAAIhL,EAAMgL,QAAUA,EAAMR,OAChEgC,EAAWjC,GAAW+B,EAAa,GAAK,GAC5C,OAAOhM,OAAO6L,OAAO,GAAInM,EAAO,CAC5BgL,MAAOwB,EAAShC,KAChBC,SAAU+B,EAAS/B,SACnBC,QAAS8B,EAAS9B,UAE1B,IJnEiC,4BIoE7B,OAAOpK,OAAO6L,OAAO,GAAInM,EAAO,CAC5BkL,SAAUlL,EAAMkL,QAChBC,kBAAiBnL,EAAMkL,SAAUlL,EAAMmL,kBAE/C,IJvEuC,kCIwEnC,OAAInL,EAAMmL,gBACC7K,OAAO6L,OAAO,GAAInM,EAAO,CAC5BmL,iBAAiB,IAId7K,OAAO6L,OAAO,GAAInM,EAAO,CAC5BkL,SAAS,EACTC,iBAAiB,IAI7B,IJnFqC,gCIoFjC,OAAO7K,OAAO6L,OAAO,GAAInM,EAAO,CAC5BoL,eAAgBpL,EAAMoL,gBAG9B,IJ7FkC,6BI8F9B,OAAO9K,OAAO6L,OAAO,GAAInM,EAAO,CAC5ByL,gBAAiBzL,EAAMyL,iBAQ/B,IJ7GkC,6BI8G9B,OAAOnL,OAAO6L,OAAO,GAAInM,EAAO,CAC5BqL,qBAAqB,IAG7B,IJ9GqC,gCI+GjC,OAAO/K,OAAO6L,OAAO,GAAInM,EAAO,CAC5BqL,qBAAqB,IAE7B,IJjHqC,gCIkHjC,OAAO/K,OAAO6L,OAAO,GAAInM,EAAO,CAC5BqL,qBAAqB,IAE7B,IJxDgC,2BIyD5B,OAAO/K,OAAO6L,OAAO,GAAInM,EAAO,CAC5B2L,+BAA+B,IAEvC,IJ3DyC,sCI4DrC,OAAOrL,OAAO6L,OAAO,GAAInM,EAAO,CAC5B4L,0BAA0B,IAElC,IJ7D+B,0BI8D3B,OAAOtL,OAAO6L,OAAO,GAAInM,EAAO,CAC5B8L,aAAa,IAErB,IJhE6B,wBIiEzB,OAAOxL,OAAO6L,OAAO,GAAInM,EAAO,CAC5B8L,aAAa,IAErB,IJ/E4B,uBIgFxB,OAAO9L,EACX,IJhIsC,iCIiIlC,OAAOM,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEI+L,eAAgB/L,EAAM+L,gBAE9B,IJpIqC,gCIqIjC,OAAOzL,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIgM,mBAAoBhM,EAAMgM,oBAElC,IJxIiC,8BIyI7B,OAAO1L,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIiM,iBAAkBjM,EAAMiM,kBAEhC,QACI,OAAOjM,ICrKfyM,EAAe,CACfC,YAAa,EACbC,OAAQ,UACRC,KAAM,UACNC,MAAO,GAyEIC,aApEX,SAAAA,IAA6D,IAAjDC,EAAiD9M,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,QAA1CE,EAAW6M,EAA+B/M,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,QAAvBE,EAAWiI,EAAYnI,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAAIK,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA8F,GACzD9F,KAAK+F,KAAOA,EACZ/F,KAAKgG,MAAQA,GAASP,EACtBzF,KAAKoB,MAAQA,sDAIb,IAAI6E,EAAQ,IAAIH,EAAM9F,KAAK+F,KAAM/F,KAAKgG,MAAOhG,KAAKoB,OAClD,OAAO9H,OAAO6L,OAAOc,EAAOjG,kCAI5B,OAAOA,KAAK+F,KAAK9D,aCgGViE,aA7GX,SAAAA,EAAYrB,GAAQvL,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAkG,GAGhBlG,KAAK6E,MAAQA,EACb7E,KAAK6C,OAAS,GACd7C,KAAKwD,KAAO,GACZxD,KAAKmG,MAAQ,GACbnG,KAAK4D,MAAQ,GACb5D,KAAKoG,WAAY,EACjBpG,KAAKqG,QAAS,EACdrG,KAAKsG,UAAW,sDAIhB,IAAIC,EAAQ,IAAIL,EAAMlG,KAAK6E,OAC3B,OAAOvL,OAAO6L,OAAOoB,EAAOvG,kCAG5B4C,GACA,GAAIA,aAAiBkD,EACjB9F,KAAK6C,OAAOjC,KAAKgC,OAEhB,CACD,IACI4D,EAAW,IAAIV,EADRlD,EACoB,GAAIA,EAAMxB,OACzCpB,KAAK6C,OAAOjC,KAAK4F,GAErB,OAAOxG,4CAGI6C,GAAQ,IAAAvC,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IACnB,QAAAsH,EAAAC,EAAkBmC,EAAlBvF,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA0B,KAAjBsC,EAAiBnC,EAAArF,MACtB4E,KAAKyG,IAAI7D,IAFM,MAAAjF,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAInB,OAAOR,6CAgBKmG,GACZ,IAAIC,GAAapG,KAAKoG,UACtB,OAAO9M,OAAO6L,OAAOnF,KAAKpE,QACtB,CACIwK,UAAYA,EACZD,MAAOA,wCAIPG,GAER,OADAtG,KAAKsG,SAAWA,EACTtG,uCAODqG,GACN,OAAO/M,OAAO6L,OAAOnF,KAAKpE,QACtB,CACIyK,OAASA,4CAIL7C,EAAKI,GACjB,OAAOtK,OAAO6L,OAAOnF,KAAKpE,QACtB,CACI4H,KAAOA,EACPI,MAAOA,EACPyC,QAAQ,uCAIT,IAAApJ,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IACP,QAAAiE,EAAAC,EAAiB2C,KAAK6C,OAAtBvF,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA8B,CAAAG,EAAAhC,MACpByK,MAAQ7F,KAAKoG,UAAY,EAAI,GAFhC,MAAAzI,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAIP,OAAO6C,KAAK6C,wCAaZ,MAAO,CACHW,KAAMxD,KAAKwD,KACXI,MAAO5D,KAAK4D,MACZf,OAAQ6D,KAAKC,UAAU3G,KAAK6C,OAAQ,KAAM,kCAlE9C,IAAIZ,EAAM,IAAIC,IADRlE,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAEN,QAAAgF,EAAAC,EAAkB4B,KAAK6C,OAAvBvF,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAA+B,KAAtB4E,EAAsBzE,EAAA/C,MAC3B6G,EAAMA,EAAI2E,MAAMhE,EAAMmD,gBAAgB7D,IAAMU,EAAMhH,QAAUgH,EAAMX,MAHhE,MAAAtE,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GAKN,OAAO+D,iCAIP,IAAIA,EAAMjC,KAAKiC,IACf,OAAO,IAAIf,KAAOe,EAAIJ,KAAOI,EAAI4E,MAAM,GAAI5E,EAAIH,KAAOG,EAAI6E,MAAM,YClDlEC,EAAS,CACX,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WA4FWC,wGAvFKnC,EAAOoC,GACnB,IAAIV,EAAQ,IAAIL,EAAMrB,GAOtB,OANA0B,EAAM/C,KAAOwD,EAAOE,WAAWD,GACT,IAAlBA,EAAO/N,SAEPqN,EAAMH,WAAY,EAClBG,EAAMD,UAAW,GAEdC,qCAOOU,GAId,IAHA,IAAIzD,EAAOwD,EAAOG,YACdC,EAAM,EACNC,EAAa,SAACd,GAAD,OAAWA,EAAM/C,OAASA,GACpCyD,EAAOK,KAAKD,IACf7D,EAAOwD,EAAOG,YAAcC,EAC5BA,IAEJ,OAAO5D,sCAGQyD,GACf,OAAOA,EAAOK,KAAK,SAACC,GAAD,OAASA,EAAIjB,+CAGjBW,EAAQV,GACvB,IAAIiB,EAAuBR,EAAOS,YAAYR,GAC1CO,IACAA,EAAqBlB,UAAW,GAEpCC,EAAMD,UAAW,uCAGDW,GAEhB,IADA,IAAId,EAAQ,GADYuB,EAAA,WAEnB,IAAIC,EAAGC,EAAAC,GACR,IAAKZ,EAAOK,KAAK,SAACf,GAAD,OACbA,EAAMH,WAAaG,EAAMJ,QAAUwB,IAEnC,OADAxB,EAAQwB,EACR,SAJRE,EAAA,EAAAD,EAAgBb,EAAhBc,EAAAD,EAAA1O,OAAA2O,IAAwB,cAAAH,IAIhB,MAGR,OAAOvB,iCAGGc,EAAQV,GAClB,IAAIuB,EAAQb,EAAO1B,UAAU,SAACwC,GAAD,OAAOA,IAAMxB,IACtCyB,EAAYf,EAAOgB,OAAO,SAAAF,GAAC,OAAIA,IAAMxB,IAQzC,OAPIuB,EAAQ,IACRE,EAAUF,EAAM,GAAGxB,UAAW,EACG,KAA7B0B,EAAUF,EAAM,GAAG3B,QACnB6B,EAAUF,EAAQ,GAAG3B,MAAQa,EAAOkB,aAAaF,IAErDA,EAAUF,EAAM,GAAG1B,WAAY,GAE5B4B,+BAMCf,GACR,IAAIe,EAAYf,EAAOpK,QAYvB,OAXAmL,EAAUG,KAAM,SAASC,EAAIC,GACzB,IAAIC,EAAQF,EAAG5E,KAAK+E,cAChBC,EAAQH,EAAG7E,KAAK+E,cACpB,OAAID,EAAQE,GACA,EAERF,EAAQE,EACD,EAEJ,IAEJR,iCAGGf,GACV,OAAOA,EAAOwB,IAAK,SAAAlC,GAAK,OAAIA,EAAMmC,+CAvElC,MAAO,iBCoHAzB,EA/JA,WAAwB,IAG/B0B,EAHQ3P,EAAuBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAf,GAAIG,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EAC/ByP,EAAgB5P,EAAMsO,KAAK,SAAAf,GAAK,OAAIA,EAAMD,WAC1CuC,EAAkB7P,EAAMuM,UAAU,SAAAgB,GAAK,OAAIA,EAAMD,WAGrD,OAAQlN,EAAOC,MACX,IRmCgC,2BQjC5B,OADAsP,EAAW3B,EAAO2B,SAASvP,EAAOyL,MAAO7L,GACzC,GAAA8P,OAAAxP,OAAAgD,EAAA,EAAAhD,CAAWN,GAAX,CAAkB2P,IAEtB,IRgCqB,gBQ/BjB,SAAAG,OAAAxP,OAAAgD,EAAA,EAAAhD,CAAWN,GAAX,CAAkBI,EAAOmN,QAE7B,IR8BmC,8BQ7B/B,OAAIqC,EACO5B,EAAO+B,OAAO/P,EAAO4P,GAGrB5P,EAGf,IRkEgC,2BQjE5B,MAAO,GAEX,IRoBkC,6BQnB9B,OAAOgO,EAAOmB,KAAKnP,GAEvB,IRoBoC,+BQnBhC,IAAImN,EAAQ,GACZ,IAAK/M,EAAOmN,MAAMH,WAEA,MADdD,EAAQa,EAAOkB,aAAalP,IACV,OAEtB,OAAOA,EAAMyP,IAAI,SAAClC,GACd,GAAIA,IAAUnN,EAAOmN,MAIjB,OAAInN,EAAOmN,MAAMH,UACNG,EAGAA,EAAMyC,aAAY,GAI7B,IAAIL,EAAWpC,EAAM0C,gBAAgB9C,GAErC,OADAwC,EAASrC,SAAWqC,EAASvC,UACtBuC,IAKnB,IRLmC,gCQM/B,OAAO3P,EAAMyP,IAAI,SAAClC,GACd,OAAIA,IAAUnN,EAAOmN,MACVA,EAAMyC,aAAY,GAGlBzC,EAAMyC,aAAazC,EAAMD,YAc5C,IRxBoC,+BQyBhC,OAAOtN,EAAMyP,IAAI,SAAClC,GACd,OAAIA,IAAUqC,EACHrC,EAGAA,EAAM2C,WAAU,KAInC,IRjCsC,iCQkClC,OAAOlQ,EAAMyP,IAAI,SAAClC,GACd,OAAIA,EAAMF,OACCE,EAAM4C,gBAAgB/P,EAAOuP,SAASnF,KAAMpK,EAAOuP,SAAS/E,OAG5D2C,IAInB,IR1CsC,iCQ2ClC,OAAOvN,EAAMyP,IAAI,SAAClC,GACd,OAAIA,EAAMF,OACCE,EAAM2C,WAAU,GAGhB3C,IAInB,IRlDsC,iCQmDlC,GAAIsC,IAAoB7P,EAAME,OAAS,EACnC,OAAOF,EAIP,IAAIoQ,EAAYpQ,EAAM6P,EAAkB,GAExC,OAAO7P,EAAMyP,IAAI,SAAAlC,GACb,GAAIA,IAAUqC,EAAe,CACzB,IAAIS,EAAc9C,EAAM0C,gBAAgB,IAExC,OADAI,EAAY/C,UAAW,EAChB+C,EAEN,GAAI9C,IAAU6C,EAAW,CAC1B,IAAIjD,EAAQyC,EAAczC,MACtBmD,EAAe/C,EAAM0C,gBAAgB9C,GAEzC,OADAmD,EAAahD,UAAW,EACjBgD,EAGP,OAAO/C,IAKvB,IR3EoC,+BQ4EhC,GAAwB,IAApBsC,EACA,OAAO7P,EAGP,IAAIoQ,EAAYpQ,EAAM6P,EAAkB,GAExC,OAAO7P,EAAMyP,IAAI,SAAAlC,GACb,GAAIA,IAAUqC,EAAe,CACzB,IAAIS,EAAc9C,EAAM0C,gBAAgB,IAExC,OADAI,EAAY/C,UAAW,EAChB+C,EAEN,GAAI9C,IAAU6C,EAAW,CAC1B,IAAIE,EAAe/C,EAAM0C,gBAAgBL,EAAczC,OAGvD,OAFAmD,EAAalD,WAAY,EACzBkD,EAAahD,UAAW,EACjBgD,EAGP,OAAO/C,IAKvB,QACI,OAAOvN,IC5JbuQ,EAAoB,CACtBtK,EAAG,EACHC,EAAG,EACHsK,YAAQrQ,EACRsQ,YAAQtQ,EACRuQ,iBAAavQ,GAmDFwQ,EAhDD,WAAuC,IAAtC3Q,EAAsCC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAA9BsQ,EAAmBnQ,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EACjD,OAAQC,EAAOC,MACX,ITc4B,uBSbxB,OAAOC,OAAO6L,OAAO,GAAInM,EAAO,CAC5BiG,EAAG7F,EAAO6F,EACVC,EAAG9F,EAAO8F,IAElB,ITU2B,sBSTvB,OAAO5F,OAAO6L,OAAO,GAAInM,EAAO,CAC5BwQ,OAAQpQ,EAAO6F,EACfwK,OAAQrQ,EAAO8F,IAEvB,ITMyB,oBSLrB,OAAO5F,OAAO6L,OAAO,GAAInM,EAAO,CAC5BwQ,YAAQrQ,EACRsQ,YAAQtQ,IAGhB,ITO2B,sBSNvB,OAAOG,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEI0Q,YAAa,CACT,CAACzK,EAAG7F,EAAOwQ,GAAI1K,EAAG9F,EAAOyQ,IACzB,CAAC5K,EAAG7F,EAAO0Q,GAAI5K,EAAG9F,EAAO2Q,OAarC,ITTyB,oBSUrB,OAAOzQ,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEI0Q,iBAAavQ,IAIrB,QACI,OAAOH,WCnDbgR,EAA2B,CAC7BC,qBAAqB,EACrBC,yBAAyB,EACzBC,aAAc,KACdC,mBAAoB,KACpBC,oBAAqB,KACrBC,mBAAoB,KACpBC,oBAAqB,KACrBC,cAAUrR,EACVsR,gBAAiB,MAGfC,EAAYrS,OAAOsS,cAuGVC,EArGW,WAA8C,IAA7C5R,EAA6CC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAArC+Q,EAA0B5Q,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EACpE,OAAQC,EAAOC,MACX,IVJqC,gCUKjC,OAAOC,OAAO6L,OAAO,GAAI6E,EAA0B,CAC/CC,qBAAqB,IAE7B,IVbkC,6BUgBlC,IVZqC,gCUajC,OAAO3Q,OAAO6L,OAAO,GAAI6E,GAE7B,IVE6B,wBUDzB,OAAO1Q,OAAO6L,OAAO,GAAInM,EAAO,CAC5BmR,aAAcnR,EAAMiR,oBAAsB7Q,EAAOwJ,MAAQ,OAEjE,IVD4B,uBUExB,OAAOtJ,OAAO6L,OAAO,GAAInM,EAAO,CAC5BmR,aAAc,OAEtB,IVJ8B,yBUK1B,IAAKnR,EAAMiR,oBACP,OAAOjR,EAIX,GAAIA,EAAMkR,wBACN,OAAO5Q,OAAO6L,OAAO,GAAInM,EAAO,CAC5BoR,mBAAoBhR,EAAOwJ,MAC3B0H,mBAAoBlR,EAAOmN,MAC3B8D,oBAAqB,KACrBE,oBAAqB,KACrBL,yBAAyB,EACzBM,cAAUrR,EACVsR,gBAAiB,OAIrB,GAAIrR,EAAOwJ,QAAU5J,EAAMoR,mBACvB,OAAOpR,EAGX,IAEIwR,EAAUC,EAFVI,EAAS7R,EAAMoR,mBAAmBrE,KAClC+E,EAAS1R,EAAOwJ,MAAMmD,KANzBgF,EAY6BxQ,IAAQyQ,SAASR,SAASK,EAAQC,GAZ/DG,EAAA3R,OAAA4R,EAAA,EAAA5R,CAAAyR,EAAA,GAgBD,OAJCP,EAZAS,EAAA,GAYUR,EAZVQ,EAAA,GAgBM3R,OAAO6L,OAAO,GAAInM,EAAO,CAC5BqR,oBAAqBjR,EAAOwJ,MAC5B2H,oBAAqBnR,EAAOmN,MAC5B2D,yBAAyB,EACzBM,SAAUA,EACVC,gBAAiBA,IAG7B,IVnD2B,sBUoDvB,OAAIzR,EAAMmR,cAAgBO,EACf1R,EAGAM,OAAO6L,OAAO,GAAInM,EAAO,CAC5BkR,yBAAyB,EACzBE,mBAAoB,KACpBE,mBAAoB,KACpBD,oBAAqB,KACrBE,oBAAqB,KACrBC,cAAUrR,EACVsR,gBAAiB,OAI7B,IVhDmC,8BUiD/B,OAAIrR,EAAOmN,QAAUvN,EAAMsR,oBACvBlR,EAAOmN,QAAUvN,EAAMuR,oBAChBjR,OAAO6L,OAAO,GAAI6E,GAGlBhR,EAGf,IVrDoC,+BUsDhC,OAAII,EAAOmN,MAAMH,WACZhN,EAAOmN,QAAUvN,EAAMsR,oBACpBlR,EAAOmN,QAAUvN,EAAMuR,oBAIpBvR,EAHAM,OAAO6L,OAAO,GAAI6E,GAMjC,QACI,OAAOhR,6VChHnB,IAAMmS,EAAuB,CACzBC,QAAIjS,EACJqK,KAAM,GACN6H,MAAO,WACPC,iBAAanS,GAGXoS,EAA2B,CAC7BC,SAAUL,EACVM,cAAe,IAkBnB,IA2EeC,EA3EM,WAA8C,IAA7C1S,EAA6CC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAArCsS,EAA0BnS,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EAC/D,OAAQC,EAAOC,MACX,IXoDgD,2CWzChD,IX2CoD,+CW1ChD,OAAOC,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAAU,CACNJ,GAAIhS,EAAOgS,GACX5H,KAAMpK,EAAOoK,KACb6H,MAAOjS,EAAOiS,MACdC,YAAalS,EAAOkS,eAIhC,IX+BmD,8CW9B/C,OAAOhS,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAASlS,OAAAC,EAAA,EAAAD,CAAA,GACFN,EAAMwS,SADL,CAEJF,YAAalS,EAAOkS,gBAIhC,IX2B6B,wBW1BzB,OAAOhS,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAASlS,OAAAC,EAAA,EAAAD,CAAA,GACFN,EAAMwS,SADL,CAEJhI,KAAMpK,EAAOoK,SAIzB,IXgB6C,wCWhB7C,IAAAmI,EACgD3S,EAAMyS,cADtDG,EACWxS,EAAOgS,GAAkBS,GADpCF,EAAAC,GAAAtS,OAAAwS,EAAA,EAAAxS,CAAAqS,EAAA,CAAAC,GAAAnD,IAAAsD,KAEI,OAAOzS,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAAUxS,EAAMwS,SAASJ,KAAOhS,EAAOgS,GAAKD,EAAuBnS,EAAMwS,SACzEC,cAAeI,IAGvB,IXSmC,8BWR/B,OAAOvS,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAAUpS,EAAOoS,WAGzB,IXKgC,2BWJ5B,OAAOlS,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIwS,SAAUL,IAGlB,IXLqD,gDWMjD,OA9EZ,SAAoBa,EAAoBC,GACpC,GAA4B,OAAxBA,QAAwD9S,IAAxB8S,EAChC,OAAO,EAEX,GAAI3S,OAAO4S,KAAKF,GAAoB9S,SAAWI,OAAO4S,KAAKD,GAAqB/S,OAC5E,OAAO,EACX,IAAK,IAAIgH,KAAO8L,EACZ,IAAMC,EAAoBE,eAAejM,IAAS8L,EAAmB9L,GAAKoL,cAAgBW,EAAoB/L,GAAKoL,YAC/G,OAAO,EAIf,OAAO,EAkEQc,CAAWpT,EAAMyS,cAAerS,EAAOqS,eAC1CzS,EADGM,OAAAC,EAAA,EAAAD,CAAA,GAGAN,EAHA,CAIHyS,cAAerS,EAAOqS,gBAG9B,QACI,OAAOzS,IClGbqT,EAAe,CACjBC,eAAgB,EAChBC,iBAAiB,EACjBC,cAAe,IAmBJC,EAhBA,WAAgC,IAA/BzT,EAA+BC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAzBoT,EAAcjT,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EAC3C,OAAQC,EAAOC,MACX,IZqD+B,0BYpD3B,OAAOgT,EAEX,IZiD8B,yBYhD1B,OAAO/S,OAAAC,EAAA,EAAAD,CAAA,GACAN,EADP,CAEIuT,iBAAiB,EACjBC,cAAepT,EAAOoT,gBAE9B,QACI,OAAOxT,ICIJ0T,GAVCC,YAAgB,CAC5B5T,OACAmM,MACA+B,SACAwF,SACAf,eACAd,oBACAjB,UCVWiD,GATH,SAAAC,KAAGC,SAAHD,EAAaE,SAAb,OAA4B,SAAAvP,GAAI,OAAI,SAAApE,GdwBZ,yBctB7BA,EAAOC,MACN2T,QAAQJ,IAAI,WAAaxT,EAAOC,KAAMD,GAG1CoE,EAAKpE,MCNI6T,GAAb,WACI,SAAAA,IAAe3T,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAiN,GACXjN,KAAKkN,SAAW,GAChBlN,KAAK4D,MAAQ,GACb5D,KAAKmN,SAAW,GAChBnN,KAAKoN,UAAY,GACjBpN,KAAK6C,OAAS,GANtB,OAAAvJ,OAAA2G,EAAA,EAAA3G,CAAA2T,EAAA,EAAA/M,IAAA,MAAAmN,IAAA,WAUQ,IAAIC,EAAI,IAAIpL,IADN5B,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAEN,QAAAsH,EAAAC,EAAkBV,KAAKmN,SAAvB7P,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAiC,KAAxBsC,EAAwBnC,EAAArF,MAC7BkS,EAAE1G,MAAMhE,EAAMX,MAHZ,MAAAtE,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAAA,IAAAvD,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAKN,QAAAiE,EAAAC,EAAkB2C,KAAKoN,UAAvB9P,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAkC,KAAzB2F,EAAyBxF,EAAAhC,MAC9BkS,EAAE1G,MAAMhE,EAAMX,MANZ,MAAAtE,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAAA,IAAAa,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAQN,QAAAgF,EAAAC,EAAkB4B,KAAK6C,OAAvBvF,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAA+B,KAAtB4E,EAAsBzE,EAAA/C,MAC3BkS,EAAE1G,MAAMhE,EAAMX,MATZ,MAAAtE,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GAWN,OAAOoP,MApBfL,EAAA,GC4DA,SAASM,GAAeC,GACpB,MAAuB,YAAnBA,EAAUhK,KACH,IAAIjJ,IAAQ6B,QAAQoR,GAGR,QAAnBA,EAAUhK,KACH,IAAIjJ,IAAQD,IAAIkT,GAGJ,UAAnBA,EAAUhK,KACH,IAAIjJ,IAAQ2G,MAAMsM,QAD7B,EAKG,SAASC,KAA4B,IAKpCC,EALkBR,EAAkBjU,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAT,GAAIkH,EAAKlH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EACpCwU,EAAM,IAAIV,GAEdU,EAAIT,SAAWA,EAIf,IACIQ,EAAYhH,KAAKkH,MAAMzN,GACzB,MAAO0N,GACL,MAAM,IAAIC,MAAM,uBAGpB,GAAIJ,aAAqBK,MACrB,IACI,IAAItS,EAAU,IAAIlB,IAAQmB,QAD1B4E,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAEA,QAAAsH,EAAAC,EAAsBgN,EAAtBpQ,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAiC,KAAxB0N,EAAwBvN,EAAArF,MAC7BK,EAAQY,QAAQ2R,IAHpB,MAAArQ,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAKAmN,EAAI9K,OAAOjC,KAAKnF,GAEpB,MAAOoS,GAAG,IAAA5Q,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IACN,QAAAiE,EAAAC,EAAsBqQ,EAAtBpQ,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAiC,KAAxBuQ,EAAwBpQ,EAAAhC,MAC7BuS,EAAI9K,OAAOjC,KAAM2M,GAAeC,KAF9B,MAAA7P,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,SAOVwQ,EAAI9K,OAAOjC,KAAM2M,GAAeG,IAGpC,OAAOC,EArGXpT,IAAQ0T,MAAR,WACI,SAAAA,IAAe3U,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAiO,GACXjO,KAAKkO,IAAM,GAKXlO,KAAKvG,OAAS,IAAIc,IAAQ2G,MAI1BlB,KAAK+B,MAAQ,EAIb/B,KAAKgC,OAAS,EAftB,OAAA1I,OAAA2G,EAAA,EAAA3G,CAAA2U,EAAA,EAAA/N,IAAA,MAAAmN,IAAA,WAkBQ,OAAO,IAAI9S,IAAQ2H,IACflC,KAAKvG,OAAOwF,EAAIe,KAAK+B,MAAM,EAC3B/B,KAAKvG,OAAOyF,EAAIc,KAAKgC,OAAO,EAC5BhC,KAAKvG,OAAOwF,EAAIe,KAAKgC,OAAO,EAC5BhC,KAAKvG,OAAOyF,EAAIc,KAAKgC,OAAO,OAtBxCiM,EAAA,GCFA,IAgEeE,GAhEG,SAAAtB,GAAA,IAAGE,EAAHF,EAAGE,SAAUD,EAAbD,EAAaC,SAAb,OAA4B,SAAAtP,GAAI,OAAI,SAAApE,GAElD,GjB0DmC,4BiB1D/BA,EAAOC,KACP,OAAOmE,EAAKpE,GAGhB,IAAIJ,EAAQ8T,IACRjI,EAAQ7L,EAAMkM,IAAIL,MAClBoC,EAASjO,EAAMiO,OACfhD,EAASjL,EAAMkM,IAAIjB,OAEnBsC,OAAQpN,EACRH,EAAMkM,IAAIR,sBACV6B,EAAQS,EAAO2B,SAAS9D,EAAOoC,GAC/BA,EAAOrG,KAAK2F,KAGZA,EAAQU,EAAOK,KAAK,SAACC,GAAD,OAASA,EAAIjB,cAE7BC,EAAQS,EAAO2B,SAAS9D,EAAOoC,GAC/BA,EAAOrG,KAAK2F,IApBwC,IAAAjG,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAyB5D,QAAAsH,EAAAC,EAAiBtH,EAAOgV,KAAKC,MAA7B/Q,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAoC,CAAAG,EAAArF,MAC3BkT,YAAY,SAACC,GACd,IAAIC,EAEJ,IAEIA,EADUf,GAAU,GAAGc,GACL1L,OACpB,MAAOgL,GACLb,QAAQJ,IAAIiB,EAAEY,SACdD,EAAcvK,EAAO2J,MAAMW,GAK/B,GAAIC,EAAYtV,OAAS,EAAG,KAAA+D,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IACxB,QAAAiE,EAAAC,EAAkBmR,EAAlBlR,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA+B,KAAtB2F,EAAsBxF,EAAAhC,MAC3BmL,EAAME,IAAI7D,IAFU,MAAAjF,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,IAMxBoJ,EAAM1D,OAAO3J,OAAS,IACtB6T,EAAS,CACL1T,KjBViB,wBiBWjBuJ,MAAO2D,EACP1B,MAAOA,IAEXkI,EAAS,CACL1T,KjBNwB,+BiBOxBkN,MAAOA,OAMnB,OA3DwD,MAAA5I,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,OCyEjDkO,GA3ES,SAAA7B,GAAA,IAAEC,EAAFD,EAAEC,SAAFD,EAAYE,SAAZ,OAA0B,SAAAvP,GAAI,OAAI,SAAApE,GAEtD,IAAMuQ,EAAQmD,IAAWnD,MACrB9E,EAAQzL,EAAOyL,MAGnB,GAAIA,EACA,OAAQzL,EAAOC,MACX,IlBNiB,gBkBObwL,EAAM8J,SACN,MAEJ,IlBauB,sBkBZnB9J,EAAM+J,kBACN,MAEJ,IlBQwB,4BkBPFzV,IAAdC,EAAOyV,SAAkC1V,IAAdC,EAAO0V,IAClCjK,EAAMkK,eAAe3V,EAAOyV,GAAIzV,EAAO0V,IAE3C,MAEJ,IlBIqB,oBkBHjBjK,EAAMmK,iBACN,MAEJ,IlBayB,wBkBZrB,IAAIvV,EAASL,EAAOwJ,MAAMnJ,OACtBwI,EAAM7I,EAAOwJ,MAAMX,IACvB,GAAIgN,MAAMxV,EAAOwF,IAAMgQ,MAAMxV,EAAOyF,GAAI,OACxC2F,EAAMqK,gBAAgBzV,EAAOwF,EAAGxF,EAAOyF,GACvC2F,EAAMsK,aAAalN,EAAI4E,KAAO5E,EAAIJ,KAAMI,EAAI6E,KAAO7E,EAAIH,MACvD,MAEJ,IlBP6B,4BkBQzB,IAAIsN,EAAMhW,EAAOiW,MAAQ,EAEzBxK,EAAMyK,YAAYlW,EAAO6F,EAAG7F,EAAO8F,EAAGkQ,EAAK,KAC3C,MAEJ,IlBpCa,YkBqCTvK,EAAM0K,oBACN1K,EAAM2K,qBACN,MAEJ,IlBZuB,sBkBanB3K,EAAM4K,iBAAiBrW,EAAOwQ,GAAIxQ,EAAOyQ,IACzC,MAEJ,IlBfwB,uBkBgBpB,GAAIF,EAAMD,YAAa,CACnB,IAAImF,EAAKlF,EAAMD,YAAY,GAAGzK,EAAI0K,EAAMD,YAAY,GAAGzK,EACnD6P,EAAKnF,EAAMD,YAAY,GAAGxK,EAAIyK,EAAMD,YAAY,GAAGxK,EACnDwQ,EAAYvV,KAAKwV,KAAKd,EAAGA,EAAKC,EAAGA,GAErCD,EAAKzV,EAAO0Q,GAAK1Q,EAAOwQ,GACxBkF,EAAK1V,EAAO2Q,GAAK3Q,EAAOyQ,GACxB,IACI+F,EADczV,KAAKwV,KAAKd,EAAGA,EAAKC,EAAGA,GACbY,EAC1B7K,EAAMgL,gBAAgBzW,EAAOwQ,GAAIxQ,EAAOyQ,GAAI+F,GAEhD,MAEJ,IlB5BqB,oBkB6BjB/K,EAAMiL,kBAQlBtS,EAAKpE,MCtEL2W,GAAc1X,OAAO0X,YAqEVC,GA3Dc,SAAAnD,GAAA,IAAEE,EAAFF,EAAEE,SAAUD,EAAZD,EAAYC,SAAZ,OAA0B,SAAAtP,GAAI,OAAI,SAAApE,GAE3D,GnB6D6C,wCmB7DzCA,EAAOC,KAA0D,CAEjE,IAAIL,EAAQ8T,IACRjI,EAAQ7L,EAAMkM,IAAIL,MAElBoC,EAASjO,EAAMiO,OACfgJ,EAAejJ,EAAOS,YAAYR,GAElCiJ,EADSD,EAAapN,OACP4F,IAAI,SAAA7F,GAAK,MACxB,CAACA,EAAMmD,KAAK9G,EAAI,IAAM2D,EAAMmD,KAAK7G,EAAI,IAAM0D,EAAMmD,KAAKoK,GAAIvN,EAAMmD,KAAKqK,MAG5DL,GAAYM,OAAO,gCAGzBC,KAFS,gCAGXC,KAAKL,GACLM,KAAK,SAAUC,GACZ,GAAIA,EAAO5X,MAAO,OAAOmU,QAAQnU,MAAM,UAAY4X,EAAO5X,OAE1D,IAAI8P,EAAW3B,EAAO2B,SAAS9D,EAAOoC,GACtC0B,EAASnF,KAAO,aAChBmF,EAAS/E,MAAQ,aALG,IAAAtD,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAQpB,QAAAsH,EAAAC,EAAgB+P,EAAOC,OAAvBpT,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA+B,KAAtBqQ,EAAsBlQ,EAAArF,MACvBwH,OAAK,EACT,GAAI+N,EAAI,aAAc5C,OAA2B,IAAlB4C,EAAI,GAAGzX,OAAc,CAChD,IAAI+C,EAAKgF,YAAkB,IAAZ0P,EAAI,GAAG,GAAsB,IAAZA,EAAI,GAAG,IACnCtW,EAAa,IAATsW,EAAI,GAEZ/N,EAAQzH,YAAIc,EAAI5B,EAAGsW,EAAI,GAAIA,EAAI,GAAIpW,IAAQ4B,UAG3CyG,EAAQT,YACJlB,YAAe,IAAT0P,EAAI,GAAmB,IAATA,EAAI,IACxB1P,YAAe,IAAT0P,EAAI,GAAmB,IAATA,EAAI,KAE5BA,EAAI,KACJ/N,EAAMxB,MAAQuP,EAAI,IAEtBhI,EAASlC,IAAI7D,IAxBG,MAAAjF,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GA0BpByG,EAAOrG,KAAK+H,GAEZoE,EAAS,CACL1T,KnBrBiB,wBmBsBjBwL,MAAOA,EACPjC,MAAOqN,MAKvB,OAAOzS,EAAKpE,2DC/DDwX,GAJEC,KAAMC,OAAO,CAC1BC,QAAS,yCC0EAC,GAAc,SAACnM,EAAOjC,GAC/B,MAAO,CACHvJ,KrBtC6B,wBqBuC7BwL,QACAjC,UCxEKqO,GAAc,SAAC1K,GACxB,MAAO,CACHlN,KtBkCqB,gBsBjCrBkN,UAgBK2K,GAAqB,SAAC3K,GAC/B,MAAO,CACHlN,KtBoBoC,+BsBnBpCkN,UCrBKW,GAAa,SAACiK,GAIvB,IAHA,IAAI3N,EAHY,WAIZ4D,EAAM,EACNC,EAAa,SAACmE,GAAD,OAAcA,EAAShI,OAASA,GAC1ClK,OAAO8X,OAAOD,GAAW7J,KAAKD,IACjC7D,EAPY,WAOS4D,EACrBA,IAEJ,OAAO5D,2CCYI6N,GA1BA,SAACC,GACZ,IAAIC,EACJ,OAAQD,EAAMjY,MACV,IAAK,UACDkY,EAAYC,KAAQC,YACpB,MACJ,IAAK,OACDF,EAAYD,EAAMI,OAASF,KAAQG,eAAiBH,KAAQI,kBAC5D,MACJ,QACIL,EAAYC,KAAQC,YAI5B,IAAII,EAAcP,EAAMQ,WAAaN,KAAO,aAA4BA,KAAO,OAC/E,OACIO,EAAAC,EAAAC,cAAA,UAAQrO,MAAO0N,EAAM1N,MAAOsO,QAASZ,EAAMY,QAASC,UAAWN,GAC3DE,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAM8N,EAAMe,SACZjP,KAAK,KACL+O,UAAWZ,0BCRZe,GAZS,WACpB,OACIP,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQe,iBACpBR,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAK,aACLJ,KAAK,KACL+O,UAAWX,KAAQgB,sCC8FpBC,8LAzFP,OACIV,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQ,gBAEpBO,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,eAAeyO,SAAS,cAC7CH,QAASlS,KAAKsR,MAAMqB,2BAQ5BZ,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,mBAAmByO,SAAS,cAAcH,QAASlS,KAAKsR,MAAMsB,2BAM3Fb,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,oBAAoByO,SAAS,QAClDH,QAASlS,KAAKsR,MAAMuB,0BAG5Bd,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,kBAAkByO,SAAS,gBAChDH,QAASlS,KAAKsR,MAAMwB,6BAG5Bf,EAAAC,EAAAC,cAACM,GAAD,MAEAR,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,4BAA4ByO,SAAS,OAC1DH,QAASlS,KAAKsR,MAAMyB,sBAG5BhB,EAAAC,EAAAC,cAACM,GAAD,MAEAR,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,OAAOuK,MAAM,cAAcyO,SAAS,aACzCX,QAAS1R,KAAKsR,MAAMjN,oBACpB6N,QAASlS,KAAKsR,MAAM0B,qBAG5BjB,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,OAAOuK,MAAM,kCAAkCyO,SAAS,mBAC7DX,OAAQ1R,KAAKsR,MAAMjN,oBACnB6N,QAASlS,KAAKsR,MAAM2B,+BAG5BlB,EAAAC,EAAAC,cAACM,GAAD,MAEAR,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,2CAA2CyO,SAAS,QACzEH,QAASlS,KAAKsR,MAAM4B,sCAG5BnB,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,wBAAwByO,SAAS,YACtDH,QAASlS,KAAKsR,MAAM6B,2BAG5BpB,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,0BAA0ByO,SAAS,eACxDH,QAASlS,KAAKsR,MAAM8B,0BAG5BrB,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,wBAAwByO,SAAS,MACtDH,QAASlS,KAAKsR,MAAM+B,wBAG3BrT,KAAKsR,MAAM3M,8BACRoN,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,4BAA4ByO,SAAS,OAC1DH,QAASlS,KAAKsR,MAAMgC,qCAE5B,KAEJvB,EAAAC,EAAAC,cAACM,GAAD,MAEAR,EAAAC,EAAAC,cAAA,UAAQE,UAAWX,KAAQ,qBACnBU,QAASlS,KAAKsR,MAAMiC,eAEvBvT,KAAKsR,MAAMtN,OAGhB+N,EAAAC,EAAAC,cAACM,GAAD,MAEAR,EAAAC,EAAAC,cAACS,GAAD,CAAQrZ,KAAK,UAAUuK,MAAM,QAAQyO,SAAS,OACtCH,QAASlS,KAAKsR,MAAMkC,0BAG5BzB,EAAAC,EAAAC,cAACM,GAAD,cAtFekB,oDC0MhBC,eA9MX,SAAAA,EAAYC,GAAQ,IAAAC,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA0T,GAChBE,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAAoa,GAAAK,KAAA/T,KAAM2T,IAENK,KAAMC,OAAN3a,OAAA4a,GAAA,EAAA5a,CAAAsa,IACAA,EAAKO,kBAAmB,EAExBP,EAAKQ,gBAAgB,IAEjBR,EAAKD,OAAOU,YAAc,GAAKT,EAAKD,OAAOW,aAAe,IAC1DV,EAAKD,OAAO5R,MAAQ6R,EAAKD,OAAOU,YAChCT,EAAKD,OAAO3R,OAAS4R,EAAKD,OAAOW,cAGrCV,EAAKvO,OAAS,CAACpG,EAAG2U,EAAKD,OAAO5R,MAAQ,EAAG7C,EAAG0U,EAAKD,OAAO3R,OAAS,GACjE4R,EAAKxO,WAAa,KAClBwO,EAAKtP,WAAa,EAElBsP,EAAKW,UAAY,CAACtV,OAAG9F,EAAW+F,OAAG/F,GAEnCya,EAAKY,mBAAgBrb,EACrBya,EAAKa,kBAAetb,EACpBya,EAAKc,kBAAevb,EACpBya,EAAKe,cAAe,EAtBJf,wEAmChB,IAAI/O,EAAQ,IAAI6O,EAAM1T,KAAK2T,QAC3B,OAAOra,OAAO6L,OAAON,EAAO7E,kCAG5B4C,GAEA,OADA5C,KAAK4U,SAAShS,GACP5C,6CAIP,OAAOA,KAAKoF,WAAapF,KAAKsE,8CAGvBuQ,GACP,OAAQA,EAAS7U,KAAK8U,mDAGfD,GACP,OAAQ7U,KAAK8U,gBAAkBD,gCAG7BE,GACF,OAASA,EAAU/U,KAAKqF,OAAOpG,GAAKe,KAAK8U,8CAGvCE,GACF,OAAShV,KAAKqF,OAAOnG,EAAI8V,GAAWhV,KAAK8U,8CAGvCG,GACF,OAAQjV,KAAK8U,gBAAkBG,EAASjV,KAAKqF,OAAOpG,gCAGlDiW,GACF,OAAQlV,KAAKqF,OAAOnG,EAAIc,KAAK8U,gBAAkBI,8BAG/CjU,GACA,MAAO,CAAChC,EAAGe,KAAKmV,MAAMlU,EAAMhC,GAAIC,EAAGc,KAAKoV,MAAMnU,EAAM/B,kCAGlDmW,GACFrV,KAAKqF,OAAS,CAACpG,EAAGoW,EAAUpW,EAAGC,EAAGmW,EAAUnW,iCAG1CoW,EAAQC,GACVvV,KAAKqF,OAAS,CACVpG,EAAGe,KAAKqF,OAAOpG,EAAIqW,EACnBpW,EAAGc,KAAKqF,OAAOnG,EAAIqW,kCAKpB3F,GACH,IAAI4F,EAAW5F,GAAS,IACxB5P,KAAKsE,WAAanK,KAAKsb,IAAI,IAAUD,EAAWxV,KAAKsE,4CAGjDsL,GACJ,IAAI4F,EAAW5F,GAAS,IACxB5P,KAAKsE,WAAanK,KAAKub,IAAI,KAAO1V,KAAKsE,WAAakR,gCAInDG,EAAQC,EAAQxG,EAAKQ,GACtB,IAAIqF,EAASjV,KAAK6V,MAAMF,GACpBT,EAASlV,KAAK8V,MAAMF,GAExBxG,EAAMpP,KAAK+V,OAAOnG,GAAS5P,KAAKgW,QAAQpG,GAExC,IAAIqG,EAAYjW,KAAKmV,MAAMF,GACvBiB,EAAYlW,KAAKoV,MAAMF,GAI3B,OAFAlV,KAAKmW,MAAMR,EAASM,EAAWL,EAASM,GAEjC,CAACD,EAAWC,uCAGXP,EAAQC,EAAQxG,EAAKQ,GAC7B5P,KAAKoW,KAAKT,EAAQC,EAAQxG,EAAKQ,wCAGtB7N,EAAOC,GAEF,IAAVD,IAAaA,EAAQ,KACV,IAAXC,IAAcA,EAAS,KAC3B,IAEI4N,EAFazV,KAAKsb,IAAIzV,KAAK2T,OAAO5R,OAAS,IAAIA,GAAQ/B,KAAK2T,OAAO3R,QAAU,IAAIA,IACvDhC,KAAKoF,WACVpF,KAAKsE,WAG1BqR,EAAS3V,KAAK2T,OAAO5R,MAAM,EAC3B6T,EAAS5V,KAAK2T,OAAO3R,OAAO,EAChChC,KAAKoW,KAAKT,EAAQC,GAJR,EAIqBhG,oCAM3B5P,KAAK2T,OAAOU,YAAc,GAAKrU,KAAK2T,OAAOW,aAAe,IAC1DtU,KAAK2T,OAAO5R,MAAQ/B,KAAK2T,OAAOU,YAChCrU,KAAK2T,OAAO3R,OAAShC,KAAK2T,OAAOW,wDAYrCtU,KAAKuU,UAAUtV,EAAIe,KAAKqF,OAAOpG,EAC/Be,KAAKuU,UAAUrV,EAAIc,KAAKqF,OAAOnG,EAC/Bc,KAAK8P,yDAGMjB,EAAIC,GACX9O,KAAK2U,mBACExb,IAAP0V,QAA2B1V,IAAP2V,QACC3V,IAArB6G,KAAKuU,UAAUtV,QAAwC9F,IAArB6G,KAAKuU,UAAUrV,IACjDc,KAAKqF,OAAS,CACNpG,EAAGe,KAAKuU,UAAUtV,EAAI4P,EACtB3P,EAAGc,KAAKuU,UAAUrV,EAAI4P,6CAMlC9O,KAAKuU,UAAUtV,OAAI9F,EACnB6G,KAAKuU,UAAUrV,OAAI/F,0CAGP8F,EAAGC,GACf,IAAI6V,EAAU/U,KAAKmV,MAAMlW,GACrB+V,EAAUhV,KAAKoV,MAAMlW,GAErB2P,EAAK7O,KAAK2T,OAAO5R,MAAQ,EAAIgT,EAC7BjG,EAAK9O,KAAK2T,OAAO3R,OAAS,EAAIgT,EAClChV,KAAKmW,MAAMtH,EAAIC,4CAGFiG,EAASC,GACtBhV,KAAKwU,cAAgBxU,KAAKsE,WAC1BtE,KAAKyU,aAAezU,KAAK6V,MAAMd,GAC/B/U,KAAK0U,aAAe1U,KAAK8V,MAAMd,GAC/BhV,KAAK2U,cAAe,EACpB3U,KAAKgP,yDAGO+F,EAASC,EAASpF,GAC9B5P,KAAKsE,WAAasL,EAAQ5P,KAAKwU,cAC/BxU,KAAKqF,OAAS,CACVpG,EAAG8V,EAAU/U,KAAK8U,gBAAkB9U,KAAKyU,aACzCvV,EAAG8V,EAAUhV,KAAK8U,gBAAkB9U,KAAK0U,wDAK7C1U,KAAKwU,mBAAgBrb,EACrB6G,KAAKyU,kBAAetb,EACpB6G,KAAK0U,kBAAevb,EACpB6G,KAAK2U,cAAe,kCAIpB3U,KAAK2T,OAAO0C,WAAW,MAAMC,UAAU,EAAG,EAAGtW,KAAK2T,OAAO5R,MAAO/B,KAAK2T,OAAO3R,oCAhL5E,IAAIuU,EAAOvW,KAAK6V,MAAM,GAClBW,EAAOxW,KAAK8V,MAAM9V,KAAK2T,OAAO3R,QAC9ByU,EAAOzW,KAAK6V,MAAM7V,KAAK2T,OAAO5R,OAC9B2U,EAAO1W,KAAK8V,MAAM,GAEtB,OAAS,IAAI5T,IAAIqU,EAAMC,EAAMC,EAAMC,UAhCvBC,MCgCPC,GAAuB,SAAC/R,EAAO5F,EAAGC,EAAGmQ,GAC9C,MAAO,CACHhW,K5BXiC,4B4BYjCwL,MAAOA,EACP5F,EAAGA,EACHC,EAAGA,EACHmQ,MAAOA,ICjCTwH,gNACFC,cAAgBC,IAAMC,cAEtBC,gBAAkB,SAACC,GAEf,GADAtD,EAAKtC,MAAMzM,MAAM8O,OAAOwD,QACnBD,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,QASvD,GAAIge,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,OAAc,CAC1E,IAAIwQ,EAAc,CACd,CACIzK,EAAGiY,EAAME,YAAYC,QAAQ,GAAGC,QAAUJ,EAAME,YAAYG,OAAOC,WACnEtY,EAAGgY,EAAME,YAAYC,QAAQ,GAAGI,QAAUP,EAAME,YAAYG,OAAOG,WAEvE,CACIzY,EAAGiY,EAAME,YAAYC,QAAQ,GAAGC,QAAUJ,EAAME,YAAYG,OAAOC,WACnEtY,EAAGgY,EAAME,YAAYC,QAAQ,GAAGI,QAAUP,EAAME,YAAYG,OAAOG,YAG3E9D,EAAKtC,MAAMqG,gBAAgB/D,EAAKtC,MAAMzM,MAAO6E,SAnB7CkK,EAAKtC,MAAM2F,gBACPrD,EAAKtC,MAAMzM,MACXqS,EAAMU,OACNV,EAAMW,OACNjE,EAAKtC,MAAM3H,MAAMH,OAAS0N,EAAMU,OAAShE,EAAKtC,MAAM3H,MAAMH,YAASrQ,EACnEya,EAAKtC,MAAM3H,MAAMF,OAASyN,EAAMW,OAASjE,EAAKtC,MAAM3H,MAAMF,YAAStQ,MA+B/E2e,gBAAkB,SAACZ,GAEf,GAAKA,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,QAGvD,GAAIge,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,OAAc,CAC1E,IAAIwQ,EAAc,CACd,CACIzK,EAAGiY,EAAME,YAAYC,QAAQ,GAAGC,QAAUJ,EAAME,YAAYG,OAAOC,WACnEtY,EAAGgY,EAAME,YAAYC,QAAQ,GAAGI,QAAUP,EAAME,YAAYG,OAAOG,WAEvE,CACIzY,EAAGiY,EAAME,YAAYC,QAAQ,GAAGC,QAAUJ,EAAME,YAAYG,OAAOC,WACnEtY,EAAGgY,EAAME,YAAYC,QAAQ,GAAGI,QAAUP,EAAME,YAAYG,OAAOG,YAG3E9D,EAAKtC,MAAMyG,gBAAgBnE,EAAKtC,MAAMzM,MAAO6E,SAb7CkK,EAAKtC,MAAMwG,gBAAgBlE,EAAKtC,MAAMzM,MAAOqS,EAAMU,OAAQV,EAAMW,WAiBzEG,cAAgB,SAACd,GACbA,EAAMe,kBACNf,EAAMgB,iBACDhB,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,OAGnDge,EAAME,YAAYC,SAAgD,IAArCH,EAAME,YAAYC,QAAQne,QAC5D0a,EAAKtC,MAAM6G,cAAcvE,EAAKtC,MAAMzM,OAHpC+O,EAAKtC,MAAM0G,cAAcpE,EAAKtC,MAAMzM,UAO5CuT,iBAAmB,SAAClB,GAChBtD,EAAKtC,MAAMzM,MAAM8O,OAAO0E,OACxB7M,SAAS8M,KAAKnB,WAGlBoB,iBAAmB,SAACrB,GAGhB,IAAI7H,EAAQ6H,EAAMsB,QAAUtB,EAAMuB,WACpB,IAAVpJ,GACAuE,EAAKtC,MAAMsF,qBAAqBhD,EAAKtC,MAAMzM,MAAOqS,EAAMwB,QAASxB,EAAMyB,QAAStJ,MAIxFuJ,oBAAsB,SAAC1B,GAEE,IAAjBA,EAAMsB,QACN5E,EAAKtC,MAAMsF,qBAAqBhD,EAAKtC,MAAMzM,MAAOqS,EAAM2B,OAAQ3B,EAAM4B,QAAS5B,EAAMsB,WAI7FO,YAAc,SAAC7B,yFAKX,IAAIrS,EAAQ,IAAI6O,GAAM1T,KAAK8W,cAAckC,SAKzCnU,EAAMoU,GAAG,iBAAkBjZ,KAAK8X,iBAChCjT,EAAMoU,GAAG,iBAAkBjZ,KAAKiX,iBAEhCpS,EAAMoU,GAAG,eAAgBjZ,KAAKgY,eAC9BnT,EAAMoU,GAAG,aAAcjZ,KAAKoY,kBAC5BvT,EAAM8O,OAAOuF,iBAAiB,aAAclZ,KAAKuY,iBAAkB,CAACY,SAAS,IAC7EtU,EAAM8O,OAAOuF,iBAAiB,iBAAkBlZ,KAAK4Y,oBAAqB,CAACO,SAAS,IACpFtU,EAAM8O,OAAOuF,iBAAiB,QAASlZ,KAAK+Y,aAE5C/Y,KAAKsR,MAAM8H,cAAcvU,oCAIzB,OACIkN,EAAAC,EAAAC,cAAA,UACIoH,SAAS,IACTC,IAAKtZ,KAAK8W,cACV1L,GAAG,aACH+G,UAAWoH,KAAO,cAClBxX,MAAM,MACNC,OAAO,eA5HOyR,aAuJf+F,eApBS,SAAAxgB,GACpB,MAAO,CACH6L,MAAO7L,EAAMkM,IAAIL,MACjB8E,MAAO3Q,EAAM2Q,QAIM,SAAAoD,GACvB,MAAO,CACHqM,cAAe,SAACvU,GAAD,OAAWkI,EDrJL,SAAClI,GAC1B,MAAO,CACHxL,K5BDyB,oB4BEzBwL,MAAOA,GCkJ4B4U,CAAsB5U,KACzDiT,gBAAiB,SAACjT,EAAO5F,EAAGC,GAAX,OAAiB6N,ED/IX,SAAClI,EAAO5F,EAAGC,GACtC,MAAO,CACH7F,K5BgB2B,sB4Bf3BwL,MAAOA,EACP5F,EAAGA,EACHC,EAAGA,GC0IwCua,CAAwB5U,EAAO5F,EAAGC,KAC7E8Y,cAAe,SAACnT,EAAO5F,EAAGC,GAAX,OAAiB6N,EDvIX,SAAClI,EAAO5F,EAAGC,GACpC,MAAO,CACH7F,K5BQyB,oB4BPzBwL,MAAOA,EACP5F,EAAGA,EACHC,EAAGA,GCkIsCua,CAAsB5U,EAAO5F,EAAGC,KACzE+X,gBAAiB,SAACpS,EAAO5F,EAAGC,EAAG2P,EAAIC,GAAlB,OAAyB/B,ED/HnB,SAAClI,EAAO5F,EAAGC,EAAG2P,EAAIC,GAC7C,MAAO,CACHzV,K5BH4B,uB4BI5BwL,MAAOA,EACP5F,EAAGA,EACHC,EAAGA,EACH2P,GAAIA,EACJC,GAAIA,GCwH+C2K,CAAwB5U,EAAO5F,EAAGC,EAAG2P,EAAIC,KAC5F8H,qBAAsB,SAAC/R,EAAO5F,EAAGC,EAAGmQ,GAAd,OAAwBtC,EAAS0M,GAA6B5U,EAAO5F,EAAGC,EAAGmQ,KACjG0I,gBAAiB,SAAClT,EAAO6E,GAAR,OAAwBqD,ED5GlB,SAAClI,EAAO6E,GACnC,MAAO,CACHrQ,K5Bf2B,sB4BgB3BwL,MAAOA,EACP+E,GAAIF,EAAY,GAAGzK,EACnB4K,GAAIH,EAAY,GAAGxK,EACnB4K,GAAIJ,EAAY,GAAGzK,EACnB8K,GAAIL,EAAY,GAAGxK,GCqG+Bua,CAAwB5U,EAAO6E,KACjFiO,gBAAiB,SAAC9S,EAAO6E,GAAR,OAAwBqD,EDlGlB,SAAClI,EAAO6E,GACnC,MAAO,CACHrQ,K5BzB4B,uB4B0B5BwL,MAAOA,EACP+E,GAAIF,EAAY,GAAGzK,EACnB4K,GAAIH,EAAY,GAAGxK,EACnB4K,GAAIJ,EAAY,GAAGzK,EACnB8K,GAAIL,EAAY,GAAGxK,GC2F+Bua,CAAwB5U,EAAO6E,KACjFyO,cAAe,SAACtT,GAAD,OAAWkI,EDxFL,SAAClI,GAC1B,MAAO,CACHxL,K5BnCyB,oB4BoCzBwL,SCqFmC4U,CAAsB5U,OAIlD2U,CAA6C3C,wBChJ7C6C,GAZS,WACpB,OACI3H,EAAAC,EAAAC,cAAA,OAAKE,UAAWoH,KAAO,mBACnBxH,EAAAC,EAAAC,cAAA,WACIF,EAAAC,EAAAC,cAAA,qBC4BD0H,mMAvBP,GAAI3Z,KAAKsR,MAAMzM,MAAM8O,QAAU3T,KAAKsR,MAAMzM,MAAM8O,OAAO0C,WAAW,MAAO,CAErE,IAAIhR,EAASrF,KAAKsR,MAAMzM,MAAMQ,OAC1Bf,EAAatE,KAAKsR,MAAMzM,MAAMP,WAAWtE,KAAKsR,MAAMzM,MAAMO,WAC9DpF,KAAKsR,MAAMzM,MAAM+U,aAAavU,EAAOpG,EAAGoG,EAAOnG,EAAGoF,GAAaA,GAE/DtE,KAAKsR,MAAMzM,MAAMgV,yDAKrB7Z,KAAKsR,MAAMwI,oDAIX,OACI/H,EAAAC,EAAAC,cAACF,EAAAC,EAAM+H,SAAP,KACK/Z,KAAKsR,MAAM0I,iBA7BCvG,aCCtB,SAASwG,GAASrX,GAA0B,IAAnBoD,EAAmB/M,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,QAAXE,EACpC,OAAIyJ,aAAiB1B,IAsBzB,SAAwBD,EAAO+E,GAC3B,IAAIkU,EAAUlU,GAASA,EAAMkU,OAAUlU,EAAMkU,OAAS,EAClDtU,EAAOI,GAASA,EAAMJ,KAAOI,EAAMJ,KAAO,UAC1CqU,EAAW,IAAIE,KAGnB,OAFAF,EAASrU,KAAOqU,EAASG,UAAUxU,GAAMyU,QACzCJ,EAASK,OAASL,EAASM,WAAWtZ,EAAMhC,EAAGgC,EAAM/B,EAAGgb,GAAQG,QACzDJ,EA3BIO,CAAe5X,EAAOoD,GAE7BpD,aAAiBxG,IA6BzB,SAA0B+F,EAAS6D,GAC/B,IAAIiU,EAAW,IAAIE,KACfzU,EAAcM,QAA+B7M,IAAtB6M,EAAMN,YAA4BM,EAAMN,YAAc,EAC7E+U,GAAczU,QAA+B7M,IAAtB6M,EAAMyU,aAA4BzU,EAAMyU,YAC/D9U,EAASK,GAASA,EAAML,OAASK,EAAML,OAAS,QACpD,OAAOsU,EACFS,eAAehV,EAAY,EAAE,EAAE,GAAG+U,GAClCE,YAAYhV,GACZiV,OAAOzY,EAAQZ,GAAGtC,EAAGkD,EAAQZ,GAAGrC,GAChC2b,OAAO1Y,EAAQV,GAAGxC,EAAGkD,EAAQV,GAAGvC,GAChC4b,YAtCMC,CAAiBnY,EAAOoD,GAE/BpD,aAAiBtI,IAwCzB,SAAsBa,EAAK6K,GAGvB,IAAIiU,EAAW,IAAIE,KACfzU,EAAcM,GAASA,EAAMN,YAAcM,EAAMN,YAAc,EAC/D+U,GAAczU,QAA+B7M,IAAtB6M,EAAMyU,aAA4BzU,EAAMyU,YAC/D9U,EAASK,GAASA,EAAML,OAASK,EAAML,OAAS,QACpD,OAAOsU,EACFS,eAAehV,EAAY,EAAE,EAAE,GAAG+U,GAClCE,YAAYhV,GACZxK,IAAIA,EAAIc,GAAGgD,EAAG9D,EAAIc,GAAGiD,EAAG/D,EAAId,EAAGc,EAAItB,WAAYsB,EAAInB,UAAWmB,EAAIvB,kBAClEkhB,YAlDME,CAAapY,EAAOoD,GAE3BpD,aAAiBjB,IAoDzB,SAAyB2Y,EAAQtU,GAC7B,IAAIiU,EAAW,IAAIE,KACfzU,EAAcM,GAASA,EAAMN,YAAcM,EAAMN,YAAc,EAE/DC,EAASK,GAASA,EAAML,OAASK,EAAML,OAAS,UAChDC,EAAOI,GAASA,EAAMJ,KAAOI,EAAMJ,KAAO,UAK9C,OAJAqU,EAASS,eAAehV,EAAY,EAAE,EAAE,IAAG,GAC3CuU,EAAStU,OAASsU,EAASU,YAAYhV,GAAQ0U,QAC/CJ,EAASrU,KAAOqU,EAASG,UAAUxU,GAAMyU,QACzCJ,EAASM,WAAWD,EAAOre,GAAGgD,EAAGqb,EAAOre,GAAGiD,EAAGob,EAAOjgB,GAC9C4f,EA7DIgB,CAAgBrY,EAAOoD,GAE9BpD,aAAiBV,IA+DzB,SAAsBD,EAAK+D,GACvB,IAAIiU,EAAW,IAAIE,KACfzU,EAAcM,GAASA,EAAMN,YAAcM,EAAMN,YAAc,EAC/DC,EAASK,GAASA,EAAML,OAASK,EAAML,OAAS,UAChDC,EAAOI,GAASA,EAAMJ,KAAOI,EAAMJ,KAAO,UAK9C,OAJAqU,EAASS,eAAehV,EAAY,EAAE,EAAE,IAAG,GAC3CuU,EAAStU,OAASsU,EAASU,YAAYhV,GAAQ0U,QAC/CJ,EAASrU,KAAOqU,EAASG,UAAUxU,GAAMyU,QACzCJ,EAASiB,SAASjZ,EAAIJ,KAAMI,EAAIH,KAAMG,EAAI4E,KAAK5E,EAAIJ,KAAMI,EAAI6E,KAAK7E,EAAIH,MAC/DmY,EAvEIkB,CAAavY,EAAOoD,GAE3BpD,aAAiBlH,IAqGzB,SAA0BD,EAASuK,GAC/B,IAAIiU,EAAW,IAAIE,KACfzU,EAAcM,GAASA,EAAMN,YAAcM,EAAMN,YAAc,EAC/DC,EAASK,GAASA,EAAML,OAASK,EAAML,OAAS,UAChDC,EAAOI,GAASA,EAAMJ,KAAOI,EAAMJ,KAAO,UAC9CqU,EAASS,eAAehV,EAAY,EAAE,EAAE,IAAG,GAC3CuU,EAAStU,OAASsU,EAASU,YAAYhV,GAAQ0U,QAC/CJ,EAASrU,KAAOqU,EAASG,UAAUxU,GAAMyU,QAPH,IAAApd,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAStC,QAAAiE,EAAAC,EAAiB5B,EAAQc,MAAzBe,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAgC,KAAvBme,EAAuBhe,EAAAhC,MAC5BigB,GAAgBpB,EAAUmB,IAVQ,MAAAzd,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GActC,OADA8c,EAASa,YACFb,EAlHIqB,CAAiB1Y,EAAOoD,GAE5B,KA+EX,SAASuV,GAAgBtB,EAAUuB,GAC3BA,EAAK5Y,iBAAiBxG,IAX9B,SAAgC6d,EAAU9X,GACtC8X,EAASY,OAAO1Y,EAAQV,GAAGxC,EAAGkD,EAAQV,GAAGvC,GAWrCuc,CAAuBxB,EAAUuB,EAAK5Y,OAEjC4Y,EAAK5Y,iBAAiBtI,KAVnC,SAA4B2f,EAAU9e,GAGlC8e,EAAS9e,IAAIA,EAAIc,GAAGgD,EAAG9D,EAAIc,GAAGiD,EAAG/D,EAAId,EAAGc,EAAItB,WAAYsB,EAAInB,UAAWmB,EAAIvB,kBAQvE8hB,CAAmBzB,EAAUuB,EAAK5Y,OAI1C,SAASyY,GAAgBpB,EAAUmB,GAC/B,IAAI7Z,EAAK6Z,EAAKO,MAAMjiB,MACpBugB,EAASW,OAAOrZ,EAAGtC,EAAGsC,EAAGrC,GAFY,IAAAoB,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAIrC,QAAAsH,EAAAC,EAAiB0a,EAAjB9d,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAuB,CACnBib,GAAgBtB,EADGxZ,EAAArF,QAJc,MAAAuC,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,IC/GlC,IAAMob,GAAW,SAACC,EAAMC,GAE3B,IADA,IAAIC,GAAQ,EACZlU,EAAA,EAAAmU,EAAgB1iB,OAAO4S,KAAK4P,GAA5BjU,EAAAmU,EAAA9iB,OAAA2O,IAAmC,CAA9B,IAAI3H,EAAG8b,EAAAnU,GACR,GAAIiU,EAAK5b,KAAS2b,EAAK3b,GAAM,CACzB6b,GAAQ,EACR,OAGR,OAAOA,GAGEE,GAAS,SAACxd,EAAKiF,EAASD,GACjC,OAAQhF,EAAIiF,GAASwY,QAAQzY,ICHpB0Y,GAAb,SAAAC,GACI,SAAAD,EAAYE,GAAQ,IAAAzI,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAmc,IAChBvI,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAA6iB,GAAApI,KAAA/T,QAKJsc,gBAAkB,SAACpF,GACftD,EAAKtC,MAAMiL,YAAY3I,EAAKtC,MAAMrL,QAPlB2N,EAUpB4I,eAAiB,SAACtF,GACdtD,EAAKtC,MAAMmL,cAXK7I,EAcpB8I,YAAc,SAACxF,GACXtD,EAAKtC,MAAMY,QAAQ0B,EAAKtC,MAAMrL,MAAO2N,EAAKtC,MAAM/K,QAbhDqN,EAAKhR,MAAQ,IAAI+Z,KACjBN,EAAOxX,MAAM+P,SAAShB,EAAKhR,OAHXgR,EADxB,OAAAta,OAAAsjB,GAAA,EAAAtjB,CAAA6iB,EAAAC,GAAA9iB,OAAA2G,EAAA,EAAA3G,CAAA6iB,EAAA,EAAAjc,IAAA,SAAA9E,MAAA,WAqBQ,IAAIyJ,EAAQ7E,KAAKsR,MAAMzM,MACnBsB,EAASnG,KAAKsR,MAAMuL,SAAW7c,KAAKsR,MAAMwL,SAAY,QAAU9c,KAAKsR,MAAMnL,MAC3EN,EAAS7F,KAAKsR,MAAMuL,SAAW7c,KAAKsR,MAAMwL,SAAY,EAAM,GAC5D5Y,EAAUlE,KAAKsR,MAAMpN,QAErBwB,EAAc1F,KAAKsR,MAAMrL,MAAMF,KAAKgX,SAAW/c,KAAKsR,MAAMrL,MAAMF,KAAKgX,cAAW5jB,EAChFyM,EAAO1B,EAAUlE,KAAKsR,MAAMnL,MAAQ,QAEpCnG,KAAK4C,MAAMqX,SAAS+C,UACpBhd,KAAK4C,MAAMqX,SAAWA,GAASja,KAAKsR,MAAMrL,MAAMF,KAAK,CACjDL,YAAaA,EACb+U,aAAa,EACb9U,OAAQQ,EACRP,KAAMA,EACNsU,OAAQ,GAAMrV,EAAMP,WAAaO,EAAMO,eAevCpF,KAAK4C,MAAMqX,SAAStU,SAAQ3F,KAAK4C,MAAMqX,SAAStU,OAAOK,MAAQG,GAC/DnG,KAAK4C,MAAMqX,SAASrU,OAAM5F,KAAK4C,MAAMqX,SAASrU,KAAKI,MAAQJ,GAC3D5F,KAAK4C,MAAMqX,SAASK,SAAQta,KAAK4C,MAAMqX,SAASK,OAAOJ,OACvD,GAAMrV,EAAMP,WAAaO,EAAMO,cAEvCpF,KAAK4C,MAAMiD,MAAQ7F,KAAKsR,MAAMlL,UAAYP,EAAQ,IAvD1D,CAAA3F,IAAA,oBAAA9E,MAAA,WA8DQ4E,KAAK4C,MAAMqW,GAAG,YAAajZ,KAAKsc,iBAChCtc,KAAK4C,MAAMqW,GAAG,WAAYjZ,KAAKwc,gBAC/Bxc,KAAK4C,MAAMqW,GAAG,QAASjZ,KAAK0c,aAI5B1c,KAAKid,WApEb,CAAA/c,IAAA,wBAAA9E,MAAA,SAuE0B8hB,EAAWC,GAC7B,OAAIvB,GAAS5b,KAAKsR,MAAO4L,KAxEjC,CAAAhd,IAAA,qBAAA9E,MAAA,WA+EQ4E,KAAKid,WA/Eb,CAAA/c,IAAA,uBAAA9E,MAAA,WAmFQ4E,KAAK4C,MAAMwa,IAAI,YAAapd,KAAKsc,iBACjCtc,KAAK4C,MAAMwa,IAAI,WAAYpd,KAAKwc,gBAChCxc,KAAK4C,MAAMwa,IAAI,QAASpd,KAAK0c,aAC7B1c,KAAKsR,MAAMzM,MAAMwY,YAAYrd,KAAK4C,OAClC5C,KAAK4C,MAAMqX,SAASqD,UAvF5B,CAAApd,IAAA,SAAA9E,MAAA,WA2FQ,OAAO,SA3Ff+gB,EAAA,CAAoC1I,aCCvB8J,GAAb,SAAAnB,GAAA,SAAAmB,IAAA,IAAAC,EAAA5J,EAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAud,GAAA,QAAAE,EAAAxkB,UAAAC,OAAAwkB,EAAA,IAAA3P,MAAA0P,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,EAAAC,GAAA1kB,UAAA0kB,GAAA,OAAA/J,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,MAAAwd,EAAAlkB,OAAAwa,GAAA,EAAAxa,CAAAikB,IAAAxJ,KAAA6J,MAAAJ,EAAA,CAAAxd,MAAA8I,OAAA4U,MACIpB,gBAAkB,SAACpF,GACftD,EAAKtC,MAAMiL,YAAY3I,EAAKtC,MAAMrL,QAF1C2N,EAKI4I,eAAiB,SAACtF,GACdtD,EAAKtC,MAAMmL,cANnB7I,EASI8I,YAAc,SAACxF,GACXtD,EAAKtC,MAAMY,QAAQ0B,EAAKtC,MAAMrL,MAAO2N,EAAKtC,MAAM/K,QAVxDqN,EAAA,OAAAta,OAAAsjB,GAAA,EAAAtjB,CAAAikB,EAAAnB,GAAA9iB,OAAA2G,EAAA,EAAA3G,CAAAikB,EAAA,EAAArd,IAAA,SAAA9E,MAAA,WAcQ,GAAK4E,KAAK6d,OAAV,CAGA7d,KAAK6d,OAAOhY,MAAQ7F,KAAKsR,MAAMlL,UADnB,EACuC,EAEnD,IAAIrE,EAAQ/B,KAAKsR,MAAMrL,MAAMF,KAAKhE,MAC9B6N,EAAQ5P,KAAK6d,OAAOC,MAAMC,aAAa/d,KAAK6d,OAAOC,MAAME,cAC7Dhe,KAAKsR,MAAMrL,MAAMF,KAAK/D,OAAShC,KAAKsR,MAAMrL,MAAMF,KAAKhE,MAAQ6N,EAC7D,IAAIqO,EAASlc,EAAM/B,KAAK6d,OAAOC,MAAMC,aACjCG,EAASnc,GAAO/B,KAAK6d,OAAOC,MAAME,cAAcpO,GAChDuO,EAAKne,KAAKsR,MAAMrL,MAAMF,KAAKtM,OAAOwF,EAClCmf,EAAKpe,KAAKsR,MAAMrL,MAAMF,KAAKtM,OAAOyF,EAEtCc,KAAK6d,OAAOjE,aAAauE,EAAIC,EAAIH,GAASC,GAE1Cle,KAAK6d,OAAOQ,KAAOre,KAAK6d,OAAOC,MAAMC,aAAa,EAClD/d,KAAK6d,OAAOS,KAAOte,KAAK6d,OAAOC,MAAME,cAAc,KA9B3D,CAAA9d,IAAA,YAAA9E,MAAA,WAoCgB,IAAAmjB,EAAAve,KACFwe,EAAM,IAAIvQ,MAEhBuQ,EAAIC,OAAS,WAETF,EAAKV,OAAS,IAAIa,KAAOF,GACzBD,EAAKjN,MAAMzM,MAAM+P,SAAS2J,EAAKV,QAO/BU,EAAKtB,SAELsB,EAAKjN,MAAMqN,cAAcJ,EAAKjN,MAAMrL,MAAOsY,EAAKjN,MAAM/K,MAAOiY,IAEjEA,EAAII,aAAa,cAAe,aAYhCJ,EAAIK,IAAM7e,KAAKsR,MAAMrL,MAAMF,KAAKmI,MAjExC,CAAAhO,IAAA,oBAAA9E,MAAA,WAqEQ4E,KAAK8e,cArEb,CAAA5e,IAAA,wBAAA9E,MAAA,SAwE0B8hB,EAAWC,GAC7B,OAAIvB,GAAS5b,KAAKsR,MAAO4L,KAzEjC,CAAAhd,IAAA,qBAAA9E,MAAA,WAgFQ4E,KAAKid,WAhFb,CAAA/c,IAAA,uBAAA9E,MAAA,WAwFQ4E,KAAKsR,MAAMzM,MAAMwY,YAAYrd,KAAK6d,UAxF1C,CAAA3d,IAAA,SAAA9E,MAAA,WA4FQ,OAAO,SA5FfmiB,EAAA,CAAoC9J,aCJ9BsL,gNACFJ,cAAgB,SAAC1Y,EAAOM,EAAOuX,GAC3BlK,EAAKtC,MAAMN,YAAY4C,EAAKtC,MAAMzM,MAAO+O,EAAKtC,MAAM/K,OACpDqN,EAAKoL,wFAGA,IAAAT,EAAAve,KACL,OACIA,KAAKsR,MAAM/K,MAAM1D,OAAO4F,IAAI,SAAC7F,EAAOkF,GAChC,OAAOlF,EAAMmD,KAAKmI,IACd6D,EAAAC,EAAAC,cAACgN,GAAD,CACI/e,IAAK4H,EACLjD,MAAO0Z,EAAKjN,MAAMzM,MAClB0B,MAAOgY,EAAKjN,MAAM/K,MAClBN,MAAOrD,EACPwD,UAAWmY,EAAKjN,MAAM/K,MAAMH,UAC5ByW,QAASja,IAAU2b,EAAKjN,MAAMnH,aAC9B2S,SACIla,IAAU2b,EAAKjN,MAAMlH,oBACrBxH,IAAU2b,EAAKjN,MAAMjH,oBAEzBlE,MAAOoY,EAAKjN,MAAM/K,MAAMJ,MACxBjC,QAASqa,EAAKjN,MAAMpN,QACpBE,cAAema,EAAKjN,MAAMlN,cAC1BE,WAAYia,EAAKjN,MAAMhN,WACvBiY,YAAagC,EAAKjN,MAAMiL,YACxBE,WAAY8B,EAAKjN,MAAMmL,WACvBvK,QAASqM,EAAKjN,MAAMY,QACpByM,cAAeJ,EAAKI,gBAGxB5M,EAAAC,EAAAC,cAACiN,GAAD,CACIhf,IAAK4H,EACLjD,MAAO0Z,EAAKjN,MAAMzM,MAClB0B,MAAOgY,EAAKjN,MAAM/K,MAClBN,MAAOrD,EACPwD,UAAWmY,EAAKjN,MAAM/K,MAAMH,UAC5ByW,QAASja,IAAU2b,EAAKjN,MAAMnH,aAC9B2S,SACIla,IAAU2b,EAAKjN,MAAMlH,oBACrBxH,IAAU2b,EAAKjN,MAAMjH,oBAEzBlE,MAAOoY,EAAKjN,MAAM/K,MAAMJ,MACxBjC,QAASqa,EAAKjN,MAAMpN,QACpBC,gBAAiBoa,EAAKjN,MAAMnN,gBAC5BG,WAAYia,EAAKjN,MAAMhN,WACvBiY,YAAagC,EAAKjN,MAAM6N,yBACxB1C,WAAY8B,EAAKjN,MAAM8N,wBACvBlN,QAASqM,EAAKjN,MAAM+N,8BAhDf5L,aAuFd+F,eA/BS,SAACxgB,GACrB,MAAO,CACH6L,MAAO7L,EAAMkM,IAAIL,MACjBoC,OAAQjO,EAAMiO,OACd9C,gBAAiBnL,EAAMkM,IAAIf,gBAC3BC,cAAepL,EAAMkM,IAAId,cACzBF,QAASlL,EAAMkM,IAAIhB,QACnBI,WAAYtL,EAAMkM,IAAIZ,WACtBN,MAAOhL,EAAMkM,IAAIlB,MACjBN,QAAS1K,EAAMkM,IAAIxB,QACnBD,SAAUzK,EAAMkM,IAAIzB,SACpBY,oBAAqBrL,EAAMkM,IAAIb,oBAC/BI,eAAgBzL,EAAMkM,IAAIT,eAC1BO,kBAAmBhM,EAAMkM,IAAIF,kBAC7BC,gBAAiBjM,EAAMkM,IAAID,gBAC3B2F,kBAAmB5R,EAAM4R,kBACzBT,aAAcnR,EAAM4R,kBAAkBT,aACtCC,mBAAoBpR,EAAM4R,kBAAkBR,mBAC5CC,oBAAqBrR,EAAM4R,kBAAkBP,sBAI1B,SAAA0C,GACvB,MAAO,CACHiE,YAAa,SAACnM,EAAOjC,GAAR,OAAkBmK,EAAS0M,GAAoB5U,EAAOjC,KACnEuc,yBAA0B,SAACvc,GAAD,OAAWmK,EfIL,SAACnK,GACrC,MAAO,CACHvJ,KrB9D6B,wBqB+D7BuJ,SeP8C6W,CAAiC7W,KAC/Ewc,wBAAyB,kBAAMrS,EfW5B,CACH1T,KrBpE4B,0BoCyD5BgmB,mBAAoB,SAACzc,EAAO2D,GAAR,OAAkBwG,EfeZ,SAACnK,EAAO2D,GACtC,MAAO,CACHlN,KrBzE8B,yBqB0E9BuJ,QACA2D,SenB+CkT,CAA2B7W,EAAO2D,OAI1EiT,CAA6CuF,wBC5E7CO,GAdQ,SAAAzS,GAAsB,IAAnBhI,EAAmBgI,EAAnBhI,MAAOjC,EAAYiK,EAAZjK,MACzBnJ,EAASmJ,EAAMmD,KAAKtM,QAAUmJ,EAAMmD,KACpCwZ,EAAO1a,EAAM8O,OAAO6D,WAAa3S,EAAMsQ,MAAM1b,EAAOwF,GAAK,EACzDugB,EAAM3a,EAAM8O,OAAO+D,UAAY7S,EAAMuQ,MAAM3b,EAAOyF,GAAK,EAI3D,OAHaqgB,EAAO1a,EAAM8O,OAAO6D,YAAc+H,EAAO1a,EAAM8O,OAAO6D,WAAa3S,EAAM8O,OAAO5R,OACzFyd,EAAM3a,EAAM8O,OAAO+D,WAAa8H,EAAM3a,EAAM8O,OAAO+D,UAAY7S,EAAM8O,OAAO3R,OAG5E+P,EAAAC,EAAAC,cAAA,OAAKjM,MAAO,CAACyZ,SAAS,WAAYF,KAAKA,EAAK,KAAMC,IAAKA,EAAI,MAAOrN,UAAWX,KAAQkO,gBACjF3N,EAAAC,EAAAC,cAAA,UAAKrP,EAAMxB,QAEf,MCoBOoY,eAZS,SAACxgB,GACrB,MAAO,CACH6L,MAAO7L,EAAMkM,IAAIL,MACjBT,cAAepL,EAAMkM,IAAId,cACzBE,WAAYtL,EAAMkM,IAAIZ,WACtBC,QAASvL,EAAMkM,IAAIX,QACnBC,QAASxL,EAAMkM,IAAIV,UAIA,SAAAuI,GAAa,MAAO,IAEhCyM,CA9Bc,SAAClI,GAE1B,OAAQA,EAAM/K,MAAMH,WAAakL,EAAMlN,cACnCkN,EAAM/K,MAAM1D,OAAO4F,IAAI,SAAC7F,EAAOkF,GACvB,OAAQlF,EAAMxB,OAAgC,KAAvBwB,EAAMxB,MAAMue,OAC/B5N,EAAAC,EAAAC,cAAC2N,GAAD,CACI1f,IAAK4H,EACLjD,MAAOyM,EAAMzM,MACbjC,MAAOA,EACP0B,WAAYgN,EAAMhN,WAClBC,QAAS+M,EAAM/M,QACfC,QAAS8M,EAAM9M,UACb,OAGlB,2BCGOqb,GAlBK,SAACvO,GACjB,IAAIzM,EAAQyM,EAAMzM,MACd0a,EAAO1a,EAAM8O,OAAO6D,WAAa3S,EAAMsQ,MAAM7D,EAAMwO,OAAO7gB,GAAK,EAC/DugB,EAAM3a,EAAM8O,OAAO+D,UAAY7S,EAAMuQ,MAAM9D,EAAMwO,OAAO5gB,GAAK,GAG7DD,EAAIgd,GAAO3K,EAAMwO,OAAO7gB,EAAGqS,EAAM5N,QAAS4N,EAAM7N,UAChDvE,EAAI+c,GAAO3K,EAAMwO,OAAO5gB,EAAGoS,EAAM5N,QAAS4N,EAAM7N,UAEpD,OACIsO,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQqO,YAAa7Z,MAAO,CAACuZ,KAAKA,EAAMC,IAAIA,IACxDzN,EAAAC,EAAAC,cAAA,eACOhT,EADP,MACaC,KCsFV6gB,eA3FX,SAAAA,EAAYzO,GAAO,IAAAsC,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA+f,IACfnM,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAAymB,GAAAhM,KAAA/T,QASJsc,gBAAkB,SAACpF,GAEftD,EAAKhR,MAAMod,OAAS,IAAIC,KAAOrM,EAAKtC,MAAMnL,MAAO,EAAG,EAAG,IACvDyN,EAAKsM,SAAS,CAACrD,SAAQ,KAbRjJ,EAgBnB4I,eAAiB,SAACtF,GAEdtD,EAAKhR,MAAMod,OAAS,KACpBpM,EAAKsM,SAAS,CAACrD,SAAQ,KAnBRjJ,EAsBnB8I,YAAc,SAACxF,GAEXlK,QAAQJ,IAAIgH,EAAKtC,MAAMwO,SAtBvBlM,EAAKhR,MAAQ,IAAI+Z,KACjBrL,EAAMzM,MAAM+P,SAAShB,EAAKhR,OAE1BgR,EAAK5a,MAAQ,CACT6jB,SAAS,GANEjJ,yEA4Bf,IAAI/O,EAAQ7E,KAAKsR,MAAMzM,MACnBc,EAAS3F,KAAKsR,MAAMnL,MACpBP,EAAO5F,KAAKsR,MAAMnL,MAIlBnG,KAAK4C,MAAMqX,SAAS+C,UACpBhd,KAAK4C,MAAMqX,SAAWA,GAASja,KAAKsR,MAAMwO,OACtC,CACIna,OAAQA,EACRC,KAAMA,EACNsU,OAAQ,GAAMrV,EAAMP,WAAaO,EAAMO,eAI/CpF,KAAK4C,MAAMqX,SAASK,OAAOJ,OAAS,GAAMrV,EAAMP,WAAaO,EAAMO,YACnEpF,KAAK4C,MAAMqX,SAASrU,KAAKI,MAAQJ,GAErC5F,KAAK4C,MAAMiD,MAfC,8CAmBZ7F,KAAK4C,MAAMqW,GAAG,YAAajZ,KAAKsc,iBAChCtc,KAAK4C,MAAMqW,GAAG,WAAYjZ,KAAKwc,gBAC/Bxc,KAAK4C,MAAMqW,GAAG,QAASjZ,KAAK0c,aAE5B1c,KAAK4C,MAAMud,cAAe,EAE1BngB,KAAKid,uDAGaC,EAAWC,GAC7B,OAAIvB,GAAS5b,KAAKsR,MAAO4L,KAActB,GAAS5b,KAAKhH,MAAOmkB,gDAO5Dnd,KAAKid,wDAILjd,KAAK4C,MAAMwa,IAAI,YAAapd,KAAKsc,iBACjCtc,KAAK4C,MAAMwa,IAAI,WAAYpd,KAAKwc,gBAChCxc,KAAK4C,MAAMwa,IAAI,QAASpd,KAAK0c,aAE7B1c,KAAKsR,MAAMzM,MAAMwY,YAAYrd,KAAK4C,OAClC5C,KAAK4C,MAAMqX,SAASqD,yCAIpB,OAAOtd,KAAKhH,MAAM6jB,QACd9K,EAAAC,EAAAC,cAACmO,GAAD,CACIvb,MAAO7E,KAAKsR,MAAMzM,MAClBib,OAAQ9f,KAAKsR,MAAMwO,OACnBpc,QAAS1D,KAAKsR,MAAM5N,QACpBD,SAAUzD,KAAKsR,MAAM7N,WAErB,YAxFcgQ,aCcf4M,GAlBW,SAAC/O,GAEvB,OAAOA,EAAMrL,MAAMF,KAAKua,SACpBhP,EAAMrL,MAAMF,KAAKua,SAAS7X,IAAI,SAACqX,EAAQhY,GAAT,OAC1BiK,EAAAC,EAAAC,cAACsO,GAAD,CAAiBrgB,IAAK4H,EACLjD,MAAOyM,EAAMzM,MACbib,OAAQA,EACR3Z,MAAOmL,EAAMnL,MACbzC,QAAS4N,EAAM5N,QACfD,SAAU6N,EAAM7N,SAChBa,WAAYgN,EAAMhN,WAClBC,QAAS+M,EAAM/M,QACfC,QAAS8M,EAAM9M,YAEhC,MCgBGgV,eAdS,SAACxgB,GACrB,MAAO,CACH6L,MAAO7L,EAAMkM,IAAIL,MACjBV,gBAAiBnL,EAAMkM,IAAIf,gBAC3BG,WAAYtL,EAAMkM,IAAIZ,WACtBC,QAASvL,EAAMkM,IAAIX,QACnBC,QAASxL,EAAMkM,IAAIV,QACnBd,QAAS1K,EAAMkM,IAAIxB,QACnBD,SAAUzK,EAAMkM,IAAIzB,WAID,SAAAsJ,GAAa,MAAO,IAEhCyM,CAhCgB,SAAClI,GAC5B,OAAQA,EAAM/K,MAAMH,WAAakL,EAAMnN,gBACnCmN,EAAM/K,MAAM1D,OAAO4F,IAAI,SAAC7F,EAAOkF,GAAR,OACnBiK,EAAAC,EAAAC,cAACuO,GAAD,CACItgB,IAAK4H,EACLjD,MAAOyM,EAAMzM,MACboB,MAAOrD,EACPuD,MAAOmL,EAAM/K,MAAMJ,MACnBzC,QAAS4N,EAAM5N,QACfD,SAAU6N,EAAM7N,SAChBa,WAAYgN,EAAMhN,WAClBC,QAAS+M,EAAM/M,QACfC,QAAS8M,EAAM9M,YAGvB,OCUOic,oOAbP,OAAOzgB,KAAKsR,MAAMrK,OAAOwB,IAAI,SAAClC,GAAD,OACzBwL,EAAAC,EAAAC,cAACF,EAAAC,EAAM+H,SAAP,CAAgB7Z,IAAKqG,EAAM/C,MAEvBuO,EAAAC,EAAAC,cAACyO,GAAD,CAAgBna,MAAOA,IAEvBwL,EAAAC,EAAAC,cAAC0O,GAAD,CAAsBpa,MAAOA,IAE7BwL,EAAAC,EAAAC,cAAC2O,GAAD,CAAwBra,MAAOA,cAjBjBkN,aCGxBoN,gNACFC,cAAgB/J,IAAMC,cACtB+J,aAAe,OAEf/nB,MAAQ,CACJwQ,YAAQrQ,EACRsQ,YAAQtQ,EACR6nB,UAAM7nB,EACN8nB,UAAM9nB,EACN+nB,gBAAgB,KAGpBpJ,gBAAkB,SAACZ,GACfA,EAAMgB,iBAENtE,EAAKmN,aAAazD,QAEd1J,EAAK5a,MAAMkoB,gBACXtN,EAAKsM,SAAS,CACV1W,YAAQrQ,EACRsQ,YAAQtQ,EACR6nB,UAAM7nB,EACN8nB,UAAM9nB,EACN+nB,gBAAgB,IAEpBtN,EAAKmN,aAAapN,OAAO3N,MAAMmb,OAAS,SAGxCvN,EAAKsM,SAAS,CACV1W,OAAQoK,EAAKmN,aAAalL,MAAMqB,EAAMU,QACtCnO,OAAQmK,EAAKmN,aAAajL,MAAMoB,EAAMW,QACtCqJ,gBAAgB,IAEpBtN,EAAKmN,aAAapN,OAAO3N,MAAMmb,OAAS,gBAIhDlK,gBAAkB,SAACC,GACXtD,EAAK5a,MAAMkoB,gBACXtN,EAAKsM,SAAS,CACVc,KAAMpN,EAAKmN,aAAalL,MAAMqB,EAAMU,QACpCqJ,KAAMrN,EAAKmN,aAAajL,MAAMoB,EAAMW,aAKhDG,cAAgB,SAACd,OAGjBqB,iBAAmB,SAACrB,GAChBA,EAAMgB,iBAEN,IAAI7I,EAAQ6H,EAAMsB,QAAUtB,EAAMuB,WACpB,IAAVpJ,IAEAuE,EAAKtC,MAAMsF,qBAAqBhD,EAAKtC,MAAMzM,MAAOqS,EAAMwB,QAASxB,EAAMyB,QAAStJ,GAEhFuE,EAAKwN,WAIbxI,oBAAsB,SAAC1B,GACnBA,EAAMgB,iBAEe,IAAjBhB,EAAMsB,SAEN5E,EAAKtC,MAAMsF,qBAAqBhD,EAAKtC,MAAMzM,MAAOqS,EAAM2B,OAAQ3B,EAAM4B,QAAS5B,EAAMsB,QAErF5E,EAAKwN,gFAMT,IAAIvc,EAAQ7E,KAAK+gB,aAEbM,EADSxc,EAAM8O,OACE0C,WAAW,MAEhCrW,KAAK+gB,aAAa1b,OAASrF,KAAKsR,MAAMzM,MAAMQ,OAC5CrF,KAAK+gB,aAAa3b,WAAapF,KAAKsR,MAAMzM,MAAMO,WAChDpF,KAAK+gB,aAAazc,WAAatE,KAAKsR,MAAMzM,MAAMP,WAEhDtE,KAAK+gB,aAAazD,QAGlB,IAiBIgE,EAAOC,EAAmBC,EAC1BC,EAAOC,EAlBPC,EAAOxnB,KAAKsb,IAAI5Q,EAAMsQ,MAAMnV,KAAKhH,MAAMwQ,QAAS3E,EAAMsQ,MAAMnV,KAAKhH,MAAMgoB,OACvEY,EAAOznB,KAAKsb,IAAI5Q,EAAMuQ,MAAMpV,KAAKhH,MAAMyQ,QAAS5E,EAAMuQ,MAAMpV,KAAKhH,MAAMioB,OACvElf,EAAQ5H,KAAKqB,IAAIqJ,EAAMgd,WAAW7hB,KAAKhH,MAAMwQ,OAASxJ,KAAKhH,MAAMgoB,OACjEhf,EAAS7H,KAAKqB,IAAIqJ,EAAMgd,WAAW7hB,KAAKhH,MAAMyQ,OAASzJ,KAAKhH,MAAMioB,OAEtEI,EAAQS,YACRT,EAAQU,KAAKJ,EAAMC,EAAM7f,EAAOC,GAGhCqf,EAAQzG,OAAO/V,EAAMsQ,MAAMnV,KAAKhH,MAAMwQ,QAAS3E,EAAMuQ,MAAMpV,KAAKhH,MAAMyQ,SACtE4X,EAAQxG,OAAOhW,EAAMsQ,MAAMnV,KAAKhH,MAAMgoB,MAAOnc,EAAMuQ,MAAMpV,KAAKhH,MAAMioB,OAEpEI,EAAQW,UAAY,EACpBX,EAAQ3b,YAAc,QACtB2b,EAAQ1b,SAKR,IAAIsc,EAAOjiB,KAAKkiB,cAEhBb,EAAQc,KAAO,aAIfX,EAAYH,EAAQe,YAAYH,GAAMlgB,MAGlC5H,KAAKqB,IAAIqJ,EAAMsQ,MAAMnV,KAAKhH,MAAMgoB,MAAQW,IAAS,GACjDN,EAAQgB,UAAY,OACpBf,EAAQK,EAAO,EACfF,EAAQE,IAIRN,EAAQgB,UAAY,QAEpBZ,GADAH,EAAQK,EAAO5f,EAAQ,GACPyf,EAAY,GAShCE,GALIH,EADApnB,KAAKqB,IAAIqJ,EAAMuQ,MAAMpV,KAAKhH,MAAMioB,MAAQW,IAAS,EACzCA,EAAO,EAGPA,EAAO5f,EArBN,GAqB4B,GArB5B,GAuBgB,EAE7Bqf,EAAQiB,UAAY,QACpBjB,EAAQkB,YAAc,GACtBlB,EAAQmB,SAASf,EAAOC,EAAOF,EAAY,EAAGiB,IAE9CpB,EAAQiB,UAAY,QACpBjB,EAAQkB,YAAc,EACtBlB,EAAQqB,SAAS1iB,KAAKkiB,cAAeZ,EAAOC,yCAI5C,IAAI1S,EAAK7O,KAAKhH,MAAMgoB,KAAOhhB,KAAKhH,MAAMwQ,OAClCsF,EAAK9O,KAAKhH,MAAMioB,KAAOjhB,KAAKhH,MAAMyQ,OAClCkZ,EAAOxoB,KAAKwV,KAAKd,EAAKA,EAAKC,EAAKA,GAEpC,MADc,MAAQ9O,KAAKic,OAAOpN,GAAM,OAAS7O,KAAKic,OAAOnN,GAAM,MAAQ9O,KAAKic,OAAO0G,kCAIpFlkB,GACH,OAAQA,EAAMuB,KAAKsR,MAAM5N,SAASwY,QAAQlc,KAAKsR,MAAM7N,sDAKrDzD,KAAK+gB,aAAe,IAAIrN,GAAM1T,KAAK8gB,cAAc9H,SACjDhZ,KAAK+gB,aAAa1b,OAASrF,KAAKsR,MAAMzM,MAAMQ,OAC5CrF,KAAK+gB,aAAa3b,WAAapF,KAAKsR,MAAMzM,MAAMO,WAChDpF,KAAK+gB,aAAazc,WAAatE,KAAKsR,MAAMzM,MAAMP,WAEhDtE,KAAK+gB,aAAa9H,GAAG,iBAAkBjZ,KAAK8X,iBAC5C9X,KAAK+gB,aAAa9H,GAAG,iBAAkBjZ,KAAKiX,iBAC5CjX,KAAK+gB,aAAa9H,GAAG,eAAgBjZ,KAAKgY,eAE1ChY,KAAK+gB,aAAapN,OAAOuF,iBAAiB,aAAclZ,KAAKuY,kBAC7DvY,KAAK+gB,aAAapN,OAAOuF,iBAAiB,iBAAkBlZ,KAAK4Y,kEAI7D5Y,KAAKhH,MAAMkoB,gBACXlhB,KAAKohB,sDAKTphB,KAAK+gB,aAAazD,QAClBtd,KAAK+gB,aAAaxR,oBAClBvP,KAAK+gB,aAAa6B,2DAIlB,IAAIC,EAAa7iB,KAAKsR,MAAMzM,MAAM8O,OAC9B5R,EAAQ8gB,EAAW9gB,MACnBC,EAAS6gB,EAAW7gB,OACpBwd,EAAMqD,EAAWnL,UACjB6H,EAAOsD,EAAWrL,WACtB,OACIzF,EAAAC,EAAAC,cAAA,UAAQoH,SAAS,IAAIC,IAAKtZ,KAAK8gB,cACvB/e,MAAOA,EACPC,OAAQA,EACRgE,MAAO,CAACyZ,SAAU,WAAYD,IAAKA,EAAKD,KAAMA,YA/LlC9L,aAoNjB+F,eAdS,SAAA3M,GAAW,IAAT3H,EAAS2H,EAAT3H,IACtB,MAAO,CACHL,MAAOK,EAAIL,MACXnB,QAASwB,EAAIxB,QACbD,SAAUyB,EAAIzB,WAIK,SAAAsJ,GACvB,MAAO,CACH6J,qBAAsB,SAAC/R,EAAO5F,EAAGC,EAAGmQ,GAAd,OAAwBtC,EAAS0M,GAA6B5U,EAAO5F,EAAGC,EAAGmQ,OAI1FmK,CAA6CqH,ICtG7CiC,eA9GX,SAAAA,EAAYzG,GAAQ,IAAAzI,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA8iB,IAChBlP,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAAwpB,GAAA/O,KAAA/T,QACKmC,QAAU,IAAIwa,KACnBN,EAAOxX,MAAM+P,SAAShB,EAAKzR,SAE3ByR,EAAKmP,WAAa,IAAIC,KACtBpP,EAAKmP,WAAW9jB,EAAI,EACpB2U,EAAKmP,WAAW7jB,EAAI,EACpBmd,EAAOxX,MAAM+P,SAAShB,EAAKmP,YARXnP,uEA0CbnV,GACH,OAAQA,EAAIuB,KAAKsR,MAAM5N,SAASwY,QAAQlc,KAAKsR,MAAM7N,gDAInD,GAAKzD,KAAK+iB,WAAV,CAEA,IAAIle,EAAQ7E,KAAKsR,MAAMzM,MAEnB5C,EAAMjC,KAAKsR,MAAM7G,gBAAgBxI,IACjChB,GAAagB,EAAIJ,KAAOI,EAAI4E,MAAQ,EAApC5F,GAA2CgB,EAAIH,KAAOG,EAAI6E,MAAQ,EAClE+H,EAAK,GAAMhK,EAAMP,WAAaO,EAAMO,YACpC0J,EAAK,GAAMjK,EAAMP,WAAaO,EAAMO,YAEpCnD,EAAIH,OAASG,EAAI6E,OACjB+H,EAAK,EACLC,GAAMA,GAOV9O,KAAK+iB,WAAWd,KAAOjiB,KAAKic,OAAOjc,KAAKsR,MAAM7G,gBAAgBvR,QAG9D8G,KAAK+iB,WAAWZ,KAAhB,GAAArZ,OADe,GACf,YAEA,IAAIma,EAAU,GAAMpe,EAAMP,WAAaO,EAAMO,YAGzC+Y,EAAKld,EAAU4N,EACfuP,EAAKnd,EAAU6N,EACnB9O,KAAK+iB,WAAWnJ,aAAauE,EAAIC,EAAI6E,GAAUA,mCAI3CjjB,KAAKsR,MAAM7G,kBACXzK,KAAKmC,QAAQ8X,SAAWA,GAASja,KAAKsR,MAAM7G,iBAC5CzK,KAAKkjB,2DAITljB,KAAKohB,oDAGLphB,KAAKmC,QAAQ8X,SAASqD,QAClBtd,KAAKsR,MAAMlH,oBAAsBpK,KAAKsR,MAAMjH,qBAC5CrK,KAAKsR,MAAMhH,mBAAmBlE,WAC9BpG,KAAKsR,MAAM/G,oBAAoBnE,YAE/BpG,KAAKohB,OACLphB,KAAKkjB,8DAKTljB,KAAKsR,MAAMzM,MAAMwY,YAAYrd,KAAKmC,SAClCnC,KAAKmC,QAAQ8X,SAASqD,QACtBtd,KAAKsR,MAAMzM,MAAMwY,YAAYrd,KAAK+iB,YAClC/iB,KAAK+iB,WAAWd,KAAO,oCAIvB,OAAO,YA3GiBxO,aCcjB0P,GAhBW,SAAAtW,GAAgD,IAA9ChI,EAA8CgI,EAA9ChI,MAAOue,EAAuCvW,EAAvCuW,OAAQC,EAA+BxW,EAA/BwW,OAAQ3f,EAAuBmJ,EAAvBnJ,QAASD,EAAcoJ,EAAdpJ,SACpDof,EAAahe,EAAM8O,OACnB6L,EAAMqD,EAAWnL,UAAY,GAC7B6H,EAAOsD,EAAW9gB,MAAQ,IAC1B9C,EAAI4F,EAAMgR,MAAMuN,GAChBlkB,EAAI2F,EAAMiR,MAAMuN,GACpB,OACItR,EAAAC,EAAAC,cAAA,OAAKjM,MAAO,CAACyZ,SAAU,WAAYD,IAAKA,EAAKD,KAAMA,EAC/C+D,gBAAiB,QAASC,QAAQ,KAClCxR,EAAAC,EAAAC,cAAA,MAAIjM,MAAO,CAACwd,OAAQ,EAAGC,QAAS,IAAhC,MACQxH,GAAOhd,EAAEyE,EAAQD,GADzB,OACwCwY,GAAO/c,EAAEwE,EAAQD,0BCb/DigB,GAAYlY,SAASmY,eAAe,cAkC3BC,eA9BX,SAAAA,EAAYtS,GAAO,IAAAsC,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA4jB,IACfhQ,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAAsqB,GAAA7P,KAAA/T,KAAMsR,KAIDuS,GAAKrY,SAASyG,cAAc,OALlB2B,oFAWf8P,GAAUI,YAAY9jB,KAAK6jB,mDAK3BH,GAAUrG,YAAYrd,KAAK6jB,qCAK3B,OAAOE,IAASC,aAEZhkB,KAAKsR,MAAM0I,SAEXha,KAAK6jB,WA1BGpQ,iCCyELwQ,gNArEXC,kBAAoB,SAACC,GACI,aAAjBA,EAAG5M,OAAOnM,IACVwI,EAAKtC,MAAM8S,gBAInBC,cAAgB,SAACF,GACG,WAAZA,EAAGG,MACH1Q,EAAKtC,MAAM8S,gBAInBG,YAAc,SAACJ,GACXA,EAAKA,GAAM9rB,OAAO6e,MAElBtD,EAAK8E,QAAU9E,EAAK4Q,MAAQL,EAAG7M,QAC/B1D,EAAK+E,QAAU/E,EAAK6Q,MAAQN,EAAG1M,QAC/B7D,EAAK4Q,MAAQL,EAAG7M,QAChB1D,EAAK6Q,MAAQN,EAAG1M,QAEhB,IAAIiN,EAAUP,EAAG5M,OACjBmN,EAAQ1e,MAAMwZ,IAAOkF,EAAQhN,UAAY9D,EAAK+E,QAAW,KACzD+L,EAAQ1e,MAAMuZ,KAAQmF,EAAQlN,WAAa5D,EAAK8E,QAAW,QAG/DiM,iBAAmB,SAACR,GAEhBA,EAAG5M,OAAOqN,UAAY,KACtBT,EAAG5M,OAAOsN,YAAc,QAG5BC,cAAgB,SAACX,GACbA,EAAKA,GAAM9rB,OAAO6e,MAElBtD,EAAK4Q,MAAQL,EAAG7M,QAChB1D,EAAK6Q,MAAQN,EAAG1M,QAChB0M,EAAG5M,OAAOqN,UAAYhR,EAAK+Q,iBAE3BR,EAAG5M,OAAOsN,YAAcjR,EAAK2Q,iGAI7B/Y,SAAS0N,iBAAiB,UAAWlZ,KAAKqkB,8DAI1C7Y,SAASuZ,oBAAoB,UAAW/kB,KAAKqkB,gDAI7C,OAAOrkB,KAAKsR,MAAM0T,UACdjT,EAAAC,EAAAC,cAACgT,GAAD,KACIlT,EAAAC,EAAAC,cAAA,OACI7G,GAAG,WACH+G,UAAWX,KAAQ0T,SACnBhT,QAASlS,KAAKkkB,mBAEdnS,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQyS,WACnBkB,YAAanlB,KAAK8kB,eAEnB/S,EAAAC,EAAAC,cAAA,cAASjS,KAAKsR,MAAM8T,QACnBplB,KAAKsR,MAAM0I,YAIxB,YAvEavG,aCoCV4R,GAhCI,SAAC/T,GAChB,OACIS,EAAAC,EAAAC,cAACqT,GAAD,CACIN,UAAW1T,EAAM7M,eACjB2f,WAAY9S,EAAMiU,iBAClBH,OAAO,QAEPrT,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQ6T,YACpBtT,EAAAC,EAAAC,cAAA,UAAKX,EAAM1N,MAAX,KAAoB0N,EAAMzN,SAE1BkO,EAAAC,EAAAC,cAAA,6BACAF,EAAAC,EAAAC,cAAA,0BACAF,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,oCACAF,EAAAC,EAAAC,cAAA,KAAGuT,KAAK,8CAAR,8CAGAzT,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,4CACAF,EAAAC,EAAAC,cAAA,KAAGuT,KAAK,gDAAR,gDAGAzT,EAAAC,EAAAC,cAAA,kCC3BhB,SAASwT,GAAiBC,EAAI9iB,GAC1B8iB,EAAGC,aAAa,SACZD,EAAGE,eAAe,IAAKhjB,EAAMmD,KAAK9G,GAClCymB,EAAGE,eAAe,IAAKhjB,EAAMmD,KAAK7G,GAClCwmB,EAAGE,eAAe,QAAShjB,EAAMxB,OACrCskB,EAAGG,aAGP,SAASC,GAAmBJ,EAAI9iB,GAC5B8iB,EAAGC,aAAa,WACZD,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKxE,GAAGtC,GACtCymB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKxE,GAAGrC,GACtCwmB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtE,GAAGxC,GACtCymB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtE,GAAGvC,GACtCwmB,EAAGE,eAAe,QAAShjB,EAAMxB,OACrCskB,EAAGG,aAGP,SAASE,GAAeL,EAAI9iB,GACxB8iB,EAAGC,aAAa,OACZD,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMmD,KAAKrM,MAAMuF,IACpDymB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMmD,KAAKrM,MAAMwF,IACpDwmB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMmD,KAAKpM,IAAIsF,IAClDymB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMmD,KAAKpM,IAAIuF,IAClDwmB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtM,OAAOwF,GAC1CymB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtM,OAAOyF,GAC1CwmB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKnM,mBAAqBsC,IAAK,MAAQ,MACrEwpB,EAAGE,eAAe,QAAShjB,EAAMxB,OACrCskB,EAAGG,aAGP,SAASI,GAAkBP,EAAI9iB,GAC3B8iB,EAAGC,aAAa,UACZD,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtM,OAAOwF,GAC1CymB,EAAGE,eAAe,KAAMhjB,EAAMmD,KAAKtM,OAAOyF,GAC1CwmB,EAAGE,eAAe,QAAShjB,EAAMxB,OACrCskB,EAAGG,aAOP,SAASK,GAAmBR,EAAIjqB,GAC5BiqB,EAAGC,aAAa,WADqB,IAAArlB,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAGrC,QAAAsH,EAAAC,EAAiBjF,EAAQc,MAAzBe,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAgC,KAAvB8a,EAAuB3a,EAAArF,MACxBggB,EAAKzc,gBAAkBC,IAAY1C,GACnCwpB,EAAGC,aAAa,UAGhBD,EAAGC,aAAa,QAGpBD,EAAGE,eAAe,UAAlB,GAAA9c,OAAgCsS,EAAKhY,OART,IAAAnG,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAU5B,QAAAiE,EAAAC,EAAiB+d,EAAjB9d,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuB,KAAdue,EAAcpe,EAAAhC,MACnBsqB,EAAGC,aAAa,QAChB,IAAI/iB,EAAQ4Y,EAAK5Y,MACbA,aAAiBxG,KACjBspB,EAAGE,eAAe,OAAQ,WAC1BF,EAAGE,eAAe,KAAMhjB,EAAMrB,GAAGtC,GACjCymB,EAAGE,eAAe,KAAMhjB,EAAMrB,GAAGrC,GACjCwmB,EAAGE,eAAe,KAAMhjB,EAAMnB,GAAGxC,GACjCymB,EAAGE,eAAe,KAAMhjB,EAAMnB,GAAGvC,IAC1Bsc,EAAK5Y,iBAAiBtI,KAC7BorB,EAAGE,eAAe,OAAQ,SAC1BF,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMlJ,MAAMuF,IAC/CymB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMlJ,MAAMwF,IAC/CwmB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMjJ,IAAIsF,IAC7CymB,EAAGE,eAAe,KAAMzrB,KAAK6rB,MAAMpjB,EAAMjJ,IAAIuF,IAC7CwmB,EAAGE,eAAe,KAAMhjB,EAAMnJ,OAAOwF,GACrCymB,EAAGE,eAAe,KAAMhjB,EAAMnJ,OAAOyF,GACrCwmB,EAAGE,eAAe,KAAMhjB,EAAMhJ,mBAAqBsC,IAAK,MAAQ,OAEhEwpB,EAAGE,eAAe,OAAQ,WAE9BF,EAAGG,cA/BqB,MAAAloB,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAkC5BuoB,EAAGG,cArC8B,MAAAloB,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAwCrCklB,EAAGG,aAGA,SAASM,GAAgBtjB,GAC5B,IAAI6iB,EAAK,IAAIU,MAAU,GACvBV,EAAGW,cAAc,MAAO,SAExBX,EAAGC,aAAa,UAChBD,EAAGC,aAAa,SAAS1D,KAAK,8BAA8B4D,aALxB,IAAA7nB,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAOpC,QAAAgF,EAAAC,EAAkByE,EAAlBvF,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAA0B,KAAjB4E,EAAiBzE,EAAA/C,MAClBwH,EAAMmD,gBAAgB7E,IACtBukB,GAAiBC,EAAI9iB,GAEhBA,EAAMmD,gBAAgB3J,IAC3B0pB,GAAmBJ,EAAI9iB,GAElBA,EAAMmD,gBAAgBzL,IAC3ByrB,GAAeL,EAAI9iB,GAEdA,EAAMmD,gBAAgBpE,IAC3BskB,GAAkBP,EAAI9iB,GAEjBA,EAAMmD,gBAAgB7D,KAGtBU,EAAMmD,gBAAgBrK,KAC3BwqB,GAAmBR,EAAI9iB,EAAMmD,OAxBD,MAAApI,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GA6BpC,OADAwnB,EAAGY,cACIZ,EAAGa,mCC9ECC,uLAlCP,IAAIC,EAAezmB,KAAKsR,MAAM0T,UAC1BhlB,KAAKsR,MAAMrK,OAAOwB,IAAK,SAAAlC,GACvB,OAAOA,EAAMH,UAAY,CACrB8G,SAAQ,GAAApE,OAAKvC,EAAM/C,KAAX,QACRkjB,UAAWP,GAAgB5f,EAAM1D,SACjC,OACH,GACL,OAAO7C,KAAKsR,MAAM0T,WAAahlB,KAAKsR,MAAMrK,OAAO/N,OAAS,EACtD6Y,EAAAC,EAAAC,cAACqT,GAAD,CACIN,UAAWhlB,KAAKsR,MAAM0T,UACtBZ,WAAYpkB,KAAKsR,MAAM8S,WACvBgB,OAAO,kBAEPrT,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQgV,eACpBzU,EAAAC,EAAAC,cAAA,4DACAF,EAAAC,EAAAC,cAAA,UAEKwU,EAAahe,IAAI,SAAA2F,GAAI,OACT,OAATA,EAAgB,KAChB2D,EAAAC,EAAAC,cAAA,MAAI/R,IAAKkO,EAAKlB,UACV6E,EAAAC,EAAAC,cAAA,KAAGuT,KAAM,gCAAkCmB,mBAAmBvY,EAAKsY,WAChEE,SAAUxY,EAAKlB,UACbkB,EAAKlB,gBAQ9B,YAhCgBuG,aCHtBoT,GAAerb,SAASmY,eAAe,iBA0B9BmD,eAvBX,SAAAA,EAAYxV,GAAO,IAAAsC,EAAA,OAAAta,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAA8mB,IACflT,EAAAta,OAAAua,GAAA,EAAAva,CAAA0G,KAAA1G,OAAAwa,GAAA,EAAAxa,CAAAwtB,GAAA/S,KAAA/T,KAAMsR,KACDuS,GAAKrY,SAASyG,cAAc,OAFlB2B,oFAMfiT,GAAa/C,YAAY9jB,KAAK6jB,mDAI9BgD,GAAaxJ,YAAYrd,KAAK6jB,qCAI9B,OAAOE,IAASC,aAEZhkB,KAAKsR,MAAM0I,SAEXha,KAAK6jB,WAnBUpQ,iCCsBZsT,gNAtBX/tB,MAAQ,CACJguB,SAAS,yFAIThnB,KAAKkgB,SAAS,CACV8G,SAAS,IAEbhnB,KAAKsR,MAAM2V,kDAIX,OAASjnB,KAAKhH,MAAMguB,QAChBjV,EAAAC,EAAAC,cAACiV,GAAD,KACInV,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQuV,SAAUE,eAAgBjnB,KAAKsR,MAAM2V,gBACzDlV,EAAAC,EAAAC,cAAA,UAAKjS,KAAKsR,MAAM7C,WAEN,YAlBPgF,iCC4BvB,SAAS0T,GAAWC,GAGhB,IAFA,IAAIxqB,EAAQ,GAEZiL,EAAA,EAAAwf,EAAiBtZ,MAAMuZ,KAAKF,GAA5Bvf,EAAAwf,EAAAnuB,OAAA2O,IAAuC,CAAlC,IAAI2T,EAAI6L,EAAAxf,GACLxO,EAAOmiB,EAAK+L,aAAa,QAE7B,GAAa,YAATluB,EAAoB,CACpB,IAAIkI,EAAK,IAAIL,IAAMC,SAASqa,EAAK+L,aAAa,MAAM,IAAKpmB,SAASqa,EAAK+L,aAAa,MAAM,KACtF9lB,EAAK,IAAIP,IAAMC,SAASqa,EAAK+L,aAAa,MAAM,IAAKpmB,SAASqa,EAAK+L,aAAa,MAAM,KAE1F3qB,EAAMgE,KAAK,IAAIxE,IAAQmF,EAAIE,IAG/B,GAAa,UAATpI,EAAkB,CAClB,IAAIkI,EAAK,IAAIL,IAAMC,SAASqa,EAAK+L,aAAa,MAAM,IAAKpmB,SAASqa,EAAK+L,aAAa,MAAM,KACtF9lB,EAAK,IAAIP,IAAMC,SAASqa,EAAK+L,aAAa,MAAM,IAAKpmB,SAASqa,EAAK+L,aAAa,MAAM,KACtFtrB,EAAK,IAAIiF,IAAMC,SAASqa,EAAK+L,aAAa,MAAM,IAAKpmB,SAASqa,EAAK+L,aAAa,MAAM,KAEtF3tB,EAA+C,OAA5B4hB,EAAK+L,aAAa,MAErC1tB,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAE1BQ,IAAQN,MAAMC,GAAGL,EAAYG,KAC7BA,EAAWJ,EAAmBI,EAAW,EAAEG,KAAKC,GAAKJ,EAAW,EAAEG,KAAKC,IAG3E,IAAIC,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEvB0D,EAAMgE,KAAK,IAAItG,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,KAIxD,OAAOgD,EAGX,SAAS4qB,GAAaC,GAClB,IAAIhsB,EAAU,IAAIC,IAKdyK,EAAQshB,EAAYF,aAAa,SACrC9rB,EAAQuK,MAAQ,CACZL,OAAQQ,QAAShN,EACjByM,KAAMO,QAAShN,EACf0M,MAAO,GAIX,IAAIzE,EAAQqmB,EAAYF,aAAa,SACrC9rB,EAAQ2F,MAAQA,EAIhB,IADA,IAAIsmB,EAAUD,EAAYE,qBAAqB,UAC/CC,EAAA,EAAAC,EAAmB9Z,MAAMuZ,KAAKI,GAA9BE,EAAAC,EAAA3uB,OAAA0uB,IAAwC,CAAnC,IACGR,EADOS,EAAAD,GACWD,qBAAqB,QAC3ClsB,EAAQY,QAAQ8qB,GAAWC,IAK/B,IADA,IAAIU,EAAQL,EAAYE,qBAAqB,QAC7CI,EAAA,EAAAC,EAAiBja,MAAMuZ,KAAKQ,GAA5BC,EAAAC,EAAA9uB,OAAA6uB,IAAoC,CAA/B,IACGX,EADKY,EAAAD,GACWJ,qBAAqB,QACzClsB,EAAQY,QAAQ8qB,GAAWC,IAG/B,OAAO3rB,EAGX,SAASwsB,GAAaC,GAClB,IAAI3mB,EAAK,IAAIL,IAAMC,SAAS+mB,EAAWX,aAAa,MAAM,IAAKpmB,SAAS+mB,EAAWX,aAAa,MAAM,KAClG9lB,EAAK,IAAIP,IAAMC,SAAS+mB,EAAWX,aAAa,MAAM,IAAKpmB,SAAS+mB,EAAWX,aAAa,MAAM,KAElGplB,EAAU,IAAI/F,IAAQmF,EAAIE,GAG1BL,EAAQ8mB,EAAWX,aAAa,SAGpC,OAFAplB,EAAQf,MAAQA,EAETe,EAGX,SAASgmB,GAAWC,GAChB,IAAI7mB,EAAK,IAAIL,IAAMC,SAASinB,EAASb,aAAa,MAAM,IAAKpmB,SAASinB,EAASb,aAAa,MAAM,KAC9F9lB,EAAK,IAAIP,IAAMC,SAASinB,EAASb,aAAa,MAAM,IAAKpmB,SAASinB,EAASb,aAAa,MAAM,KAC9FtrB,EAAK,IAAIiF,IAAMC,SAASinB,EAASb,aAAa,MAAM,IAAKpmB,SAASinB,EAASb,aAAa,MAAM,KAE9F3tB,EAAmD,OAAhCwuB,EAASb,aAAa,MAEzC1tB,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAE1BQ,IAAQN,MAAMC,GAAGL,EAAYG,KAC7BA,EAAWJ,EAAmBI,EAAW,EAAEG,KAAKC,GAAKJ,EAAW,EAAEG,KAAKC,IAG3E,IAAIC,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEnBiC,EAAM,IAAIb,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,GAG3CwH,EAAQgnB,EAASb,aAAa,SAGlC,OAFApsB,EAAIiG,MAAQA,EAELjG,EAGX,SAASktB,GAAWC,GAChB,IAAIrnB,EAAQ,IAAIC,IAAMC,SAASmnB,EAASf,aAAa,KAAK,IAAKpmB,SAASmnB,EAASf,aAAa,KAAK,KAG/FnmB,EAAQknB,EAASf,aAAa,SAGlC,OAFAtmB,EAAMG,MAAQA,EAEPH,EAGX,SAASsnB,GAAWC,GAChB,IAAIhK,EAAM,IAAIjkB,IAAQ0T,MAKtB,OAJAuQ,EAAI/kB,OAAS,IAAIyH,IAAMC,SAASqnB,EAASjB,aAAa,MAAM,IAAKpmB,SAASqnB,EAASjB,aAAa,MAAM,KACtG/I,EAAIzc,MAAQZ,SAASqnB,EAASjB,aAAa,SAAS,IACpD/I,EAAIxc,OAASb,SAASqnB,EAASjB,aAAa,UAAU,IACtD/I,EAAItQ,IAAMsa,EAASjB,aAAa,OACzB/I,EAxJXjkB,IAAQ0T,MAAR,WACI,SAAAA,IAAe3U,OAAAyG,EAAA,EAAAzG,CAAA0G,KAAAiO,GACXjO,KAAKkO,IAAM,GAKXlO,KAAKvG,OAAS,IAAIc,IAAQ2G,MAI1BlB,KAAK+B,MAAQ,EAIb/B,KAAKgC,OAAS,EAftB,OAAA1I,OAAA2G,EAAA,EAAA3G,CAAA2U,EAAA,EAAA/N,IAAA,MAAAmN,IAAA,WAkBQ,OAAO,IAAI9S,IAAQ2H,IACflC,KAAKvG,OAAOwF,EAAIe,KAAK+B,MAAM,EAC3B/B,KAAKvG,OAAOyF,EAAIc,KAAKgC,OAAO,EAC5BhC,KAAKvG,OAAOwF,EAAIe,KAAKgC,OAAO,EAC5BhC,KAAKvG,OAAOyF,EAAIc,KAAKgC,OAAO,OAtBxCiM,EAAA,GCAA,IAAMwa,GAAc,OACdC,GAAc,MACpB,SAASC,GAAaxoB,GAClB,OAAOhG,KAAK6rB,MAAM4C,OAAOzoB,GAAKsoB,GAAY,GAE9C,SAASI,GAAa1oB,GAClB,OAAOhG,KAAK6rB,MAAM4C,OAAOzoB,GAAKuoB,GAAY,GAG9C,SAASlB,GAAasB,EAAOpvB,GASzB,IARA,IAKI+H,EACAxF,EANA4G,EAAS,GACTT,EAAI1I,EACJiH,EAAOmoB,EAAM1mB,GACb2mB,EAAQpoB,EAAKK,MAAM,KACnBO,EAAK,IAAIL,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAG3DC,GAAc,IACN,CAGR,QADAD,GADApoB,EAAOmoB,EAAM1mB,IACApB,MAAM,MACL,IACV,IAAK,KACDS,EAAK,IAAIP,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3DlmB,EAAOjC,KAAM,IAAIxE,IAAQmF,EAAIE,IAE7BF,EAAKE,EAAG7F,QACR,MACJ,IAAK,KACD6F,EAAK,IAAIP,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3D9sB,EAAK,IAAIiF,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAE3D,IACInvB,EAA6B,MADrBmvB,EAAM,GACqBxuB,IAAQ2B,GAAK3B,IAAQ4B,IAExDtC,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAC1BE,IAAMC,GAAGL,EAAYG,KACrBA,GAAY,EAAEG,KAAKC,GACnBR,GAAmB,GAEvB,IAAIS,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEvB2J,EAAOjC,KAAK,IAAItG,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,IAEjD2H,EAAKE,EAAG7F,QACR,MACJ,IAAK,KACDotB,GAAc,EAKtB,GAAIA,EACA,MAGJ5mB,IAEJ,OAAOS,EAGX,SAASomB,GAAU9oB,EAAK+oB,GACpB,IAAIH,EAAQ5oB,EAAIa,MAAM,KAClBO,EAAK,IAAIL,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3DtnB,EAAK,IAAIP,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3D5mB,EAAU,IAAI/F,IAAQmF,EAAIE,GAE1B0nB,EAAWD,EADFN,OAAOG,EAAM,KAG1B,OADA5mB,EAAQ4a,SAAWoM,EACZhnB,EAGX,SAASinB,GAASjpB,EAAK+oB,GACnB,IAAIH,EAAQ5oB,EAAIa,MAAM,KAClBO,EAAK,IAAIL,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3DtnB,EAAK,IAAIP,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAC3D9sB,EAAK,IAAIiF,IAAOynB,GAAaI,EAAM,IAAKJ,GAAaI,EAAM,KAG3DnvB,EAA6B,MADrBmvB,EAAM,IACqBxuB,IAAQ2B,GAAK3B,IAAQ4B,IAExDtC,EAAaC,YAAOmC,EAAGsF,GAAIxH,MAC3BC,EAAWF,YAAOmC,EAAIwF,GAAI1H,MAC1BQ,IAAQN,MAAMC,GAAGL,EAAYG,KAC7BA,GAAY,EAAEG,KAAKC,GACnBR,GAAmB,GAEvB,IAAIS,EAAIP,YAAOmC,EAAIsF,GAAIrI,OAEnBiC,EAAM,IAAIb,IAAI2B,EAAI5B,EAAGR,EAAYG,EAAUJ,GAG3CuvB,EAAWD,EADFN,OAAOG,EAAM,KAI1B,OAFA5tB,EAAI4hB,SAAWoM,EAERhuB,EClGX,IAAMkuB,GAAgB,UAChBC,GAAiB,IAIjBC,GAAQ,OAEd,SAASC,GAASrpB,GACd,IAAI1B,EAAMmqB,OAAOzoB,GACjB,OAAOhG,KAAK6rB,MAAMvnB,EAAI4qB,GAAcC,GAAe,GCRvD,IAAMG,GAAgB,IACtB,SAASC,GAAevpB,GACpB,OAAOhG,KAAK6rB,MAAM4C,OAAOzoB,GAAKspB,GAAc,GCFzC,SAASE,GAASzc,EAAU/M,GAC/B,IAAIwN,EAAM,IAAIV,GACdU,EAAIT,SAAWA,EAEf,IAEIsB,GAFS,IAAI1O,GAEQ8N,MAAMzN,GAE/B,GAAIqO,EAAYtV,OAAS,EAAG,KAAAoH,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IACxB,QAAAsH,EAAAC,EAAkB8N,EAAlBlR,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA+B,KAAtBsC,EAAsBnC,EAAArF,MAC3BuS,EAAI9K,OAAOjC,KAAKgC,IAFI,MAAAjF,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,IAM5B,OAAOmN,ECLX,IAAMic,GAAa,SAACC,EAAQC,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GAEvD,IAAIC,EAAU,IAAIC,QAAS,SAACC,EAASC,GACjCN,EAAOpL,OAAU,SAAS2L,EAASvlB,EAAOoC,EAAQ8F,EAAUgd,EAAOG,EAASC,GACxE,OAAO,SAACjT,GACJ,IAIIvJ,EAJAY,EAAS2I,EAAMK,OAAO7G,OAEtB2Z,EAAeD,EAAQ5mB,KAAKxC,MAAM,KAClCspB,EAAYD,EAAaA,EAAanxB,OAAO,GAG7CyU,EADc,QAAd2c,ELyIb,SAAkBpd,EAAU/M,GAC/B,IAAIwN,EAAM,IAAIV,GAEdU,EAAIT,SAAWA,EAEf,IACIqd,GADS,IAAIC,WACGC,gBAAgBtqB,EAAK,YAGrCuqB,EAASH,EAAO5C,qBAAqB,SACrC+C,GAAUA,EAAOxxB,OAAS,IAC1ByU,EAAI/J,MAAQ8mB,EAAO,GAAGC,WAAWC,WAKrC,IADA,IAAIC,EAAcN,EAAO5C,qBAAqB,WAC9CmD,EAAA,EAAAC,EAAuBhd,MAAMuZ,KAAKuD,GAAlCC,EAAAC,EAAA7xB,OAAA4xB,IAAgD,CAA3C,IACGrvB,EAAU+rB,GADCuD,EAAAD,IAEfnd,EAAIR,SAASvM,KAAKnF,GAKtB,IADA,IAAIuvB,EAAcT,EAAO5C,qBAAqB,YAC9CsD,EAAA,EAAAC,EAAqBnd,MAAMuZ,KAAK0D,GAAhCC,EAAAC,EAAAhyB,OAAA+xB,IAA8C,CAAzC,IACGxvB,EAAU+rB,GADD0D,EAAAD,IAEbtd,EAAIP,UAAUxM,KAAKnF,GAKvB,IADA,IAAI0vB,EAAcZ,EAAO5C,qBAAqB,WAC9CyD,EAAA,EAAAC,EAAuBtd,MAAMuZ,KAAK6D,GAAlCC,EAAAC,EAAAnyB,OAAAkyB,IAAgD,CAA3C,IACGjpB,EAAU8lB,GADCoD,EAAAD,IAEfzd,EAAI9K,OAAOjC,KAAKuB,GAKpB,IADA,IAAImpB,EAAYf,EAAO5C,qBAAqB,SAC5C4D,EAAA,EAAAC,EAAqBzd,MAAMuZ,KAAKgE,GAAhCC,EAAAC,EAAAtyB,OAAAqyB,IAA4C,CAAvC,IACGE,EAAQtD,GADCqD,EAAAD,IAEb5d,EAAI9K,OAAOjC,KAAK6qB,GAKpB,IADA,IAAIC,EAAYnB,EAAO5C,qBAAqB,SAC5CgE,EAAA,EAAAC,EAAqB7d,MAAMuZ,KAAKoE,GAAhCC,EAAAC,EAAA1yB,OAAAyyB,IAA4C,CAAvC,IACG1qB,EAAQonB,GADCuD,EAAAD,IAEbhe,EAAI9K,OAAOjC,KAAKK,GAKpB,IADA,IAAI4qB,EAAYtB,EAAO5C,qBAAqB,WAC5CmE,EAAA,EAAAC,EAAqBhe,MAAMuZ,KAAKuE,GAAhCC,EAAAC,EAAA7yB,OAAA4yB,IAA4C,CAAvC,IACGhO,EAAQyK,GADCwD,EAAAD,IAEbne,EAAI9K,OAAOjC,KAAKkd,GAGpB,OAAOnQ,EKhMeqe,CAAS5B,EAAQ5mB,KAAM+K,GAEV,QAAd+b,EFjBlB,SAAkBpd,EAAU/M,GAC/B,IAAIwN,EAAM,IAAIV,GACdU,EAAIT,SAAWA,EAIf,IAFA,IAAI9M,EAAeD,EAAI3H,MAAM,aAEpB4J,EAAI,EAAGA,EAAIhC,EAAalH,OAAQkJ,IAAK,CAC1C,IACI2mB,EADO3oB,EAAagC,GACPpB,MAAM,KAEnBirB,EAAKvC,GAAeX,EAAM,IAC1BmD,EAAKxC,GAAeX,EAAM,IAC1B5Y,EAAKyY,OAAOG,EAAM,IAClB3Y,EAAKwY,OAAOG,EAAM,IAClBnmB,EAAQ3B,YAAMgrB,EAAGC,GACrBtpB,EAAMuN,GAAKA,EACXvN,EAAMwN,GAAKA,EACXzC,EAAI9K,OAAOjC,KAAKgC,GAGpB,OAAO+K,EEFewe,CAAS/B,EAAQ5mB,KAAM+K,GAEV,QAAd+b,EACCX,GAASS,EAAQ5mB,KAAM+K,GAEV,SAAd+b,EACC7c,GAAU2c,EAAQ5mB,KAAM+K,GJuE3C,SAAkBrB,EAAU/M,GAC/B,IAAIwN,EAAM,IAAIV,GACdU,EAAIT,SAAWA,EAOf,IALA,IACIzR,EADA2E,EAAeD,EAAI3H,MAAM,aAGzB0wB,EAAY,GAEP9mB,EAAE,EAAGA,EAAIhC,EAAalH,OAAQkJ,IAAK,CACxC,IAAIzB,EAAOP,EAAagC,GACpB2mB,EAAQpoB,EAAKK,MAAM,KAEvB,GAA6B,MAAzB+nB,EAAM,GAAGqD,OAAO,EAAE,GAOtB,OAAQrD,EAAM,IACV,IAAK,IACDttB,EAAU,IAAIC,IACd,IACI2wB,EADU1rB,EAAKK,MAAM,KACF,GACvBvF,EAAQ4wB,SAAWA,EACnB,MACJ,IAAK,KACD,IAAI3yB,EAAQ0I,EACRS,EAAS2kB,GAAapnB,EAAc1G,GACxC+B,EAAQY,QAAQwG,GAChBT,EAAI1I,EAAQmJ,EAAO3J,OAAS,EAC5B,MACJ,IAAK,KACDyU,EAAI9K,OAAOjC,KAAKnF,GAChB,MACJ,IAAK,IACD,IAAI6wB,EAAUrD,GAAUtoB,EAAMuoB,GAC9Bvb,EAAI9K,OAAOjC,KAAK0rB,GAChB,MACJ,IAAK,IACD,IAAIC,EAASnD,GAASzoB,EAAMuoB,GAC5Bvb,EAAI9K,OAAOjC,KAAK2rB,OA7BxB,CACI,IAAIC,EAAS5D,OAAOG,EAAM,GAAGqD,OAAO,IAChCjD,EAAWN,GAAaE,EAAM,GAAGqD,OAAO,IAC5ClD,EAAUsD,GAAUrD,GAgC5B,OAAOxb,EIpHe8e,CAASrC,EAAQ5mB,KAAM+K,GAEjC,IAAIhI,EAAQS,EAAO2B,SAAS9D,EAAOoC,GACd,KAAjBmjB,EAAQ5mB,OACR+C,EAAM/C,KAAO4mB,EAAQ5mB,MAEzB+C,EAAM3C,MAAQ+J,EAAI/J,MAzBJ,IAAAtD,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IA2Bd,QAAAsH,EAAAC,EAAoBiN,EAAIR,SAAxB7P,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAkC,KAAzB7E,EAAyBgF,EAAArF,MAC9B,GAAIK,EAAQmB,MAAMwG,KAAO,GAAK3H,EAAQc,MAAM6G,KAAO,EAAG,CAGlD,IAAIR,EAAQ,IAAIkD,EAAMrK,OAAStC,EAAWsC,EAAQ2F,OAElDmF,EAAME,IAAI7D,KAjCJ,MAAAjF,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAAA,IAAAvD,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAqCd,QAAAiE,EAAAC,EAAoBsQ,EAAIP,UAAxB9P,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAmC,KAA1BxB,EAA0B2B,EAAAhC,MAC/B,GAAIK,EAAQmB,MAAMwG,KAAO,GAAK3H,EAAQc,MAAM6G,KAAO,EAAG,CAGlD,IAAIR,EAAQ,IAAIkD,EAAMrK,OAAStC,EAAWsC,EAAQ2F,OAElDmF,EAAME,IAAI7D,KA3CJ,MAAAjF,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAAA,IAAAa,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IA+Cd,QAAAgF,EAAAC,EAAkBuP,EAAI9K,OAAtBvF,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAA8B,KAArB4E,EAAqBzE,EAAA/C,MACtB6K,EAAQ,IAAIH,EAAMlD,OAAOzJ,EAAWyJ,EAAMxB,OAC9CmF,EAAME,IAAIR,IAjDA,MAAAtI,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GAsDVksB,IAAYL,EAAM,KAClB/iB,EAAOgC,YAAY/B,EAAQV,GAC3BA,EAAMJ,MAAQa,EAAOkB,aAAajB,GAClCV,EAAMH,WAAY,EAClB2G,EAAS,CACL1T,K3DlCa,wB2DmCbwL,MAAOA,EACPjC,MAAO2D,KAGfwG,EAAS,CACL1T,K3DpCS,gB2DqCTkN,MAAOA,IAGXwG,EAAS,CACL1T,K3DNiB,0B2DSrB6wB,GAAQ,IA1EC,CA4EdJ,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,EAAOG,GAEzCL,EAAOD,WAAWE,KAQtB,OAJA/c,EAAS,CACL1T,K3DnB+B,4B2DsB5B2wB,GAGL0C,GAAc,SAAC7C,EAAQC,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GAsDxD,OArDc,IAAIE,QAAS,SAACC,EAASC,GACjCN,EAAO3Q,iBAAiB,OAAQ,WAY5B,IAAI4E,EHxGT,SAAoBgM,GACvB,IAAIhM,EAAQ,GAERiL,EAAQe,EAAKtmB,KAAKxC,MAAM,KACxB2rB,EAAO5D,EAAM,GAAGqD,OAAO,GACvBQ,EAAO7D,EAAM,GAAKA,EAAM,GAAGqD,OAAO,QAAKjzB,EAEvC8F,EAAIgQ,MAAM2d,GAAQ,EAAIpD,GAASoD,GAAQ,IACvC1tB,EAAI+P,MAAM0d,GAAQ,EAAInD,GAASmD,GAAQ,IAW3C,OATA7O,EAAMrkB,OAAS,IAAIyH,IAAMjC,EAAEC,GAC3B4e,EAAM/b,MAAQwnB,GAAMD,GAAe,IACnCxL,EAAM7b,IAAM,IAAIC,IACZ4b,EAAMrkB,OAAOwF,EAAI6e,EAAM/b,MAAM,EAC7B+b,EAAMrkB,OAAOyF,EAAI4e,EAAM/b,MAAM,EAC7B+b,EAAMrkB,OAAOwF,EAAI6e,EAAM/b,MAAM,EAC7B+b,EAAMrkB,OAAOyF,EAAI4e,EAAM/b,MAAM,GAG1B+b,EGqFayK,CAAWuB,GACvBhM,EAAM5P,IAAMlO,KAAK0Q,OAEjB,IAAIzK,EAAQ,IAAIH,EAAMgY,GAElBvX,EAAQS,EAAO2B,SAAS9D,EAAOoC,GACjB,KAAd6iB,EAAKtmB,OACL+C,EAAM/C,KAAOsmB,EAAKtmB,MAGtB+C,EAAME,IAAIR,GAIN6jB,IAASC,EAAM,KACf/iB,EAAOgC,YAAY/B,EAAQV,GAC3BA,EAAMJ,MAAQa,EAAOkB,aAAajB,GAClCV,EAAMH,WAAY,EAClB2G,EAAS,CACL1T,K3DhGiB,wB2DiGjBwL,MAAOA,EACPjC,MAAO2D,KAIfwG,EAAS,CACL1T,K3DnGa,gB2DoGbkN,MAAOA,IAGXwG,EAAS,CACL1T,K3DrEqB,0B2DwEzB6wB,GAAQ,KACT,GAEHL,EAAOgD,cAAc/C,MAMvBgD,GAAW,SAAChD,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GAC7C,GAAkB,KAAdD,EAAKzwB,MACHywB,EAAKzwB,KAAKb,MAAM,WAAasxB,EAAKzwB,KAAKb,MAAM,kBAC3CsxB,EAAKzwB,KAAKb,MAAM,WAFxB,CAIA,IAAIqxB,EAAS,IAAIkD,WAEjB,OAAIjD,EAAKzwB,KAAKb,MAAM,WAAasxB,EAAKzwB,KAAKb,MAAM,kBAAoBsxB,EAAKtmB,KAAKhL,MAAM,aAC1EoxB,GAAWC,EAAQC,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GAGpDD,EAAKzwB,KAAKb,MAAM,WACdk0B,GAAY7C,EAAQC,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GAGvDE,QAAQE,OAAO,wBAGb6C,GAAY,SAACjD,EAAOllB,EAAOoC,GACpC,OAAO,SAAC8F,GACJA,EtCpEG,CACH1T,KrBnC+B,4B2D8G/B,IADA,IAAI4zB,EAAW,GACfplB,EAAA,EAAAwf,EAAiBtZ,MAAMuZ,KAAKyC,GAA5BliB,EAAAwf,EAAAnuB,OAAA2O,IAAoC,CAA/B,IAAIiiB,EAAIzC,EAAAxf,GACLmiB,EAAU8C,GAAShD,EAAMjlB,EAAOoC,EAAQ8F,EAAUgd,GACtDkD,EAASrsB,KAAKopB,GAGlB,OAAOC,QAAQiD,IAAID,GACdzc,KAAM,SAACY,GACJrE,EAASogB,GAAqB/b,MAGjCgc,MAAM,SAAAv0B,GACHw0B,MAAMx0B,EAAM4V,SACZ1B,EtClFL,CACH1T,KrBxC6B,8B2D8HxB8zB,GAAuB,SAAC/b,GACjC,MAAO,CACH/X,K3DlJ8B,yB2DmJ9BmT,cAAe4E,IC1MjBkc,gNACFC,aAAexW,IAAMC,cACrBwW,mBAAqBzW,IAAMC,cAE3ByW,qBAAuB,IACvBC,sBAAwB,IAExB10B,MAAQ,CACJ20B,UAAS,EACTC,cAAe,MAGnBC,uBAAyB,kBAAMja,EAAK2Z,aAAavU,QAAQ8U,WAEzDC,aAAe,SAAC5J,GACZA,EAAGlM,kBACHrE,EAAKtC,MAAM0c,QAAQ7J,EAAGyJ,eACXzJ,EAAGyJ,cAAcvf,MAAM,GAC7BC,YAAa,SAAAC,GAAM,OACpBqF,EAAKsM,SAAS,CACV0N,cAAerf,SAK3B0f,YAAc,SAAC9J,GAEXA,EAAGjM,iBAEH,IAAI6R,EAAQ,GAEZ,GAAI5F,EAAG+J,aAAa7f,OAEhB,IAAK,IAAIjM,EAAI,EAAGA,EAAI+hB,EAAG+J,aAAa7f,MAAMnV,OAAQkJ,IAE9C,GAAsC,SAAlC+hB,EAAG+J,aAAa7f,MAAMjM,GAAG+rB,KAAiB,CAC1C,IAAIrE,EAAO3F,EAAG+J,aAAa7f,MAAMjM,GAAGgsB,YACpCrE,EAAMnpB,KAAKkpB,SAKnBC,EAAQ5F,EAAG+J,aAAanE,MAG5BnW,EAAKtC,MAAM0b,UAAUjD,EAAOnW,EAAKtC,MAAMzM,MAAO+O,EAAKtC,MAAMrK,QAEzD2M,EAAKsM,SAAS,CAACyN,UAAS,OAG5BU,gBAAkB,SAAClK,GAEfA,EAAGjM,iBACHtE,EAAKsM,SAAS,CAACyN,UAAS,OAG5BW,iBAAmB,SAACnK,GAChBA,EAAGjM,iBACHtE,EAAKsM,SAAS,CAACyN,UAAS,OAG5BY,qBAAuB,SAACrX,GACpB,GAAMsX,MAAQzB,YAAc0B,SAA5B,CACA,IAAI1E,EAAQ7S,EAAMK,OAAOwS,MACzBnW,EAAKtC,MAAM0b,UAAUjD,EAAOnW,EAAKtC,MAAMzM,MAAO+O,EAAKtC,MAAMrK,YAG7Dmd,WAAa,WACTxQ,EAAKtC,MAAMod,kBACX9a,EAAKtC,MAAM8S,mGAIPpkB,KAAKsR,MAAM/E,4DAIfvM,KAAKytB,qBAAuBztB,KAAKwtB,mBAAmBxU,QAAQ3E,YAC5DrU,KAAK0tB,sBAAwB1tB,KAAKwtB,mBAAmBxU,QAAQ1E,8CAI7D,IAAIqa,EAAkC,KAA7B3uB,KAAKhH,MAAM40B,cAAuB,GAAK,EAC5CgB,EAAkC,KAA7B5uB,KAAKhH,MAAM40B,cAAuB,GAAK,EAC5CiB,EAAkB,GAItB,GAFiC,KAA7B7uB,KAAKhH,MAAM40B,gBAAsBiB,EAAkB,iBAEnD7uB,KAAKsR,MAAM/E,iBAAmBvM,KAAKsR,MAAM9E,cAActT,OAAS,EAAG,CACnE,IAAI41B,EAAc9uB,KAAKsR,MAAM9E,cAActT,OACvB,IAAhB41B,IAAmBD,EAAkB,gCACrCC,EAAc,IAAGD,EAAe,yBAAA/lB,OAA4BgmB,EAA5B,YAGxC,OAAO9uB,KAAKsR,MAAM0T,UACdjT,EAAAC,EAAAC,cAACqT,GAAD,CACIN,UAAWhlB,KAAKsR,MAAM0T,UACtBZ,WAAYpkB,KAAKokB,WACjBgB,OAAO,gBAEPrT,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQ8b,aACpBvb,EAAAC,EAAAC,cAAA,OAAKE,UAAWnS,KAAKhH,MAAM20B,SAAX,GAAA7kB,OACT0I,KAAQud,aADC,KAAAjmB,OACe0I,KAAQwd,sBADvB,GAAAlmB,OAET0I,KAAQud,aAFC,KAAAjmB,OAEe0I,KAAQyd,uBAClCjpB,MAAO,CAACkpB,YAAaP,EAAIQ,aAAcR,EAAIS,WAAYR,EAAIS,cAAeT,GAC1EZ,QAAShuB,KAAK+tB,aACduB,OAAQtvB,KAAKiuB,YACbsB,kBAAmBvvB,KAAKquB,gBACxBmB,mBAAoBxvB,KAAKsuB,iBACzBhV,IAAKtZ,KAAKwtB,oBAGsB,KAA7BxtB,KAAKhH,MAAM40B,cACP7b,EAAAC,EAAAC,cAAA,8CACAF,EAAAC,EAAAC,cAAA,KAAGjM,MAAO,CAACjE,MAAM/B,KAAKytB,qBAAsBzrB,OAAOhC,KAAK0tB,wBACnD1tB,KAAKhH,MAAM40B,gBAM5B7b,EAAAC,EAAAC,cAAA,gBAEAF,EAAAC,EAAAC,cAAA,UAAQC,QAASlS,KAAK6tB,wBAAtB,oBAIA9b,EAAAC,EAAAC,cAAA,SAAOjM,MAAO,CAACghB,QAAS,QACjB3tB,KAAK,OAAOigB,IAAKtZ,KAAKutB,aAAc/pB,KAAK,UAAUisB,UAAQ,EAC3DC,SAAU1vB,KAAKuuB,uBAGA,KAApBM,EACE9c,EAAAC,EAAAC,cAAC0d,GAAD,CACI1I,eAAkBjnB,KAAKsR,MAAMod,gBAC7BjgB,QAASogB,IAAsB,OAK/C,YA5Icpb,aAgKX+F,eAhBS,SAAAxgB,GACpB,MAAO,CACHiO,OAAQjO,EAAMiO,OACdpC,MAAO7L,EAAMkM,IAAIL,MACjB0H,gBAAiBvT,EAAMyT,OAAOF,gBAC9BC,cAAexT,EAAMyT,OAAOD,gBAIT,SAAAO,GACvB,MAAO,CACHigB,UAAW,SAACjD,EAAOllB,EAAOoC,GAAf,OAA0B8F,EAAS0M,GAAkBsQ,EAAOllB,EAAOoC,KAC9EynB,gBAAiB,kBAAM3hB,EDmDpB,CACH1T,K3DxJ+B,+B4DwGxBmgB,CAA6C8T,ICnKtDsC,gNACF52B,MAAM,CACFyE,MAAK,wFAIDuC,KAAKsR,MAAMzM,QAAU7E,KAAKhH,MAAMyE,OAChCuC,KAAKsR,MAAMue,0BAA0B7vB,KAAKsR,MAAMzM,MAAO7E,KAAKsR,MAAM9Y,MAAM6jB,OAAOjR,IAC/EpL,KAAKkgB,SAAS,CAACziB,MAAK,sCAIxB,OAAO,YAZagW,aA4Bb+F,eAZS,SAAA3M,GACpB,MAAO,CACHhI,MAF2BgI,EAAT3H,IAEPL,QAIQ,SAAAkI,GACvB,MAAO,CACH8iB,0BAA2B,SAAChrB,EAAOuG,GAAR,OAAe2B,EtC+FT,SAAClI,EAAOuG,GAC7C,OAAO,SAAA2B,GACHA,EDlDG,CACH1T,KtBcgC,6BuBoChC0T,EFbG,CACH1T,KrBnC+B,4BuBgD/B,IAAImK,EAAO,GACP8H,OAAcnS,EAEd22B,OAAa32B,EAEX42B,EAAS,cAAgB3kB,EAAK,QAE9B4kB,EAAU,oCADgC5kB,EAAK,IAErD6e,QAAQiD,IAAI,CAACrc,GAAMxD,IAAI0iB,GAAQlf,GAAMxD,IAAI2iB,KACpCxf,KAAM,SAAAyf,GACHzsB,EAAOysB,EAAU,GAAG7hB,KAAK5K,KACzB8H,EAAc2kB,EAAU,GAAG7hB,KAAK9C,YAFhB,IAAAhL,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAIhB,QAAAsH,EAAAC,EAAsBpH,OAAO8X,OAAO6e,EAAU,GAAG7hB,MAAM,GAAGnH,OAA1D3J,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAAkE,KAAzD4vB,EAAyDzvB,EAAArF,MAC1DmL,EAAQ,IAAIL,EAChBK,EAAM1D,OAAS4K,GAAUyiB,EAAUrtB,QACnC0D,EAAM/C,KAAO0sB,EAAU1sB,KAElBssB,IAAYA,EAAavpB,GAC9BwG,EAASojB,GAAyB5pB,IAClCwG,EAASojB,GAAgC5pB,KAX7B,MAAA5I,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAahBuM,EA7FuC,SAAC3B,EAAI5H,EAAM6H,EAAOC,GACrE,MAAO,CACHjS,KvB2BoD,+CuB1BpD+R,KACA5H,OACA6H,QACAC,eAuFiB8kB,CAAwChlB,EAAI5H,EApBjD,WAoB8D8H,IAClEyB,EAASsjB,GAAuBxrB,EAAOirB,IAEvC/iB,EFjCL,CACH1T,KrBxC6B,4BuB0ExB+zB,MAAM,SAAAv0B,GACHw0B,MAAMx0B,EAAM4V,SACZ1B,EFrCL,CACH1T,KrBxC6B,6B6DpDsBi3B,CAAuCzrB,EAAOuG,OAI1FoO,CAA6CoW,wBCDtDW,gNACFvf,YAAc,WACV,IAAIzK,EAAQS,EAAOS,YAAYmM,EAAKtC,MAAMrK,QACrCV,IACLqN,EAAKtC,MAAMN,YAAY4C,EAAKtC,MAAMzM,MAAO0B,GACzCqN,EAAKoL,kBAGTwR,4BAA8B,WAC1B,GAAiC,IAA7B5c,EAAKtC,MAAMrK,OAAO/N,OAAtB,CAEA,IAAIu3B,EAAU,KACd,IACIA,EAAU7c,EAAKtC,MAAMzM,MAAM6rB,YAE/B,MAAM7iB,GACFb,QAAQJ,IAAIiB,GAEhB,IAAI8iB,EAAU,CACVntB,KAAmC,KAA7BoQ,EAAKtC,MAAM9F,SAAShI,KACtB8sB,GAAwB1c,EAAKtC,MAAM7F,eAAiBmI,EAAKtC,MAAM9F,SAAShI,KAC5EitB,QAASA,EACTnlB,aAAa,IAAIslB,MAAOC,qBAAuB,KAAM,IAAID,MAAOE,qBAEhEn4B,OAAQib,EAAKtC,MAAM3Y,QAGnBib,EAAKtC,MAAM9F,SAASJ,GACpBwI,EAAKtC,MAAMyf,yBAAyBnd,EAAKtC,MAAM9F,SAASJ,GAAIulB,EAAS/c,EAAKtC,MAAMrK,QAGhF2M,EAAKtC,MAAM0f,sBAAsBL,EAAS/c,EAAKtC,MAAMrK,OAAQ2M,EAAKtC,MAAM2f,aAIhFC,qBAAuB,WACnBtd,EAAKtC,MAAM4f,uBACXtd,EAAKtC,MAAM6f,iBACXvd,EAAKtC,MAAM2f,QAAQrwB,KAAK,QAG5ByjB,cAAgB,SAACxW,GAEb,GAAoB,eAAhBA,EAAE0J,OAAOnM,GAEb,OAAQyC,EAAEyW,MACN,IAAK,OACD1Q,EAAK5C,cACL,MAEJ,IAAK,OACD4C,EAAKtC,MAAM8f,kBACX,MAEJ,IAAK,OACDxd,EAAKtC,MAAM+f,8GAkBnBh5B,OAAOi5B,SAAWtxB,KAAKsR,MAAMigB,YAG7B/lB,SAAS0N,iBAAiB,UAAWlZ,KAAKqkB,eAE1C7Y,SAAS0N,iBAAiB,QAASlZ,KAAKwxB,8CAWxC,IAAIC,EAAoBzxB,KAAKsR,MAAMzM,MAC/BkN,EAAAC,EAAAC,cAACyf,GAAD,CACIxxB,IAAI,yBACJ2E,MAAO7E,KAAKsR,MAAMzM,MAClBb,MAAOhE,KAAKsR,MAAMtN,MAClBN,QAAS1D,KAAKsR,MAAM5N,QACpBD,SAAUzD,KAAKsR,MAAM7N,SACrB2f,OAAQpjB,KAAKsR,MAAM3H,MAAM1K,EACzBokB,OAAQrjB,KAAKsR,MAAM3H,MAAMzK,IAE7B,KAEAyyB,EAAoB3xB,KAAKsR,MAAMjN,oBAAsB0N,EAAAC,EAAAC,cAAC2f,GAAD,MAAwB,KAE7EC,EAA0B7xB,KAAKsR,MAAM1G,kBAAkBR,oBACvDpK,KAAKsR,MAAM1G,kBAAkBP,qBAC7BrK,KAAKsR,MAAM1G,kBAAkBN,mBAAmBlE,WAChDpG,KAAKsR,MAAM1G,kBAAkBL,oBAAoBnE,UAEjDwE,EAAoB5K,KAAKsR,MAAM1G,kBAAkBJ,UACrDxK,KAAKsR,MAAM1G,kBAAkBH,iBAAmBonB,EAC5C9f,EAAAC,EAAAC,cAAC6f,GAAD,CACI5xB,IAAI,oBACJ2E,MAAO7E,KAAKsR,MAAMzM,MAClBuF,mBAAoBpK,KAAKsR,MAAM1G,kBAAkBR,mBACjDC,oBAAqBrK,KAAKsR,MAAM1G,kBAAkBP,oBAClDC,mBAAoBtK,KAAKsR,MAAM1G,kBAAkBN,mBACjDC,oBAAqBvK,KAAKsR,MAAM1G,kBAAkBL,oBAClDC,SAAUxK,KAAKsR,MAAM1G,kBAAkBJ,SACvCC,gBAAiBzK,KAAKsR,MAAM1G,kBAAkBH,gBAC9C/G,QAAS1D,KAAKsR,MAAM5N,QACpBD,SAAUzD,KAAKsR,MAAM7N,WAEzB,KAEJ,OACIsO,EAAAC,EAAAC,cAAA,QAAME,UAAWoH,KAAO,iBACpBxH,EAAAC,EAAAC,cAAC8f,GAAD,CACI1tB,oBAAqBrE,KAAKsR,MAAMjN,oBAChCL,MAAOhE,KAAKsR,MAAMtN,MAClBW,8BAA+B3E,KAAKsR,MAAM3M,8BAE1CoO,oBAAqB/S,KAAKgR,YAC1BgC,mBAAoBhT,KAAKsR,MAAM0gB,gBAC/B/e,6BAA8BjT,KAAKsR,MAAM2gB,2BACzC/e,oCAAqClT,KAAKsR,MAAM4gB,2BAChD/e,yBAA0BnT,KAAKsR,MAAM8f,gBACrChe,wBAAyBpT,KAAKsR,MAAM+f,sBACpChe,sBAAuBrT,KAAKsR,MAAM6gB,oBAClC3e,wBAAyBxT,KAAKsR,MAAMiU,iBACpCjS,mCAAoCtT,KAAKsR,MAAM1M,yBAC/C2O,cAAevT,KAAKsR,MAAM8gB,YAC1B5B,4BAA6BxwB,KAAKwwB,4BAClC3d,wBAAyB7S,KAAKkxB,qBAC9Bte,yBAA0B5S,KAAKsR,MAAM+gB,gBACrCvf,2BAA4B9S,KAAKsR,MAAMghB,oBACvC3f,yBAA0B3S,KAAKsR,MAAMihB,oBAGzCxgB,EAAAC,EAAAC,cAACugB,GAAD,MAECxyB,KAAKsR,MAAMzM,MACRkN,EAAAC,EAAAC,cAACwgB,GAAD,CACI5tB,MAAO7E,KAAKsR,MAAMzM,MAClBiV,iBAAkB9Z,KAAKsR,MAAMohB,cAE7B3gB,EAAAC,EAAAC,cAAC0gB,GAAD,CAAiB1rB,OAAQjH,KAAKsR,MAAMrK,SAEnCwqB,EACAE,EACA/mB,GACgB,KAEzBmH,EAAAC,EAAAC,cAAC2gB,GAAD,MAEE5yB,KAAKsR,MAAM7M,eACTsN,EAAAC,EAAAC,cAAC4gB,GAAD,CACIpuB,eAAgBzE,KAAKsR,MAAM7M,eAC3B8gB,iBAAkBvlB,KAAKsR,MAAMiU,iBAC7B3hB,MAAO5D,KAAKsR,MAAM1N,MAClBC,QAAS7D,KAAKsR,MAAMzN,QACpBE,MAAO/D,KAAKsR,MAAMvN,QACjB,KAGP/D,KAAKsR,MAAMtM,kBACT+M,EAAAC,EAAAC,cAAC6gB,GAAD,CACI9N,UAAWhlB,KAAKsR,MAAMtM,kBACtBof,WAAYpkB,KAAKsR,MAAMghB,oBACvB1uB,MAAM,oBACNqD,OAAQjH,KAAKsR,MAAMrK,SAClB,KAERjH,KAAKsR,MAAMrM,gBACR8M,EAAAC,EAAAC,cAAC8gB,GAAD,CACI/N,UAAWhlB,KAAKsR,MAAMrM,gBACtBmf,WAAYpkB,KAAKsR,MAAMihB,kBACvB3uB,MAAM,eACNoqB,QAAShuB,KAAKsR,MAAM0hB,sBACnB,KAETjhB,EAAAC,EAAAC,cAACghB,GAAA,EAAD,CAAOC,KAAK,iBAAiBC,UAAWvD,aA9L5Bnc,aA8Pb+F,eAzDS,SAACxgB,EAAOo6B,GAC5B,MAAO,CACHvuB,MAAO7L,EAAMkM,IAAIL,MACjBjB,MAAO5K,EAAMkM,IAAItB,MACjBC,QAAS7K,EAAMkM,IAAIrB,QACnBE,MAAO/K,EAAMkM,IAAInB,MACjBI,gBAAiBnL,EAAMkM,IAAIf,gBAC3BC,cAAepL,EAAMkM,IAAId,cACzBF,QAASlL,EAAMkM,IAAIhB,QACnBI,WAAYtL,EAAMkM,IAAIZ,WACtBN,MAAOhL,EAAMkM,IAAIlB,MACjBW,8BAA+B3L,EAAMkM,IAAIP,8BACzCjB,QAAS1K,EAAMkM,IAAIxB,QACnBD,SAAUzK,EAAMkM,IAAIzB,SACpBY,oBAAqBrL,EAAMkM,IAAIb,oBAC/BI,eAAgBzL,EAAMkM,IAAIT,eAC1BO,kBAAmBhM,EAAMkM,IAAIF,kBAC7BC,gBAAiBjM,EAAMkM,IAAID,gBAC3BgC,OAAQjO,EAAMiO,OACd0C,MAAO3Q,EAAM2Q,MACbiB,kBAAmB5R,EAAM4R,kBAEzBY,SAAUxS,EAAM0S,aAAaF,SAC7BC,cAAezS,EAAM0S,aAAaD,cAElC/S,MAAOM,EAAMD,KAAKL,MAClBC,OAAQK,EAAMD,KAAKJ,SAIA,SAAAoU,GACvB,MAAO,CACHwkB,YAAa,kBAAMxkB,EzCjQhB,CACH1T,KrBAqB,mB8DiQrBq5B,aAAc,kBAAM3lB,EzC5PjB,CACH1T,KrBHuB,qB8D+PvB2X,YAAa,SAACnM,EAAOjC,GAAR,OAAkBmK,EAAS0M,GAAoB5U,EAAOjC,KACnEwvB,YAAa,kBAAMrlB,EzCxPhB,CACH1T,KrBE4B,0B8DsP5B+3B,gBAAiB,kBAAMrkB,EzCnPpB,CACH1T,KrBHiC,+B8DsPjCg4B,sBAAuB,kBAAMtkB,EzC9O1B,CACH1T,KrBRuC,qC8DsPvC84B,oBAAqB,kBAAMplB,EzCzOxB,CACH1T,KrBbqC,mC8DsPrCksB,iBAAkB,kBAAMxY,EzCpOrB,CACH1T,KrBxBkC,gC8D4PlC44B,2BAA4B,kBAAMllB,EzCzN/B,CACH1T,KrBtCqC,mC8D+PrC64B,2BAA4B,kBAAMnlB,EzCpN/B,CACH1T,KrB3CqC,mC8D+PrC24B,gBAAiB,kBAAMjlB,EzCxLpB,CACH1T,KrB7EkC,gC8DqQlCg5B,gBAAiB,kBAAMtlB,EzC5IpB,CACH1T,KrB9GsC,oC8D0PtCi5B,oBAAqB,kBAAMvlB,EzCvIxB,CACH1T,KrBnHqC,mC8D0PrCk5B,kBAAmB,kBAAMxlB,EzClItB,CACH1T,KrBxHiC,iC8D0PjCuL,yBAA0B,kBAAMmI,EzCnN7B,CACH1T,KrBayC,yC8DsMzC25B,oBAAqB,SAACpF,GAAD,OAAmB7gB,EzC/Hb,SAAC6gB,GAChC,MAAO,CACHv0B,KrBtF+B,0BqBuF/B+U,KAAMwf,GyC4H2CnU,CAA4BmU,KAE7EuD,eAAgB,kBAAMpkB,ExC1MnB,CACH1T,KtBcgC,8B8D6LhC23B,sBAAuB,SAACL,EAAS1pB,EAAQgqB,GAAlB,OAA8BlkB,EvCtHxB,SAAC4jB,EAAS1pB,EAAQgqB,GACnD,OAAO,SAAAlkB,GACH,IAAI3B,OAAKjS,EACT4T,EFnDG,CACH1T,KrBnC+B,4BuBsF/BwX,GAAMwiB,KAAK,kBAAmB1C,GACzBngB,KAAK,SAAA8iB,GACFloB,EAAKkoB,EAASllB,KAAK5K,KACnB,IAAI+vB,EAAavsB,EAAO0B,OAAOzB,GAC3BusB,EAAc,CACdpoB,GAAIA,EACJnE,OAAQssB,GAEZ,OAAO1iB,GAAMwiB,KAAK,aAAcG,KAEnChjB,KAAK,SAAA8iB,GACFvmB,EA3J+B,SAAC3B,EAAIE,GAChD,MAAO,CACHjS,KvB4DgD,2CuB3DhD+R,GAAIA,EACJE,YAAaA,GAuJImoB,CAAgCroB,EAAIwlB,KAAK8C,QAClD3mB,EF1DL,CACH1T,KrBxC6B,0BuBoGrB43B,EAAQrwB,KAAK,cAAgBwK,KAEhCgiB,MAAM,SAAAv0B,GACHw0B,MAAMx0B,EAAM4V,SACZ1B,EFjEL,CACH1T,KrBxC6B,6B8DuMiCi3B,CAAmCK,EAAS1pB,EAAQgqB,KAClHF,yBAA0B,SAAC3lB,EAAIulB,EAAS1pB,GAAd,OAAyB8F,EvC3FnB,SAAC3B,EAAIulB,EAAS1pB,GAClD,OAAO,SAAA8F,GACHA,EF9EG,CACH1T,KrBnC+B,4BuBkH/BwX,GAAM8iB,IAAN,cAAA7qB,OAAwBsC,EAAxB,SAAmCulB,GAC9BngB,KAAK,SAAA8iB,GACFvmB,EArKL,CACH1T,KvBqDmD,8CuBpDnDiS,YAmKyCslB,KAAK8C,QAItC,IACME,EAAM,oCADoCxoB,EAAK,IAErD,OAAOyF,GAAMxD,IAAIumB,KAEpBpjB,KAAM,SAAA8iB,GACH,IAAIC,EAAavsB,EAAO0B,OAAOzB,GAC3BusB,EAAc,CACdpoB,GAAIA,EACJnE,OAAQssB,GAERM,EAASv6B,OAAO4S,KAAKonB,EAASllB,MAAM,GACxC,OAAOyC,GAAM8iB,IAAN,SAAA7qB,OAAmB+qB,EAAnB,SAAkCL,KAE5ChjB,KAAM,SAAAsjB,GACH/mB,EF9FL,CACH1T,KrBxC6B,4BuBuIxB+zB,MAAM,SAAAv0B,GACHw0B,MAAMx0B,EAAM4V,SACZ1B,EFlGL,CACH1T,KrBxC6B,6B8DwM+Bi3B,CAAsCllB,EAAIulB,EAAS1pB,KAC/GiqB,qBAAsB,kBAAMnkB,EvC7OzB,CACH1T,KvB6CgC,gC8DmMzBmgB,CAA6C+W,wBCjP7CwD,GAnCU,SAACziB,GACtB,OACIS,EAAAC,EAAAC,cAAA,OAAKE,UAAWoH,KAAO,uBACnBxH,EAAAC,EAAAC,cAAA,UAAQrO,MAAM,YAAYsO,QAASZ,EAAM0iB,yBACrCjiB,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAK,OACLJ,KAAK,KACL4C,MAAO,CAACG,MAAO,WAGvB4L,EAAAC,EAAAC,cAAA,UAAQrO,MAAM,sCAAsCsO,QAASZ,EAAM2iB,0BAC/DliB,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAK,aACLJ,KAAK,KACL4C,MAAO,CAACG,MAAO,WAGvB4L,EAAAC,EAAAC,cAAA,UAAQrO,MAAM,wBAAwBsO,QAASZ,EAAM4iB,4BACjDniB,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAK,YACLJ,KAAK,KACL4C,MAAO,CAACG,MAAO,WAGvB4L,EAAAC,EAAAC,cAAA,UAAQrO,MAAM,kBAAkBsO,QAASZ,EAAM6iB,2BAC3CpiB,EAAAC,EAAAC,cAACG,GAAAJ,EAAD,CACIxO,KAAK,kBACLJ,KAAK,KACL4C,MAAO,CAACG,MAAO,iCCwBpBiuB,GAtDO,SAAC9iB,GACnB,IAAI+iB,EAAwB,SAAClQ,GACzB,IAAKA,EACD,OAAO,EACXA,EAAGlM,kBACHkM,EAAGjM,iBACH,IAAI1U,EAAO2gB,EAAGmQ,cAAc,GAAGl5B,MAC3BwI,EAAQugB,EAAGmQ,cAAc,GAAGl5B,MAC5BuN,EAAWrP,OAAO6L,OAAO,GAAImM,EAAM/K,MAAO,CAC1C/C,KAAMA,EACNI,MAAOA,IAGX,OADA0N,EAAM+iB,sBAAsB1rB,IACrB,GAGP4rB,EAAW,SAACpQ,GACZA,EAAGlM,kBACHkM,EAAG5M,OAAOJ,SAWd,OACIpF,EAAAC,EAAAC,cAAA,QAAME,UAAWoH,KAAO,mBAClBnO,GAAG,gBACHhS,OAAO,GACPo7B,SAAUH,EACVI,YATe,SAACtQ,GACtBA,EAAGlM,oBAUClG,EAAAC,EAAAC,cAAA,eACAF,EAAAC,EAAAC,cAAA,sBACAF,EAAAC,EAAAC,cAAA,SAAO5Y,KAAK,OAAO+R,GAAG,aAAa5H,KAAK,YAAYkxB,aAAcpjB,EAAM/K,MAAM/C,KACvE0O,QAASqiB,KAEhBxiB,EAAAC,EAAAC,cAAA,eACAF,EAAAC,EAAAC,cAAA,6BACAF,EAAAC,EAAAC,cAAA,YAAU7G,GAAG,cAAc5H,KAAK,aAAamxB,KAAK,KAAKC,KAAK,IAAIF,aAAcpjB,EAAM/K,MAAM3C,MAChFsO,QAASqiB,KAGnBxiB,EAAAC,EAAAC,cAAA,SAAO5Y,KAAK,SAAS2M,MAAO,CAACghB,QAAQ,UACrCjV,EAAAC,EAAAC,cAAA,UAAQC,QA3BY,SAACiS,GACzB7S,EAAMujB,0BA0BF,UACA9iB,EAAAC,EAAAC,cAAA,UAAQC,QAAS,SAACiS,GAAD,OAAQkQ,EAAsBlQ,EAAG5M,OAAOud,UAAzD,4BCmCGC,mMAhFP,GAAwC,WAApCvpB,SAASwpB,cAAcC,SAA3B,CAEA,IAAIC,EAAOl1B,KAAKm1B,KAAKC,UACjBp1B,KAAKsR,MAAM/K,MAAMD,UACjB4uB,EAAK/d,sCAIRke,EAAK9R,GACN,IAAIlpB,EAAGi7B,EAAGhoB,EAAGioB,EAgBb,OAfIF,GACAA,EAAMA,EAAIG,QAAQ,IAAK,IACvBn7B,EAAI8G,SAASk0B,EAAIx0B,UAAU,EAAG,GAAI,IAClCy0B,EAAIn0B,SAASk0B,EAAIx0B,UAAU,EAAG,GAAI,IAClCyM,EAAInM,SAASk0B,EAAIx0B,UAAU,EAAG,GAAI,IAClC00B,EAAUhS,IAGVlpB,EAAI,IACJi7B,EAAI,IACJhoB,EAAI,IACJioB,EAAU,GAEJ,QAAAzsB,OAAWzO,EAAX,KAAAyO,OAAgBwsB,EAAhB,KAAAxsB,OAAqBwE,EAArB,KAAAxE,OAA0BysB,EAAU,IAApC,sCASV,IAAInvB,EAAYpG,KAAKsR,MAAM/K,MAAMH,UAAY,kBAAoB,oBAC7DD,EAAQC,EAAYpG,KAAKy1B,KAAKz1B,KAAKsR,MAAM/K,MAAMJ,MAAO,KAAOnG,KAAKy1B,OAClEC,EAAUtvB,EAAYpG,KAAKy1B,KAAKz1B,KAAKsR,MAAM/K,MAAMJ,MAAO,IAAMnG,KAAKy1B,OACnE5vB,EAAQ7F,KAAKsR,MAAM/K,MAAMD,SAAW,EAAI,EACxCqvB,EAAsD,IAAnC31B,KAAKsR,MAAM/K,MAAM1D,OAAO3J,OAAe,GAAM,EACpE,MAAO,CACH6Y,EAAAC,EAAAC,cAAA,MAAI/R,IAAK,EACLiS,UAAWoH,KAAOrT,MAClBgM,QAASlS,KAAKsR,MAAMskB,eACpBC,cAAe71B,KAAKsR,MAAMwkB,sBAE1B/jB,EAAAC,EAAAC,cAAA,OAAKE,UAAWoH,KAAOwc,kBAClB7jB,QAASlS,KAAKsR,MAAM0kB,sBAErBjkB,EAAAC,EAAAC,cAAA,MAAIE,UAAWoH,KAAO0c,mBAClBjwB,MAAO,CAACud,QAAS1d,EAAOM,MAAOA,IADnC,WAMJ4L,EAAAC,EAAAC,cAAA,OAAKE,UAAWoH,KAAO2c,aAClBlwB,MAAO,CAACsd,gBAAiBoS,EAASnS,QAASoS,IAC5C5jB,EAAAC,EAAAC,cAAA,MAAIqH,IAAI,YACJ1V,MAAO5D,KAAKsR,MAAM/K,MAAM3C,MACxByV,SAAS,KAERrZ,KAAKsR,MAAM/K,MAAM/C,QAM9BuO,EAAAC,EAAAC,cAACqT,GAAD,CACIplB,IAAK,EACL8kB,UAAWhlB,KAAKsR,MAAM/K,MAAMF,OAC5B+d,WAAYpkB,KAAKsR,MAAMujB,sBACvBzP,OAAO,oBAEPrT,EAAAC,EAAAC,cAACkkB,GAAD,CACI5vB,MAAOvG,KAAKsR,MAAM/K,MAClB8tB,sBAAuBr0B,KAAKsR,MAAM+iB,sBAClCQ,sBAAuB70B,KAAKsR,MAAMujB,iCA3EvBphB,iCCEzB2iB,gNACFp0B,OAAS,IAETqiB,cAAgB,SAACxW,GAIb,GAAIA,EAAE0J,OAAO8e,cAAcA,eACvBxoB,EAAE0J,OAAO8e,cAAcA,cAAcA,eACrCxoB,EAAE0J,OAAO8e,cAAcA,cAAcA,cAAcjrB,IACO,eAA1DyC,EAAE0J,OAAO8e,cAAcA,cAAcA,cAAcjrB,GAGnD,OAAQyC,EAAEyW,MACN,IAAK,aACL,IAAK,YACD1Q,EAAKtC,MAAMglB,uBACX,MACJ,IAAK,YACL,IAAK,UACD1iB,EAAKtC,MAAMilB,2BAuB3BC,mBAAqB,WACjB5iB,EAAKoL,mGAMLxT,SAAS0N,iBAAiB,UAAWlZ,KAAKqkB,4DAM1CrkB,KAAKgC,OAAShC,KAAKm1B,KAAKxC,gBAAgBre,8CAGnC,IAAAiK,EAAAve,KACCgG,EAAQhG,KAAKsR,MAAMvM,cAAgBwU,KAAO,wBAA0BA,KAAO,cACjF,OACIxH,EAAAC,EAAAC,cAAA,OAAKE,UAAWnM,EACXsT,IAAI,kBACJpH,QAASlS,KAAKw2B,oBAGfzkB,EAAAC,EAAAC,cAACwkB,GAAD,CACIzC,wBAAyB,kBAAMzV,EAAKjN,MAAM0iB,wBAAwBzV,EAAKjN,MAAMzM,QAC7EovB,yBAA0Bj0B,KAAKsR,MAAM2iB,yBACrCC,2BAA4Bl0B,KAAKsR,MAAM4iB,2BACvCC,0BAA2Bn0B,KAAKsR,MAAM6iB,4BAE1CpiB,EAAAC,EAAAC,cAAA,MAAI7G,GAAG,aACHpF,MAAO,CAAC0wB,UAAU,KAAM12B,KAAKgC,OAAO,MACtChC,KAAKsR,MAAMrK,OAAOwB,IAAI,SAAClC,GAAD,OACpBwL,EAAAC,EAAAC,cAAC0kB,GAAD,CACIz2B,IAAKqG,EAAM/C,KACX+C,MAAOA,EACPqvB,eAAgB,kBAAMrX,EAAKjN,MAAMskB,eAAervB,IAChDyvB,qBAAsB,SAAC9e,GAAD,OAAWqH,EAAKjN,MAAM0kB,qBAAqB9e,EAAO3Q,IACxE8tB,sBAAuB9V,EAAKjN,MAAM+iB,sBAClCQ,sBAAuBtW,EAAKjN,MAAMujB,mCAlFjCphB,aAoHV+F,eAvBS,SAAAxgB,GACpB,MAAO,CACHiO,OAAQjO,EAAMiO,OACdpC,MAAO7L,EAAMkM,IAAIL,MACjBE,cAAe/L,EAAMkM,IAAIH,gBAIN,SAAAgI,GACvB,MAAO,CACHinB,wBAAyB,SAACnvB,GAAD,OAAWkI,E5ChHf,SAAClI,GAC1B,MAAO,CACHxL,KtBwCgC,2BsBvChCwL,MAAOA,G4C6GsC4U,CAAsB5U,KACnEovB,yBAA0B,kBAAMlnB,E5C1D7B,CACH1T,KtBNoC,kCkEgEpC66B,2BAA4B,kBAAMnnB,E5CnG/B,CACH1T,KtB4BmC,iCkEuEnC86B,0BAA2B,kBAAMpnB,E5C9F9B,CACH1T,KtBuBkC,gCkEuElCu8B,eAAgB,SAACrvB,GAAD,OAAWwG,EAAS0M,GAA2BlT,KAC/DyvB,qBAAsB,SAAC9e,EAAO3Q,GAAR,OAAkBwG,E5CpFb,SAACmK,EAAO3Q,GAEvC,OADA2Q,EAAMe,kBACC,CACH5e,KtBamC,gCsBZnCkN,MAAOA,G4CgF0CkT,CAA4BvC,EAAO3Q,KACpF8tB,sBAAuB,SAAC1rB,GAAD,OAAcoE,E5C7ElB,SAACpE,GACxB,MAAO,CACHtP,KtBQsC,iCsBPtCsP,SAAUA,G4C0EoC8Q,CAAoB9Q,KAClEksB,sBAAuB,kBAAM9nB,E5CtE1B,CACH1T,KtBEsC,oCkEoEtCi9B,qBAAsB,kBAAMvpB,E5C3DzB,CACH1T,KtBRsC,oCkEmEtCk9B,qBAAsB,kBAAMxpB,E5CtDzB,CACH1T,KtBboC,oCkEsE7BmgB,CAA6C4c,wBChH7CQ,GARQ,WACnB,OACI7kB,EAAAC,EAAAC,cAAA,SAAOE,UAAWoH,KAAO,cACrBxH,EAAAC,EAAAC,cAAA,oBCiCGuH,eAjBS,SAAA3M,GAA0B,IAAxBnB,EAAwBmB,EAAxBnB,aAAc3S,EAAU8T,EAAV9T,KACpC,MAAO,CACHyS,SAAUE,EAAaF,SACvB5S,SAAUG,EAAKH,WAII,SAAAmU,GACvB,MAAO,CACHimB,oBAAqB,SAAC9b,GAAD,OAAWnK,EAAS,CACrC1T,KpE4B2B,0BoE3B3B+U,KAAM8I,EAAM0W,iBAEhBiJ,mBAAoB,SAACrzB,GAAD,OAAUuJ,E7CHJ,SAACvJ,GAC/B,MAAO,CACHnK,KvBmD6B,wBuBlD7BmK,Q6CAuC8sB,CAAgC9sB,OAIhEgW,CAlCC,SAAClI,GACb,OACIS,EAAAC,EAAAC,cAACF,EAAAC,EAAM+H,SAAP,KAIIhI,EAAAC,EAAAC,cAAA,OAAKE,UAAU,WAAW6b,QAAS1c,EAAM0hB,qBACrCjhB,EAAAC,EAAAC,cAAC6kB,GAAD,CAAe7F,QAAS3f,EAAM2f,QACf8F,kCAAmCzlB,EAAMylB,oCAExDhlB,EAAAC,EAAAC,cAAC+kB,GAAD,MACAjlB,EAAAC,EAAAC,cAACglB,GAAD,8BCADC,gBAXS,SAAC5lB,GACrB,IAAMtL,EAAoC,eAA5BsL,EAAMhZ,SAAS6+B,SACzB3lB,KAAQ,6BACRA,KAAQ,cACZ,OACIO,EAAAC,EAAAC,cAAA,UAAQE,UAAWnM,GACf+L,EAAAC,EAAAC,cAAA,6BCJNmlB,wNACFp+B,MAAM,CACFyE,MAAK,wFAEY,IAAA8gB,EAAAve,KACjB,GAAIA,KAAKsR,MAAMzM,QAAU7E,KAAKhH,MAAMyE,KAAM,CACtC,IAAIoH,EAAQ7E,KAAKsR,MAAMzM,MACnBoC,EAASjH,KAAKsR,MAAMrK,OAUxBgjB,QAAQiD,IAAI,CAACrc,KAJA,4IAKRL,KAAM,SAACyf,GACJ,IAAK,IAAI7tB,EAAE,EAAGA,EAAI,EAAGA,IAAK,CACtB,IAAIi1B,EAAOpH,EAAU7tB,GACjBmE,EAAQS,EAAO2B,SAAS9D,EAAOoC,GACnCV,EAAMJ,MAAQa,EAAOkB,aAAajB,GAClCV,EAAM/C,KAAO,OACb+C,EAAM3C,MAAQ,GACd2C,EAAMD,UAAW,EACjBC,EAAMH,WAAY,EAElB,IAAIuH,EAAMgc,GAASpjB,EAAM/C,KAAM6zB,EAAKjpB,MATd9N,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAWtB,QAAAsH,EAAAC,EAAkBiN,EAAI9K,OAAtBvF,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA8B,KAArBsC,EAAqBnC,EAAArF,MACtB6K,EAAQ,IAAIH,EAAMlD,OAAOzJ,EAAWyJ,EAAMxB,OAC9CmF,EAAME,IAAIR,IAbQ,MAAAtI,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GAgBtB+d,EAAKjN,MAAMgmB,kBAAkBzyB,EAAO0B,GACpCgY,EAAKjN,MAAML,YAAY1K,GACvBgY,EAAKjN,MAAMimB,yBAGlBnK,MAAO,SAAAv0B,GACJmU,QAAQJ,IAAI/T,GACZ0lB,EAAKjN,MAAMimB,wBAGnBv3B,KAAKkgB,SAAS,CAACziB,MAAK,IACpBuC,KAAKsR,MAAMkmB,uGAOf,OAAO,YArDI/jB,cAgFJ+F,eAvBS,SAAAxgB,GACpB,MAAO,CACHiO,OAAQjO,EAAMiO,OACdpC,MAAO7L,EAAMkM,IAAIL,QAIE,SAAAkI,GACvB,MAAO,CACHuqB,kBAAmB,SAACzyB,EAAO0B,GAAR,OAAkBwG,EAAS,CAC1C1T,KtErCyB,wBsEsCzBwL,MAAOA,EACPjC,MAAO2D,KAEX0K,YAAa,SAAC1K,GAAD,OAAWwG,EAAS,CAC7B1T,KtEtCiB,gBsEuCjBkN,MAAOA,KAEXixB,sBAAuB,kBAAMzqB,EjD2B1B,CACH1T,KrBnC+B,6BsEQ/Bk+B,oBAAqB,kBAAMxqB,EjDgCxB,CACH1T,KrBxC6B,6BsEWtBmgB,CAA6C4d,ICvFtDK,kMAEEz3B,KAAKsR,MAAM1M,4DAGX,OAAO,YALmB6O,aAsBnB+F,eAbS,SAAAxgB,GACpB,MAAO,CACHiO,OAAQjO,EAAMiO,OACdpC,MAAO7L,EAAMkM,IAAIL,QAIE,SAAAkI,GACvB,MAAO,CACHnI,yBAA0B,kBAAMmI,EAAS,CAAC1T,KvEsDV,gCuElDzBmgB,CAA6Cie,ICpBtDC,sGACWC,EAAUC,GAEnB,IADA,IAAIC,EAAqBjP,OAAOkP,kBAChCjwB,EAAA,EAAAkwB,EAAAz+B,OAAAgD,EAAA,EAAAhD,CAAqBs+B,EAASh7B,OAA9BiL,EAAAkwB,EAAA7+B,OAAA2O,IAAsC,CAAjC,IAAI2T,EAAIuc,EAAAlwB,GACL2C,EAAWktB,EAAkBM,aAAaxc,EAAMmc,GAChDntB,EAAWqtB,IACXA,EAAqBrtB,GAG7B,OAAOqtB,uCAGSI,EAAON,GACvB,IAAIO,EAAWD,EAAMr1B,MAAMX,IACvBA,EAAM,IAAIC,IACV0mB,OAAOuP,kBACPD,EAASp2B,KACT8mB,OAAOkP,kBACPI,EAASpxB,MAET+wB,EAAqBjP,OAAOkP,kBAC5BM,EAAcT,EAAS/6B,MAAMyF,OAAOJ,GATP3B,GAAA,EAAAC,GAAA,EAAAC,OAAArH,EAAA,IAUjC,QAAAsH,EAAAC,EAAkB03B,EAAlB96B,OAAAC,cAAA+C,GAAAG,EAAAC,EAAAlD,QAAAC,MAAA6C,GAAA,EAA8B,KAArB+3B,EAAqB53B,EAAArF,MACtBoP,OAAQ,EACR6tB,EAAMz1B,iBAAiBxG,KAAW67B,EAAMr1B,iBAAiBxG,IACzDoO,EAAWktB,EAAkBY,gBAAgBD,EAAMz1B,MAAOq1B,EAAMr1B,OAE3Dy1B,EAAMz1B,iBAAiBtI,KAAO29B,EAAMr1B,iBAAiBxG,IAC1DoO,EAAWktB,EAAkBa,YAAYN,EAAMr1B,MAAOy1B,EAAMz1B,OAEvDy1B,EAAMz1B,iBAAiBxG,KAAW67B,EAAMr1B,iBAAiBtI,IAC9DkQ,EAAWktB,EAAkBa,YAAYF,EAAMz1B,MAAOq1B,EAAMr1B,OAEvDy1B,EAAMz1B,iBAAiBtI,KAAO29B,EAAMr1B,iBAAiBtI,MAC1DkQ,EAAWktB,EAAkBc,QAAQH,EAAMz1B,MAAOq1B,EAAMr1B,QAGxD4H,EAAWqtB,IACXA,EAAqBrtB,IA1BI,MAAA7M,GAAA4C,GAAA,EAAAC,EAAA7C,EAAA,YAAA2C,GAAA,MAAAI,EAAA9C,QAAA8C,EAAA9C,SAAA,WAAA2C,EAAA,MAAAC,GA6BjC,OAAOq3B,sCAGQ52B,EAAO2B,GACtB,IACI61B,EADO,IAAIC,IAAKz3B,EAAO,IAAI03B,IAAO,EAAE,IACfC,UAAUh2B,GAC/Bi1B,EAAqBjP,OAAOkP,kBAHH76B,GAAA,EAAAC,GAAA,EAAAC,OAAAhE,EAAA,IAI7B,QAAAiE,EAAAC,EAAeo7B,EAAfn7B,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA8B,KAArB47B,EAAqBz7B,EAAAhC,MAAA09B,EAES73B,EAAM83B,WAAWF,GAF1BG,EAAA1/B,OAAA4R,EAAA,EAAA5R,CAAAw/B,EAAA,GAErBtuB,EAFqBwuB,EAAA,GAAAA,EAAA,GAGtBxuB,EAAWqtB,IACXA,EAAqBrtB,IARA,MAAA7M,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAW7B,OAAO06B,0CAGYoB,EAAUC,GAC7B,IAAIrB,EAAqBjP,OAAOkP,kBADO95B,GAAA,EAAAC,GAAA,EAAAC,OAAA/E,EAAA,IAEvC,QAAAgF,EAAAC,EAAkB66B,EAAS3Y,SAA3BhjB,OAAAC,cAAAS,GAAAG,EAAAC,EAAAZ,QAAAC,MAAAO,GAAA,EAAqC,KAA5BiD,EAA4B9C,EAAA/C,MAC7BoP,EAAWktB,EAAkByB,YAAYl4B,EAAOi4B,GAChD1uB,EAAWqtB,IACXA,EAAqBrtB,IALU,MAAA7M,GAAAM,GAAA,EAAAC,EAAAP,EAAA,YAAAK,GAAA,MAAAI,EAAAR,QAAAQ,EAAAR,SAAA,WAAAK,EAAA,MAAAC,GAAA,IAAAk7B,GAAA,EAAAC,GAAA,EAAAC,OAAAngC,EAAA,IAQvC,QAAAogC,EAAAC,EAAkBN,EAAS5Y,SAA3BhjB,OAAAC,cAAA67B,GAAAG,EAAAC,EAAAh8B,QAAAC,MAAA27B,GAAA,EAAqC,KAA5Bn4B,EAA4Bs4B,EAAAn+B,MAC7BoP,EAAWktB,EAAkByB,YAAYl4B,EAAOg4B,GAChDzuB,EAAWqtB,IACXA,EAAqBrtB,IAXU,MAAA7M,GAAA07B,GAAA,EAAAC,EAAA37B,EAAA,YAAAy7B,GAAA,MAAAI,EAAA57B,QAAA47B,EAAA57B,SAAA,WAAAy7B,EAAA,MAAAC,GAcvC,OAAOzB,sCAGQ11B,EAAShH,GASxB,IARA,IAKIqP,EALAqtB,EAAqBjP,OAAOkP,kBAC5B2B,EAAM,IAAId,IAAOx2B,EAAQzI,MAAOyI,EAAQxI,KAO5CiuB,EAAA,EAAA8R,EAJU,EAFVD,EAAMA,EAAIt6B,aAEKE,cAAcC,SAASnE,EAAId,GAAIo/B,EAAIj6B,aAAaF,SAASnE,EAAId,IAI5EutB,EAAA8R,EAAAxgC,OAAA0uB,IAAmB,CAAd,IAAI+R,EAACD,EAAA9R,GACFgS,EAAgBz+B,EAAI1B,OAAOiG,UAAUi6B,GACrCC,EAAc3gB,GAAG9d,KACjBqP,EAAWktB,EAAkByB,YAAYS,EAAez3B,IACzC01B,IACXA,EAAqBrtB,GAdJ,IAAAqvB,GAAA,EAAAC,GAAA,EAAAC,OAAA5gC,EAAA,IAmB7B,QAAA6gC,EAAAC,EAAkB9+B,EAAImlB,SAAtBhjB,OAAAC,cAAAs8B,GAAAG,EAAAC,EAAAz8B,QAAAC,MAAAo8B,GAAA,EAAgC,KAAvB54B,EAAuB+4B,EAAA5+B,MACxBoP,EAAWktB,EAAkByB,YAAYl4B,EAAOkB,GAChDqI,EAAWqtB,IACXA,EAAqBrtB,IAtBA,MAAA7M,GAAAm8B,GAAA,EAAAC,EAAAp8B,EAAA,YAAAk8B,GAAA,MAAAI,EAAAr8B,QAAAq8B,EAAAr8B,SAAA,WAAAk8B,EAAA,MAAAC,GAAA,IAAAG,GAAA,EAAAC,GAAA,EAAAC,OAAAjhC,EAAA,IAyB7B,QAAAkhC,EAAAC,EAAkBn4B,EAAQme,SAA1BhjB,OAAAC,cAAA28B,GAAAG,EAAAC,EAAA98B,QAAAC,MAAAy8B,GAAA,EAAoC,KAA3Bj5B,EAA2Bo5B,EAAAj/B,MAC5BoP,EAAWktB,EAAkByB,YAAYl4B,EAAO9F,GAChDqP,EAAWqtB,IACXA,EAAqBrtB,IA5BA,MAAA7M,GAAAw8B,GAAA,EAAAC,EAAAz8B,EAAA,YAAAu8B,GAAA,MAAAI,EAAA18B,QAAA08B,EAAA18B,SAAA,WAAAu8B,EAAA,MAAAC,GA+B7B,OAAOvC,kCAGI0C,EAAMC,GACjB,IACIhwB,EADAqtB,EAAqBjP,OAAOkP,kBAI5B2C,EAAeF,EAAK3+B,QAGxB,GAFA6+B,EAAapgC,GAAKmgC,EAAKngC,GACvBmQ,EAAWktB,EAAkByB,YAAYqB,EAAK/gC,OAAQghC,IACvC5C,EAAoB,KAAA6C,EAI3BH,EAAKxB,WAAYrB,EAAkBiD,aAAaH,EAAM,IAAI7B,KAAQnuB,EAAS,KAJhDowB,EAAAthC,OAAA4R,EAAA,EAAA5R,CAAAohC,EAAA,GAG1BG,EAH0BD,EAAA,GAAAA,EAAA,GAK3BrgC,IAAQN,MAAM6gC,KAAKD,KACnBhD,EAAqBrtB,GAK7B,GAAIjQ,IAAQN,MAAM8gC,GAAGR,EAAKlgC,EAAGmgC,EAAKngC,GAAI,CAClC,IAAI2gC,EAAcT,EAAK3+B,QAGvB,GAFAo/B,EAAY3gC,GAAKmgC,EAAKngC,GACtBmQ,EAAWktB,EAAkByB,YAAYqB,EAAK/gC,OAAQuhC,IACvCnD,EAAoB,KAAAoD,EAI3BV,EAAKxB,WAAYrB,EAAkBiD,aAAaH,EAAM,IAAI7B,KAAQnuB,EAAS,KAJhD0wB,EAAA5hC,OAAA4R,EAAA,EAAA5R,CAAA2hC,EAAA,GAG1BJ,EAH0BK,EAAA,GAAAA,EAAA,GAK3B3gC,IAAQN,MAAM6gC,KAAKD,KACnBhD,EAAqBrtB,IAMjC,GAAIjQ,IAAQN,MAAMkhC,GAAGZ,EAAKlgC,EAAGmgC,EAAKngC,GAAI,CAClC,IAAI2gC,EAAcR,EAAK5+B,QAGvB,GAFAo/B,EAAY3gC,GAAKkgC,EAAKlgC,GACtBmQ,EAAWktB,EAAkByB,YAAYoB,EAAK9gC,OAAQuhC,IACvCnD,EAAoB,KAAAuD,EAI3Bb,EAAKxB,WAAYrB,EAAkBiD,aAAaH,EAAM,IAAI7B,KAAQnuB,EAAS,KAJhD6wB,EAAA/hC,OAAA4R,EAAA,EAAA5R,CAAA8hC,EAAA,GAG1BP,EAH0BQ,EAAA,GAAAA,EAAA,GAK3B9gC,IAAQN,MAAM6gC,KAAKD,KACnBhD,EAAqBrtB,IA7CV,IAAA8wB,GAAA,EAAAC,GAAA,EAAAC,OAAAriC,EAAA,IAkDvB,QAAAsiC,EAAAC,EAAkBnB,EAAKja,SAAvBhjB,OAAAC,cAAA+9B,GAAAG,EAAAC,EAAAl+B,QAAAC,MAAA69B,GAAA,EAAiC,KAAxBr6B,EAAwBw6B,EAAArgC,MACzBoP,EAAWktB,EAAkByB,YAAYl4B,EAAOu5B,GAChDhwB,EAAWqtB,IACXA,EAAqBrtB,IArDN,MAAA7M,GAAA49B,GAAA,EAAAC,EAAA79B,EAAA,YAAA29B,GAAA,MAAAI,EAAA99B,QAAA89B,EAAA99B,SAAA,WAAA29B,EAAA,MAAAC,GAAA,IAAAG,GAAA,EAAAC,GAAA,EAAAC,OAAA1iC,EAAA,IAwDvB,QAAA2iC,EAAAC,EAAkBvB,EAAKla,SAAvBhjB,OAAAC,cAAAo+B,GAAAG,EAAAC,EAAAv+B,QAAAC,MAAAk+B,GAAA,EAAiC,KAAxB16B,EAAwB66B,EAAA1gC,MACzBoP,EAAWktB,EAAkByB,YAAYl4B,EAAOs5B,GAChD/vB,EAAWqtB,IACXA,EAAqBrtB,IA3DN,MAAA7M,GAAAi+B,GAAA,EAAAC,EAAAl+B,EAAA,YAAAg+B,GAAA,MAAAI,EAAAn+B,QAAAm+B,EAAAn+B,SAAA,WAAAg+B,EAAA,MAAAC,GA8DvB,OAAOhE,uCAGS18B,EAAK6gC,GACrB,IAAIC,EAAU9gC,EAAIS,QAElB,OADAqgC,EAAQhgC,GAAKggC,EAAQhgC,GAAGyD,UAAUs8B,GAC3BC,oCAGMxgC,EAASugC,GACtB,IAAIE,EAAa,IAAIxgC,IADMygC,GAAA,EAAAC,GAAA,EAAAC,OAAAljC,EAAA,IAE3B,QAAAmjC,EAAAC,EAAiB9gC,EAAQc,MAAzBe,OAAAC,cAAA4+B,GAAAG,EAAAC,EAAA/+B,QAAAC,MAAA0+B,GAAA,EAAgC,KAAvB/gB,EAAuBkhB,EAAAlhC,MACxByH,EAAS,GADe25B,GAAA,EAAAC,GAAA,EAAAC,OAAAvjC,EAAA,IAE5B,QAAAwjC,EAAAC,EAAiBxhB,EAAjB9d,OAAAC,cAAAi/B,GAAAG,EAAAC,EAAAp/B,QAAAC,MAAA++B,GAAA,EAAuB,KAAdhhB,EAAcmhB,EAAAvhC,MACnB,GAAIogB,EAAK5Y,iBAAiBxG,IACtByG,EAAOjC,KACH,IAAIxE,IAAQof,EAAK5Y,MAAMrB,GAAG7B,UAAUs8B,GAAMxgB,EAAK5Y,MAAMnB,GAAG/B,UAAUs8B,UAGrE,GAAIxgB,EAAK5Y,iBAAkBtI,IAAK,CACjC,IAAIuiC,EAAYrhB,EAAK5Y,MAAMhH,QAC3BihC,EAAU5gC,GAAKuf,EAAK5Y,MAAM3G,GAAGyD,UAAUs8B,GACvCn5B,EAAOjC,KAAKi8B,KAXQ,MAAAl/B,GAAA8+B,GAAA,EAAAC,EAAA/+B,EAAA,YAAA6+B,GAAA,MAAAI,EAAAh/B,QAAAg/B,EAAAh/B,SAAA,WAAA6+B,EAAA,MAAAC,GAc5BR,EAAW7/B,QAAQwG,IAhBI,MAAAlF,GAAAy+B,GAAA,EAAAC,EAAA1+B,EAAA,YAAAw+B,GAAA,MAAAI,EAAA3+B,QAAA2+B,EAAA3+B,SAAA,WAAAw+B,EAAA,MAAAC,GAkB3B,OAAOH,WAKfxE,GAAkBn9B,QAAUA,IAEbm9B,UCzMV59B,GAAUS,IAAVT,OAECgjC,gNACF9jC,MAAM,CACFyE,MAAK,EACL2Q,KAAK,yFAEY,IAAAmQ,EAAAve,KACjB,GAAIA,KAAKsR,MAAMzM,QAAU7E,KAAKhH,MAAMyE,KAAM,CACtC,IAAIoH,EAAQ7E,KAAKsR,MAAMzM,MACnBoC,EAASjH,KAAKsR,MAAMrK,OAEpBV,EAAQS,EAAO2B,SAAS9D,EAAOoC,GACnCV,EAAMJ,MAAQa,EAAOkB,aAAajB,GAClCV,EAAM/C,KAAO,iBACb+C,EAAM3C,MAAQ,iBACd2C,EAAMD,UAAW,EACjBC,EAAMH,WAAY,EAElByK,KAAM,0JACDL,KAAM,SAAC6mB,GACJ,IACIM,EADSpZ,EAAKjN,MAAMrN,OACFd,eAAek0B,EAAKjpB,MAC1C7H,EAAME,IAAIkxB,GAEV,IAAIqE,EAAMliC,GAAQ,GAAG69B,EAAS11B,IAAI4E,KAAO8wB,EAAS11B,IAAIJ,MAAO,GACzD+1B,EAAWD,EAASj4B,UAAUs8B,GAClCz1B,EAAME,IAAImxB,GAEV,IAAImF,EAAYrF,GAAkB9Z,MAAMga,EAAUD,GAC9CqF,EAAWpF,EAASl4B,UAAU5F,IAAQijC,EAAW,IACrDx2B,EAAME,IAAIu2B,GAIVze,EAAKjN,MAAMgmB,kBAAkBzyB,EAAO0B,GACpCgY,EAAKjN,MAAML,YAAY1K,GACvBgY,EAAKjN,MAAM2rB,qBACX1e,EAAKjN,MAAMimB,wBAEnBv3B,KAAKkgB,SAAS,CAACziB,MAAK,IACpBuC,KAAKsR,MAAMkmB,0DAIf,OAAO,YA3Ca/jB,aA0Eb+F,eA3BS,SAAAxgB,GACpB,MAAO,CACHiO,OAAQjO,EAAMiO,OACdpC,MAAO7L,EAAMkM,IAAIL,MACjBZ,OAAQjL,EAAMkM,IAAIjB,SAIC,SAAA8I,GACvB,MAAO,CACHuqB,kBAAmB,SAACzyB,EAAO0B,GAAR,OAAkBwG,EAAS,CAC1C1T,KzE7ByB,wByE8BzBwL,MAAOA,EACPjC,MAAO2D,KAEX0K,YAAa,SAAC1K,GAAD,OAAWwG,EAAS,CAC7B1T,KzE9BiB,gByE+BjBkN,MAAOA,KAEX02B,mBAAoB,kBAAMlwB,EAAS,CAC/B1T,KzEPsB,wByES1Bm+B,sBAAuB,kBAAMzqB,EpDgC1B,CACH1T,KrBnC+B,6ByEG/Bk+B,oBAAqB,kBAAMxqB,EpDqCxB,CACH1T,KrBxC6B,6ByEMtBmgB,CAA6CsjB,wBCxE7CI,GAVC,WACZ,OACInrB,EAAAC,EAAAC,cAACgT,GAAD,KACIlT,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQ0T,UACpBnT,EAAAC,EAAAC,cAAA,OAAKE,UAAWX,KAAQ2rB,QAAxB,kBCGHC,GAAc,SAAC1kC,EAAOC,GAC/B,MAAO,CACHU,K3EiF8B,yB2EhF9BX,QACAC,SACAC,SALqDK,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAT,OASvCokC,GAAa,SAACxkC,GACvB,MAAO,CACHQ,K3EyE6B,wB2ExE7BR,UAWKykC,GAAS,WAIlB,OAHAC,aAAaC,WAAW,SACxBD,aAAaC,WAAW,kBACxBD,aAAaC,WAAW,UACjB,CACHnkC,K3EyD6B,0B2ErDxBokC,GAAmB,SAACC,GAC7B,OAAO,SAAA3wB,GACH4wB,WAAW,WACP,IAAMC,EAAQL,aAAaM,QAAQ,SAC7BC,EAAWP,aAAaM,QAAQ,YAElC9wB,EADA6wB,GAASE,EACAC,GAAMH,EAAOE,GAGbR,OAEG,IAAjBI,KAIEK,GAAQ,SAACH,EAAOE,GACzB,OAAO,SAAA/wB,GACHA,EAtDG,CACH1T,K3EsF8B,2B2EhC9B,IAAM2kC,EAAW,CACbJ,QACAE,WACAG,mBAAmB,GAEvBV,aAAaW,QAAQ,QAASN,GAC9BL,aAAaW,QAAQ,WAAYJ,GAEjCjtB,KAAMwiB,KADM,wHACI2K,GACXxtB,KAAK,SAAA8iB,GACF,IAAM6K,EAAiB,IAAIvN,MAAK,IAAIA,MAAOwN,UAAsC,IAA1B9K,EAASllB,KAAKiwB,WACrEd,aAAaW,QAAQ,QAAS5K,EAASllB,KAAKkwB,SAC5Cf,aAAaW,QAAQ,iBAAkBC,GACvCZ,aAAaW,QAAQ,SAAU5K,EAASllB,KAAKmwB,SAE7CxxB,EAASqwB,GAAY9J,EAASllB,KAAKkwB,QAAShL,EAASllB,KAAKmwB,UAC1DxxB,EAAS0wB,GAAiBnK,EAASllB,KAAKiwB,YACxC,IAAMG,EAAc,SAAWlL,EAASllB,KAAKkwB,QAAU,8BAAgChL,EAASllB,KAAKmwB,QAAU,IAC/G,OAAO1tB,KAAMxD,IAAI,iDAAmDmxB,KAEvEhuB,KAAK,SAAA8iB,GACF,GAAIh6B,OAAO8X,OAAOkiB,EAASllB,KAAKlV,OAAS,GAAI,CACzC,IAAMN,EAAWU,OAAO8X,OAAOkiB,EAASllB,MAAM,GAAGxV,SACjD2kC,aAAaW,QAAQ,WAAYtlC,GACjCmU,EA1DW,SAACnU,GAC5B,MAAO,CACHS,K3EoEmC,6B2EnEnCT,YAuDqB6lC,CAAgBnlC,OAAO8X,OAAOkiB,EAASllB,MAAM,GAAGxV,cAGhEw0B,MAAM,SAAAv0B,GACHkU,EAASswB,GAAWxkC,EAAMy6B,SAASllB,KAAKvV,YCpElD6lC,kMAEE1+B,KAAKsR,MAAMqtB,8DAG0B,MAAjC3+B,KAAKsR,MAAMhZ,SAAS6+B,eAA+Ch+B,IAA3B6G,KAAKsR,MAAM9F,SAASJ,IAC5DpL,KAAKsR,MAAM2f,QAAQrwB,KAAK,cAAgBZ,KAAKsR,MAAM9F,SAASJ,qCAWhE,OACI2G,EAAAC,EAAAC,cAAA,OAAKE,UAAU,OACXJ,EAAAC,EAAAC,cAAC2sB,GAAD,CACIh7B,MAAO5D,KAAKsR,MAAM1N,MAClBC,QAAS7D,KAAKsR,MAAMzN,QACpBg7B,gBAAiB7+B,KAAKsR,MAAMutB,gBAC5BjmC,SAAUoH,KAAKsR,MAAM1Y,WAGzBmZ,EAAAC,EAAAC,cAAC6sB,GAAD,MAEA/sB,EAAAC,EAAAC,cAACghB,GAAA,EAAD,KAMIlhB,EAAAC,EAAAC,cAACghB,GAAA,EAAD,CAAOC,KAAK,QAAQ6L,OAAK,EAAC5L,UAAWiE,KAMrCrlB,EAAAC,EAAAC,cAACghB,GAAA,EAAD,CAAOC,KAAK,YAAYC,UAAWsE,KACnC1lB,EAAAC,EAAAC,cAACghB,GAAA,EAAD,CAAOC,KAAK,sBAAsBC,UAAW2J,MAIhD98B,KAAKsR,MAAMxM,YAAciN,EAAAC,EAAAC,cAAC+sB,GAAD,MAAa,aA7CrCvrB,aAoEHyjB,gBAAW1d,YAjBF,SAAA3M,GAA+B,IAA7B9T,EAA6B8T,EAA7B9T,KAAMmM,EAAuB2H,EAAvB3H,IAAKwG,EAAkBmB,EAAlBnB,aACjC,MAAO,CACH9H,MAAOsB,EAAItB,MACXC,QAASqB,EAAIrB,QACbiB,YAAaI,EAAIJ,YACjB0G,SAAUE,EAAaF,SACvBqzB,gBAAgC,OAAf9lC,EAAKL,MACtBE,SAAUG,EAAKH,WAII,SAAAmU,GACvB,MAAO,CACH4xB,eAAgB,kBAAM5xB,ED8CnB,SAAAA,GACH,IAAMrU,EAAQ6kC,aAAaM,QAAQ,SACnC,GAAKnlC,EAGA,CACD,IAAMC,EAAS4kC,aAAaM,QAAQ,UAC9BjlC,EAAW2kC,aAAaM,QAAQ,YAChCM,EAAiB,IAAIvN,KAAK2M,aAAaM,QAAQ,mBACrD,GAAIM,EAAiB,IAAIvN,KAAQ,CAC7B,IAAMqO,EAAWd,EAAeC,WAAY,IAAIxN,MAAOwN,UACvDrxB,EAASqwB,GAAY1kC,EAAOC,EAAQC,IACpCmU,EAAS0wB,GAAiBwB,EAAW,WAGrClyB,EAASuwB,WAZbvwB,EAASuwB,WC7CK9jB,CAA6CklB,KCtEjEQ,WAAmB7mC,OAAO8mC,sCAAwCC,KAElEC,GAAQC,YAAY5yB,GACtBwyB,GACIK,YAAgB3yB,GAAKuB,GAAW6B,GAAsBtB,GAAiB8wB,OAI/Ezb,IAAS0b,OACL1tB,EAAAC,EAAAC,cAACytB,EAAA,EAAD,CAAUL,MAAOA,IACbttB,EAAAC,EAAAC,cAAC0tB,EAAA,EAAD,CAAeC,SAAU97B,IACrBiO,EAAAC,EAAAC,cAAC4tB,GAAD,QAGRr0B,SAASmY,eAAe,S/EwFtB,kBAAmBmc,WACrBA,UAAUC,cAAcC,MAAMxvB,KAAK,SAAAyvB,GACjCA,EAAaC,mCgF1HnBC,EAAAC,QAAA,CAAkB1tB,OAAA,uBAAAjB,YAAA,4BAAAE,eAAA,+BAAAC,kBAAA,kCAAAyuB,aAAA,kDCAlBF,EAAAC,QAAA,CAAkB9S,YAAA,iCAAAgT,OAAA,4BAAAvR,aAAA,kCAAAE,sBAAA,2CAAAD,qBAAA,+DCAlBmR,EAAAC,QAAA,CAAkBl6B,MAAA,gCAAA6vB,kBAAA,4CAAAE,mBAAA,6CAAAC,aAAA,uCAAAqK,kBAAA,0CAAAC,oBAAA,iECAlBL,EAAAC,QAAA,CAAkB7tB,gBAAA,yCAAAC,cAAA,4DCAlB2tB,EAAAC,QAAA,CAAkBK,cAAA,sCAAAC,oBAAA,4CAAAL,aAAA,4DCAlBF,EAAAC,QAAA,CAAkBlb,SAAA,6BAAAjB,WAAA,+BAAAqc,OAAA,gDCAlBH,EAAAC,QAAA,CAAkBO,aAAA,+BAAAC,uBAAA,yCAAAN,OAAA,gDCAlBH,EAAAC,QAAA,CAAkBS,aAAA,oCAAAC,4BAAA,wECAlBX,EAAAC,QAAA,CAAkBlb,SAAA,0BAAAiY,OAAA,wBAAA4D,MAAA,4CCAlBZ,EAAAC,QAAA,CAAkBY,aAAA,yDCAlBb,EAAAC,QAAA,CAAkBa,iBAAA,6DCAlBd,EAAAC,QAAA,CAAkBc,YAAA,iCAAAxhB,eAAA,yDCAlBygB,EAAAC,QAAA,CAAkBvgB,YAAA,iCAAAygB,OAAA,iDCAlBH,EAAAC,QAAA,CAAkB/a,WAAA,oDCAlB8a,EAAAC,QAAA,CAAkB5Z,cAAA,qCAAA8Z,OAAA,8BAAAa,KAAA,4BAAAC,MAAA,kDCAlBjB,EAAAC,QAAA,CAAkBrZ,SAAA,2BAAAsa,UAAA,iDCAlBlB,EAAAC,QAAA,CAAkBkB,eAAA,yDCAlBnB,EAAAC,QAAA,CAAkBmB,qBAAA,kECAlBpB,EAAAC,QAAA,CAAkBoB,kBAAA,4DCAlBrB,EAAAC,QAAA,CAAkBqB,YAAA","file":"static/js/main.0358917e.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n\n              // Execute callback\n              if (config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import * as actionTypes from '../actionTypes';\r\n\r\nconst initialState = {\r\n    token: null,\r\n    userId: null,\r\n    username: null,\r\n    error: null,\r\n    loading: false\r\n};\r\n\r\nconst auth = (state=initialState, action) => {\r\n    switch (action.type) {\r\n        case actionTypes.AUTHENTICATION_STARTED:\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                loading: true\r\n            };\r\n        case actionTypes.AUTHENTICATION_SUCCEED:\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                token: action.token,\r\n                userId: action.userId,\r\n                username: action.username,\r\n                loading: false\r\n            };\r\n        case actionTypes.AUTHENTICATION_FAILED:\r\n            return {\r\n                ...state,\r\n                error: action.error,\r\n                token: null,\r\n                userId: null,\r\n                username: null,\r\n                loading: false\r\n            };\r\n        case actionTypes.AUTHENTICATION_LOGOUT:\r\n            return {\r\n                ...state,\r\n                token: null,\r\n                userId: null,\r\n                username: null\r\n            };\r\n        case actionTypes.AUTHENTICATION_SET_USERNAME:\r\n            return {\r\n                ...state,\r\n                username: action.username\r\n            };\r\n        default:\r\n            return state\r\n    }\r\n};\r\n\r\nexport default auth;","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nexport const NEW_STAGE_CREATED = \"NEW_STAGE_CREATED\";\r\nexport const STAGE_RESIZED = \"STAGE_RESIZED\";\r\nexport const NEW_SHAPE_PASTED = \"NEW_SHAPE_PASTED\";\r\nexport const CLEAR_ALL = \"CLEAR_ALL\";\r\nexport const STAGE_UNMOUNTED = \"STAGE_UNMOUNTED\";\r\n\r\n/** Toolbar buttons **/\r\nexport const PAN_BY_DRAG_BUTTON_CLICKED = \"PAN_BY_DRAG_BUTTON_CLICKED\";\r\n// export const SAVE_DOCUMENT_BUTTON_CLICKED = \"SAVE_DOCUMENT_BUTTON_CLICKED\";\r\nexport const MANAGE_CLOUD_STORAGE_BUTTON_CLICKED = \"MANAGE_CLOUD_STORAGE_BUTTON_CLICKED\";\r\n\r\nexport const MEASURE_POINTS_BUTTON_PRESSED = \"MEASURE_POINTS_BUTTON_PRESSED\";\r\nexport const MEASURE_SHAPES_BUTTON_PRESSED = \"MEASURE_SHAPES_BUTTON_PRESSED\";\r\nexport const TOGGLE_ABOUT_POPUP_CLICKED = \"TOGGLE_ABOUT_POPUP_CLICKED\";\r\n// export const CLOSE_ABOUT_POPUP_BUTTON_PRESSED = \"CLOSE_ABOUT_POPUP_BUTTON_PRESSED\";\r\nexport const TOGGLE_UNITS_CLICKED = \"TOGGLE_UNITS_CLICKED\";\r\nexport const TOGGLE_WIDTH_MODE_CLICKED = \"TOGGLE_WIDTH_MODE_CLICKED\";\r\nexport const TOGGLE_DISPLAY_VERTICES_CLICKED = \"TOGGLE_DISPLAY_VERTICES_CLICKED\";\r\nexport const TOGGLE_DISPLAY_LABELS_CLICKED = \"TOGGLE_DISPLAY_LABELS_CLICKED\";\r\nexport const TOGGLE_SHOW_LAYER_LIST_CLICKED = \"TOGGLE_SHOW_LAYER_LIST_CLICKED\";\r\nexport const TOGGLE_DOWNLOAD_POPUP_CLICKED = \"TOGGLE_DOWNLOAD_POPUP_CLICKED\";\r\nexport const TOGGLE_UPLOAD_POPUP_CLICKED=\"TOGGLE_UPLOAD_POPUP_CLICKED\";\r\n\r\nexport const MOUSE_MOVED_ON_STAGE = \"MOUSE_MOVED_ON_STAGE\";\r\nexport const MOUSE_DOWN_ON_STAGE = \"MOUSE_DOWN_ON_STAGE\";\r\nexport const MOUSE_UP_ON_STAGE = \"MOUSE_UP_ON_STAGE\";\r\nexport const MOUSE_WHEEL_MOVE_ON_STAGE = \"MOUSE_WHEEL_MOVE_ON_STAGE\";\r\n\r\nexport const MOUSE_ROLL_OVER_SHAPE = \"MOUSE_ROLL_OVER_SHAPE\";\r\nexport const MOUSE_ROLL_OUT_SHAPE = \"MOUSE_ROLL_OUT_SHAPE\";\r\nexport const MOUSE_CLICKED_ON_SHAPE = \"MOUSE_CLICKED_ON_SHAPE\";\r\n\r\nexport const PINCH_DOWN_ON_STAGE = \"PINCH_DOWN_ON_STAGE\";\r\nexport const PINCH_MOVED_ON_STAGE = \"PINCH_MOVED_ON_STAGE\";\r\nexport const PINCH_UP_ON_STAGE = \"PINCH_UP_ON_STAGE\";\r\n\r\n// export const HOME_BUTTON_CLICKED = \"HOME_BUTTON_CLICKED\";\r\nexport const PAN_TO_COORDINATE = \"PAN_TO_COORDINATE\";\r\nexport const PAN_AND_ZOOM_TO_SHAPE = \"PAN_AND_ZOOM_TO_SHAPE\";\r\n\r\nexport const LAYER_LIST_PANEL_PRESSED = \"LAYER_LIST_PANEL_PRESSED\";\r\nexport const ADD_LAYER_BUTTON_PRESSED = \"ADD_LAYER_BUTTON_PRESSED\";\r\nexport const ADD_NEW_LAYER = \"ADD_NEW_LAYER\";\r\nexport const DELETE_LAYER_BUTTON_PRESSED = \"DELETE_LAYER_BUTTON_PRESSED\";\r\nexport const SORT_LAYERS_BUTTON_PRESSED = \"SORT_LAYERS_BUTTON_PRESSED\";\r\nexport const CLEAN_AND_UPDATE_LAYERS = \"CLEAN_AND_UPDATE_LAYERS\";\r\n\r\nexport const TOGGLE_DISPLAY_LAYER_PRESSED = \"TOGGLE_DISPLAY_LAYER_PRESSED\";\r\nexport const TOGGLE_AFFECTED_LAYER_PRESSED=\"TOGGLE_AFFECTED_LAYER_PRESSED\";\r\nexport const OPEN_LAYER_EDIT_FORM_PRESSED = \"OPEN_LAYER_EDIT_FORM_PRESSED\";\r\nexport const SUBMIT_LAYER_EDIT_FORM_PRESSED = \"SUBMIT_LAYER_EDIT_FORM_PRESSED\";\r\nexport const ESCAPE_LAYER_EDIT_FORM_PRESSED = \"ESCAPE_LAYER_EDIT_FORM_PRESSED\";\r\n\r\nexport const LAYERS_LIST_ARROW_DOWN_PRESSED = \"LAYERS_LIST_ARROW_DOWN_PRESSED\";\r\nexport const LAYERS_LIST_ARROW_UP_PRESSED = \"LAYERS_LIST_ARROW_UP_PRESSED\";\r\n\r\n// export const TOGGLE_WATCH_EXPAND_CLICKED = \"TOGGLE_WATCH_EXPAND_CLICKED\";\r\n\r\n// export const FILENAME_LIST_SELECTED = \"FILENAME_LIST_SELECTED\";\r\nexport const FILES_UPLOAD_COMPLETED = \"FILES_UPLOAD_COMPLETED\";\r\nexport const INITIALIZE_UPLOAD_STATE = \"INITIALIZE_UPLOAD_STATE\";\r\nexport const DATA_FROM_BUFFER_PASTED = \"DATA_FROM_BUFFER_PASTED\";\r\n\r\n/** AABB Distance Measurement Demo **/\r\nexport const AABB_DEMO_URI = \"AABB_DEMO_URI\";\r\nexport const AABB_DEMO_NEXT_DIST_STEP = \"AABB_DEMO_NEXT_DIST_STEP\";\r\nexport const AABB_TREE_NEXT_LEVEL = \"AABB_TREE_NEXT_LEVEL\";\r\n\r\n/** Collision demo **/\r\nexport const COLLISION_DEMO_URI = \"COLLISION_DEMO_URI\";\r\nexport const COLLISION_DEMO_BUTTON_PRESSED = \"COLLISION_DEMO_BUTTON_PRESSED\";\r\n\r\n/** Skeleton recognition demo **/\r\nexport const SKELETON_RECOGNITION_URI = \"SKELETON_RECOGNITION_URI\";\r\nexport const SKELETON_RECOGNITION_BUTTON_PRESSED=\"SKELETON_RECOGNITION_BUTTON_PRESSED\";\r\n\r\nexport const ASYNC_OPERATION_STARTED = \"ASYNC_OPERATION_STARTED\";\r\nexport const ASYNC_OPERATION_ENDED = \"ASYNC_OPERATION_ENDED\";\r\n\r\n/** Documents list **/\r\nexport const REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED = \"REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED\";\r\nexport const REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED = \"REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED\";\r\nexport const REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED = \"REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED\";\r\nexport const REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED = \"REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED\";\r\nexport const DELETE_DOCUMENT_FROM_DATABASE_SUCCEED = \"DELETE_DOCUMENT_FROM_DATABASE_SUCCEED\";\r\nexport const DOCUMENT_SELECTED_FROM_LIST = \"DOCUMENT_SELECTED_FROM_LIST\";\r\nexport const DOCUMENT_NAME_UPDATED = \"DOCUMENT_NAME_UPDATED\";\r\nexport const CLEAR_ALL_BUTTON_CLICKED = \"CLEAR_ALL_BUTTON_CLICKED\";\r\n\r\n/* Authentication */\r\nexport const AUTHENTICATION_STARTED = \"AUTHENTICATION_STARTED\";\r\nexport const AUTHENTICATION_SUCCEED = \"AUTHENTICATION_SUCCEED\";\r\nexport const AUTHENTICATION_FAILED = \"AUTHENTICATION_FAILED\";\r\nexport const AUTHENTICATION_LOGOUT = \"AUTHENTICATION_LOGOUT\";\r\nexport const AUTHENTICATION_SET_USERNAME = \"AUTENTICATION_SET_USERNAME\";\r\n\r\n","import {Utils, Arc, vector} from \"@flatten-js/core\";\r\n\r\nexport function arcSE(center, start, end, counterClockwise) {\r\n    let startAngle = vector(center,start).slope;\r\n    let endAngle = vector(center, end).slope;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, start).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\nexport function arcStartSweep(center, start, sweep, counterClockwise) {\r\n    let startAngle = vector(center,start).slope;\r\n    let endAngle = startAngle + sweep;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, start).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\nexport function arcEndSweep(center, end, sweep, counterClockwise) {\r\n    let endAngle = vector(center,end).slope;\r\n    let startAngle = endAngle - sweep;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, end).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\n","\r\n/**\r\n * Created by Alex Bol on 12/02/2018.\r\n */\r\nimport {Segment, Arc, Polygon, Face} from \"@flatten-js/core\";\r\nimport {CW, CCW, INSIDE, OUTSIDE, ORIENTATION} from \"@flatten-js/core\";\r\nimport {vector} from \"@flatten-js/core\";\r\nimport Flatten from \"@flatten-js/core\";\r\nimport {arcSE, arcStartSweep, arcEndSweep} from \"./createArcs\";\r\n\r\nconst {unify, subtract, BOOLEAN_UNION} = Flatten.BooleanOperations;\r\nconst {addToIntPoints, getSortedArray, splitByIntersections} = Flatten.BooleanOperations;\r\nconst {removeNotRelevantChains, removeOldFaces, restoreFaces} = Flatten.BooleanOperations;\r\n\r\n/**\r\n * Offset polygon by given value\r\n * @param {Polygon} polygon - input polygon\r\n * @param {number} value - offset value, may be positive or negative\r\n * @returns {Polygon} offsetPolygon\r\n */\r\n\r\n/**\r\n *\r\n * @param polygon\r\n * @param value\r\n *\r\n */\r\nexport function offset(polygon, value) {\r\n    let w = value;\r\n\r\n    let edges = [...polygon.edges];\r\n    let offsetPolygon = polygon.clone();\r\n    let offsetEdge;\r\n\r\n    if (w !== 0) {\r\n\r\n        for (let edge of edges) {\r\n            if (edge.isSegment()) {\r\n                offsetEdge = offsetSegment(edge.shape, w);\r\n            }\r\n            else {\r\n                offsetEdge = offsetArc(edge.shape, w);\r\n            }\r\n\r\n            if (w > 0) {\r\n                offsetPolygon = unify(offsetPolygon, offsetEdge);\r\n            }\r\n            else {\r\n                offsetPolygon = subtract(offsetPolygon, offsetEdge);\r\n            }\r\n        }\r\n    }\r\n\r\n    return offsetPolygon;\r\n}\r\n\r\nexport function offsetArc(arc, value) {\r\n\r\n    let w = Math.abs(value);\r\n\r\n    // Define outline polygon\r\n    let polygon = new Polygon();\r\n    let arc_cap1,arc_cap2;\r\n\r\n    let arc_outer = arc.clone();\r\n    arc_outer.r = arc.r + w;\r\n\r\n    arc_cap1 = arcStartSweep(arc.end, arc_outer.end, Math.PI, arc.counterClockwise);\r\n    arc_cap2 = arcEndSweep(arc.start, arc_outer.start, Math.PI, arc.counterClockwise);\r\n\r\n    let arc_inner = undefined;\r\n    if (arc.r > w) {\r\n        arc_inner = new Arc(arc.pc, arc.r - w, arc.endAngle, arc.startAngle,\r\n            arc.counterClockwise === CW ? CCW : CW);\r\n    }\r\n    else {\r\n        // arc_inner = new Arc(arc.pc, w - arc.r, arc.startAngle, arc.endAngle, arc.counterClockwise);\r\n        arc_inner = new Segment(arc_cap1.end, arc_cap2.start);\r\n    }\r\n\r\n    polygon.addFace([arc_outer, arc_cap1, arc_inner, arc_cap2]);\r\n    [...polygon.faces][0].setArcLength();\r\n\r\n    // Create intersection points\r\n    let ips = Face.getSelfIntersections([...polygon.faces][0], polygon.edges, false);\r\n\r\n    // TODO: getSelfIntersections returns points with correspondent edges - avoid duplication\r\n    ips = ips.slice(0,ips.length/2);    // for now slice array to avoid duplication in points\r\n\r\n    let int_points = [];\r\n    let edge_cap1;\r\n    let edge_cap2;\r\n\r\n    edge_cap1 = [...polygon.edges][1];\r\n    edge_cap2 = [...polygon.edges][3];\r\n\r\n    for (let pt of ips) {\r\n        addToIntPoints(edge_cap1, pt, int_points);\r\n        addToIntPoints(edge_cap2, pt, int_points);\r\n    }\r\n\r\n    // Sort intersection points and insert them as new vertices\r\n    let int_points_sorted = getSortedArray(int_points);\r\n    splitByIntersections(polygon, int_points_sorted);\r\n\r\n\r\n    // Set BV flags\r\n    let bv = OUTSIDE;\r\n    for (let int_point of int_points_sorted) {\r\n        int_point.edge_before.bv = bv;\r\n        int_point.edge_after.bv = (bv === OUTSIDE ? INSIDE : OUTSIDE);\r\n        bv = int_point.edge_after.bv;   // invert flag on each iteration\r\n    }\r\n\r\n    // Remove inner \"chains\"\r\n    let op = BOOLEAN_UNION;\r\n    removeNotRelevantChains(polygon, op, int_points_sorted, true);\r\n\r\n    // return int_points_sorted;\r\n    // Swap links\r\n    let num = int_points.length;\r\n    if (num > 0) {\r\n        let edge_before;\r\n        let edge_after;\r\n        // 0 => 3\r\n        edge_before = int_points_sorted[0].edge_before;\r\n        edge_after = int_points_sorted[num-1].edge_after;\r\n        edge_before.next = edge_after;\r\n        edge_after.prev = edge_before;\r\n\r\n        // Fill in missed links in intersection points\r\n        int_points_sorted[0].edge_after = int_points_sorted[num-1].edge_after;\r\n        int_points_sorted[num-1].edge_before = int_points_sorted[0].edge_before;\r\n\r\n        if (num === 4) {\r\n            // 2 => 1\r\n            edge_before = int_points_sorted[2].edge_before;\r\n            edge_after = int_points_sorted[1].edge_after;\r\n            edge_before.next = edge_after;\r\n            edge_after.prev = edge_before;\r\n\r\n            // Fill in missed links in intersection points\r\n            int_points_sorted[2].edge_after = int_points_sorted[1].edge_after;\r\n            int_points_sorted[1].edge_before = int_points_sorted[2].edge_before;\r\n        }\r\n\r\n        // remove old faces\r\n        removeOldFaces(polygon, int_points);\r\n        // restore faces\r\n        restoreFaces(polygon, int_points, int_points);\r\n    }\r\n\r\n    let face0 = [...polygon.faces][0];\r\n    if (face0.orientation() === ORIENTATION.CCW) {\r\n        polygon.reverse();\r\n    }\r\n    return polygon;\r\n}\r\n\r\nexport function offsetSegment(seg, value) {\r\n    let w = Math.abs(value);\r\n\r\n    let polygon = new Polygon();\r\n    let v_seg = vector(seg.end.x-seg.start.x, seg.end.y-seg.start.y);\r\n    let v_seg_unit = v_seg.normalize();\r\n    let v_left = v_seg_unit.rotate90CCW().multiply(w);\r\n    let v_right = v_seg_unit.rotate90CW().multiply(w);\r\n    let seg_left = seg.translate(v_left);\r\n    let seg_right = seg.translate(v_right).reverse();\r\n    let cap1 = arcSE(seg.end, seg_left.end, seg_right.start, CW);\r\n    let cap2 = arcSE(seg.start, seg_right.end, seg_left.start, CW);\r\n\r\n    polygon.addFace([seg_left, cap1, seg_right, cap2]);\r\n    return polygon;\r\n}\r\n","/**\r\n * Created by alexanderbol on 01/05/2017.\r\n */\r\n\r\nimport {Point, Segment, Arc, Circle, Box, Polygon, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\nimport {offsetSegment, offsetArc} from \"../models/polygonOffset\";\r\n\r\n/*\r\nlet debug_str = `\r\n+\t\t[0]\t{nrec=27 nalloc=27 h_ind_id=-1 ...} mat_cont_hdr_struc\tmat_cont_struc\r\n+\t\t[1]\t{pmin=59146400,5973200 pmax=59606001,6438000} mat_cont_lim_struc\tmat_cont_struc\r\n+\t\t[2]\t{nedge=23 nalloc=25 ntop=2 ...} mat_cont_poly_struc\tmat_cont_struc\r\n+\t\t[3]\t{pmin=59146400,5973200 pmax=59606001,6438000} mat_cont_lim_struc\tmat_cont_struc\r\n+\t\t[4]\t{ps=59192738,6363124 pe=59216000,6372800 pc=59216000,6340000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[5]\t{ps=59216000,6372800 pe=59267652,6372800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[6]\t{ps=59267652,6372800 pe=59267652,6307200 pc=59360000,6340000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[7]\t{ps=59267652,6307200 pe=59229586,6307200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[8]\t{ps=59229586,6307200 pe=59212000,6289614} mat_seg_struc\tmat_cont_struc\r\n+\t\t[9]\t{ps=59212000,6289614 pe=59212000,6056386} mat_seg_struc\tmat_cont_struc\r\n+\t\t[10]\t{ps=59212000,6056386 pe=59229586,6038800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[11]\t{ps=59229586,6038800 pe=59469614,6038800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[12]\t{ps=59469614,6038800 pe=59487200,6056386} mat_seg_struc\tmat_cont_struc\r\n+\t\t[13]\t{ps=59487200,6056386 pe=59487200,6100500} mat_seg_struc\tmat_cont_struc\r\n+\t\t[14]\t{ps=59487200,6100500 pe=59434000,6180000 pc=59520000,6180000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[15]\t{ps=59434000,6180000 pe=59552800,6100500 pc=59520000,6180000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[16]\t{ps=59552800,6100500 pe=59552800,6042800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[17]\t{ps=59552800,6042800 pe=59543124,6019538 pc=59520000,6042800 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[18]\t{ps=59543124,6019538 pe=59506462,5982876} mat_seg_struc\tmat_cont_struc\r\n+\t\t[19]\t{ps=59506462,5982876 pe=59483200,5973200 pc=59483200,6006000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[20]\t{ps=59483200,5973200 pe=59216000,5973200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[21]\t{ps=59216000,5973200 pe=59192738,5982876 pc=59216000,6006000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[22]\t{ps=59192738,5982876 pe=59156076,6019538} mat_seg_struc\tmat_cont_struc\r\n+\t\t[23]\t{ps=59156076,6019538 pe=59146400,6042800 pc=59179200,6042800 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[24]\t{ps=59146400,6042800 pe=59146400,6303200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[25]\t{ps=59146400,6303200 pe=59156076,6326462 pc=59179200,6303200 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[26]\t{ps=59156076,6326462 pe=59192738,6363124} mat_seg_struc\tmat_cont_struc\r\n`;\r\n*/\r\n\r\n/*\r\n+\t\tcircle\t{pc=40445880,-10500080 r=41327880}\tmat_circle_struc\r\n+\t\tcircle\t{pc=38215880,-7700040 r=92456}\tmat_circle_struc\r\n+\t\trect\t{pll=38215880,-7700040 w=92456 h=50000}\tmat_rect_struc\r\n+\t\tshape1\t{type=512 s={...} }\t_mat_shape_struc\r\n+\t\tline\t{ps=-18423,529080 pe=1047776,480195 r=60000 cap=0}\tmat_line_struc\r\n+\t\tarc\t{ps=1001217,249728 pe=752127,51853 pc=853697,179712 cw=??? r=60000 cap=0}\tmat_arc_struc\r\n */\r\n\r\nexport class Parser {\r\n    parseToWatchArray(str) {\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n        let watchArray = [];\r\n        for (let line of arrayOfLines) {\r\n            watchArray.push(line.substring(line.indexOf('{')));\r\n        }\r\n        return watchArray;\r\n    }\r\n\r\n    parseToPoint(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let pointArr = parenth.split('=')[1].split(',');\r\n        let point = new Point(parseInt(pointArr[0],10), parseInt(pointArr[1],10));\r\n        point.label = line.split(/\\s+/)[1];\r\n        return point;\r\n    }\r\n\r\n    parseToSegment(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        return new Segment(ps, pe);\r\n    }\r\n\r\n    parseToArc(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let pcArr = termArr[2].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n\r\n        let cwStr = termArr[3].split('=')[1];\r\n        let counterClockwise = cwStr === '0' ? true : false;\r\n\r\n        let startAngle = vector(pc,ps).slope;\r\n        let endAngle = vector(pc, pe).slope;\r\n\r\n        if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n            // endAngle += 2*Math.PI;\r\n            endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n        }\r\n        let r = vector(pc, ps).length;\r\n\r\n        return new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n    }\r\n\r\n    parseToCircle(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let pcArr = termArr[0].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n        let r = parseInt(termArr[1].split('=')[1],10);\r\n        // let circle = new Circle(pc, r);\r\n        // let polygon = new Polygon();\r\n        // polygon.addFace(circle);\r\n        return new Circle(pc, r);;\r\n    }\r\n\r\n    parseToRectangle(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let pllArr = termArr[0].split('=')[1].split(',');\r\n        let xmin = parseInt(pllArr[0],10);\r\n        let ymin = parseInt(pllArr[1],10);\r\n        let width = parseInt(termArr[1].split('=')[1],10);\r\n        let height = parseInt(termArr[2].split('=')[1],10);\r\n\r\n        let box = new Box(xmin, ymin, xmin + width, ymin + height);\r\n        let polygon = new Polygon();\r\n        polygon.addFace(box);\r\n        return polygon;\r\n        // return new Box(xmin, ymin, xmin + width, ymin + height);\r\n    }\r\n\r\n    parseToODBLine(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let w = parseInt(termArr[2].split('=')[1],10);\r\n\r\n        let segment = new Segment(ps, pe);\r\n        let polygon = w > 0 ? offsetSegment(segment, w) : new Polygon();\r\n\r\n        return polygon;\r\n    }\r\n\r\n    parseToODBArc(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let pcArr = termArr[2].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n\r\n        let cwStr = termArr[3].split('=')[1];\r\n        let counterClockwise = cwStr === '0' ? true : false;\r\n\r\n        let startAngle = vector(pc,ps).slope;\r\n        let endAngle = vector(pc, pe).slope;\r\n\r\n        if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n            // endAngle += 2*Math.PI;\r\n            endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n        }\r\n        let r = vector(pc, ps).length;\r\n\r\n        let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n        let w = parseInt(termArr[4].split('=')[1],10);\r\n\r\n        let polygon = w > 0 ? offsetArc(arc, w) : new Polygon();\r\n\r\n        return polygon;\r\n    }\r\n\r\n    parseToPolygon(str) {\r\n        let polygon = new Polygon();\r\n        // let mulitystr = debug_str;\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n\r\n        for (let i=0; i < arrayOfLines.length; i++) {\r\n            let line = arrayOfLines[i];\r\n            if (line.search('mat_cont_poly_struc') >= 0) {\r\n                let parenth = line.match(/\\{([^)]+)\\}/)[1];       // string inside {..}\r\n                let termArr = parenth.split(' ');                 // array of terms \"attr=value\"\r\n                let nedgesTerm = termArr[0];                      // \"nedge=nn\"\r\n                let nedgesStr = nedgesTerm.split('=')[1];\r\n                let nedges = parseInt(nedgesStr,10);\r\n\r\n                // Create new face from next #nedges of segments and arcs\r\n                let edges = [];\r\n                for (let j=i+2; j < i+2+nedges; j++) {\r\n                    line = arrayOfLines[j];\r\n                    // let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n                    // let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n                    if (line.search('mat_seg_struc') >= 0) {\r\n                        let segment = this.parseToSegment(line);\r\n                        edges.push(segment);\r\n                    }\r\n                    else if (line.search('mat_curve_struc') >= 0) {\r\n                        let arc = this.parseToArc(line);\r\n                        edges.push(arc);\r\n                    }\r\n                }\r\n                polygon.addFace(edges);\r\n            }\r\n        }\r\n        return polygon;\r\n    }\r\n\r\n    parseToPoints(str) {\r\n        let points = [];\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n        for (let line of arrayOfLines) {\r\n            if (line.search('point_struc') >= 0) {\r\n                let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n                let pointArr = parenth.split('=')[1].split(',');\r\n                let point = new Point(parseInt(pointArr[0],10), parseInt(pointArr[1],10));\r\n                point.label = line.split(/\\s+/)[1];\r\n                points.push(point);\r\n            }\r\n        }\r\n        return points;\r\n    }\r\n\r\n    parseToShapes(str) {\r\n        let shapes = [];\r\n        let shape;\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n        for (let line of arrayOfLines) {\r\n            if (line.search('point_struc') >= 0) {\r\n                shape = this.parseToPoint(line);\r\n            }\r\n            else if (line.search('_seg_struc') >= 0) {\r\n                shape = this.parseToSegment(line);\r\n            }\r\n            else if (line.search('_curve_struc') >= 0) {\r\n                shape = this.parseToArc(line);\r\n            }\r\n            else if (line.search('_circle_struc') >= 0) {\r\n                shape = this.parseToCircle(line);\r\n            }\r\n            else if (line.search('_rect_struc') >= 0) {\r\n                shape = this.parseToRectangle(line);\r\n            }\r\n            else if (line.search('_line_struc') >= 0) {\r\n                shape = this.parseToODBLine(line);\r\n            }\r\n            else if (line.search('_arc_struc') >= 0) {\r\n                shape = this.parseToODBArc(line);\r\n            }\r\n            shapes.push(shape);\r\n        }\r\n        return shapes;\r\n    }\r\n\r\n    parse(str) {\r\n        /* try polygon */\r\n        let polygon = this.parseToPolygon(str);\r\n        if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n            return [polygon];\r\n        }\r\n\r\n        /* try array of shapes excluding polygon */\r\n        let shapes = this.parseToShapes(str);\r\n        if (shapes.length > 0) {\r\n            return shapes;\r\n        }\r\n\r\n        /* try array of points */\r\n        let points = this.parseToPoints(str);\r\n        if (points.length > 0) {\r\n            return points;\r\n        }\r\n\r\n    }\r\n}\r\n\r\n","import * as ActionTypes from \"../actionTypes\";\r\nimport {Parser} from \"../../dataParsers/parser\";\r\n\r\nconst unitsList = [\r\n    {\r\n        name: \"pixels\",\r\n        decimals: 0,\r\n        divisor: 1\r\n    },\r\n    {\r\n        name: \"inch\",\r\n        decimals: 7,\r\n        divisor: 10160000\r\n    },\r\n    {\r\n        name: \"mm\",\r\n        decimals: 6,\r\n        divisor: 400000\r\n    }];\r\n\r\nconst defaultAppState = {\r\n    title: \"Debug Viewer\",\r\n    version: process.env.REACT_APP_VERSION,\r\n    build: \"\",\r\n    units: \"pixels\",\r\n    decimals: 0,\r\n    divisor: 1,\r\n    // bg: \"#F1F1F1\",\r\n    parser: new Parser(),\r\n    widthOn: true,\r\n    displayVertices: false,\r\n    displayLabels: true,\r\n    measurePointsActive: false,\r\n    zoomFactor: undefined,\r\n    originX: undefined,\r\n    originY: undefined,\r\n    showAboutPopup: false,\r\n    importDataToNewLayer: true,       // if false, import data to affected layer\r\n    showSkeletonRecognitionButton: false,\r\n    applySkeletonRecognition: false,\r\n    stage: null,\r\n    showSpinner: false,\r\n    showLayerList: false,\r\n    showDownloadPopup: false,\r\n    showUploadPopup: false,\r\n};\r\n\r\nconst app = (state = defaultAppState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.NEW_STAGE_CREATED:\r\n            return Object.assign({}, state, {\r\n                stage: action.stage,\r\n                zoomFactor: action.stage.zoomFactor * action.stage.resolution,\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y,\r\n            });\r\n\r\n        case ActionTypes.STAGE_UNMOUNTED:\r\n            return Object.assign({}, state, {\r\n                stage: null,\r\n                zoomFactor: undefined,\r\n                originX: undefined,\r\n                originY: undefined\r\n            });\r\n\r\n        case ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE:\r\n        case ActionTypes.PAN_AND_ZOOM_TO_SHAPE:\r\n        case ActionTypes.PINCH_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                zoomFactor: action.stage.zoomFactor * action.stage.resolution,\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y,\r\n            });\r\n        case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y\r\n            });\r\n        case ActionTypes.TOGGLE_UNITS_CLICKED:\r\n            let curUnitsId = unitsList.findIndex(units => state.units === units.name);\r\n            let newUnits = unitsList[(curUnitsId + 1) % 3];\r\n            return Object.assign({}, state, {\r\n                units: newUnits.name,\r\n                decimals: newUnits.decimals,\r\n                divisor: newUnits.divisor\r\n            });\r\n        case ActionTypes.TOGGLE_WIDTH_MODE_CLICKED:\r\n            return Object.assign({}, state, {\r\n                widthOn: !state.widthOn,\r\n                displayVertices: state.widthOn ? state.displayVertices : false\r\n            });\r\n        case ActionTypes.TOGGLE_DISPLAY_VERTICES_CLICKED:\r\n            if (state.displayVertices) {\r\n                return Object.assign({}, state, {\r\n                    displayVertices: false\r\n                });\r\n            }\r\n            else {\r\n                return Object.assign({}, state, {\r\n                    widthOn: false,\r\n                    displayVertices: true\r\n                });\r\n            }\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LABELS_CLICKED:\r\n            return Object.assign({}, state, {\r\n                displayLabels: !state.displayLabels\r\n            });\r\n\r\n        case ActionTypes.TOGGLE_ABOUT_POPUP_CLICKED:\r\n            return Object.assign({}, state, {\r\n                showAboutPopup: !state.showAboutPopup\r\n            });\r\n\r\n        // case ActionTypes.CLOSE_ABOUT_POPUP_BUTTON_PRESSED:\r\n        //     return Object.assign({}, state, {\r\n        //         showAboutPopup: false\r\n        //     });\r\n\r\n        case ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: false\r\n            });\r\n\r\n        case ActionTypes.MEASURE_POINTS_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: true\r\n            });\r\n        case ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: false\r\n            });\r\n        case ActionTypes.SKELETON_RECOGNITION_URI:\r\n            return Object.assign({}, state, {\r\n                showSkeletonRecognitionButton: true\r\n            });\r\n        case ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                applySkeletonRecognition: true\r\n            });\r\n        case ActionTypes.ASYNC_OPERATION_STARTED:\r\n            return Object.assign({}, state, {\r\n                showSpinner: true\r\n            });\r\n        case ActionTypes.ASYNC_OPERATION_ENDED:\r\n            return Object.assign({}, state, {\r\n                showSpinner: false\r\n            });\r\n        case ActionTypes.AABB_TREE_NEXT_LEVEL:\r\n            return state;\r\n        case ActionTypes.TOGGLE_SHOW_LAYER_LIST_CLICKED:\r\n            return {\r\n                ...state,\r\n                showLayerList: !state.showLayerList\r\n            };\r\n        case ActionTypes.TOGGLE_DOWNLOAD_POPUP_CLICKED:\r\n            return {\r\n                ...state,\r\n                showDownloadPopup: !state.showDownloadPopup\r\n            };\r\n        case ActionTypes.TOGGLE_UPLOAD_POPUP_CLICKED:\r\n            return {\r\n                ...state,\r\n                showUploadPopup: !state.showUploadPopup\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default app;\r\n","\r\nlet defaultStyle = {\r\n    strokeStyle: 1,\r\n    stroke: \"#FF0303\",\r\n    fill: \"#FF0303\",\r\n    alpha: 1.0\r\n};\r\n\r\n/* Class Model represents data model that will be added to layer */\r\nclass Model {\r\n    constructor(geom = undefined, style = undefined, label = \"\") {\r\n        this.geom = geom;\r\n        this.style = style || defaultStyle;\r\n        this.label = label;\r\n    }\r\n\r\n    clone() {\r\n        let model = new Model(this.geom, this.style, this.label);\r\n        return Object.assign(model, this);\r\n    }\r\n\r\n    get box() {\r\n        return this.geom.box;\r\n    }\r\n/*\r\n    static transformPoint(pt, stage) {\r\n        return new Flatten.Point(stage.W2C_X(pt.x), stage.W2C_Y(pt.y));\r\n    }\r\n\r\n    static transformSegment(segment, stage) {\r\n        return new Flatten.Segment(\r\n            Model.transformPoint(segment.ps, stage),\r\n            Model.transformPoint(segment.pe, stage)\r\n        )\r\n    }\r\n\r\n    static transformArc(arc, stage) {\r\n        return new Flatten.Arc(\r\n            Model.transformPoint(arc.pc, stage),\r\n            stage.W2C_Scalar(arc.r),\r\n            arc.startAngle,\r\n            arc.endAngle,\r\n            arc.counterClockwise\r\n        )\r\n    }\r\n\r\n    static transformEdge(shape, stage) {\r\n        if (shape instanceof Flatten.Segment) {\r\n            return Model.transformSegment(shape, stage);\r\n        }\r\n        else if (shape instanceof Flatten.Arc) {\r\n            return Model.transformArc(shape, stage);\r\n        }\r\n    }\r\n\r\n    static transformFace(face, stage) {\r\n        // Get shapes of face as array\r\n        let shapes = [];\r\n        for (let edge of face) {\r\n            shapes.push(edge.shape);\r\n        }\r\n\r\n        // Transform array of edges\r\n        return shapes.map(shape => Model.transformEdge(shape, stage));\r\n    }\r\n\r\n    static transformPolygon(polygon, stage) {\r\n        let newPolygon = new Flatten.Polygon();\r\n        let shapes = [];\r\n        for (let face of polygon.faces) {\r\n            shapes = Model.transformFace(face, stage);\r\n            newPolygon.addFace(shapes);\r\n        }\r\n        return newPolygon;\r\n    }\r\n*/\r\n}\r\n\r\nexport default Model;","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Point, Box} from '@flatten-js/core';\r\n// import { Shape } from '../models/shape';\r\nimport Model from './model';\r\n\r\nclass Layer {\r\n    constructor(stage) {\r\n        // super();\r\n        // cannot define Layer as extension of PlanarSet due to bug in compiler ?\r\n        this.stage = stage;\r\n        this.shapes = [];         // new Flatten.PlanarSet();\r\n        this.name = \"\";\r\n        this.color = \"\";\r\n        this.title = \"\";\r\n        this.displayed = false;\r\n        this.edited = false;\r\n        this.affected = false;\r\n    }\r\n\r\n    clone() {\r\n        let layer = new Layer(this.stage);\r\n        return Object.assign(layer, this);\r\n    }\r\n\r\n    add(shape) {\r\n        if (shape instanceof Model) {\r\n            this.shapes.push(shape);       // add(shape)\r\n        }\r\n        else {\r\n            let geom = shape;\r\n            let newShape = new Model(geom, {}, shape.label) // , this.stage);\r\n            this.shapes.push(newShape);     // add(newShape);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    addShapesArray(shapes) {\r\n        for (let shape of shapes) {\r\n            this.add(shape);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    get box() {\r\n        let box = new Box();\r\n        for (let shape of this.shapes) {\r\n            box = box.merge(shape.geom instanceof Box ? shape.clone() : shape.box);\r\n        }\r\n        return box;\r\n    }\r\n\r\n    get center() {\r\n        let box = this.box;\r\n        return new Point((box.xmin + box.xmax)/2, (box.ymin + box.ymax)/2);\r\n    }\r\n\r\n    toggleDisplayed(color) {\r\n        let displayed = !this.displayed;\r\n        return Object.assign(this.clone(),\r\n            {\r\n                displayed : displayed,\r\n                color: color\r\n            });\r\n    }\r\n\r\n    setAffected(affected) {\r\n        this.affected = affected;\r\n        return this;\r\n        // return Object.assign(this.clone(),\r\n        //     {\r\n        //         affected : affected\r\n        //     });\r\n    }\r\n\r\n    setEdited(edited) {\r\n        return Object.assign(this.clone(),\r\n            {\r\n                edited : edited\r\n            });\r\n    }\r\n\r\n    setNameAndTitle(name,title) {\r\n        return Object.assign(this.clone(),\r\n            {\r\n                name : name,\r\n                title: title,\r\n                edited: false\r\n            });\r\n    }\r\n\r\n    setAlpha() {\r\n        for(let shape of this.shapes) {\r\n            shape.alpha = this.displayed ? 1 : 0;\r\n        }\r\n        return this.shapes;\r\n    }\r\n\r\n    // toggleExpanded(shapeToggle) {\r\n    //     for(let shape of this.shapes) {\r\n    //         if (shape === shapeToggle) {\r\n    //             shape.expanded = !shape.expanded;\r\n    //         }\r\n    //     }\r\n    //     return this;\r\n    // }\r\n\r\n    toJSON() {\r\n        return {\r\n            name: this.name,\r\n            title: this.title,\r\n            shapes: JSON.stringify(this.shapes, null, ' ')\r\n        };\r\n    }\r\n}\r\n\r\nexport default Layer;\r\n","/**\r\n * Created by alexanderbol on 20/04/2017.\r\n */\r\n\r\nimport Layer from '../models/layer';\r\n\r\nconst colors = [\r\n    \"#FF0303\",\r\n    \"#4AA403\",\r\n    \"#540080\",\r\n    \"#FFFF40\",\r\n    \"#FF0080\",\r\n    \"#AED424\",\r\n    \"#545400\",\r\n    \"#FFA980\",\r\n    \"#A95480\",\r\n    \"#A9A9FF\",\r\n    \"#00FF00\",\r\n    \"#FFEE76\",\r\n    \"#A40576\",\r\n    \"#4385C8\",\r\n    \"#1CC826\",\r\n    \"#BDBD00\",\r\n    \"#48316E\",\r\n    \"#14616E\",\r\n    \"#8040BD\",\r\n    \"#DC7676\",\r\n    \"#924845\",\r\n    \"#A90000\",\r\n    \"#FFA900\"\r\n];\r\n\r\nclass Layers {\r\n\r\n    static newLayer(stage, layers) {\r\n        let layer = new Layer(stage);\r\n        layer.name = Layers.getNewName(layers);\r\n        if (layers.length === 0) { // first layer\r\n            // layer.color = Layers.getNextColor(layers);\r\n            layer.displayed = false;\r\n            layer.affected = false;\r\n        }\r\n        return layer;\r\n    }\r\n\r\n    static get defaultName() {\r\n        return \"layer\";\r\n    }\r\n\r\n    static getNewName(layers) {\r\n        let name = Layers.defaultName;\r\n        let inc = 1;\r\n        let comparator = (layer) => layer.name === name;\r\n        while (layers.find(comparator) ) {\r\n            name = Layers.defaultName + inc;\r\n            inc++;\r\n        }\r\n        return name;\r\n    }\r\n\r\n    static getAffected(layers) {\r\n        return layers.find((lay) => lay.affected);\r\n    }\r\n\r\n    static setAffected(layers, layer) {\r\n        let currentAffectedLayer = Layers.getAffected(layers);\r\n        if (currentAffectedLayer) {\r\n            currentAffectedLayer.affected = false;\r\n        }\r\n        layer.affected = true;\r\n    }\r\n\r\n    static getNextColor(layers) {\r\n        let color = \"\";\r\n        for (let col of colors) {\r\n            if (!layers.find((layer) =>\r\n                layer.displayed && layer.color === col)) {\r\n                color = col;\r\n                break;\r\n            }\r\n        }\r\n        return color;\r\n    }\r\n\r\n    static delete(layers, layer) {\r\n        let index = layers.findIndex((l) => l === layer);\r\n        let newLayers = layers.filter(l => l !== layer);\r\n        if (index > 0) {\r\n            newLayers[index-1].affected = true;\r\n            if (newLayers[index-1].color === \"\") {\r\n                newLayers[index - 1].color = Layers.getNextColor(newLayers);\r\n            }\r\n            newLayers[index-1].displayed = true;\r\n        }\r\n        return newLayers;\r\n        // another option to delete from array:\r\n        // const newLayers = [...layers]\r\n        // return newLayers.splice( index, 1);\r\n    }\r\n\r\n    static sort(layers) {\r\n        let newLayers = layers.slice();\r\n        newLayers.sort( function(l1, l2) {\r\n            let name1 = l1.name.toUpperCase();\r\n            let name2 = l2.name.toUpperCase();\r\n            if (name1 < name2) {\r\n                return -1;\r\n            }\r\n            if (name1 > name2) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return newLayers;\r\n    }\r\n\r\n    static toJSON(layers) {\r\n        return layers.map( layer => layer.toJSON() );\r\n    }\r\n}\r\n\r\nexport default Layers;","import * as ActionTypes from \"../actionTypes\";\r\nimport Layers from \"../../models/layers\";\r\n\r\nconst layers = (state = [], action) => {\r\n    let affectedLayer = state.find(layer => layer.affected);\r\n    let affectedLayerId = state.findIndex(layer => layer.affected);\r\n    let newLayer;\r\n\r\n    switch (action.type) {\r\n        case ActionTypes.ADD_LAYER_BUTTON_PRESSED:\r\n            newLayer = Layers.newLayer(action.stage, state);\r\n            return [...state, newLayer];\r\n\r\n        case ActionTypes.ADD_NEW_LAYER:\r\n            return [...state, action.layer];\r\n\r\n        case ActionTypes.DELETE_LAYER_BUTTON_PRESSED:\r\n            if (affectedLayer) {\r\n                return Layers.delete(state, affectedLayer);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        case ActionTypes.CLEAR_ALL_BUTTON_CLICKED:\r\n            return [];\r\n\r\n        case ActionTypes.SORT_LAYERS_BUTTON_PRESSED:\r\n            return Layers.sort(state);\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED:\r\n            let color = \"\";\r\n            if (!action.layer.displayed) {\r\n                color = Layers.getNextColor(state);\r\n                if (color === \"\") return;  // no free colors\r\n            }\r\n            return state.map((layer) => {\r\n                if (layer !== action.layer) {\r\n                    // if action.layer will be undisplayed,\r\n                    // it cannot become affected, then\r\n                    // keep affected on this layer\r\n                    if (action.layer.displayed) {\r\n                        return layer;\r\n                    }\r\n                    else {\r\n                        return layer.setAffected(false);\r\n                    }\r\n                }\r\n                else {\r\n                    let newLayer = layer.toggleDisplayed(color);\r\n                    newLayer.affected = newLayer.displayed;\r\n                    return newLayer;\r\n                }\r\n                // return layer.toggleDisplayed(color);\r\n            });\r\n\r\n        case ActionTypes.TOGGLE_AFFECTED_LAYER_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer !== action.layer) {\r\n                    return layer.setAffected(false);\r\n                }\r\n                else {\r\n                    return layer.setAffected(!layer.affected);\r\n                }\r\n            });\r\n\r\n        // case ActionTypes.NEW_SHAPE_PASTED:\r\n        //     return state.map((layer) => {\r\n        //         if (layer.affected) {\r\n        //             return layer.addShapesArray(action.shapesArray);\r\n        //         }\r\n        //         else {\r\n        //             return layer;\r\n        //         }\r\n        //     });\r\n\r\n        case ActionTypes.OPEN_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer !== affectedLayer) {\r\n                    return layer;\r\n                }\r\n                else {\r\n                    return layer.setEdited(true);\r\n                }\r\n            });\r\n\r\n        case ActionTypes.SUBMIT_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer.edited) {\r\n                    return layer.setNameAndTitle(action.newLayer.name, action.newLayer.title);\r\n                }\r\n                else {\r\n                    return layer;\r\n                }\r\n            });\r\n\r\n        case ActionTypes.ESCAPE_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer.edited) {             // !== action.layer) {\r\n                    return layer.setEdited(false);\r\n                }\r\n                else {\r\n                    return layer;\r\n                }\r\n            });\r\n\r\n        case ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED:\r\n            if (affectedLayerId === state.length - 1) {\r\n                return state;\r\n            }\r\n            else {\r\n\r\n                let nextLayer = state[affectedLayerId + 1];\r\n\r\n                return state.map(layer => {\r\n                    if (layer === affectedLayer) {\r\n                        let newCurLayer = layer.toggleDisplayed(\"\");\r\n                        newCurLayer.affected = false;\r\n                        return newCurLayer;\r\n                    }\r\n                    else if (layer === nextLayer) {\r\n                        let color = affectedLayer.color;\r\n                        let newNextLayer = layer.toggleDisplayed(color);\r\n                        newNextLayer.affected = true;\r\n                        return newNextLayer;\r\n                    }\r\n                    else {\r\n                        return layer;\r\n                    }\r\n                });\r\n            }\r\n\r\n        case ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED:\r\n            if (affectedLayerId === 0) {\r\n                return state;\r\n            }\r\n            else {\r\n                let nextLayer = state[affectedLayerId - 1];\r\n\r\n                return state.map(layer => {\r\n                    if (layer === affectedLayer) {\r\n                        let newCurLayer = layer.toggleDisplayed(\"\");\r\n                        newCurLayer.affected = false;\r\n                        return newCurLayer;\r\n                    }\r\n                    else if (layer === nextLayer) {\r\n                        let newNextLayer = layer.toggleDisplayed(affectedLayer.color);\r\n                        newNextLayer.displayed = true;\r\n                        newNextLayer.affected = true;\r\n                        return newNextLayer;\r\n                    }\r\n                    else {\r\n                        return layer;\r\n                    }\r\n                });\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default layers;","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst defaultMouseState = {\r\n    x: 0,\r\n    y: 0,\r\n    startX: undefined,\r\n    startY: undefined,\r\n    touchPoints: undefined\r\n};\r\n\r\nconst mouse = (state = defaultMouseState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                x: action.x,\r\n                y: action.y\r\n            });\r\n        case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                startX: action.x,\r\n                startY: action.y\r\n            });\r\n        case ActionTypes.MOUSE_UP_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                startX: undefined,\r\n                startY: undefined\r\n            });\r\n\r\n        case ActionTypes.PINCH_DOWN_ON_STAGE: {\r\n            return {\r\n                ...state,\r\n                touchPoints: [\r\n                    {x: action.x1, y: action.y1},\r\n                    {x: action.x2, y: action.y2}\r\n                ]\r\n            }\r\n        }\r\n        // case ActionTypes.PINCH_MOVED_ON_STAGE: {\r\n        //     return {\r\n        //         ...state,\r\n        //         touchPoints: [\r\n        //             {x: action.x1, y: action.y1},\r\n        //             {x: action.x2, y: action.y2}\r\n        //         ]\r\n        //     }\r\n        // }\r\n        case ActionTypes.PINCH_UP_ON_STAGE: {\r\n            return {\r\n                ...state,\r\n                touchPoints: undefined\r\n            }\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default mouse;","import * as ActionTypes from \"../actionTypes\";\r\nimport Flatten from \"@flatten-js/core\";\r\n\r\nconst defaultMeasureShapesTool = {\r\n    measureShapesActive: false,\r\n    measureShapesFirstClick: true,\r\n    hoveredShape: null,\r\n    firstMeasuredShape: null,\r\n    secondMeasuredShape: null,\r\n    firstMeasuredLayer: null,\r\n    secondMeasuredLayer: null,\r\n    distance: undefined,\r\n    shortestSegment: null\r\n};\r\n\r\nconst is_mobile = window.mobilecheck();\r\n\r\nconst measureShapesTool = (state = defaultMeasureShapesTool, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED:\r\n            return Object.assign({}, defaultMeasureShapesTool, {\r\n                measureShapesActive: true\r\n            });\r\n        case ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED:\r\n            return Object.assign({}, defaultMeasureShapesTool);\r\n\r\n        case ActionTypes.MEASURE_POINTS_BUTTON_PRESSED:\r\n            return Object.assign({}, defaultMeasureShapesTool);\r\n\r\n        case ActionTypes.MOUSE_ROLL_OVER_SHAPE:\r\n            return Object.assign({}, state, {\r\n                hoveredShape: state.measureShapesActive ? action.shape : null\r\n            });\r\n        case ActionTypes.MOUSE_ROLL_OUT_SHAPE:\r\n            return Object.assign({}, state, {\r\n                hoveredShape: null\r\n            });\r\n        case ActionTypes.MOUSE_CLICKED_ON_SHAPE:\r\n            if (!state.measureShapesActive) {\r\n                return state;\r\n            }\r\n            // measureShapesActive\r\n\r\n            if (state.measureShapesFirstClick) {\r\n                return Object.assign({}, state, {\r\n                    firstMeasuredShape: action.shape,\r\n                    firstMeasuredLayer: action.layer,\r\n                    secondMeasuredShape: null,\r\n                    secondMeasuredLayer: null,\r\n                    measureShapesFirstClick: false,\r\n                    distance: undefined,\r\n                    shortestSegment: null\r\n                })\r\n            }\r\n            else {    // second click\r\n                if (action.shape === state.firstMeasuredShape) {\r\n                    return state;  // second click on the same shape\r\n                }\r\n\r\n                let shape1 = state.firstMeasuredShape.geom;\r\n                let shape2 = action.shape.geom;\r\n                let distance, shortestSegment;\r\n                // if (shape1 instanceof Flatten.Polygon && shape2 instanceof Flatten.Polygon) {\r\n                //     [distance, shortestSegment] = Flatten.Distance.polygon2polygon(shape1, shape2);\r\n                // }\r\n                // else {\r\n                [distance, shortestSegment] = Flatten.Distance.distance(shape1, shape2);\r\n                // }\r\n\r\n\r\n                return Object.assign({}, state, {\r\n                    secondMeasuredShape: action.shape,\r\n                    secondMeasuredLayer: action.layer,\r\n                    measureShapesFirstClick: true,\r\n                    distance: distance,\r\n                    shortestSegment: shortestSegment\r\n                });\r\n            }\r\n        case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n            if (state.hoveredShape || is_mobile) {\r\n                return state\r\n            }\r\n            else {\r\n                return Object.assign({}, state, {\r\n                    measureShapesFirstClick: true,\r\n                    firstMeasuredShape: null,\r\n                    firstMeasuredLayer: null,\r\n                    secondMeasuredShape: null,\r\n                    secondMeasuredLayer: null,\r\n                    distance: undefined,\r\n                    shortestSegment: null\r\n                });\r\n            }\r\n\r\n        case ActionTypes.DELETE_LAYER_BUTTON_PRESSED:\r\n            if (action.layer === state.firstMeasuredLayer ||\r\n                action.layer === state.secondMeasuredLayer) {\r\n                return Object.assign({}, defaultMeasureShapesTool);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED:\r\n            if (action.layer.displayed &&\r\n                (action.layer === state.firstMeasuredLayer ||\r\n                    action.layer === state.secondMeasuredLayer)) {\r\n                return Object.assign({}, defaultMeasureShapesTool);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default measureShapesTool;","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst documentDefaultState = {\r\n    id: undefined,\r\n    name: \"\",\r\n    owner: \"Alex Bol\",\r\n    lastUpdated: undefined\r\n};\r\n\r\nconst cloudStorageDefaultState = {\r\n    document: documentDefaultState,\r\n    documentsList: {}\r\n};\r\n\r\nfunction isUpToDate(stateDocumentsList, actionDocumentsList) {\r\n    if (actionDocumentsList === null || actionDocumentsList === undefined)\r\n        return true;\r\n\r\n    if (Object.keys(stateDocumentsList).length !== Object.keys(actionDocumentsList).length)\r\n        return false;\r\n    for (let key in stateDocumentsList) {\r\n        if (!(actionDocumentsList.hasOwnProperty(key) && (stateDocumentsList[key].lastUpdated !== actionDocumentsList[key].lastUpdated))) {\r\n            return false\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nconst cloudStorage = (state = cloudStorageDefaultState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    id: action.id,\r\n                    name: action.name,\r\n                    owner: action.owner,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    id: action.id,\r\n                    name: action.name,\r\n                    owner: action.owner,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    ...state.document,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.DOCUMENT_NAME_UPDATED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    ...state.document,\r\n                    name: action.name\r\n                }\r\n            };\r\n\r\n        case ActionTypes.DELETE_DOCUMENT_FROM_DATABASE_SUCCEED:\r\n            let { [action.id]: document, ...newList } = state.documentsList;\r\n            return {\r\n                ...state,\r\n                document: state.document.id === action.id ? documentDefaultState : state.document,\r\n                documentsList: newList\r\n            };\r\n\r\n        case ActionTypes.DOCUMENT_SELECTED_FROM_LIST:\r\n            return {\r\n                ...state,\r\n                document: action.document\r\n            };\r\n\r\n        case ActionTypes.CLEAR_ALL_BUTTON_CLICKED:\r\n            return {\r\n                ...state,\r\n                document: documentDefaultState\r\n            };\r\n\r\n        case ActionTypes.REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED:\r\n            return isUpToDate(state.documentsList, action.documentsList) ?\r\n                state :\r\n            {\r\n                ...state,\r\n                documentsList: action.documentsList\r\n            };\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default cloudStorage","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst defaultState = {\r\n    uploadStarted:  false,\r\n    uploadCompleted: false,\r\n    uploadedFiles: []\r\n};\r\n\r\nconst upload = (state=defaultState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.INITIALIZE_UPLOAD_STATE:\r\n            return defaultState;\r\n\r\n        case ActionTypes.FILES_UPLOAD_COMPLETED:\r\n            return {\r\n                ...state,\r\n                uploadCompleted: true,\r\n                uploadedFiles: action.uploadedFiles\r\n            };\r\n        default:\r\n            return state\r\n    }\r\n};\r\n\r\nexport default upload","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\n\r\nimport {combineReducers} from 'redux';\r\n\r\nimport auth from \"./reducers/auth\";\r\nimport app from \"./reducers/app\";\r\nimport layers from \"./reducers/layers\";\r\nimport mouse from \"./reducers/mouse\";\r\nimport measureShapesTool from \"./reducers/measureShapesTool\";\r\nimport cloudStorage from \"./reducers/cloudStorage\";\r\nimport upload from \"./reducers/upload\";\r\n\r\nconst reducer = combineReducers({\r\n    auth,\r\n    app,\r\n    layers,\r\n    upload,\r\n    cloudStorage,\r\n    measureShapesTool,\r\n    mouse\r\n});\r\n\r\nexport default reducer;\r\n","import * as ActionTypes from '../store/actionTypes';\r\n\r\nconst log = ({ getState, dispatch }) => next => action => {\r\n\r\n    if(action.type !== ActionTypes.MOUSE_MOVED_ON_STAGE) {\r\n        console.log('ACTION: ' + action.type, action);\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nexport default log;","import {Box} from '@flatten-js/core';\r\n\r\nexport class Job {\r\n    constructor() {\r\n        this.filename = \"\";\r\n        this.title = \"\";\r\n        this.profiles = [];   // array of FlattenJS Polygons\r\n        this.materials = [];  // array of FlattenJS Polygons\r\n        this.shapes = [];     // array of other FlattenJS shapes\r\n    }\r\n\r\n    get box() {\r\n        let b = new Box();\r\n        for (let shape of this.profiles) {\r\n            b.merge(shape.box);\r\n        }\r\n        for (let shape of this.materials) {\r\n            b.merge(shape.box);\r\n        }\r\n        for (let shape of this.shapes) {\r\n            b.merge(shape.box);\r\n        }\r\n        return b;\r\n    }\r\n}","// import { Job } from '../models/job';\r\nimport Flatten from '@flatten-js/core';\r\n\r\n// import Model from '../models/model';\r\nimport {Job} from \"../models/job\";\r\n\r\nFlatten.Image = class Image {\r\n    constructor() {\r\n        this.uri = \"\";\r\n        /**\r\n         * Center in world coordinates\r\n         * @type {Flatten.Point}\r\n         */\r\n        this.center = new Flatten.Point();\r\n        /**\r\n         * Width in world units (inch/mm)\r\n         */\r\n        this.width = 0;\r\n        /**\r\n         * Height in world units (inch/mm)\r\n         */\r\n        this.height = 0;\r\n    }\r\n    get box() {\r\n        return new Flatten.Box(\r\n            this.center.x - this.width/2,\r\n            this.center.y - this.height/2,\r\n            this.center.x + this.height/2,\r\n            this.center.y + this.height/2\r\n        );\r\n\r\n    }\r\n};\r\n\r\n// export function parseJSON(shapes) {\r\n//     let models = [];\r\n//     let geom;\r\n//     let model;\r\n//     for (let shape of JSON.parse(shapes)) {\r\n//         if (shape.geom instanceof Array) {      // TODO: add \"name\" to polygon stringified\r\n//             geom = new Flatten.Polygon();\r\n//             for (let faceArray of shape.geom) {\r\n//                 geom.addFace(faceArray);\r\n//             }\r\n//         }\r\n//         else if (shape.geom.uri) {\r\n//             geom = new Flatten.Image();\r\n//             geom.uri = shape.geom.uri;\r\n//             geom.center = shape.geom.center;\r\n//             geom.width = shape.geom.width;\r\n//             geom.height = shape.geom.height;\r\n//         }\r\n//         else {\r\n//             geom = Flatten[shape.geom.name](shape.geom);\r\n//         }\r\n//         model = new Model(geom, shape.style, shape.label);\r\n//         models.push(model);\r\n//     }\r\n//\r\n//     return models;\r\n// }\r\n\r\nfunction parseJSONShape(jsonShape) {\r\n    if (jsonShape.name === \"segment\") {\r\n        return new Flatten.Segment(jsonShape);\r\n    }\r\n\r\n    if (jsonShape.name === \"arc\") {\r\n        return new Flatten.Arc(jsonShape);\r\n    }\r\n\r\n    if (jsonShape.name === \"point\") {\r\n        return new Flatten.Point(jsonShape);\r\n    }\r\n}\r\n\r\nexport function parseJSON(filename=\"\", str) {\r\n    let job = new Job();\r\n\r\n    job.filename = filename;\r\n\r\n    let jsonArray;\r\n\r\n    try {\r\n        jsonArray = JSON.parse(str);\r\n    } catch (e) {\r\n        throw new Error(\"Illegal JSON string\")\r\n    }\r\n\r\n    if (jsonArray instanceof Array) {\r\n        try {\r\n            let polygon = new Flatten.Polygon();\r\n            for (let faceArray of jsonArray) {\r\n                polygon.addFace(faceArray);\r\n            }\r\n            job.shapes.push(polygon);\r\n        }\r\n        catch (e) {\r\n            for (let jsonShape of jsonArray) {\r\n                job.shapes.push( parseJSONShape(jsonShape) );\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        job.shapes.push( parseJSONShape(jsonArray) );\r\n    }\r\n\r\n    return job;\r\n}\r\n","import * as ActionTypes from \"../store/actionTypes\";\r\nimport Layers from \"../models/layers\";\r\nimport {parseJSON} from \"../dataParsers/parseJSON\";\r\n\r\nconst pasteData = ({ dispatch, getState }) => next => action => {\r\n\r\n    if (action.type !== ActionTypes.DATA_FROM_BUFFER_PASTED) {\r\n        return next(action);\r\n    }\r\n\r\n    let state = getState();\r\n    let stage = state.app.stage;\r\n    let layers = state.layers;\r\n    let parser = state.app.parser;\r\n\r\n    let layer = undefined;\r\n    if (state.app.importDataToNewLayer) {   // import data to new layer\r\n        layer = Layers.newLayer(stage, layers);\r\n        layers.push(layer);\r\n    }\r\n    else {                                  // import data to affected layer\r\n        layer = layers.find((lay) => lay.affected);\r\n        if (!layer) {                       // if no layer affected, add new\r\n            layer = Layers.newLayer(stage, layers);\r\n            layers.push(layer);\r\n        }\r\n    }\r\n\r\n    // Paste data from ClipBoard\r\n    for (let item of action.data.items) {\r\n        item.getAsString((string) => {\r\n            let shapesArray;\r\n\r\n            try {\r\n                let job = parseJSON(\"\",string);\r\n                shapesArray = job.shapes\r\n            } catch (e) {\r\n                console.log(e.message)\r\n                shapesArray = parser.parse(string);\r\n            }\r\n\r\n            // TODO: add something like poly.valid()\r\n\r\n            if (shapesArray.length > 0) {\r\n                for (let shape of shapesArray) {\r\n                    layer.add(shape);\r\n                }\r\n            }\r\n\r\n            if (layer.shapes.length > 0) {\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    shape: layer,\r\n                    stage: stage\r\n                });\r\n                dispatch({\r\n                    type: ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED,\r\n                    layer: layer\r\n                })\r\n            }\r\n\r\n        });\r\n\r\n        break;\r\n    }\r\n\r\n};\r\n\r\nexport default pasteData;\r\n","import * as ActionTypes from '../store/actionTypes';\r\n\r\nconst stageController = ({getState, dispatch}) => next => action => {\r\n\r\n    const mouse = getState().mouse;\r\n    let stage = action.stage;\r\n\r\n\r\n    if (stage) {\r\n        switch (action.type) {\r\n            case ActionTypes.STAGE_RESIZED:\r\n                stage.resize();\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n                stage.panByMouseStart();\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n                if (action.dx !== undefined && action.dy !== undefined) {\r\n                    stage.panByMouseMove(action.dx, action.dy);\r\n                }\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_UP_ON_STAGE:\r\n                stage.panByMouseStop();\r\n                break;\r\n\r\n            case ActionTypes.PAN_AND_ZOOM_TO_SHAPE:\r\n                let center = action.shape.center;\r\n                let box = action.shape.box;\r\n                if (isNaN(center.x) || isNaN(center.y)) return;\r\n                stage.panToCoordinate(center.x, center.y);\r\n                stage.zoomToLimits(box.xmax - box.xmin, box.ymax - box.ymin);\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE:\r\n                let bIn = action.delta > 0;\r\n                // stage.zoomByMouse(action.x, action.y, bIn, 1 + Math.abs(action.delta)/100.);\r\n                stage.zoomByMouse(action.x, action.y, bIn, 1.2);\r\n                break;\r\n\r\n            case ActionTypes.CLEAR_ALL:\r\n                stage.removeAllChildren();\r\n                stage.removeAllListeners();\r\n                break;\r\n\r\n            case ActionTypes.PINCH_DOWN_ON_STAGE:\r\n                stage.zoomByPinchStart(action.x1, action.y1);\r\n                break;\r\n\r\n            case ActionTypes.PINCH_MOVED_ON_STAGE:\r\n                if (mouse.touchPoints) {\r\n                    let dx = mouse.touchPoints[0].x - mouse.touchPoints[1].x;\r\n                    let dy = mouse.touchPoints[0].y - mouse.touchPoints[1].y;\r\n                    let distStart = Math.sqrt(dx*dx + dy*dy);\r\n\r\n                    dx = action.x2 - action.x1;\r\n                    dy = action.y2 - action.y1;\r\n                    let distCurrent = Math.sqrt(dx*dx + dy*dy);\r\n                    let ratio = distCurrent / distStart;\r\n                    stage.zoomByPinchMove(action.x1, action.y1, ratio);\r\n                }\r\n                break;\r\n\r\n            case ActionTypes.PINCH_UP_ON_STAGE:\r\n                stage.zoomByPinchStop();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nexport default stageController;","import * as ActionTypes from '../store/actionTypes';\r\nimport Layers from \"../models/layers\";\r\nimport {point, arc, segment} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\nlet Algorithmia = window.Algorithmia;\r\n\r\n// function zoomHome(shape, stage) {\r\n//     let box = shape.box;\r\n//     let x = (box.xmin + box.xmax)/2;\r\n//     let y = (box.ymin + box.ymax)/2;\r\n//     stage.panToCoordinate(x, y);\r\n//     stage.zoomToLimits(box.xmax - box.xmin, box.ymax - box.ymin);\r\n// }\r\n\r\nconst skeleton_recognition = ({dispatch, getState}) => next => action => {\r\n\r\n    if (action.type === ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED) {\r\n\r\n        let state = getState();\r\n        let stage = state.app.stage;\r\n\r\n        let layers = state.layers;\r\n        let currentLayer = Layers.getAffected(layers);\r\n        let shapes = currentLayer.shapes;\r\n        let input = shapes.map(shape =>\r\n            [shape.geom.x / 400., shape.geom.y / 400., shape.geom.nx, shape.geom.ny]\r\n        );\r\n\r\n        let client = Algorithmia.client(\"simby4RUwqQmtMDaHAPj5wsQwlD1\");\r\n        let algorithm = \"alexbol99/SeketonRecognition\";\r\n\r\n        client.algo(algorithm)\r\n            .pipe(input)\r\n            .then(function (output) {\r\n                if (output.error) return console.error(\"error: \" + output.error);\r\n\r\n                let newLayer = Layers.newLayer(stage, layers);\r\n                newLayer.name = \"recognized\";\r\n                newLayer.title = \"recognized\";\r\n                // newLayer.displayed = true;\r\n\r\n                for (let row of output.result) {\r\n                    let shape;\r\n                    if (row[0] instanceof Array && row[0].length === 2) {\r\n                        let pc = point(row[0][0] * 400, row[0][1] * 400);\r\n                        let r = row[1] * 400;\r\n                        /********center radius startAng endAng **********/\r\n                        shape = arc(pc, r, row[2], row[3], Flatten.CCW)\r\n                    }\r\n                    else {\r\n                        shape = segment(\r\n                            point(row[0] * 400, row[1] * 400),\r\n                            point(row[2] * 400, row[3] * 400))\r\n                    }\r\n                    if (row[4]) {\r\n                        shape.label = row[4]\r\n                    }\r\n                    newLayer.add(shape)\r\n                }\r\n                layers.push(newLayer);\r\n\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    stage: stage,\r\n                    shape: currentLayer\r\n                })\r\n            });\r\n    }\r\n\r\n    return next(action);\r\n};\r\n\r\n\r\nexport default skeleton_recognition;\r\n","import axios from 'axios';\r\n\r\nconst instance = axios.create({\r\n    baseURL: \"https://debug-viewer.firebaseio.com/\"\r\n});\r\n\r\nexport default instance;\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const resizeStage = () => {\r\n    return {\r\n        type: ActionTypes.STAGE_RESIZED\r\n    }\r\n};\r\n\r\nexport const destroyStage = () => {\r\n    return {\r\n        type: ActionTypes.STAGE_UNMOUNTED\r\n    }\r\n};\r\n\r\nexport const toggleUnits = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_UNITS_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleWidthMode = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_WIDTH_MODE_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDisplayVertices = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_VERTICES_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDisplayLabels = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_LABELS_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleAboutPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_ABOUT_POPUP_CLICKED\r\n    }\r\n};\r\n\r\n// export const closeAboutPopup = () => {\r\n//     return {\r\n//         type: ActionTypes.CLOSE_ABOUT_POPUP_BUTTON_PRESSED\r\n//     }\r\n// };\r\n\r\nexport const toggleMeasureBetweenPoints = () => {\r\n    return {\r\n        type: ActionTypes.MEASURE_POINTS_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\nexport const toggleMeasureBetweenShapes = () => {\r\n    return {\r\n        type: ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\nexport const applySkeletonRecognition = () => {\r\n    return {\r\n        type: ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\n// export const handleFileSelect = (files, stage, layers) => {\r\n//     return {\r\n//         type: ActionTypes.FILENAME_LIST_SELECTED,\r\n//         files,\r\n//         stage,\r\n//         layers\r\n//     }\r\n// };\r\n\r\nexport const setHomeView = (stage, shape) => {\r\n    return {\r\n        type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n        stage,\r\n        shape\r\n    }\r\n};\r\n\r\nexport const togglePanByDrag = () => {\r\n    return {\r\n        type: ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED\r\n    }\r\n};\r\n\r\nexport const handleMouseRollOverShape = (shape) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_ROLL_OVER_SHAPE,\r\n        shape\r\n    }\r\n};\r\n\r\nexport const handleMouseRollOutShape = () => {\r\n    return {\r\n        type: ActionTypes.MOUSE_ROLL_OUT_SHAPE\r\n    }\r\n};\r\n\r\nexport const handleClickOnShape = (shape, layer) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_CLICKED_ON_SHAPE,\r\n        shape,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const asyncOperationStarted = () => {\r\n    return {\r\n        type: ActionTypes.ASYNC_OPERATION_STARTED\r\n    }\r\n};\r\n\r\nexport const asyncOperationEnded = () => {\r\n    return {\r\n        type: ActionTypes.ASYNC_OPERATION_ENDED\r\n    }\r\n};\r\n\r\nexport const openDocumentOnCloud = () => {\r\n    return {\r\n        type: ActionTypes.MANAGE_CLOUD_STORAGE_BUTTON_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleLayerList = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_SHOW_LAYER_LIST_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDownloadPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DOWNLOAD_POPUP_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleUploadPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_UPLOAD_POPUP_CLICKED\r\n    }\r\n};\r\n\r\nexport const pasteDataFromBuffer = (clipboardData) => {\r\n    return {\r\n        type: ActionTypes.DATA_FROM_BUFFER_PASTED,\r\n        data: clipboardData\r\n    }\r\n};\r\n\r\n\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const addEmptyLayer = (stage) => {\r\n    return {\r\n        type: ActionTypes.ADD_LAYER_BUTTON_PRESSED,\r\n        stage: stage\r\n    }\r\n};\r\n\r\nexport const addNewLayer = (layer) => {\r\n    return {\r\n        type: ActionTypes.ADD_NEW_LAYER,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const deleteAffectedLayer = () => {\r\n    return {\r\n        type: ActionTypes.DELETE_LAYER_BUTTON_PRESSED\r\n    };\r\n};\r\n\r\nexport const sortLayers = () => {\r\n    return {\r\n        type: ActionTypes.SORT_LAYERS_BUTTON_PRESSED\r\n    };\r\n};\r\n\r\nexport const toggleDisplayLayer = (layer) => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const toggleAffectedLayer = (event, layer) => {\r\n    event.stopPropagation();\r\n    return {\r\n        type: ActionTypes.TOGGLE_AFFECTED_LAYER_PRESSED,\r\n        layer: layer\r\n    };\r\n};\r\n\r\nexport const updateLayer = (newLayer) => {\r\n    return {\r\n        type: ActionTypes.SUBMIT_LAYER_EDIT_FORM_PRESSED,\r\n        newLayer: newLayer\r\n    };\r\n};\r\n\r\nexport const closeEditLayerForm = () => {\r\n    return {\r\n        type: ActionTypes.ESCAPE_LAYER_EDIT_FORM_PRESSED\r\n    };\r\n};\r\n\r\nexport const openAffectedLayerEditForm = () => {\r\n    return {\r\n        type: ActionTypes.OPEN_LAYER_EDIT_FORM_PRESSED,\r\n    }\r\n};\r\n\r\nexport const setAffectedNextLayer = () => {\r\n    return {\r\n        type: ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED\r\n    }\r\n};\r\n\r\nexport const setAffectedPrevLayer = () => {\r\n    return {\r\n        type: ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED\r\n    }\r\n};\r\n\r\nexport const deleteAllLayers = () => {\r\n    return {\r\n        type: ActionTypes.CLEAR_ALL_BUTTON_CLICKED,\r\n    }\r\n}\r\n\r\n\r\n\r\n","import * as ActionTypes from \"../actionTypes\";\r\nimport axios from \"../../axios-database\";\r\nimport * as appActions from \"../actions/appActions\";\r\nimport * as layerActions from '../../store/actions/layersActions';\r\nimport Layer from \"../../models/layer\";\r\nimport {parseJSON} from \"../../dataParsers/parseJSON\";\r\nimport Layers from \"../../models/layers\";\r\n\r\nconst defaultName = \"document\";\r\n\r\nexport const getNewName = (documents) => {\r\n    let name = defaultName;\r\n    let inc = 1;\r\n    let comparator = (document) => document.name === name;\r\n    while (Object.values(documents).find(comparator)) {\r\n        name = defaultName + inc;\r\n        inc++;\r\n    }\r\n    return name;\r\n};\r\n\r\nexport const registerDocumentAddedToDatabase = (id, lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED,\r\n        id: id,\r\n        lastUpdated: lastUpdated\r\n    }\r\n};\r\n\r\nexport const updateDocumentTimeStamp = (lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED,\r\n        lastUpdated: lastUpdated\r\n    }\r\n};\r\n\r\nexport const updateDocumentName = (name) => {\r\n    return {\r\n        type: ActionTypes.DOCUMENT_NAME_UPDATED,\r\n        name\r\n    }\r\n};\r\n\r\nexport const clearCurrentDocument = () => {\r\n    return {\r\n        type: ActionTypes.CLEAR_ALL_BUTTON_CLICKED,\r\n    }\r\n};\r\n\r\nexport const updateCurrentDocument = (document) => {\r\n    return {\r\n        type: ActionTypes.DOCUMENT_SELECTED_FROM_LIST,\r\n        document\r\n    }\r\n};\r\n\r\nexport const requestFetchDocumentFromDatabaseSucceed = (id, name, owner, lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED,\r\n        id,\r\n        name,\r\n        owner,\r\n        lastUpdated\r\n    }\r\n};\r\n\r\nexport const deleteDocumentFromDatabaseSucceed = (id) => {\r\n    return {\r\n        type: ActionTypes.DELETE_DOCUMENT_FROM_DATABASE_SUCCEED,\r\n        id\r\n    }\r\n};\r\n\r\nexport const requestFetchDocumentsFromDatabaseSucceed = (documentsList) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED,\r\n        documentsList\r\n    }\r\n};\r\n\r\nexport const fetchDocumentsFromDatabase = (token, userId) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        const queryParams = '?auth=' + token + '&orderBy=\"userId\"&equalTo=\"' + userId + '\"';\r\n        const url = '/documents.json' + queryParams;\r\n        axios.get(url)\r\n            .then(response => {\r\n                dispatch(requestFetchDocumentsFromDatabaseSucceed(response.data));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const deleteDocumentFromDatabase = (id) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        const url = '/documents/' + id + '.json';\r\n        axios.delete(url)\r\n            .then (response => {\r\n                // query geom by \"id\"\r\n                const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n                const url = '/geom.json' + queryParams;\r\n                return axios.get(url)\r\n            })\r\n            .then (response => {\r\n                const geomId = Object.keys(response.data)[0];\r\n                return axios.delete(`/geom/${geomId}.json`)\r\n            })\r\n            .then(response => {\r\n                dispatch(deleteDocumentFromDatabaseSucceed(id));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const fetchDocumentFromDatabase = (stage, id) => {\r\n    return dispatch => {\r\n        dispatch(layerActions.deleteAllLayers());\r\n        dispatch(appActions.asyncOperationStarted());\r\n        let name = \"\";\r\n        let lastUpdated = undefined;\r\n        let owner = \"Alex Bol\";\r\n        let firstLayer = undefined;\r\n\r\n        const docUrl = '/documents/' + id + '.json';\r\n        const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n        const geomUrl = '/geom.json' + queryParams;\r\n        Promise.all([axios.get(docUrl),axios.get(geomUrl)])\r\n            .then( responses => {\r\n                name = responses[0].data.name;\r\n                lastUpdated = responses[0].data.lastUpdated;\r\n\r\n                for (let layerData of Object.values(responses[1].data)[0].layers) {\r\n                    let layer = new Layer();\r\n                    layer.shapes = parseJSON(layerData.shapes);\r\n                    layer.name = layerData.name;\r\n\r\n                    if (!firstLayer) firstLayer = layer;\r\n                    dispatch(layerActions.addNewLayer(layer));\r\n                    dispatch(layerActions.toggleDisplayLayer(layer));\r\n                }\r\n                dispatch(requestFetchDocumentFromDatabaseSucceed(id, name, owner, lastUpdated));\r\n                dispatch(appActions.setHomeView(stage, firstLayer));\r\n                // dispatch(layerActions.toggleDisplayLayer(firstLayer));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const addDocumentToDatabase = (payload, layers, history) => {\r\n    return dispatch => {\r\n        let id = undefined;\r\n        dispatch(appActions.asyncOperationStarted());\r\n        axios.post('/documents.json', payload)\r\n            .then(response => {\r\n                id = response.data.name;\r\n                let layersJSON = Layers.toJSON(layers);\r\n                let geomPayload = {\r\n                    id: id,\r\n                    layers: layersJSON\r\n                };\r\n                return axios.post('/geom.json', geomPayload)\r\n            })\r\n            .then(response => {\r\n                dispatch(registerDocumentAddedToDatabase(id, Date.now()));\r\n                dispatch(appActions.asyncOperationEnded());\r\n\r\n                // update url\r\n                history.push('/documents/' + id);\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const updateDocumentInDatabase = (id, payload, layers) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        // update documents header\r\n        axios.put(`/documents/${id}.json`, payload)\r\n            .then(response => {\r\n                dispatch(updateDocumentTimeStamp(Date.now()));\r\n                // dispatch(appActions.asyncOperationEnded());\r\n\r\n                // query geom by \"id\"\r\n                const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n                const url = '/geom.json' + queryParams;\r\n                return axios.get(url)\r\n            })\r\n            .then( response => {\r\n                let layersJSON = Layers.toJSON(layers);\r\n                let geomPayload = {\r\n                    id: id,\r\n                    layers: layersJSON\r\n                };\r\n                let geomId = Object.keys(response.data)[0];  // response.data.name;\r\n                return axios.put(`/geom/${geomId}.json`, geomPayload)\r\n            })\r\n            .then( reponse => {\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\n\r\n\r\n","import React from 'react';\r\nimport FontAwesome from \"react-fontawesome\";\r\nimport classes from \"./Button.module.css\";\r\n\r\nconst button = (props) => {\r\n    let iconStyle;\r\n    switch (props.type) {\r\n        case \"trigger\":\r\n            iconStyle = classes.IconTrigger;\r\n            break;\r\n        case \"mode\":\r\n            iconStyle = props.active ? classes.IconModeActive : classes.IconModeNotActive;\r\n            break;\r\n        default:\r\n            iconStyle = classes.IconTrigger;\r\n            break;\r\n    }\r\n    // eslint-disable-next-line\r\n    let buttonStyle = props.mobileOnly ? classes[\"Button\",\"DrawerButton\"] : classes[\"Button\"];\r\n    return (\r\n        <button title={props.title} onClick={props.onClick} className={buttonStyle}>\r\n            <FontAwesome\r\n                name={props.iconName}\r\n                size='2x'\r\n                className={iconStyle}\r\n            />\r\n        </button>\r\n    );\r\n};\r\n\r\nexport default button;","import React from 'react';\r\nimport FontAwesome from \"react-fontawesome\";\r\nimport classes from \"./ButtonSeparator.module.css\";\r\n\r\nconst buttonSeparator = () => {\r\n    return (\r\n        <div className={classes.ButtonSeparator}>\r\n            <FontAwesome\r\n                name='ellipsis-v'\r\n                size='2x'\r\n                className={classes.IconSeparator}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default buttonSeparator;","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport Button from '../../../components/UI/Button/Button';\r\nimport Separator from '../../../components/UI/ButtonSeparator/ButtonSeparator';\r\n\r\nimport classes from './ToolbarComponent.module.css';\r\nimport '@fortawesome/fontawesome-free/css/all.css';\r\n\r\nclass ToolbarComponent extends Component {\r\n    // openJobButtonClicked = () => this.refs.browseFiles.click();\r\n\r\n    render() {\r\n        return (\r\n            <div className={classes[\"App-toolbar\"]}>\r\n                {/*<h4>Toolbar</h4>*/}\r\n                <Button type=\"trigger\" title=\"Upload files\" iconName='folder-open'\r\n                        onClick={this.props.onShowUploadPopupPressed}\r\n                />\r\n\r\n                {/*<input style={{fontSize: 16, marginTop: 5, marginBottom: 5, display: \"none\"}}*/}\r\n                       {/*type=\"file\" id=\"browseFiles\" ref=\"browseFiles\" name=\"files[]\" multiple*/}\r\n                       {/*onChange={this.props.onFileSelected}*/}\r\n                {/*/>*/}\r\n\r\n                <Button type=\"trigger\" title=\"Show/hide layers\" iconName='layer-group' onClick={this.props.onLayerListButtonClicked} />\r\n\r\n                    {/*<Button type=\"trigger\" title=\"Save document on cloud\" iconName='save'*/}\r\n                        {/*onClick={this.props.onSaveDocumentButtonClicked}*/}\r\n                {/*/>*/}\r\n\r\n                <Button type=\"trigger\" title=\"Delete all layers\" iconName='broom'\r\n                        onClick={this.props.onClearAllButtonClicked}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Download layers\" iconName='file-download'\r\n                        onClick={this.props.onShowDownloadPopupPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"Zoom and pan to home view\" iconName='home'\r\n                        onClick={this.props.onHomeButtonPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"mode\" title=\"Pan by drag\" iconName='arrows-alt'\r\n                        active={!this.props.measurePointsActive}\r\n                        onClick={this.props.onPanByDragPressed}\r\n                />\r\n\r\n                <Button type=\"mode\" title=\"Measure distance between points\" iconName='drafting-compass'\r\n                        active={this.props.measurePointsActive}\r\n                        onClick={this.props.onMeasurePointsButtonPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"Measure distance between selected shapes\" iconName='ruler'\r\n                        onClick={this.props.onMeasureBetweenShapesButtonPressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display solid or wire\" iconName='fill-drip'\r\n                        onClick={this.props.onToggleWidthModePressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display vertices on/off\" iconName='draw-polygon'\r\n                        onClick={this.props.onToggleVerticesPressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display labels on/off\" iconName='tag'\r\n                        onClick={this.props.onToggleLabelsPressed}\r\n                />\r\n\r\n                {this.props.showSkeletonRecognitionButton ? (\r\n                    <Button type=\"trigger\" title=\"Skeleton Recognition Demo\" iconName='tree'\r\n                            onClick={this.props.onSkeletonRecognitionButtonPressed}\r\n                    />\r\n                ) : null}\r\n\r\n                <Separator/>\r\n\r\n                <button className={classes[\"App-toolbar-units\"]}\r\n                        onClick={this.props.onUnitClicked}\r\n                >\r\n                    {this.props.units}\r\n                </button>\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"About\" iconName='info'\r\n                        onClick={this.props.onShowAboutPopupPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ToolbarComponent;\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\nimport {Box} from '@flatten-js/core';\r\nimport { Stage as CreatejsStage, Touch } from \"@createjs/easeljs\";\r\n\r\nclass Stage extends CreatejsStage {\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        Touch.enable(this);\r\n        this.mouseMoveOutside = false;   // true;\r\n        // this.enableDOMEvents(false);\r\n        this.enableMouseOver(20);\r\n\r\n        if (this.canvas.clientWidth > 0 && this.canvas.clientHeight > 0) {\r\n            this.canvas.width = this.canvas.clientWidth;\r\n            this.canvas.height = this.canvas.clientHeight;\r\n            // this.updateViewport(this.canvas.width, this.canvas.height);\r\n        }\r\n        this.origin = {x: this.canvas.width / 2, y: this.canvas.height / 2};\r\n        this.resolution = 0.00001;          // MM 2 Pixels when zoomFactor = 1;\r\n        this.zoomFactor = 1.0;\r\n\r\n        this.oldOrigin = {x: undefined, y: undefined};   // used by pan\r\n        // used by zoom by pinch\r\n        this.oldZoomFactor = undefined;\r\n        this.pinchAnchorX = undefined;\r\n        this.pinchAnchorY = undefined;\r\n        this.pinchStarted = false;\r\n    }\r\n\r\n    get box() {\r\n        let minX = this.C2W_X(0);\r\n        let minY = this.C2W_Y(this.canvas.height);\r\n        let maxX = this.C2W_X(this.canvas.width);\r\n        let maxY = this.C2W_Y(0);\r\n\r\n        return ( new Box(minX, minY, maxX, maxY) );\r\n    }\r\n\r\n    clone() {\r\n        let stage = new Stage(this.canvas);\r\n        return Object.assign(stage, this);\r\n    }\r\n\r\n    add(shape) {\r\n        this.addChild(shape);\r\n        return this;\r\n    }\r\n\r\n    scalingFactor() {\r\n        return this.resolution * this.zoomFactor;\r\n    }\r\n\r\n    C2W_Scalar(scalar) {\r\n        return (scalar / this.scalingFactor());\r\n    }\r\n\r\n    W2C_Scalar(scalar) {\r\n        return (this.scalingFactor() * scalar);\r\n    }\r\n\r\n    C2W_X(canvasX) {\r\n        return ((canvasX - this.origin.x) / this.scalingFactor());\r\n    }\r\n\r\n    C2W_Y(canvasY) {\r\n        return ((this.origin.y - canvasY) / this.scalingFactor());\r\n    }\r\n\r\n    W2C_X(worldX) {\r\n        return (this.scalingFactor() * worldX + this.origin.x);\r\n    }\r\n\r\n    W2C_Y(worldY) {\r\n        return (this.origin.y - this.scalingFactor() * worldY);\r\n    }\r\n\r\n    W2C(point) {\r\n        return {x: this.W2C_X(point.x), y: this.W2C_Y(point.y)}\r\n    }\r\n\r\n    panTo(newOrigin) {\r\n        this.origin = {x: newOrigin.x, y: newOrigin.y}\r\n    }\r\n\r\n    panBy(deltaX, deltaY) {\r\n        this.origin = {\r\n            x: this.origin.x + deltaX,\r\n            y: this.origin.y + deltaY\r\n        }\r\n    }\r\n\r\n    // zoom by 10% each time\r\n    zoomIn(ratio) {\r\n        let curRatio = ratio || 1.1;\r\n        this.zoomFactor = Math.min(10000000, curRatio * this.zoomFactor);\r\n    }\r\n\r\n    zoomOut(ratio) {\r\n        let curRatio = ratio || 1.1;\r\n        this.zoomFactor = Math.max(0.001, this.zoomFactor / curRatio);\r\n    }\r\n\r\n    // ZoomIn/Out + \"Focus follows mouse\"\r\n    zoom(focusX, focusY, bIn, ratio) {\r\n        let worldX = this.C2W_X(focusX);    // world coordinate of mouse focus before zoom\r\n        let worldY = this.C2W_Y(focusY);\r\n\r\n        bIn ? this.zoomIn(ratio) : this.zoomOut(ratio);\r\n\r\n        let newFocusX = this.W2C_X(worldX); // canvas coordinate after zoom\r\n        let newFocusY = this.W2C_Y(worldY);\r\n\r\n        this.panBy(focusX - newFocusX, focusY - newFocusY);\r\n\r\n        return [newFocusX, newFocusY];\r\n    }\r\n\r\n    zoomByMouse(focusX, focusY, bIn, ratio) {\r\n        this.zoom(focusX, focusY, bIn, ratio);\r\n    }\r\n\r\n    zoomToLimits(width, height) {\r\n        // prevent zero division in case of single point box\r\n        if (width === 0) width = 400000;\r\n        if (height === 0) height = 400000;\r\n        let resolution = Math.min(this.canvas.width / (1.1*width), this.canvas.height / (1.1*height));\r\n        let zoomFactor = resolution / this.resolution;\r\n        let ratio = zoomFactor / this.zoomFactor;\r\n        let bIn = true; //ratio > 1;\r\n\r\n        let focusX = this.canvas.width/2;\r\n        let focusY = this.canvas.height/2;\r\n        this.zoom(focusX, focusY, bIn, ratio);\r\n    }\r\n\r\n    resize() {\r\n        // this.origin.x = this.canvas.width / 2;\r\n        // this.origin.y = this.canvas.height / 2;\r\n        if (this.canvas.clientWidth > 0 && this.canvas.clientHeight > 0) {\r\n            this.canvas.width = this.canvas.clientWidth;\r\n            this.canvas.height = this.canvas.clientHeight;\r\n        }\r\n    }\r\n\r\n    // drawSomething() {\r\n    //     let shape = new Shape();\r\n    //     shape.graphics.beginFill('red').drawRect(0, 0, 20, 20);\r\n    //     this.addChild(shape);\r\n    //     this.update();\r\n    // }\r\n\r\n    panByMouseStart() {\r\n        this.oldOrigin.x = this.origin.x;\r\n        this.oldOrigin.y = this.origin.y;\r\n        this.zoomByPinchStop();\r\n    }\r\n\r\n    panByMouseMove(dx, dy) {\r\n        if (this.pinchStarted) return;\r\n        if (dx !== undefined && dy !== undefined &&\r\n            this.oldOrigin.x !== undefined && this.oldOrigin.y !== undefined) {\r\n            this.origin = {\r\n                    x: this.oldOrigin.x + dx,\r\n                    y: this.oldOrigin.y + dy\r\n                };\r\n        }\r\n    }\r\n\r\n    panByMouseStop() {\r\n        this.oldOrigin.x = undefined;\r\n        this.oldOrigin.y = undefined;\r\n    }\r\n\r\n    panToCoordinate(x, y) {\r\n        let canvasX = this.W2C_X(x);\r\n        let canvasY = this.W2C_Y(y);\r\n\r\n        let dx = this.canvas.width / 2 - canvasX;\r\n        let dy = this.canvas.height / 2 - canvasY;\r\n        this.panBy(dx, dy);\r\n    }\r\n\r\n    zoomByPinchStart(canvasX, canvasY) {\r\n        this.oldZoomFactor = this.zoomFactor;\r\n        this.pinchAnchorX = this.C2W_X(canvasX);\r\n        this.pinchAnchorY = this.C2W_Y(canvasY);\r\n        this.pinchStarted = true;\r\n        this.panByMouseStop();\r\n    }\r\n\r\n    zoomByPinchMove(canvasX, canvasY, ratio) {\r\n        this.zoomFactor = ratio * this.oldZoomFactor;\r\n        this.origin = {\r\n            x: canvasX - this.scalingFactor() * this.pinchAnchorX,\r\n            y: canvasY + this.scalingFactor() * this.pinchAnchorY\r\n        }\r\n    }\r\n\r\n    zoomByPinchStop() {\r\n        this.oldZoomFactor = undefined;\r\n        this.pinchAnchorX = undefined;\r\n        this.pinchAnchorY = undefined;\r\n        this.pinchStarted = false;\r\n    }\r\n\r\n    clear() {\r\n        this.canvas.getContext('2d').clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n}\r\n\r\nexport default Stage;\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const registerStage = (stage) => {\r\n    return {\r\n        type: ActionTypes.NEW_STAGE_CREATED,\r\n        stage: stage\r\n    }\r\n};\r\n\r\nexport const handleMouseDown = (stage, x, y) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_DOWN_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y\r\n    }\r\n};\r\n\r\nexport const handleMouseUp = (stage, x, y) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_UP_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y\r\n    }\r\n};\r\n\r\nexport const handleMouseMove = (stage, x, y, dx, dy) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_MOVED_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y,\r\n        dx: dx,\r\n        dy: dy\r\n    }\r\n};\r\n\r\nexport const handleMouseWheelMove = (stage, x, y, delta) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y,\r\n        delta: delta\r\n    }\r\n};\r\n\r\nexport const handlePinchDown = (stage, touchPoints) => {\r\n    return {\r\n        type: ActionTypes.PINCH_DOWN_ON_STAGE,\r\n        stage: stage,\r\n        x1: touchPoints[0].x,\r\n        y1: touchPoints[0].y,\r\n        x2: touchPoints[1].x,\r\n        y2: touchPoints[1].y\r\n    }\r\n};\r\n\r\nexport const handlePinchMove = (stage, touchPoints) => {\r\n    return {\r\n        type: ActionTypes.PINCH_MOVED_ON_STAGE,\r\n        stage: stage,\r\n        x1: touchPoints[0].x,\r\n        y1: touchPoints[0].y,\r\n        x2: touchPoints[1].x,\r\n        y2: touchPoints[1].y\r\n    }\r\n};\r\n\r\nexport const handlePinchUp = (stage) => {\r\n    return {\r\n        type: ActionTypes.PINCH_UP_ON_STAGE,\r\n        stage\r\n    }\r\n};\r\n\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport styles from \"./CanvasComponent.module.css\";\r\nimport Stage from '../../../models/stage';\r\nimport { connect } from \"react-redux\";\r\n// import * as ActionTypes from \"../../../store/actionTypes\";\r\nimport * as actions from '../../../store/actions/stageActions';\r\n\r\nclass CanvasComponent extends Component {\r\n    canvasElement = React.createRef();\r\n\r\n    handleMouseMove = (event) => {\r\n        this.props.stage.canvas.focus();\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseMove(\r\n                this.props.stage,\r\n                event.stageX,\r\n                event.stageY,\r\n                this.props.mouse.startX ? event.stageX - this.props.mouse.startX : undefined,\r\n                this.props.mouse.startY ? event.stageY - this.props.mouse.startY : undefined\r\n            );\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            let touchPoints = [\r\n                {\r\n                    x: event.nativeEvent.touches[0].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[0].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n                {\r\n                    x: event.nativeEvent.touches[1].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[1].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n            ];\r\n            this.props.handlePinchMove(this.props.stage, touchPoints);\r\n        }\r\n\r\n        // if (this.props.stage.pinchStarted) {\r\n        //     this.props.handleSecondTouchMove(this.props.stage, event.stageX, event.stageY);\r\n        // }\r\n        // else {\r\n        //     this.props.handleMouseMove(\r\n        //         this.props.stage,\r\n        //         event.stageX,\r\n        //         event.stageY,\r\n        //         this.props.mouse.startX ? event.stageX - this.props.mouse.startX : undefined,\r\n        //         this.props.mouse.startY ? event.stageY - this.props.mouse.startY : undefined\r\n        //     );\r\n        // }\r\n    };\r\n\r\n    handleMouseDown = (event) => {\r\n        // if (event.pointerID === -1 || event.pointerID === 0) {\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseDown(this.props.stage, event.stageX, event.stageY);\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            let touchPoints = [\r\n                {\r\n                    x: event.nativeEvent.touches[0].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[0].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n                {\r\n                    x: event.nativeEvent.touches[1].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[1].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n            ];\r\n            this.props.handlePinchDown(this.props.stage, touchPoints);\r\n        }\r\n    };\r\n\r\n    handleMouseUp = (event) => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseUp(this.props.stage);\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            this.props.handlePinchUp(this.props.stage);\r\n        }\r\n    };\r\n\r\n    handleMouseLeave = (event) => {   // nothing works except click\r\n        this.props.stage.canvas.blur();\r\n        document.body.focus();\r\n    };\r\n\r\n    handleMouseWheel = (event) => {\r\n        /*event.preventDefault();*/\r\n\r\n        let delta = event.detail || event.wheelDelta;\r\n        if (delta !== 0) {\r\n            this.props.handleMouseWheelMove(this.props.stage, event.offsetX, event.offsetY, delta);\r\n        }\r\n    };\r\n\r\n    handleMouseWheelFox = (event) => {\r\n        /*event.preventDefault();*/\r\n        if (event.detail !== 0) {\r\n            this.props.handleMouseWheelMove(this.props.stage, event.layerX, event.layerY, -event.detail);\r\n        }\r\n    };\r\n\r\n    handlePaste = (event) => {\r\n        let a = event;\r\n    }\r\n\r\n    componentDidMount() {\r\n        let stage = new Stage(this.canvasElement.current);\r\n\r\n        // stage.setClearColor(\"#FFFFFF\");\r\n        // stage.update();\r\n\r\n        stage.on(\"stagemousedown\", this.handleMouseDown);\r\n        stage.on(\"stagemousemove\", this.handleMouseMove);\r\n        // stage.on(\"click\", this.handleMouseDown);\r\n        stage.on(\"stagemouseup\", this.handleMouseUp);\r\n        stage.on(\"mouseleave\", this.handleMouseLeave);\r\n        stage.canvas.addEventListener(\"mousewheel\", this.handleMouseWheel, {passive: true});\r\n        stage.canvas.addEventListener(\"DOMMouseScroll\", this.handleMouseWheelFox, {passive: true});\r\n        stage.canvas.addEventListener(\"paste\", this.handlePaste);\r\n\r\n        this.props.registerStage(stage);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <canvas\r\n                tabIndex=\"1\"\r\n                ref={this.canvasElement}\r\n                id=\"mainCanvas\"\r\n                className={styles[\"App-canvas\"]}\r\n                width=\"100\"\r\n                height=\"100\"\r\n            >\r\n            </canvas>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        stage: state.app.stage,\r\n        mouse: state.mouse\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        registerStage: (stage) => dispatch(actions.registerStage(stage)),\r\n        handleMouseDown: (stage, x, y) => dispatch(actions.handleMouseDown(stage, x, y)),\r\n        handleMouseUp: (stage, x, y) => dispatch(actions.handleMouseUp(stage, x, y)),\r\n        handleMouseMove: (stage, x, y, dx, dy) => dispatch(actions.handleMouseMove(stage, x, y, dx, dy)),\r\n        handleMouseWheelMove: (stage, x, y, delta) => dispatch(actions.handleMouseWheelMove(stage, x, y, delta)),\r\n        handlePinchDown: (stage, touchPoints) => dispatch(actions.handlePinchDown(stage, touchPoints)),\r\n        handlePinchMove: (stage, touchPoints) => dispatch(actions.handlePinchMove(stage, touchPoints)),\r\n        handlePinchUp: (stage) => dispatch(actions.handlePinchUp(stage))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CanvasComponent);\r\n","/**\r\n * Created by alexanderbol on 17/06/2017.\r\n */\r\nimport React from 'react';\r\nimport styles from './StatusComponent.module.css';\r\n\r\nconst StatusComponent = () => {\r\n    return (\r\n        <div className={styles[\"App-status-bar\"]}>\r\n            <div>\r\n                <h5>\r\n                    &nbsp;\r\n                </h5>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default StatusComponent;","import React, {Component} from 'react';\r\n// import Utils from \"../utils\";\r\n\r\nclass StageComponent extends Component {\r\n    // shouldComponentUpdate useless because always returns \"true\",\r\n    // Don't know why, maybe because of children?\r\n    // ----------------------------------------------------------\r\n    // shouldComponentUpdate(nextProps, nextState) {\r\n    //     if (Utils.is_equal(this.props, nextProps)) {\r\n    //         return false;\r\n    //     }\r\n    //     return true;\r\n    // }\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.stage.canvas && this.props.stage.canvas.getContext('2d')) {\r\n\r\n            let origin = this.props.stage.origin;\r\n            let zoomFactor = this.props.stage.zoomFactor*this.props.stage.resolution;\r\n            this.props.stage.setTransform(origin.x, origin.y, zoomFactor, -zoomFactor);\r\n\r\n            this.props.stage.update();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.onStageUnmounted();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <React.Fragment>\r\n                {this.props.children}\r\n            </React.Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default StageComponent;","import {Point, Segment, Circle, Arc, Polygon, Box} from '@flatten-js/core';\r\nimport {Graphics} from '@createjs/easeljs';\r\n\r\n/* Provide conversion methods from FlattenJS objects to CreateJS Graphics */\r\nexport function graphics(shape, style = undefined) {\r\n    if (shape instanceof Point) {\r\n        return graphics_point(shape, style);\r\n    }\r\n    if (shape instanceof Segment) {\r\n        return graphics_segment(shape, style);\r\n    }\r\n    if (shape instanceof Arc) {\r\n        return graphics_arc(shape, style);\r\n    }\r\n    if (shape instanceof Circle) {\r\n        return graphics_circle(shape, style);\r\n    }\r\n    if (shape instanceof Box) {\r\n        return graphics_box(shape, style);\r\n    }\r\n    if (shape instanceof Polygon) {\r\n        return graphics_polygon(shape, style);\r\n    }\r\n    return null;\r\n}\r\n\r\n// Point.prototype.graphics = function(style) {\r\nfunction graphics_point(point, style) {\r\n    let radius = (style && style.radius) ? style.radius : 3;\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    let graphics = new Graphics();\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.circle = graphics.drawCircle(point.x, point.y, radius).command;\r\n    return graphics;\r\n};\r\n\r\n// Segment.prototype.graphics = function(style) {\r\nfunction graphics_segment(segment, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle !== undefined ? style.strokeStyle : 2;\r\n    let ignoreScale = style && style.ignoreScale !== undefined ? style.ignoreScale : true;\r\n    let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    return graphics\r\n        .setStrokeStyle(strokeStyle,1,0,10,ignoreScale)\r\n        .beginStroke(stroke)\r\n        .moveTo(segment.ps.x, segment.ps.y)\r\n        .lineTo(segment.pe.x, segment.pe.y)\r\n        .endStroke();\r\n};\r\n\r\n// Arc.prototype.graphics = function(style) {\r\nfunction graphics_arc(arc, style) {\r\n    // let startAngle = 2 * Math.PI - this.startAngle;\r\n    // let endAngle =  2 * Math.PI - this.endAngle;\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 2;\r\n    let ignoreScale = style && style.ignoreScale !== undefined ? style.ignoreScale : true;\r\n    let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    return graphics\r\n        .setStrokeStyle(strokeStyle,1,0,10,ignoreScale)\r\n        .beginStroke(stroke)\r\n        .arc(arc.pc.x, arc.pc.y, arc.r, arc.startAngle, arc.endAngle, !arc.counterClockwise)\r\n        .endStroke();\r\n};\r\n\r\n// Circle.prototype.graphics = function(style) {\r\nfunction graphics_circle(circle, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    // let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.drawCircle(circle.pc.x, circle.pc.y, circle.r);\r\n    return graphics;\r\n};\r\n\r\n\r\nfunction graphics_box(box, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.drawRect(box.xmin, box.ymin, box.xmax-box.xmin, box.ymax-box.ymin);\r\n    return graphics;\r\n};\r\n\r\nfunction setGraphicsEdgeSegment(graphics, segment) {\r\n    graphics.lineTo(segment.pe.x, segment.pe.y);\r\n}\r\n\r\nfunction setGraphicsEdgeArc(graphics, arc) {\r\n    // let startAngle = 2 * Math.PI - arc.startAngle;\r\n    // let endAngle = 2 * Math.PI - arc.endAngle;\r\n    graphics.arc(arc.pc.x, arc.pc.y, arc.r, arc.startAngle, arc.endAngle, !arc.counterClockwise);\r\n}\r\n\r\nfunction setGraphicsEdge(graphics, edge) {\r\n    if (edge.shape instanceof Segment) {\r\n        setGraphicsEdgeSegment(graphics, edge.shape);\r\n    }\r\n    else if (edge.shape instanceof Arc) {\r\n        setGraphicsEdgeArc(graphics, edge.shape);\r\n    }\r\n}\r\n\r\nfunction setGraphicsFace(graphics, face) {\r\n    let ps = face.first.start;\r\n    graphics.moveTo(ps.x, ps.y);\r\n\r\n    for (let edge of face) {\r\n        setGraphicsEdge(graphics, edge);\r\n    }\r\n}\r\n\r\n// Polygon.prototype.graphics = function(style) {\r\nfunction graphics_polygon(polygon, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n\r\n    for (let face of polygon.faces) {\r\n        setGraphicsFace(graphics, face);\r\n    }\r\n\r\n    graphics.endStroke();\r\n    return graphics;\r\n};\r\n\r\n","export const is_equal = (obj1, obj2) => {\r\n    let equal = true;\r\n    for (let key of Object.keys(obj2)) {\r\n        if (obj2[key] !== obj1[key]) {\r\n            equal = false;\r\n            break;\r\n        }\r\n    }\r\n    return equal;\r\n};\r\n\r\nexport const format = (num, divisor, decimals) => {\r\n    return (num/divisor).toFixed(decimals);\r\n};\r\n","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Shape} from '@createjs/easeljs';\r\nimport {graphics} from '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\n\r\nexport class ShapeComponent extends Component {\r\n    constructor(params) {\r\n        super();\r\n        this.shape = new Shape();\r\n        params.stage.addChild(this.shape);\r\n    }\r\n\r\n    handleMouseOver = (event) => {\r\n        this.props.onMouseOver(this.props.model);\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        this.props.onMouseOut();\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        this.props.onClick(this.props.model, this.props.layer);\r\n    };\r\n\r\n    redraw() {\r\n        // Draw shape\r\n        let stage = this.props.stage;\r\n        let color = (this.props.hovered || this.props.selected) ? \"black\" : this.props.color;\r\n        let alpha = (this.props.hovered || this.props.selected) ? 1.0 : 0.6;\r\n        let widthOn = this.props.widthOn;\r\n\r\n        let strokeStyle = this.props.model.geom.aperture ? this.props.model.geom.aperture : undefined;\r\n        let fill = widthOn ? this.props.color : \"white\";\r\n\r\n        if (this.shape.graphics.isEmpty()) {\r\n            this.shape.graphics = graphics(this.props.model.geom,{\r\n                strokeStyle: strokeStyle,\r\n                ignoreScale: true,\r\n                stroke: color,\r\n                fill: fill,\r\n                radius: 3. / (stage.zoomFactor * stage.resolution)\r\n            });\r\n\r\n            // this.skeletonShape = new Shape();\r\n            // this.skeletonShape.graphics = this.props.model.geom.graphics({\r\n            //     strokeStyle: 1,\r\n            //     ignoreScale: true,\r\n            //     stroke: color,\r\n            //     fill: fill,\r\n            //     radius: 3. / (stage.zoomFactor * stage.resolution)\r\n            // });\r\n            // this.skeletonShape.alpha = 1;\r\n            // this.props.stage.addChild(this.skeletonShape);\r\n        }\r\n        else {\r\n            if (this.shape.graphics.stroke) this.shape.graphics.stroke.style = color;\r\n            if (this.shape.graphics.fill) this.shape.graphics.fill.style = fill;\r\n            if (this.shape.graphics.circle) this.shape.graphics.circle.radius =\r\n                3. / (stage.zoomFactor * stage.resolution);\r\n        }\r\n        this.shape.alpha = this.props.displayed ? alpha : 0.0;\r\n\r\n        // let box = this.props.model.geom.box;\r\n        // this.shape.cache(box.xmin, box.ymin, box.xmax - box.xmin, box.ymax - box.ymin);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.shape.on(\"mouseover\", this.handleMouseOver);\r\n        this.shape.on(\"mouseout\", this.handleMouseOut);\r\n        this.shape.on(\"click\", this.handleClick);\r\n\r\n        // this.shape.mouseEnabled = false;\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.shape.off(\"mouseover\", this.handleMouseOver);\r\n        this.shape.off(\"mouseout\", this.handleMouseOut);\r\n        this.shape.off(\"click\", this.handleClick);\r\n        this.props.stage.removeChild(this.shape);\r\n        this.shape.graphics.clear();\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Bitmap} from '@createjs/easeljs';\r\nimport '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\n// import storage from '../../../../firebase-storage';\r\n\r\nexport class ImageComponent extends Component {\r\n    handleMouseOver = (event) => {\r\n        this.props.onMouseOver(this.props.model);\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        this.props.onMouseOut();\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        this.props.onClick(this.props.model, this.props.layer);\r\n    };\r\n\r\n    redraw() {\r\n        if (!this.bitmap) return;\r\n        // Draw shape\r\n        let alpha = 1; // (this.props.hovered || this.props.selected) ? 1.0 : 0.6;\r\n        this.bitmap.alpha = this.props.displayed ? alpha : 0.0;\r\n\r\n        let width = this.props.model.geom.width;\r\n        let ratio = this.bitmap.image.naturalWidth/this.bitmap.image.naturalHeight;\r\n        this.props.model.geom.height = this.props.model.geom.width / ratio;\r\n        let scaleX = width/this.bitmap.image.naturalWidth; // 1. / (stage.zoomFactor * stage.resolution);\r\n        let scaleY = width/(this.bitmap.image.naturalHeight*ratio);\r\n        let tx = this.props.model.geom.center.x; // stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n        let ty = this.props.model.geom.center.y; // -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n\r\n        this.bitmap.setTransform(tx, ty, scaleX, -scaleY);\r\n\r\n        this.bitmap.regX = this.bitmap.image.naturalWidth/2;\r\n        this.bitmap.regY = this.bitmap.image.naturalHeight/2;\r\n\r\n        // let box = this.state.polygon.geom.box;\r\n        // this.shape.cache(box.xmin, box.ymin, box.xmax - box.xmin, box.ymax - box.ymin);\r\n    }\r\n\r\n    loadImage() {\r\n        const img = new Image();\r\n\r\n        img.onload = () => {\r\n            // img.crossOrigin=\"Anonymous\";\r\n            this.bitmap = new Bitmap(img);\r\n            this.props.stage.addChild(this.bitmap);\r\n\r\n            // this.bitmap.on(\"mouseover\", this.handleMouseOver);\r\n            // this.bitmap.on(\"mouseout\", this.handleMouseOut);\r\n            // this.bitmap.on(\"click\", this.handleClick);\r\n\r\n            // this.shape.mouseEnabled = false;\r\n            this.redraw();\r\n\r\n            this.props.onImageLoaded(this.props.model, this.props.layer, img);\r\n        };\r\n        img.setAttribute('crossOrigin', 'anonymous'); // works for me\r\n\r\n        // Create a reference from a Google Cloud Storage URI\r\n        //const ref = storage.refFromURL(this.props.model.geom.uri);\r\n\r\n        // ref.getDownloadURL()\r\n        //    .then( url => {\r\n        //\r\n        //         img.src = url;\r\n        //     })\r\n        //     .catch( error => console.log(error))\r\n\r\n        img.src = this.props.model.geom.uri;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.loadImage()\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.bitmap.off(\"mouseover\", this.handleMouseOver);\r\n        // this.bitmap.off(\"mouseout\", this.handleMouseOut);\r\n        // this.bitmap.off(\"click\", this.handleClick);\r\n\r\n        this.props.stage.removeChild(this.bitmap);\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n","import React, {Component} from 'react';\r\nimport {ShapeComponent} from './graphics/shapeComponent';\r\nimport {ImageComponent} from \"./graphics/imageComponent\";\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from \"../../../store/actions/appActions\";\r\n\r\nclass LayerComponent extends Component {\r\n    onImageLoaded = (model, layer, image) => {\r\n        this.props.setHomeView(this.props.stage, this.props.layer);\r\n        this.forceUpdate();       // ??? unclear why on Home button click not updated\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            this.props.layer.shapes.map((shape, index) => {\r\n                return shape.geom.uri ? (\r\n                    <ImageComponent\r\n                        key={index}\r\n                        stage={this.props.stage}\r\n                        layer={this.props.layer}\r\n                        model={shape}\r\n                        displayed={this.props.layer.displayed}\r\n                        hovered={shape === this.props.hoveredShape}\r\n                        selected={\r\n                            shape === this.props.firstMeasuredShape ||\r\n                            shape === this.props.secondMeasuredShape\r\n                        }\r\n                        color={this.props.layer.color}\r\n                        widthOn={this.props.widthOn}\r\n                        displayLabels={this.props.displayLabels}\r\n                        zoomFactor={this.props.zoomFactor}\r\n                        onMouseOver={this.props.onMouseOver}\r\n                        onMouseOut={this.props.onMouseOut}\r\n                        onClick={this.props.onClick}\r\n                        onImageLoaded={this.onImageLoaded}\r\n                    />\r\n                    ) : (\r\n                    <ShapeComponent\r\n                        key={index}\r\n                        stage={this.props.stage}\r\n                        layer={this.props.layer}\r\n                        model={shape}\r\n                        displayed={this.props.layer.displayed}\r\n                        hovered={shape === this.props.hoveredShape}\r\n                        selected={\r\n                            shape === this.props.firstMeasuredShape ||\r\n                            shape === this.props.secondMeasuredShape\r\n                        }\r\n                        color={this.props.layer.color}\r\n                        widthOn={this.props.widthOn}\r\n                        displayVertices={this.props.displayVertices}\r\n                        zoomFactor={this.props.zoomFactor}\r\n                        onMouseOver={this.props.handleMouseRollOverShape}\r\n                        onMouseOut={this.props.handleMouseRollOutShape}\r\n                        onClick={this.props.handleClickOnShape}\r\n                    /> )\r\n                }\r\n            )\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        layers: state.layers,\r\n        displayVertices: state.app.displayVertices,\r\n        displayLabels: state.app.displayLabels,\r\n        widthOn: state.app.widthOn,\r\n        zoomFactor: state.app.zoomFactor,\r\n        units: state.app.units,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n        measurePointsActive: state.app.measurePointsActive,\r\n        showAboutPopup: state.app.showAboutPopup,\r\n        showDownloadPopup: state.app.showDownloadPopup,\r\n        showUploadPopup: state.app.showUploadPopup,\r\n        measureShapesTool: state.measureShapesTool,\r\n        hoveredShape: state.measureShapesTool.hoveredShape,\r\n        firstMeasuredShape: state.measureShapesTool.firstMeasuredShape,\r\n        secondMeasuredShape: state.measureShapesTool.secondMeasuredShape\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        setHomeView: (stage, shape) => dispatch(actions.setHomeView(stage, shape)),\r\n        handleMouseRollOverShape: (shape) => dispatch(actions.handleMouseRollOverShape(shape)),\r\n        handleMouseRollOutShape: () => dispatch(actions.handleMouseRollOutShape()),\r\n        handleClickOnShape: (shape, layer) => dispatch(actions.handleClickOnShape(shape, layer)),\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LayerComponent);\r\n","import React from 'react';\r\nimport classes from '../LabelsLayerComponent/labelsLayer.module.css';\r\n\r\nconst labelComponent = ( {stage, shape} ) => {\r\n    let center = shape.geom.center || shape.geom;  // Point has no method center\r\n    let left = stage.canvas.offsetLeft + stage.W2C_X(center.x) + 6;\r\n    let top = stage.canvas.offsetTop + stage.W2C_Y(center.y) - 4;\r\n    let inside = left > stage.canvas.offsetLeft && left < stage.canvas.offsetLeft + stage.canvas.width &&\r\n        top > stage.canvas.offsetTop && top < stage.canvas.offsetTop + stage.canvas.height;\r\n\r\n    return inside ? (\r\n        <div style={{position:\"absolute\", left:left+\"px\", top: top+\"px\"}} className={classes.LabelComponent}>\r\n            <h5>{shape.label}</h5>\r\n        </div>\r\n    ) : null;\r\n};\r\n\r\nexport default labelComponent;","import React from 'react';\r\nimport LabelComponent from '../domelements/labelComponent';\r\nimport { connect } from \"react-redux\";\r\n\r\nconst labelsLayerComponent = (props) => {\r\n\r\n    return (props.layer.displayed && props.displayLabels) ? (\r\n        props.layer.shapes.map((shape, index) => {\r\n                return (shape.label && shape.label.trim() !== \"\") ? (\r\n                    <LabelComponent\r\n                        key={index}\r\n                        stage={props.stage}\r\n                        shape={shape}\r\n                        zoomFactor={props.zoomFactor}\r\n                        originX={props.originX}\r\n                        originY={props.originY}\r\n                    />) : null;\r\n            }\r\n        )\r\n    ) : null;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        displayLabels: state.app.displayLabels,\r\n        zoomFactor: state.app.zoomFactor,\r\n        originX: state.app.originX,\r\n        originY: state.app.originY\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {return {}};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(labelsLayerComponent);\r\n","import React from 'react'\r\nimport {format} from \"../../../../../models/utils\";\r\nimport classes from './VertexLabel.module.css';\r\n\r\nconst VertexLabel = (props) => {\r\n    let stage = props.stage;\r\n    let left = stage.canvas.offsetLeft + stage.W2C_X(props.vertex.x) + 6;\r\n    let top = stage.canvas.offsetTop + stage.W2C_Y(props.vertex.y) - 10;\r\n    // let inside = left > stage.canvas.offsetLeft && left < stage.canvas.offsetLeft + stage.canvas.width &&\r\n    //     top > stage.canvas.offsetTop && top < stage.canvas.offsetTop + stage.canvas.height;\r\n    let x = format(props.vertex.x, props.divisor, props.decimals);\r\n    let y = format(props.vertex.y, props.divisor, props.decimals);\r\n\r\n    return (\r\n        <div className={classes.VertexLabel} style={{left:left, top:top}}>\r\n            <h5>\r\n                x={x} y={y}\r\n            </h5>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default VertexLabel;","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport React,{Component} from 'react';\r\nimport {Shape, Shadow} from '@createjs/easeljs';\r\nimport {graphics} from '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\nimport VertexLabel from '../domelements/VertexLabel/VertexLabel';\r\n\r\nclass VertexComponent extends Component {\r\n    constructor(props) {\r\n        super();\r\n        this.shape = new Shape();\r\n        props.stage.addChild(this.shape);\r\n\r\n        this.state = {\r\n            hovered: false\r\n        }\r\n    }\r\n\r\n    handleMouseOver = (event) => {\r\n        // this.props.onMouseOver(this.props.model);\r\n        this.shape.shadow = new Shadow(this.props.color, 0, 0, 10);\r\n        this.setState({hovered:true})\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        // this.props.onMouseOut();\r\n        this.shape.shadow = null;\r\n        this.setState({hovered:false})\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        // this.props.onClick(this.props.model, this.props.layer);\r\n        console.log(this.props.vertex);\r\n    };\r\n\r\n    redraw() {\r\n        let stage = this.props.stage;\r\n        let stroke = this.props.color;\r\n        let fill = this.props.color;\r\n        let alpha = 1.0;\r\n\r\n\r\n        if (this.shape.graphics.isEmpty()) {\r\n            this.shape.graphics = graphics(this.props.vertex,\r\n                {\r\n                    stroke: stroke,     // this.props.color,\r\n                    fill: fill,\r\n                    radius: 3. / (stage.zoomFactor * stage.resolution)\r\n                });\r\n        }\r\n        else {\r\n            this.shape.graphics.circle.radius = 3. / (stage.zoomFactor * stage.resolution);\r\n            this.shape.graphics.fill.style = fill;\r\n        }\r\n        this.shape.alpha = alpha;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.shape.on(\"mouseover\", this.handleMouseOver);\r\n        this.shape.on(\"mouseout\", this.handleMouseOut);\r\n        this.shape.on(\"click\", this.handleClick);\r\n\r\n        this.shape.mouseEnabled = true;\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps) && is_equal(this.state, nextState)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.shape.off(\"mouseover\", this.handleMouseOver);\r\n        this.shape.off(\"mouseout\", this.handleMouseOut);\r\n        this.shape.off(\"click\", this.handleClick);\r\n\r\n        this.props.stage.removeChild(this.shape);\r\n        this.shape.graphics.clear();\r\n    }\r\n\r\n    render() {\r\n        return this.state.hovered ? (\r\n            <VertexLabel\r\n                stage={this.props.stage}\r\n                vertex={this.props.vertex}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n            />\r\n            ) : null;\r\n    }\r\n}\r\n\r\nexport default VertexComponent;","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\nimport React from 'react';\r\nimport VertexComponent from './vertexComponent';\r\n\r\nconst VerticesComponent = (props) => {\r\n\r\n    return props.model.geom.vertices ?\r\n        props.model.geom.vertices.map((vertex, index) =>\r\n            <VertexComponent key={index}\r\n                             stage={props.stage}\r\n                             vertex={vertex}\r\n                             color={props.color}\r\n                             divisor={props.divisor}\r\n                             decimals={props.decimals}\r\n                             zoomFactor={props.zoomFactor}\r\n                             originX={props.originX}\r\n                             originY={props.originY}\r\n            />\r\n        ) : null;\r\n\r\n}\r\n\r\nexport default VerticesComponent;","import React from 'react'\r\nimport VerticesComponent from './graphics/verticesComponent';\r\nimport { connect } from \"react-redux\";\r\n\r\nconst verticesLayerComponent = (props) => {\r\n    return (props.layer.displayed && props.displayVertices) ? (\r\n        props.layer.shapes.map((shape, index) =>\r\n            <VerticesComponent\r\n                key={index}\r\n                stage={props.stage}\r\n                model={shape}\r\n                color={props.layer.color}\r\n                divisor={props.divisor}\r\n                decimals={props.decimals}\r\n                zoomFactor={props.zoomFactor}\r\n                originX={props.originX}\r\n                originY={props.originY}\r\n            />\r\n        )\r\n    ) : null;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        displayVertices: state.app.displayVertices,\r\n        zoomFactor: state.app.zoomFactor,\r\n        originX: state.app.originX,\r\n        originY: state.app.originY,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {return {}};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(verticesLayerComponent);\r\n","import React, {Component} from 'react';\r\nimport LayerComponent from \"./layerComponent\";\r\nimport LabelsLayerComponent from \"./LabelsLayerComponent/labelsLayerComponent\";\r\nimport VerticesLayerComponent from './verticesLayerComponent';\r\n// import Layers from \"../../../models/layers\";\r\n\r\nclass LayersComponent extends Component {\r\n    componentDidMount() {\r\n        // if (this.props.layers.length > 0 && this.props.stage) {\r\n        //     let affectedLayer = Layers.getAffected(this.props.layers);\r\n        //     if (affectedLayer) {\r\n        //         this.props.setHomeView(this.props.stage, affectedLayer);\r\n        //     }\r\n        // }\r\n    }\r\n    render() {\r\n        return this.props.layers.map((layer) =>\r\n            <React.Fragment key={layer.name}>\r\n\r\n                <LayerComponent layer={layer} />\r\n\r\n                <LabelsLayerComponent layer={layer} />\r\n\r\n                <VerticesLayerComponent layer={layer} />\r\n            </React.Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default LayersComponent;\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport Stage from \"../models/stage\";\r\nimport * as actions from '../store/actions/stageActions';\r\n\r\nclass MeasurePointsTool extends Component {\r\n    measureCanvas = React.createRef();\r\n    measureStage = null;\r\n\r\n    state = {\r\n        startX: undefined,\r\n        startY: undefined,\r\n        endX: undefined,\r\n        endY: undefined,\r\n        measureStarted: false\r\n    };\r\n\r\n    handleMouseDown = (event) => {\r\n        event.preventDefault();\r\n\r\n        this.measureStage.clear();\r\n\r\n        if (this.state.measureStarted) {   // second click - clear measurement\r\n            this.setState({\r\n                startX: undefined,\r\n                startY: undefined,\r\n                endX: undefined,\r\n                endY: undefined,\r\n                measureStarted: false\r\n            });\r\n            this.measureStage.canvas.style.cursor = \"auto\";\r\n        }\r\n        else {                       // first click - start measurment\r\n            this.setState({\r\n                startX: this.measureStage.C2W_X(event.stageX),\r\n                startY: this.measureStage.C2W_Y(event.stageY),\r\n                measureStarted: true\r\n            });\r\n            this.measureStage.canvas.style.cursor = \"crosshair\";\r\n        }\r\n    };\r\n\r\n    handleMouseMove = (event) => {\r\n        if (this.state.measureStarted) {\r\n            this.setState({\r\n                endX: this.measureStage.C2W_X(event.stageX),\r\n                endY: this.measureStage.C2W_Y(event.stageY)\r\n            })\r\n        }\r\n    };\r\n\r\n    handleMouseUp = (event) => {\r\n    }\r\n\r\n    handleMouseWheel = (event) => {\r\n        event.preventDefault();\r\n\r\n        let delta = event.detail || event.wheelDelta;\r\n        if (delta !== 0) {\r\n            // this.props.onMouseWheelMove(event.offsetX, event.offsetY, delta);\r\n            this.props.handleMouseWheelMove(this.props.stage, event.offsetX, event.offsetY, delta);\r\n\r\n            this.draw();\r\n        }\r\n    };\r\n\r\n    handleMouseWheelFox = (event) => {\r\n        event.preventDefault();\r\n\r\n        if (event.detail !== 0) {\r\n            // this.props.onMousewheelMove(event.layerX, event.layerY, -event.detail);\r\n            this.props.handleMouseWheelMove(this.props.stage, event.layerX, event.layerY, -event.detail);\r\n\r\n            this.draw();\r\n        }\r\n    };\r\n\r\n    draw() {\r\n        // let canvas = this.measureCanvas.current;\r\n        let stage = this.measureStage; // this.props.stage;\r\n        let canvas = stage.canvas;\r\n        let context = canvas.getContext('2d');\r\n\r\n        this.measureStage.origin = this.props.stage.origin;\r\n        this.measureStage.resolution = this.props.stage.resolution;\r\n        this.measureStage.zoomFactor = this.props.stage.zoomFactor;\r\n\r\n        this.measureStage.clear();\r\n\r\n        // Draw rectangle\r\n        let pllX = Math.min(stage.W2C_X(this.state.startX), stage.W2C_X(this.state.endX));\r\n        let pllY = Math.min(stage.W2C_Y(this.state.startY), stage.W2C_Y(this.state.endY));\r\n        let width = Math.abs(stage.W2C_Scalar(this.state.startX - this.state.endX));\r\n        let height = Math.abs(stage.W2C_Scalar(this.state.startY - this.state.endY));\r\n\r\n        context.beginPath();\r\n        context.rect(pllX, pllY, width, height);\r\n\r\n        // Draw segment\r\n        context.moveTo(stage.W2C_X(this.state.startX), stage.W2C_Y(this.state.startY));\r\n        context.lineTo(stage.W2C_X(this.state.endX), stage.W2C_Y(this.state.endY));\r\n\r\n        context.lineWidth = 1;\r\n        context.strokeStyle = 'black';\r\n        context.stroke();\r\n\r\n        // Draw text\r\n        let textX, textY, textHeight, textWidth;\r\n        let backX, backY;                      // background rectangle\r\n        let text = this.measurement();\r\n\r\n        context.font = \"12pt Arial\";\r\n\r\n        textHeight = 12;\r\n        /* font size*/\r\n        textWidth = context.measureText(text).width;\r\n\r\n        // Rectangle to the right of current point, text aligned left\r\n        if (Math.abs(stage.W2C_X(this.state.endX) - pllX) <= 2) {\r\n            context.textAlign = \"left\";\r\n            textX = pllX + 3;\r\n            backX = pllX;\r\n        }\r\n        // Rectangle to the left of current point, text aligned right\r\n        else {\r\n            context.textAlign = \"right\";\r\n            textX = pllX + width - 3;\r\n            backX = textX - textWidth - 3;\r\n        }\r\n\r\n        if (Math.abs(stage.W2C_Y(this.state.endY) - pllY) <= 2) {\r\n            textY = pllY - 3;\r\n        }\r\n        else {\r\n            textY = pllY + height + textHeight + 3;\r\n        }\r\n        backY = textY - textHeight - 3;\r\n\r\n        context.fillStyle = 'white';\r\n        context.globalAlpha = 0.4;\r\n        context.fillRect(backX, backY, textWidth + 6, textHeight + 6);\r\n\r\n        context.fillStyle = \"black\";\r\n        context.globalAlpha = 1;\r\n        context.fillText(this.measurement(), textX, textY);\r\n    }\r\n\r\n    measurement() {\r\n        let dx = this.state.endX - this.state.startX;\r\n        let dy = this.state.endY - this.state.startY;\r\n        let dist = Math.sqrt(dx * dx + dy * dy);\r\n        let message = \"DX=\" + this.format(dx) + \",DY=\" + this.format(dy) + \",D=\" + this.format(dist);\r\n        return message;\r\n    }\r\n\r\n    format(num) {\r\n        return (num / this.props.divisor).toFixed(this.props.decimals);\r\n    }\r\n\r\n    componentDidMount() {\r\n        // let canvas = this.measureCanvas.current;\r\n        this.measureStage = new Stage(this.measureCanvas.current);\r\n        this.measureStage.origin = this.props.stage.origin;\r\n        this.measureStage.resolution = this.props.stage.resolution;\r\n        this.measureStage.zoomFactor = this.props.stage.zoomFactor;\r\n\r\n        this.measureStage.on(\"stagemousedown\", this.handleMouseDown);\r\n        this.measureStage.on(\"stagemousemove\", this.handleMouseMove);\r\n        this.measureStage.on(\"stagemouseup\", this.handleMouseUp);\r\n\r\n        this.measureStage.canvas.addEventListener(\"mousewheel\", this.handleMouseWheel);\r\n        this.measureStage.canvas.addEventListener(\"DOMMouseScroll\", this.handleMouseWheelFox);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.measureStarted) {\r\n            this.draw();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.measureStage.clear();\r\n        this.measureStage.removeAllChildren();\r\n        this.measureStage.removeAllEventListeners();\r\n    }\r\n\r\n    render() {\r\n        let mainCanvas = this.props.stage.canvas;\r\n        let width = mainCanvas.width;\r\n        let height = mainCanvas.height;\r\n        let top = mainCanvas.offsetTop;\r\n        let left = mainCanvas.offsetLeft;\r\n        return (\r\n            <canvas tabIndex=\"1\" ref={this.measureCanvas}\r\n                    width={width}\r\n                    height={height}\r\n                    style={{position: 'absolute', top: top, left: left}}\r\n            >\r\n            </canvas>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({app}) => {\r\n    return {\r\n        stage: app.stage,\r\n        divisor: app.divisor,\r\n        decimals: app.decimals\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        handleMouseWheelMove: (stage, x, y, delta) => dispatch(actions.handleMouseWheelMove(stage, x, y, delta))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MeasurePointsTool);\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Shape, Text} from '@createjs/easeljs';\r\nimport {graphics} from '../models/graphics';\r\n\r\nclass MeasureShapesTool extends Component {\r\n    constructor(params) {\r\n        super();\r\n        this.segment = new Shape();\r\n        params.stage.addChild(this.segment);\r\n\r\n        this.labelShape = new Text();\r\n        this.labelShape.x = 0;\r\n        this.labelShape.y = 0;\r\n        params.stage.addChild(this.labelShape);\r\n\r\n        // var html = document.createElement('div');\r\n        // html.innerText = \"\"; // params.model.label;\r\n        // html.style.position = \"absolute\";\r\n        // html.style.top = 0;\r\n        // html.style.left = 0;\r\n        //\r\n        // document.body.appendChild(html);\r\n        // this.labelShape = new createjs.DOMElement(html);\r\n        // params.stage.addChild(this.labelShape);\r\n    }\r\n\r\n    // redrawLabel() {\r\n    //     if (!this.labelShape) return;\r\n    //\r\n    //     let stage = this.props.stage;\r\n    //\r\n    //     this.labelShape.htmlElement.style.display = \"block\";\r\n    //\r\n    //     let box = this.props.shortestSegment.box;\r\n    //     let point = {x: (box.xmin + box.xmax) / 2, y: (box.ymin + box.ymax) / 2};\r\n    //     let dx = 6. / (stage.zoomFactor * stage.resolution);\r\n    //     let dy = 4. / (stage.zoomFactor * stage.resolution);\r\n    //\r\n    //     this.labelShape.htmlElement.style.font = \"16px Arial\";\r\n    //     this.labelShape.htmlElement.innerText = this.props.shortestSegment.length;\r\n    //\r\n    //     let unscale = 1. / (stage.zoomFactor * stage.resolution);\r\n    //     let tx = stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n    //     let ty = -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n    //     this.labelShape.setTransform(tx, ty, unscale, -unscale);\r\n    // }\r\n\r\n    format(num) {\r\n        return (num/this.props.divisor).toFixed(this.props.decimals);\r\n    }\r\n\r\n    redrawLabel() {\r\n        if (!this.labelShape) return;\r\n\r\n        let stage = this.props.stage;\r\n\r\n        let box = this.props.shortestSegment.box;\r\n        let point = {x: (box.xmin + box.xmax) / 2, y: (box.ymin + box.ymax) / 2};\r\n        let dx = 6. / (stage.zoomFactor * stage.resolution);\r\n        let dy = 4. / (stage.zoomFactor * stage.resolution);\r\n\r\n        if (box.ymin === box.ymax) {\r\n            dx = 0;\r\n            dy = -dy;\r\n        }\r\n\r\n        // this.labelShape.htmlElement.style.display = \"block\";\r\n        // this.labelShape.htmlElement.style.font = \"16px Arial\";\r\n        // this.labelShape.htmlElement.innerText = this.props.shortestSegment.length;\r\n\r\n        this.labelShape.text = this.format(this.props.shortestSegment.length);\r\n\r\n        let fontSize = 14.; // / (stage.zoomFactor * stage.resolution);\r\n        this.labelShape.font = `${fontSize}px Arial`;\r\n\r\n        let unscale = 1. / (stage.zoomFactor * stage.resolution);\r\n        // let tx = stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n        // let ty = -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n        let tx = point.x + dx;\r\n        let ty = point.y + dy;\r\n        this.labelShape.setTransform(tx, ty, unscale, -unscale);\r\n    }\r\n\r\n    draw() {\r\n        if (this.props.shortestSegment) {\r\n            this.segment.graphics = graphics(this.props.shortestSegment);\r\n            this.redrawLabel();\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.draw();\r\n    }\r\n    componentDidUpdate() {\r\n        this.segment.graphics.clear();\r\n        if (this.props.firstMeasuredShape && this.props.secondMeasuredShape &&\r\n            this.props.firstMeasuredLayer.displayed &&\r\n            this.props.secondMeasuredLayer.displayed) {\r\n\r\n            this.draw();\r\n            this.redrawLabel();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.stage.removeChild(this.segment);\r\n        this.segment.graphics.clear();\r\n        this.props.stage.removeChild(this.labelShape);\r\n        this.labelShape.text = \"\";\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport default MeasureShapesTool;","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\nimport React from 'react';\r\nimport {format} from '../models/utils';\r\n\r\nconst DisplayCoordsTool = ({stage, coordX, coordY, divisor, decimals}) => {\r\n    let mainCanvas = stage.canvas;\r\n    let top = mainCanvas.offsetTop + 10;\r\n    let left = mainCanvas.width - 200; //  mainCanvas.offsetLeft + 10;\r\n    let x = stage.C2W_X(coordX);\r\n    let y = stage.C2W_Y(coordY);\r\n    return (\r\n        <div style={{position: 'absolute', top: top, left: left,\r\n            backgroundColor: 'white', opacity:0.8}}>\r\n            <h5 style={{margin: 0, padding: 3}}>\r\n                X: {format(x,divisor,decimals)} Y: {format(y,divisor,decimals)}\r\n            </h5>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default DisplayCoordsTool;\r\n","import {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nconst modalRoot = document.getElementById('modal-root');\r\n\r\n// A Modal component that is an abstraction around the portal API.\r\nclass Modal extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        // Create a div that we'll render the modal into. Because each\r\n        // Modal component has its own element, we can render multiple\r\n        // modal components into the modal container.\r\n        this.el = document.createElement('div');\r\n    }\r\n\r\n    componentDidMount() {\r\n        // Append the element into the DOM on mount. We'll render\r\n        // into the modal container element (see the HTML tab).\r\n        modalRoot.appendChild(this.el);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // Remove the element from the DOM when we unmount\r\n        modalRoot.removeChild(this.el);\r\n    }\r\n\r\n    render() {\r\n        // Use a portal to render the children into the element\r\n        return ReactDOM.createPortal(\r\n            // Any valid React child: JSX, strings, arrays, etc.\r\n            this.props.children,\r\n            // A DOM element\r\n            this.el,\r\n        );\r\n    }\r\n}\r\n\r\nexport default Modal;","import React, {Component} from 'react';\r\nimport Modal from '../Modal';\r\nimport classes from './ModalPopup.module.css';\r\n\r\nclass ModalPopup extends Component {\r\n    offsetX;\r\n    offsetY;\r\n    dragX;\r\n    dragY;\r\n\r\n    onBackDropClicked = (ev) => {\r\n        if (ev.target.id === \"backDrop\") {\r\n            this.props.closePopup();\r\n        }\r\n    };\r\n\r\n    handleKeyDown = (ev) => {\r\n        if (ev.code === \"Escape\") {\r\n            this.props.closePopup();\r\n        }\r\n    };\r\n\r\n    elementDrag = (ev) => {\r\n        ev = ev || window.event;\r\n        // calculate the new cursor position:\r\n        this.offsetX = this.dragX - ev.clientX;\r\n        this.offsetY = this.dragY - ev.clientY;\r\n        this.dragX = ev.clientX;\r\n        this.dragY = ev.clientY;\r\n        // set the element's new position:\r\n        let element = ev.target;\r\n        element.style.top = (element.offsetTop - this.offsetY) + \"px\";\r\n        element.style.left = (element.offsetLeft - this.offsetX) + \"px\";\r\n    };\r\n\r\n    closeDragElement = (ev) => {\r\n        /* stop moving when mouse button is released:*/\r\n        ev.target.onmouseup = null;\r\n        ev.target.onmousemove = null;\r\n    };\r\n\r\n    dragMouseDown = (ev) => {\r\n        ev = ev || window.event;\r\n        // get the mouse cursor position at startup:\r\n        this.dragX = ev.clientX;\r\n        this.dragY = ev.clientY;\r\n        ev.target.onmouseup = this.closeDragElement;\r\n        // call a function whenever the cursor moves:\r\n        ev.target.onmousemove = this.elementDrag;\r\n    };\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('keydown', this.handleKeyDown);\r\n    }\r\n\r\n    render() {\r\n        return this.props.showPopup ? (\r\n            <Modal>\r\n                <div\r\n                    id=\"backDrop\"\r\n                    className={classes.BackDrop}\r\n                    onClick={this.onBackDropClicked}\r\n                >\r\n                    <div className={classes.ModalPopup}\r\n                         onMouseDown={this.dragMouseDown}\r\n                    >\r\n                        <header>{this.props.header}</header>\r\n                        {this.props.children}\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nexport default ModalPopup;\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\n\r\nimport React from 'react';\r\nimport classes from './AboutPopup.module.css';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\n\r\nconst AboutPopup = (props) => {\r\n    return (\r\n        <ModalPopup\r\n            showPopup={props.showAboutPopup}\r\n            closePopup={props.toggleAboutPopup}\r\n            header=\"Info\"\r\n        >\r\n            <div className={classes.AboutPopup}>\r\n                <h2>{props.title} v{props.version}</h2>\r\n\r\n                <label>{`Build date: `}</label>\r\n                <span>April 2019</span>\r\n                <br/>\r\n\r\n                <label>{`Github depository: `}</label>\r\n                <a href=\"https://github.com/alexbol99/debug-viewer1\" >\r\n                    https://github.com/alexbol99/debug-viewer1\r\n                </a>\r\n                <br/>\r\n\r\n                <label>{`3d party graphics library: `}</label>\r\n                <a href=\"https://github.com/CreateJS/EaselJS/tree/2.0\" >\r\n                    https://github.com/CreateJS/EaselJS/tree/2.0\r\n                </a>\r\n                <br/>\r\n\r\n            </div>\r\n        </ModalPopup>\r\n\r\n    )\r\n};\r\n\r\nexport default AboutPopup;\r\n","import {Point, Segment, Arc, Circle, Box, Polygon} from \"@flatten-js/core\";\r\nimport {CW, ORIENTATION} from \"@flatten-js/core\";\r\n\r\nimport XMLWriter from \"xml-writer\";\r\n\r\nfunction pointToXMLString(xw, shape) {\r\n    xw.startElement('point');\r\n        xw.writeAttribute('x', shape.geom.x);\r\n        xw.writeAttribute('y', shape.geom.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction segmentToXMLString(xw, shape) {\r\n    xw.startElement('segment');\r\n        xw.writeAttribute('xs', shape.geom.ps.x);\r\n        xw.writeAttribute('ys', shape.geom.ps.y);\r\n        xw.writeAttribute('xe', shape.geom.pe.x);\r\n        xw.writeAttribute('ye', shape.geom.pe.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction arcToXMLString(xw, shape) {\r\n    xw.startElement('arc');\r\n        xw.writeAttribute('xs', Math.round(shape.geom.start.x));\r\n        xw.writeAttribute('ys', Math.round(shape.geom.start.y));\r\n        xw.writeAttribute('xe', Math.round(shape.geom.end.x));\r\n        xw.writeAttribute('ye', Math.round(shape.geom.end.y));\r\n        xw.writeAttribute('xc', shape.geom.center.x);\r\n        xw.writeAttribute('yc', shape.geom.center.y);\r\n        xw.writeAttribute('cw', shape.geom.counterClockwise === CW ? \"yes\" : \"no\");\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction circleToXMLString(xw, shape) {\r\n    xw.startElement('circle');\r\n        xw.writeAttribute('xc', shape.geom.center.x);\r\n        xw.writeAttribute('yc', shape.geom.center.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction boxToXMLString(xw, shape) {\r\n\r\n}\r\n\r\nfunction polygonToXMlString(xw, polygon) {\r\n    xw.startElement('profile');\r\n\r\n    for (let face of polygon.faces) {\r\n        if (face.orientation() === ORIENTATION.CW) {\r\n            xw.startElement('island');\r\n        }\r\n        else {\r\n            xw.startElement('hole');\r\n        }\r\n\r\n        xw.writeAttribute('n_edges', `${face.size}`);\r\n\r\n        for (let edge of face) {\r\n            xw.startElement('edge');\r\n            let shape = edge.shape;\r\n            if (shape instanceof Segment) {\r\n                xw.writeAttribute('type', 'segment');\r\n                xw.writeAttribute('xs', shape.ps.x);\r\n                xw.writeAttribute('ys', shape.ps.y);\r\n                xw.writeAttribute('xe', shape.pe.x);\r\n                xw.writeAttribute('ye', shape.pe.y);\r\n            } else if (edge.shape instanceof Arc) {\r\n                xw.writeAttribute('type', 'curve');\r\n                xw.writeAttribute('xs', Math.round(shape.start.x));\r\n                xw.writeAttribute('ys', Math.round(shape.start.y));\r\n                xw.writeAttribute('xe', Math.round(shape.end.x));\r\n                xw.writeAttribute('ye', Math.round(shape.end.y));\r\n                xw.writeAttribute('xc', shape.center.x);\r\n                xw.writeAttribute('yc', shape.center.y);\r\n                xw.writeAttribute('cw', shape.counterClockwise === CW ? \"yes\" : \"no\");\r\n            } else {\r\n                xw.writeAttribute('type', 'unknown');\r\n            }\r\n            xw.endElement();\r\n        }\r\n\r\n        xw.endElement();  // island or hole\r\n    }\r\n\r\n    xw.endElement();     // profile\r\n}\r\n\r\nexport function createXMLString(shapes) {\r\n    let xw = new XMLWriter(true);\r\n    xw.startDocument('1.0', 'UTF-8');\r\n\r\n    xw.startElement('shapes');\r\n    xw.startElement('title').text('test polygon in xml format').endElement();\r\n\r\n    for (let shape of shapes) {\r\n        if (shape.geom instanceof Point) {\r\n            pointToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Segment) {\r\n            segmentToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Arc) {\r\n            arcToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Circle) {\r\n            circleToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Box) {\r\n            boxToXMLString(xw, shape)\r\n        }\r\n        else if (shape.geom instanceof Polygon) {\r\n            polygonToXMlString(xw, shape.geom);\r\n        }\r\n    }\r\n\r\n    xw.endDocument();\r\n    return xw.toString();\r\n}\r\n\r\n","import React, {Component} from 'react';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\nimport {createXMLString} from \"../../dataParsers/createXML\";\r\n\r\nimport classes from \"./DownloadPopup.module.css\";\r\n\r\nclass DownloadPopup extends Component {\r\n    render() {\r\n        let downloadData = this.props.showPopup ?\r\n            this.props.layers.map( layer => {\r\n            return layer.displayed ? {\r\n                filename: `${layer.name}.xml`,\r\n                xmlString: createXMLString(layer.shapes)\r\n            } : null\r\n        }) : [];\r\n        return this.props.showPopup && this.props.layers.length > 0 ? (\r\n            <ModalPopup\r\n                showPopup={this.props.showPopup}\r\n                closePopup={this.props.closePopup}\r\n                header=\"Download files\"\r\n            >\r\n                <div className={classes.DownloadPopup}>\r\n                    <h5>Click to the following links to start download</h5>\r\n                    <ul>\r\n\r\n                        {downloadData.map(data =>\r\n                            data === null ? null :\r\n                            <li key={data.filename}>\r\n                                <a href={'data:text/json;charset=utf-8,' + encodeURIComponent(data.xmlString)}\r\n                                   download={data.filename}>\r\n                                    {data.filename}\r\n                                </a>\r\n                            </li>\r\n                        )}\r\n\r\n                    </ul>\r\n                </div>\r\n            </ModalPopup>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nexport default DownloadPopup;\r\n","import {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nconst snackbarRoot = document.getElementById('snackbar-root');\r\n\r\nclass SnackbarRoot extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.el = document.createElement('div');\r\n    }\r\n\r\n    componentDidMount() {\r\n        snackbarRoot.appendChild(this.el);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        snackbarRoot.removeChild(this.el);\r\n    }\r\n\r\n    render() {\r\n        return ReactDOM.createPortal(\r\n            // Any valid React child: JSX, strings, arrays, etc.\r\n            this.props.children,\r\n            // A DOM element\r\n            this.el,\r\n        );\r\n    }\r\n}\r\n\r\nexport default SnackbarRoot;","import React,{Component} from 'react';\r\nimport SnackbarRoot from '../SnackbarRoot';\r\nimport classes from './Snackbar.module.css';\r\n\r\nclass Snackbar extends Component {\r\n    state = {\r\n        display: true\r\n    };\r\n\r\n    animationEndHandler() {\r\n        this.setState({\r\n            display: false\r\n        });\r\n        this.props.onAnimationEnd();\r\n    }\r\n\r\n    render() {\r\n        return ( this.state.display ?\r\n            <SnackbarRoot>\r\n                <div className={classes.Snackbar} onAnimationEnd={this.props.onAnimationEnd}>\r\n                    <h3>{this.props.message}</h3>\r\n                </div>\r\n            </SnackbarRoot> : null\r\n        )\r\n    }\r\n}\r\n\r\nexport default Snackbar;","import { Job } from '../models/job';\r\nimport {Point, Segment, Arc, Polygon, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\n\r\nFlatten.Image = class Image {\r\n    constructor() {\r\n        this.uri = \"\";\r\n        /**\r\n         * Center in world coordinates\r\n         * @type {Flatten.Point}\r\n         */\r\n        this.center = new Flatten.Point();\r\n        /**\r\n         * Width in world units (inch/mm)\r\n         */\r\n        this.width = 0;\r\n        /**\r\n         * Height in world units (inch/mm)\r\n         */\r\n        this.height = 0;\r\n    }\r\n    get box() {\r\n        return new Flatten.Box(\r\n            this.center.x - this.width/2,\r\n            this.center.y - this.height/2,\r\n            this.center.x + this.height/2,\r\n            this.center.y + this.height/2\r\n        );\r\n\r\n    }\r\n};\r\n\r\nfunction parseEdges(edgesXML) {\r\n    let edges = [];\r\n\r\n    for (let edge of Array.from(edgesXML)) {\r\n        let type = edge.getAttribute('type');\r\n\r\n        if (type === \"segment\") {\r\n            let ps = new Point(parseInt(edge.getAttribute('xs'),10), parseInt(edge.getAttribute('ys'),10));\r\n            let pe = new Point(parseInt(edge.getAttribute('xe'),10), parseInt(edge.getAttribute('ye'),10));\r\n\r\n            edges.push(new Segment(ps, pe));\r\n        }\r\n\r\n        if (type === \"curve\") {\r\n            let ps = new Point(parseInt(edge.getAttribute('xs'),10), parseInt(edge.getAttribute('ys'),10));\r\n            let pe = new Point(parseInt(edge.getAttribute('xe'),10), parseInt(edge.getAttribute('ye'),10));\r\n            let pc = new Point(parseInt(edge.getAttribute('xc'),10), parseInt(edge.getAttribute('yc'),10));\r\n\r\n            let counterClockwise = edge.getAttribute('cw') === 'no' ? true : false;\r\n\r\n            let startAngle = vector(pc,ps).slope;\r\n            let endAngle = vector(pc, pe).slope;\r\n\r\n            if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n                endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n            }\r\n\r\n            let r = vector(pc, ps).length;\r\n\r\n            edges.push(new Arc(pc, r, startAngle, endAngle, counterClockwise));\r\n        }\r\n    }\r\n\r\n    return edges;\r\n}\r\n\r\nfunction parsePolygon(polygonsXML) {\r\n    let polygon = new Polygon();\r\n\r\n    // let nedges = parseInt(profile.getAttribute(\"n_edges\"), 10);\r\n\r\n    // Augment Flatten object with style\r\n    let color = polygonsXML.getAttribute(\"color\");\r\n    polygon.style = {\r\n        stroke: color || undefined,\r\n        fill: color || undefined,\r\n        alpha: 1.0\r\n    };\r\n\r\n    // Augment Flatten object with label\r\n    let label = polygonsXML.getAttribute(\"label\");\r\n    polygon.label = label;\r\n\r\n    // Add islands\r\n    let islands = polygonsXML.getElementsByTagName('island');\r\n    for (let island of Array.from(islands)) {\r\n        let edgesXML = island.getElementsByTagName('edge');\r\n        polygon.addFace(parseEdges(edgesXML));\r\n    }\r\n\r\n    // Add holes\r\n    let holes = polygonsXML.getElementsByTagName('hole');\r\n    for (let hole of Array.from(holes)) {\r\n        let edgesXML = hole.getElementsByTagName('edge');\r\n        polygon.addFace(parseEdges(edgesXML));\r\n    }\r\n\r\n    return polygon;\r\n}\r\n\r\nfunction parseSegment(segmentXML) {\r\n    let ps = new Point(parseInt(segmentXML.getAttribute('xs'),10), parseInt(segmentXML.getAttribute('ys'),10));\r\n    let pe = new Point(parseInt(segmentXML.getAttribute('xe'),10), parseInt(segmentXML.getAttribute('ye'),10));\r\n\r\n    let segment = new Segment(ps, pe);\r\n\r\n    // Augment Flatten object with label property\r\n    let label = segmentXML.getAttribute(\"label\");\r\n    segment.label = label;\r\n\r\n    return segment;\r\n}\r\n\r\nfunction parseCurve(curveXML) {\r\n    let ps = new Point(parseInt(curveXML.getAttribute('xs'),10), parseInt(curveXML.getAttribute('ys'),10));\r\n    let pe = new Point(parseInt(curveXML.getAttribute('xe'),10), parseInt(curveXML.getAttribute('ye'),10));\r\n    let pc = new Point(parseInt(curveXML.getAttribute('xc'),10), parseInt(curveXML.getAttribute('yc'),10));\r\n\r\n    let counterClockwise = curveXML.getAttribute('cw') === 'no' ? true : false;\r\n\r\n    let startAngle = vector(pc,ps).slope;\r\n    let endAngle = vector(pc, pe).slope;\r\n\r\n    if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n        endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n    }\r\n\r\n    let r = vector(pc, ps).length;\r\n\r\n    let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n    // Augment Flatten object with label property\r\n    let label = curveXML.getAttribute(\"label\");\r\n    arc.label = label;\r\n\r\n    return arc;\r\n}\r\n\r\nfunction parsePoint(pointXML) {\r\n    let point = new Point(parseInt(pointXML.getAttribute('x'),10), parseInt(pointXML.getAttribute('y'),10));\r\n\r\n    // Augment Flatten object with label property\r\n    let label = pointXML.getAttribute(\"label\");\r\n    point.label = label;\r\n\r\n    return point;\r\n}\r\n\r\nfunction parseImage(imageXML) {\r\n    let img = new Flatten.Image();\r\n    img.center = new Point(parseInt(imageXML.getAttribute('xc'),10), parseInt(imageXML.getAttribute('yc'),10));\r\n    img.width = parseInt(imageXML.getAttribute('width'),10);\r\n    img.height = parseInt(imageXML.getAttribute('height'),10);\r\n    img.uri = imageXML.getAttribute('uri');\r\n    return img;\r\n}\r\n\r\nexport function parseXML(filename, str) {\r\n    let job = new Job();\r\n\r\n    job.filename = filename;\r\n\r\n    let parser = new DOMParser();\r\n    let xmlDoc = parser.parseFromString(str, \"text/xml\");\r\n\r\n    // Parse document title\r\n    let titles = xmlDoc.getElementsByTagName('title');\r\n    if (titles && titles.length > 0) {\r\n        job.title = titles[0].firstChild.nodeValue;          // take the first title if more than one\r\n    }\r\n\r\n    // Parse profiles and add polygons to the job\r\n    let profilesXML = xmlDoc.getElementsByTagName('profile');\r\n    for (let profileXML of Array.from(profilesXML)) {\r\n        let polygon = parsePolygon(profileXML);\r\n        job.profiles.push(polygon);\r\n    }\r\n\r\n    // Parse materials and add polygons to the job\r\n    let materialXML = xmlDoc.getElementsByTagName('material');\r\n    for (let shapeXML of Array.from(materialXML)) {\r\n        let polygon = parsePolygon(shapeXML);\r\n        job.materials.push(polygon);\r\n    }\r\n\r\n    // Parse segments\r\n    let segmentsXML = xmlDoc.getElementsByTagName('segment');\r\n    for (let segmentXML of Array.from(segmentsXML)) {\r\n        let segment = parseSegment(segmentXML);\r\n        job.shapes.push(segment);\r\n    }\r\n\r\n    // Parse segments\r\n    let curvesXML = xmlDoc.getElementsByTagName('curve');\r\n    for (let curveXML of Array.from(curvesXML)) {\r\n        let curve = parseCurve(curveXML);\r\n        job.shapes.push(curve);\r\n    }\r\n\r\n    // Parse points\r\n    let pointsXML = xmlDoc.getElementsByTagName('point');\r\n    for (let pointXML of Array.from(pointsXML)) {\r\n        let point = parsePoint(pointXML);\r\n        job.shapes.push(point);\r\n    }\r\n\r\n    // Parse images\r\n    let imagesXML = xmlDoc.getElementsByTagName('picture');\r\n    for (let imageXML of Array.from(imagesXML)) {\r\n        let image = parseImage(imageXML);\r\n        job.shapes.push(image);\r\n    }\r\n\r\n    return job;\r\n}\r\n","import { Job } from '../models/job';\r\nimport {Point, Segment, Arc, Polygon, Utils, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\n\r\nconst inch2pixels = 10160000;\r\nconst mils2pixels = 10160;\r\nfunction InchToPixels(str) {\r\n    return Math.round(Number(str)*inch2pixels,0);\r\n}\r\nfunction MilsToPixels(str) {\r\n    return Math.round(Number(str)*mils2pixels,0);\r\n}\r\n\r\nfunction parsePolygon(lines, start) {\r\n    let shapes = [];\r\n    let i = start;\r\n    let line = lines[i];\r\n    let terms = line.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe;\r\n    let pc;\r\n    let end_of_face = false;\r\n    while(true) {\r\n        line = lines[i];\r\n        terms = line.split(' ');\r\n        switch (terms[0]) {\r\n            case 'OS':\r\n                pe = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n                shapes.push( new Segment(ps, pe));\r\n\r\n                ps = pe.clone();\r\n                break;\r\n            case 'OC':\r\n                pe = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n                pc = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n\r\n                let cwStr = terms[5];\r\n                let counterClockwise = cwStr === 'Y' ? Flatten.CW : Flatten.CCW; /* sic ! */\r\n\r\n                let startAngle = vector(pc,ps).slope;\r\n                let endAngle = vector(pc, pe).slope;\r\n                if (Utils.EQ(startAngle, endAngle)) {\r\n                    endAngle += 2*Math.PI;\r\n                    counterClockwise = true;\r\n                }\r\n                let r = vector(pc, ps).length;\r\n\r\n                shapes.push(new Arc(pc, r, startAngle, endAngle, counterClockwise));\r\n\r\n                ps = pe.clone();\r\n                break;\r\n            case 'OE':\r\n                end_of_face = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (end_of_face) {\r\n            break;\r\n        }\r\n\r\n        i++;\r\n    }\r\n    return shapes;\r\n}\r\n\r\nfunction parseLine(str, apertures) {\r\n    let terms = str.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n    let segment = new Segment(ps, pe);\r\n    let ap_key = Number(terms[5]);\r\n    let ap_value = apertures[ap_key];\r\n    segment.aperture = ap_value;     // augmentation\r\n    return segment;\r\n}\r\n\r\nfunction parseArc(str, apertures) {\r\n    let terms = str.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n    let pc = new Point( InchToPixels(terms[5]), InchToPixels(terms[6]) );\r\n\r\n    let cwStr = terms[10];\r\n    let counterClockwise = cwStr === 'Y' ? Flatten.CW : Flatten.CCW; /* sic ! */\r\n\r\n    let startAngle = vector(pc,ps).slope;\r\n    let endAngle = vector(pc, pe).slope;\r\n    if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(pc, ps).length;\r\n\r\n    let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n    let ap_key = Number(terms[7]);\r\n    let ap_value = apertures[ap_key];\r\n    arc.aperture = ap_value;     // augmentation\r\n\r\n    return arc;\r\n}\r\n\r\nexport function parseODB(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n    let polygon;\r\n\r\n    let apertures = [];\r\n\r\n    for (let i=0; i < arrayOfLines.length; i++) {\r\n        let line = arrayOfLines[i];\r\n        let terms = line.split(' ');\r\n\r\n        if (terms[0].substr(0,1) === '$') {\r\n            let ap_key = Number(terms[0].substr(1));\r\n            let ap_value = MilsToPixels(terms[1].substr(1));\r\n            apertures[ap_key] = ap_value;\r\n            continue;\r\n        }\r\n\r\n        switch (terms[0]) {\r\n            case 'S':                  // surface started\r\n                polygon = new Polygon();\r\n                let termArr = line.split(' ');\r\n                let polarity = termArr[1];      // consider later\r\n                polygon.polarity = polarity;\r\n                break;\r\n            case 'OB':                  // polygon started\r\n                let start = i;\r\n                let shapes = parsePolygon(arrayOfLines, start);\r\n                polygon.addFace(shapes);\r\n                i = start + shapes.length + 1;\r\n                break;\r\n            case 'SE':     // surface ended\r\n                job.shapes.push(polygon);\r\n                break;\r\n            case 'L':                  // line\r\n                let odbLine = parseLine(line, apertures);\r\n                job.shapes.push(odbLine);\r\n                break;\r\n            case 'A':                  // Arc\r\n                let odbArc = parseArc(line, apertures);\r\n                job.shapes.push(odbArc);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    return job;\r\n}","import {Point,Box} from '@flatten-js/core';\r\n\r\nconst pgmResolution = 25.500025;\r\nconst microns2pixels = 400;\r\n// const inch2pixels = 10160;\r\n// const offsetX = 12.322830;\r\n// const offsetY = 8.326776;\r\nconst sizeX = 3.0303;\r\n\r\nfunction toPixels(str) {\r\n    let num = Number(str);\r\n    return Math.round(num*pgmResolution*microns2pixels,0);\r\n}\r\n\r\nexport function parseImage(file) {\r\n    let image = {};          // TODO: to be Flatten.Image\r\n\r\n    let terms = file.name.split('_');\r\n    let yStr = terms[0].substr(1);\r\n    let xStr = terms[1] ? terms[1].substr(1) : undefined;\r\n\r\n    let x = isNaN(xStr) ? 0 : toPixels(xStr) + 90000;\r\n    let y = isNaN(yStr) ? 0 : toPixels(yStr) - 40000;\r\n\r\n    image.center = new Point(x,y);\r\n    image.width = sizeX*microns2pixels*1000;    // 2 mm\r\n    image.box = new Box(\r\n        image.center.x - image.width/2,\r\n        image.center.y - image.width/2,\r\n        image.center.x + image.width/2,\r\n        image.center.y + image.width/2,\r\n    );\r\n\r\n    return image;\r\n}","import { Job } from '../models/job';\r\nimport {point} from '@flatten-js/core';\r\n\r\nconst micron2pixels = 400;\r\nfunction micronToPixels(str) {\r\n    return Math.round(Number(str)*micron2pixels,0);\r\n}\r\n\r\nexport function parseCSV(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n\r\n    for (let i = 0; i < arrayOfLines.length; i++) {\r\n        let line = arrayOfLines[i];\r\n        let terms = line.split(',');\r\n\r\n        let px = micronToPixels(terms[0]);\r\n        let py = micronToPixels(terms[1]);\r\n        let nx = Number(terms[2]);\r\n        let ny = Number(terms[3]);\r\n        let shape = point(px,py);\r\n        shape.nx = nx;\r\n        shape.ny = ny;\r\n        job.shapes.push(shape)\r\n    }\r\n\r\n    return job\r\n}","import { Job } from '../models/job';\r\nimport {Parser} from './parser';\r\n\r\nexport function parseTXT(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let parser = new Parser();\r\n\r\n    let shapesArray = parser.parse(str);\r\n\r\n    if (shapesArray.length > 0) {\r\n        for (let shape of shapesArray) {\r\n            job.shapes.push(shape)\r\n        }\r\n    }\r\n\r\n    return job\r\n}","import * as ActionTypes from \"../actionTypes\";\r\nimport * as appActions from \"../actions/appActions\";\r\nimport Layers from '../../models/layers';\r\nimport Model from \"../../models/model\";\r\nimport { parseXML } from '../../dataParsers/parserXML';\r\nimport { parseODB } from \"../../dataParsers/parserODB\";\r\nimport { parseImage } from \"../../dataParsers/parsePGM\";\r\nimport { parseCSV } from \"../../dataParsers/parseCSV\";\r\nimport { parseTXT } from \"../../dataParsers/parseTXT\";\r\nimport { parseJSON} from \"../../dataParsers/parseJSON\";\r\n\r\n// Closure to capture file information and parameters\r\nconst readAsText = (reader, file, stage, layers, dispatch, files) => {\r\n\r\n    let promise = new Promise( (resolve, reject) => {\r\n        reader.onload = (function(theFile, stage, layers, dispatch, files, resolve, reject) {\r\n            return (event) => {\r\n                let string = event.target.result;\r\n\r\n                let namesplitted = theFile.name.split('.');\r\n                let extension = namesplitted[namesplitted.length-1];\r\n                let job;\r\n                if (extension === 'xml') {\r\n                    job = parseXML(theFile.name, string);\r\n                }\r\n                else if (extension === 'csv') {\r\n                    job = parseCSV(theFile.name, string);\r\n                }\r\n                else if (extension === 'txt') {\r\n                    job = parseTXT(theFile.name, string);\r\n                }\r\n                else if (extension === 'json') {\r\n                    job = parseJSON(theFile.name, string);\r\n                }\r\n                else {\r\n                    job = parseODB(theFile.name, string);\r\n                }\r\n                let layer = Layers.newLayer(stage, layers);\r\n                if (theFile.name !== \"\") {\r\n                    layer.name = theFile.name;\r\n                }\r\n                layer.title = job.title;\r\n\r\n                for (let polygon of job.profiles) {\r\n                    if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n                        // let watch = undefined; //  parser.parseToWatchArray(string);\r\n                        // let shape = new Shape(polygon, stage, polygon.style, watch);\r\n                        let shape = new Model(polygon, undefined, polygon.label);\r\n\r\n                        layer.add(shape);\r\n                    }\r\n                }\r\n\r\n                for (let polygon of job.materials) {\r\n                    if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n                        // let watch = undefined; //  parser.parseToWatchArray(string);\r\n                        // let shape = new Shape(polygon, stage, polygon.style, watch);\r\n                        let shape = new Model(polygon, undefined, polygon.label);\r\n\r\n                        layer.add(shape);\r\n                    }\r\n                }\r\n\r\n                for (let shape of job.shapes) {\r\n                    let model = new Model(shape, undefined, shape.label);\r\n                    layer.add(model);\r\n                }\r\n\r\n                // layers.push(layer);\r\n\r\n                if (theFile === files[0]) {\r\n                    Layers.setAffected(layers, layer);\r\n                    layer.color = Layers.getNextColor(layers);\r\n                    layer.displayed = true;\r\n                    dispatch({\r\n                        type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                        stage: stage,\r\n                        shape: layer\r\n                    });\r\n                }\r\n                dispatch({\r\n                    type: ActionTypes.ADD_NEW_LAYER,\r\n                    layer: layer\r\n                });\r\n\r\n                dispatch({\r\n                    type: ActionTypes.ASYNC_OPERATION_ENDED\r\n                });\r\n\r\n                resolve(true);\r\n            }\r\n        })(file, stage, layers, dispatch, files, resolve, reject);\r\n\r\n        reader.readAsText(file);\r\n    });\r\n\r\n\r\n    dispatch({\r\n        type: ActionTypes.ASYNC_OPERATION_STARTED\r\n    });\r\n\r\n    return promise\r\n};\r\n\r\nconst readAsImage = (reader, file, stage, layers, dispatch, files) => {\r\n    let promise = new Promise( (resolve, reject) => {\r\n        reader.addEventListener(\"load\", function () {\r\n            // let image = {};          // TODO: to be Flatten.Image\r\n            // image.uri = this.result;\r\n            // image.center = new Flatten.Point(0,0);\r\n            // image.width = 2*400000;    // 2 micron\r\n            // image.box = new Flatten.Box(\r\n            //     image.center.x - image.width/2,\r\n            //     image.center.y - image.width/2,\r\n            //     image.center.x + image.width/2,\r\n            //     image.center.y + image.width/2,\r\n            // );\r\n\r\n            let image = parseImage(file);\r\n            image.uri = this.result;\r\n\r\n            let model = new Model(image);\r\n\r\n            let layer = Layers.newLayer(stage, layers);\r\n            if (file.name !== \"\") {\r\n                layer.name = file.name;\r\n            }\r\n\r\n            layer.add(model);\r\n\r\n            // layers.push(layer);\r\n\r\n            if (file === files[0]) {\r\n                Layers.setAffected(layers, layer);\r\n                layer.color = Layers.getNextColor(layers);\r\n                layer.displayed = true;\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    stage: stage,\r\n                    shape: layer\r\n                });\r\n            }\r\n\r\n            dispatch({\r\n                type: ActionTypes.ADD_NEW_LAYER,\r\n                layer: layer\r\n            });\r\n\r\n            dispatch({\r\n                type: ActionTypes.ASYNC_OPERATION_ENDED\r\n            });\r\n\r\n            resolve(true);\r\n        }, false);\r\n\r\n        reader.readAsDataURL(file);\r\n    });\r\n\r\n    return promise;\r\n};\r\n\r\nconst readFile = (file, stage, layers, dispatch, files) => {\r\n    if (file.type !== \"\" &&\r\n        !(file.type.match('text.*') || file.type.match('application.*') ||\r\n            file.type.match('image.*')) ) return;   // validate type is text\r\n\r\n    let reader = new FileReader();\r\n\r\n    if (file.type.match('text.*') || file.type.match('application.*') || file.name.match('features*')) {\r\n        return readAsText(reader, file, stage, layers, dispatch, files);\r\n    }\r\n\r\n    else if (file.type.match('image.*')) {\r\n        return readAsImage(reader, file, stage, layers, dispatch, files);\r\n    }\r\n\r\n    return Promise.reject(\"not supported file\");\r\n};\r\n\r\nexport const readFiles = (files, stage, layers) => {\r\n    return (dispatch) => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n\r\n        // Load and parse files\r\n        // in MS Edge FilesList is not array. It is indexable but not iterable\r\n        // for (let i=0; i < action.files.length; i++) {\r\n        //     readFile(action.files[i], stage, layers, dispatch, action.files);\r\n        // }\r\n        let promises = [];\r\n        for (let file of Array.from(files)) {\r\n            let promise = readFile(file, stage, layers, dispatch, files);\r\n            promises.push(promise);\r\n        }\r\n\r\n        return Promise.all(promises)\r\n            .then( (values) => {\r\n                dispatch(filesUploadCompleted(values));\r\n            })\r\n\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const filesUploadCompleted = (values) => {\r\n    return {\r\n        type: ActionTypes.FILES_UPLOAD_COMPLETED,\r\n        uploadedFiles: values\r\n    }\r\n};\r\n\r\nexport const initUploadState = () => {\r\n    return {\r\n        type: ActionTypes.INITIALIZE_UPLOAD_STATE\r\n    }\r\n};\r\n\r\nexport default readFiles;\r\n\r\n","import React, {Component} from 'react';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\nimport Snackbar from \"../UI/Snackbar/Snackbar\";\r\nimport { connect } from 'react-redux';\r\nimport classes from \"./UploadPopup.module.css\";\r\nimport * as actions from '../../store/actions/upload';\r\n\r\nclass UploadPopup extends Component {\r\n    inputElement = React.createRef();\r\n    clipboardWindowRef = React.createRef();\r\n\r\n    clipboardWindowWidth = 0;\r\n    clipboardWindowHeight = 0;\r\n\r\n    state = {\r\n        dragOver:false,\r\n        clipboardData: \"\"\r\n    };\r\n\r\n    openFilesButtonClicked = () => this.inputElement.current.click();\r\n\r\n    pasteHandler = (ev) => {\r\n        ev.stopPropagation();\r\n        this.props.onPaste(ev.clipboardData);\r\n        let item = ev.clipboardData.items[0];\r\n        item.getAsString( string =>\r\n            this.setState({\r\n                clipboardData: string\r\n            })\r\n        );\r\n    };\r\n\r\n    dropHandler = (ev) => {\r\n        // Prevent default behavior (Prevent file from being opened)\r\n        ev.preventDefault();\r\n\r\n        let files = [];\r\n\r\n        if (ev.dataTransfer.items) {\r\n            // Use DataTransferItemList interface to access the file(s)\r\n            for (let i = 0; i < ev.dataTransfer.items.length; i++) {\r\n                // If dropped items aren't files, reject them\r\n                if (ev.dataTransfer.items[i].kind === 'file') {\r\n                    let file = ev.dataTransfer.items[i].getAsFile();\r\n                    files.push(file);\r\n                }\r\n            }\r\n        } else {\r\n            // Use DataTransfer interface to access the file(s)\r\n            files = ev.dataTransfer.files;\r\n        }\r\n\r\n        this.props.readFiles(files, this.props.stage, this.props.layers);\r\n        // this.fileDropHandler(files);\r\n        this.setState({dragOver:false});\r\n    };\r\n\r\n    dragOverHandler = (ev) => {\r\n        // Prevent default behavior (Prevent file from being opened)\r\n        ev.preventDefault();\r\n        this.setState({dragOver:true})\r\n    };\r\n\r\n    dragLeaveHandler = (ev) => {\r\n        ev.preventDefault();\r\n        this.setState({dragOver:false})\r\n    };\r\n\r\n    filesSelectedHandler = (event) => {\r\n        if (!(File && FileReader && FileList)) return;\r\n        let files = event.target.files; // FileList object\r\n        this.props.readFiles(files, this.props.stage, this.props.layers);\r\n    };\r\n\r\n    closePopup = () => {\r\n        this.props.initUploadState();\r\n        this.props.closePopup();\r\n    };\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.uploadCompleted) {}\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.clipboardWindowWidth = this.clipboardWindowRef.current.clientWidth;\r\n        this.clipboardWindowHeight = this.clipboardWindowRef.current.clientHeight;\r\n    }\r\n\r\n    render() {\r\n        let pX = this.state.clipboardData === \"\" ? 30 : 0;\r\n        let pY = this.state.clipboardData === \"\" ? 60 : 0;\r\n        let snackbarMessage = \"\";\r\n\r\n        if (this.state.clipboardData !== \"\") snackbarMessage = \"Added 1 layer\";\r\n\r\n        if (this.props.uploadCompleted && this.props.uploadedFiles.length > 0) {\r\n            let newFilesNum = this.props.uploadedFiles.length;\r\n            if (newFilesNum === 1) snackbarMessage = \"File uploaded. Added 1 layer\";\r\n            if (newFilesNum > 1) snackbarMessage = `Files uploaded. Added ${newFilesNum} layers`;\r\n        }\r\n\r\n        return this.props.showPopup ? (\r\n            <ModalPopup\r\n                showPopup={this.props.showPopup}\r\n                closePopup={this.closePopup}\r\n                header=\"Upload files\"\r\n            >\r\n                <div className={classes.UploadPopup}>\r\n                    <div className={this.state.dragOver ?\r\n                        `${classes.UploadTarget} ${classes.UploadTargetDragOver}` :\r\n                        `${classes.UploadTarget} ${classes.UploadTargetDragLeave}`}\r\n                         style={{paddingLeft: pX, paddingRight: pX, paddingTop: pY, paddingBottom: pY}}\r\n                         onPaste={this.pasteHandler}\r\n                         onDrop={this.dropHandler}\r\n                         onDragOverCapture={this.dragOverHandler}\r\n                         onDragLeaveCapture={this.dragLeaveHandler}\r\n                         ref={this.clipboardWindowRef}\r\n                    >\r\n                        {\r\n                            this.state.clipboardData === \"\" ?\r\n                                <span>Paste from buffer / Drop files</span> :\r\n                                <p style={{width:this.clipboardWindowWidth, height:this.clipboardWindowHeight}}>\r\n                                    {this.state.clipboardData}\r\n                                </p>\r\n                        }\r\n\r\n                    </div>\r\n\r\n                    <h2>or</h2>\r\n\r\n                    <button onClick={this.openFilesButtonClicked}>\r\n                        Open local files\r\n                    </button>\r\n\r\n                    <input style={{display: \"none\"}}\r\n                           type=\"file\" ref={this.inputElement} name=\"files[]\" multiple\r\n                           onChange={this.filesSelectedHandler}\r\n                    />\r\n\r\n                    { snackbarMessage !== \"\" ?\r\n                        <Snackbar\r\n                            onAnimationEnd = {this.props.initUploadState}\r\n                            message={snackbarMessage} /> : null\r\n                    }\r\n\r\n                </div>\r\n            </ModalPopup>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        uploadCompleted: state.upload.uploadCompleted,\r\n        uploadedFiles: state.upload.uploadedFiles\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        readFiles: (files, stage, layers) => dispatch(actions.readFiles(files, stage, layers)),\r\n        initUploadState: () => dispatch(actions.initUploadState())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UploadPopup);\r\n","import /*React,*/ {Component} from 'react';\r\nimport { connect } from 'react-redux';\r\nimport * as cloudActions from '../../store/actions/cloudStorageActions';\r\n\r\nclass CloudDocument extends Component {\r\n    state={\r\n        done:false\r\n    };\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            this.props.fetchDocumentFromDatabase(this.props.stage, this.props.match.params.id);\r\n            this.setState({done:true});\r\n        }\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({app}) => {\r\n    return {\r\n        stage: app.stage,\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        fetchDocumentFromDatabase: (stage, id) => dispatch(cloudActions.fetchDocumentFromDatabase(stage, id)),\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CloudDocument);\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport {Route} from 'react-router-dom';\r\nimport { connect } from \"react-redux\";\r\n\r\nimport ToolbarComponent from '../../components/MainComponent/ToolbarComponent/ToolbarComponent';\r\nimport CanvasComponent from '../../components/MainComponent/CanvasComponent/CanvasComponent';\r\nimport StatusComponent from '../../components/Layout/StatusComponent/StatusComponent';\r\n\r\nimport StageComponent from \"../../components/MainComponent/GraphicsComponent/stageComponent\";\r\nimport LayersComponent from '../../components/MainComponent/GraphicsComponent/layersComponent';\r\n\r\nimport * as actions from '../../store/actions/appActions';\r\nimport * as layerActions from \"../../store/actions/layersActions\";\r\nimport * as cloudActions from '../../store/actions/cloudStorageActions';\r\n\r\nimport Layers from '../../models/layers';\r\nimport MeasurePointsTool from '../../tools/measurePointsTool';\r\nimport MeasureShapesTool from \"../../tools/measureShapesTool\";\r\nimport DisplayCoordsTool from \"../../tools/displayCoordsTool\";\r\n\r\nimport AboutPopup from \"../../components/AboutPopup/AboutPopup\";\r\nimport DownloadPopup from \"../../components/DownloadPopup/DownloadPopup\";\r\nimport UploadPopup from '../../components/UploadPopup/UploadPopup';\r\nimport CloudDocument from '../../components/Constructions/CloudDocument';\r\n\r\nimport styles from './MainComponent.module.css';\r\n\r\nclass MainComponent extends Component {\r\n    setHomeView = () => {\r\n        let layer = Layers.getAffected(this.props.layers);\r\n        if (!layer) return;\r\n        this.props.setHomeView(this.props.stage, layer);\r\n        this.forceUpdate();       // ??? unclear why on Home button click not updated\r\n    };\r\n\r\n    onSaveDocumentButtonClicked = () => {\r\n        if (this.props.layers.length === 0) return;   // nothing to save\r\n        // this.props.stage.img.crossOrigin=\"anonymous\";\r\n        let dataURL = null;\r\n        try {\r\n            dataURL = this.props.stage.toDataURL();\r\n        }\r\n        catch(e) {\r\n            console.log(e)\r\n        }\r\n        let payload = {\r\n            name: this.props.document.name === \"\" ?\r\n                cloudActions.getNewName(this.props.documentsList) : this.props.document.name,\r\n            dataURL: dataURL,\r\n            lastUpdated: new Date().toLocaleDateString() + \" \" + new Date().toLocaleTimeString(),\r\n            // token: this.props.token,\r\n            userId: this.props.userId\r\n        };\r\n\r\n        if (this.props.document.id) {\r\n            this.props.updateDocumentInDatabase(this.props.document.id, payload, this.props.layers);\r\n        }\r\n        else {\r\n            this.props.addDocumentToDatabase(payload, this.props.layers, this.props.history);\r\n        }\r\n    };\r\n\r\n    clearCurrentDocument = () => {\r\n        this.props.clearCurrentDocument();\r\n        this.props.clearAllLayers();\r\n        this.props.history.push(\"/\");\r\n    };\r\n\r\n    handleKeyDown = (e) => {\r\n        // let ctrl = e.ctrlKey;\r\n        if (e.target.id !== \"mainCanvas\")\r\n            return;\r\n        switch (e.code) {\r\n            case \"KeyH\":\r\n                this.setHomeView();\r\n                break;\r\n\r\n            case \"KeyW\":\r\n                this.props.toggleWidthMode();     // toggle width On/Off in graphics model\r\n                break;\r\n\r\n            case \"KeyE\":\r\n                this.props.toggleDisplayVertices();  // toggle vertices On/Off\r\n                break;\r\n\r\n            case \"ArrowRight\":\r\n                break;\r\n\r\n            case \"ArrowLeft\":\r\n                break;\r\n            case \"ArrowUp\":\r\n                break;\r\n            case \"ArrowDown\":\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n\r\n    componentDidMount() {\r\n        window.onresize = this.props.resizeStage;\r\n        // Keyboard event\r\n        // var _keydown = _.throttle(this.keydown, 100);\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n        // var _keyup = _.throttle(this.keyup, 500);\r\n        document.addEventListener('keyup', this.handleKeyUp);\r\n\r\n        // if (this.props.document.id === undefined) {\r\n        //     this.props.history.push(\"/\");\r\n        // }\r\n        // if (this.props.document.id !== undefined) {\r\n        //     this.props.history.push(\"/documents/\" + this.props.document.id)\r\n        // }\r\n    }\r\n\r\n    render() {\r\n        let displayCoordsTool = this.props.stage ? (\r\n            <DisplayCoordsTool\r\n                key=\"displayCoordinatedTool\"\r\n                stage={this.props.stage}\r\n                units={this.props.units}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n                coordX={this.props.mouse.x}\r\n                coordY={this.props.mouse.y}\r\n            />\r\n        ) : null;\r\n\r\n        let measurePointsTool = this.props.measurePointsActive ? <MeasurePointsTool /> : null;\r\n\r\n        let measuredLayersDisplayed = this.props.measureShapesTool.firstMeasuredShape &&\r\n            this.props.measureShapesTool.secondMeasuredShape &&\r\n            this.props.measureShapesTool.firstMeasuredLayer.displayed &&\r\n            this.props.measureShapesTool.secondMeasuredLayer.displayed;\r\n\r\n        let measureShapesTool = this.props.measureShapesTool.distance &&\r\n        this.props.measureShapesTool.shortestSegment && measuredLayersDisplayed ? (\r\n            <MeasureShapesTool\r\n                key=\"MeasureShapesTool\"\r\n                stage={this.props.stage}\r\n                firstMeasuredShape={this.props.measureShapesTool.firstMeasuredShape}\r\n                secondMeasuredShape={this.props.measureShapesTool.secondMeasuredShape}\r\n                firstMeasuredLayer={this.props.measureShapesTool.firstMeasuredLayer}\r\n                secondMeasuredLayer={this.props.measureShapesTool.secondMeasuredLayer}\r\n                distance={this.props.measureShapesTool.distance}\r\n                shortestSegment={this.props.measureShapesTool.shortestSegment}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n            />\r\n        ) : null;\r\n\r\n        return (\r\n            <main className={styles[\"Main-content\"]}>\r\n                <ToolbarComponent\r\n                    measurePointsActive={this.props.measurePointsActive}\r\n                    units={this.props.units}\r\n                    showSkeletonRecognitionButton={this.props.showSkeletonRecognitionButton}\r\n                    // onFileSelected={this.handleFileSelect}\r\n                    onHomeButtonPressed={this.setHomeView}\r\n                    onPanByDragPressed={this.props.togglePanByDrag}\r\n                    onMeasurePointsButtonPressed={this.props.toggleMeasureBetweenPoints}\r\n                    onMeasureBetweenShapesButtonPressed={this.props.toggleMeasureBetweenShapes}\r\n                    onToggleWidthModePressed={this.props.toggleWidthMode}\r\n                    onToggleVerticesPressed={this.props.toggleDisplayVertices}\r\n                    onToggleLabelsPressed={this.props.toggleDisplayLabels}\r\n                    onShowAboutPopupPressed={this.props.toggleAboutPopup}\r\n                    onSkeletonRecognitionButtonPressed={this.props.applySkeletonRecognition}\r\n                    onUnitClicked={this.props.toggleUnits}\r\n                    onSaveDocumentButtonClicked={this.onSaveDocumentButtonClicked}\r\n                    onClearAllButtonClicked={this.clearCurrentDocument}\r\n                    onLayerListButtonClicked={this.props.toggleLayerList}\r\n                    onShowDownloadPopupPressed={this.props.toggleDownloadPopup}\r\n                    onShowUploadPopupPressed={this.props.toggleUploadPopup}\r\n                />\r\n\r\n                <CanvasComponent />\r\n\r\n                {this.props.stage ? (\r\n                    <StageComponent\r\n                        stage={this.props.stage}\r\n                        onStageUnmounted={this.props.destroyStage}\r\n                    >\r\n                        <LayersComponent layers={this.props.layers}/>\r\n\r\n                        {displayCoordsTool}\r\n                        {measurePointsTool}\r\n                        {measureShapesTool}\r\n                    </StageComponent>) : null }\r\n\r\n                <StatusComponent />\r\n\r\n                { this.props.showAboutPopup ?\r\n                    <AboutPopup\r\n                        showAboutPopup={this.props.showAboutPopup}\r\n                        toggleAboutPopup={this.props.toggleAboutPopup}\r\n                        title={this.props.title}\r\n                        version={this.props.version}\r\n                        build={this.props.build}\r\n                    /> : null}\r\n\r\n\r\n                { this.props.showDownloadPopup ?\r\n                    <DownloadPopup\r\n                        showPopup={this.props.showDownloadPopup}\r\n                        closePopup={this.props.toggleDownloadPopup}\r\n                        title=\"Download document\"\r\n                        layers={this.props.layers}\r\n                    /> : null }\r\n\r\n                {this.props.showUploadPopup ?\r\n                    <UploadPopup\r\n                        showPopup={this.props.showUploadPopup}\r\n                        closePopup={this.props.toggleUploadPopup}\r\n                        title=\"Upload files\"\r\n                        onPaste={this.props.pasteDataFromBuffer}\r\n                    /> : null}\r\n\r\n                <Route path=\"/documents/:id\" component={CloudDocument}/>\r\n\r\n            </main>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        title: state.app.title,\r\n        version: state.app.version,\r\n        build: state.app.build,\r\n        displayVertices: state.app.displayVertices,\r\n        displayLabels: state.app.displayLabels,\r\n        widthOn: state.app.widthOn,\r\n        zoomFactor: state.app.zoomFactor,\r\n        units: state.app.units,\r\n        showSkeletonRecognitionButton: state.app.showSkeletonRecognitionButton,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n        measurePointsActive: state.app.measurePointsActive,\r\n        showAboutPopup: state.app.showAboutPopup,\r\n        showDownloadPopup: state.app.showDownloadPopup,\r\n        showUploadPopup: state.app.showUploadPopup,\r\n        layers: state.layers,\r\n        mouse: state.mouse,\r\n        measureShapesTool: state.measureShapesTool,\r\n\r\n        document: state.cloudStorage.document,\r\n        documentsList: state.cloudStorage.documentsList,\r\n        // onManageCloudStorageButtonClicked: ownProps.onManageCloudStorageButtonClicked\r\n        token: state.auth.token,\r\n        userId: state.auth.userId\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        resizeStage: () => dispatch(actions.resizeStage()),\r\n        destroyStage: () => dispatch(actions.destroyStage()),\r\n        setHomeView: (stage, shape) => dispatch(actions.setHomeView(stage, shape)),\r\n        toggleUnits: () => dispatch(actions.toggleUnits()),\r\n        toggleWidthMode: () => dispatch(actions.toggleWidthMode()),\r\n        toggleDisplayVertices: () => dispatch(actions.toggleDisplayVertices()),\r\n        toggleDisplayLabels: () => dispatch(actions.toggleDisplayLabels()),\r\n        toggleAboutPopup: () => dispatch(actions.toggleAboutPopup()),\r\n        toggleMeasureBetweenPoints: () => dispatch(actions.toggleMeasureBetweenPoints()),\r\n        toggleMeasureBetweenShapes: () => dispatch(actions.toggleMeasureBetweenShapes()),\r\n        togglePanByDrag: () => dispatch(actions.togglePanByDrag()),\r\n        toggleLayerList: () => dispatch(actions.toggleLayerList()),\r\n        toggleDownloadPopup: () => dispatch(actions.toggleDownloadPopup()),\r\n        toggleUploadPopup: () => dispatch(actions.toggleUploadPopup()),\r\n        applySkeletonRecognition: () => dispatch(actions.applySkeletonRecognition()),\r\n        pasteDataFromBuffer: (clipboardData) => dispatch(actions.pasteDataFromBuffer(clipboardData)),\r\n\r\n        clearAllLayers: () => dispatch(layerActions.deleteAllLayers()),\r\n\r\n        addDocumentToDatabase: (payload, layers, history) => dispatch(cloudActions.addDocumentToDatabase(payload, layers, history)),\r\n        updateDocumentInDatabase: (id, payload, layers) => dispatch(cloudActions.updateDocumentInDatabase(id, payload, layers)),\r\n        clearCurrentDocument: () => dispatch(cloudActions.clearCurrentDocument())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MainComponent);\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\nimport React from 'react';\r\nimport FontAwesome from 'react-fontawesome';\r\n\r\nimport styles from './LayerListToolbar.module.css';\r\nimport '@fortawesome/fontawesome-free/css/all.css';\r\n\r\nconst LayerListToolbar = (props) => {\r\n    return (\r\n        <div className={styles[\"Layer-list-toolbar\"]}>\r\n            <button title=\"Add layer\" onClick={props.onAddLayerButtonClicked}>\r\n                <FontAwesome\r\n                    name='plus'\r\n                    size='2x'\r\n                    style={{color: \"grey\"}}\r\n                />\r\n            </button>\r\n            <button title=\"Edit selected layer's name and info\" onClick={props.onEditLayerButtonClicked}>\r\n                <FontAwesome\r\n                    name='pencil-alt'\r\n                    size='2x'\r\n                    style={{color: \"grey\"}}\r\n                />\r\n            </button>\r\n            <button title=\"Delete selected layer\" onClick={props.onDeleteLayerButtonClicked}>\r\n                <FontAwesome\r\n                    name='trash-alt'\r\n                    size='2x'\r\n                    style={{color: \"grey\"}}\r\n                />\r\n            </button>\r\n            <button title=\"Sort layer list\" onClick={props.onSortLayersButtonClicked}>\r\n                <FontAwesome\r\n                    name='sort-alpha-down'\r\n                    size='2x'\r\n                    style={{color: \"grey\"}}\r\n                />\r\n            </button>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default LayerListToolbar;\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\n\r\nimport React from 'react';\r\nimport styles from './LayerEditForm.module.css';\r\n\r\nconst LayerEditForm = (props) => {\r\n    let onSubmitLayerEditForm = (ev) => {\r\n        if (!ev)\r\n            return false;\r\n        ev.stopPropagation();\r\n        ev.preventDefault();\r\n        let name = ev.currentTarget[0].value;\r\n        let title = ev.currentTarget[1].value;\r\n        let newLayer = Object.assign({}, props.layer, {\r\n            name: name,\r\n            title: title\r\n        });\r\n        props.onSubmitLayerEditForm(newLayer);\r\n        return false;\r\n    };\r\n\r\n    let setFocus = (ev) => {\r\n        ev.stopPropagation();\r\n        ev.target.focus();\r\n    };\r\n\r\n    let onCancelLayerEditForm = (ev) => {\r\n        props.onEscapeLayerEditForm();\r\n    };\r\n\r\n    let onMouseMoveHandler = (ev) => {\r\n        ev.stopPropagation();\r\n    };\r\n\r\n    return (\r\n        <form className={styles[\"Layer-edit-form\"]}\r\n              id=\"layerEditForm\"\r\n              action=\"\"\r\n              onSubmit={onSubmitLayerEditForm}\r\n              onMouseMove={onMouseMoveHandler}\r\n        >\r\n            <article>\r\n            <label>Name:</label>\r\n            <input type=\"text\" id=\"layer-name\" name=\"layerName\" defaultValue={props.layer.name}\r\n                   onClick={setFocus}  />\r\n            </article>\r\n            <article>\r\n            <label>Description:</label>\r\n            <textarea id=\"layer-title\" name=\"layerTitle\" cols=\"70\" rows=\"3\" defaultValue={props.layer.title}\r\n                      onClick={setFocus}>\r\n            </textarea>\r\n            </article>\r\n            <input type=\"submit\" style={{display:\"none\"}}/>\r\n            <button onClick={onCancelLayerEditForm}>Cancel</button>\r\n            <button onClick={(ev) => onSubmitLayerEditForm(ev.target.parent)}>OK</button>\r\n        </form>\r\n    )\r\n};\r\n\r\nexport default LayerEditForm;\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport ModalPopup from \"../../UI/ModalPopup/ModalPopup\";\r\nimport LayerEditForm from \"../LayerEditForm/LayerEditForm\";\r\nimport styles from './LayerListElement.module.css';\r\n\r\nclass LayerListElement extends Component {\r\n    componentDidUpdate() {\r\n        if (document.activeElement.nodeName === \"CANVAS\")\r\n            return;\r\n        let elem = this.refs.layerName;\r\n        if (this.props.layer.affected) {\r\n            elem.focus();\r\n        }\r\n    }\r\n\r\n    rgba(hex, opacity) {\r\n        let r, g, b, percent;\r\n        if (hex) {\r\n            hex = hex.replace('#', '');\r\n            r = parseInt(hex.substring(0, 2), 16);\r\n            g = parseInt(hex.substring(2, 4), 16);\r\n            b = parseInt(hex.substring(4, 6), 16);\r\n            percent = opacity;\r\n        }\r\n        else {\r\n            r = 147;\r\n            g = 128;\r\n            b = 108;\r\n            percent = 0;\r\n        }\r\n        let result = `rgba(${r},${g},${b},${percent / 100})`;\r\n\r\n        return result;\r\n    }\r\n\r\n    render() {\r\n        // let style = this.props.layer.displayed ?\r\n        //     styleSheet.displayed : styleSheet.undisplayed;\r\n\r\n        let displayed = this.props.layer.displayed ? \"Layer-displayed\" : \"Layer-undisplayed\";\r\n        let color = displayed ? this.rgba(this.props.layer.color, 100) : this.rgba();\r\n        let bgcolor = displayed ? this.rgba(this.props.layer.color, 30) : this.rgba();\r\n        let alpha = this.props.layer.affected ? 1 : 0;\r\n        let layerNameOpacity = this.props.layer.shapes.length === 0 ? 0.6 : 1.0;\r\n        return [\r\n            <li key={1}\r\n                className={styles.Layer}\r\n                onClick={this.props.onLayerClicked}\r\n                onDoubleClick={this.props.onLayerDoubleClicked}>\r\n\r\n                <div className={styles.LayerSelectionBox}\r\n                     onClick={this.props.onAffectedBoxClicked}\r\n                >\r\n                    <h4 className={styles.LayerSelectionMark}\r\n                        style={{opacity: alpha, color: color}}>\r\n                        ✓\r\n                    </h4>\r\n                </div>\r\n\r\n                <div className={styles.LayerNameBox}\r\n                     style={{backgroundColor: bgcolor, opacity: layerNameOpacity}}>\r\n                    <h4 ref=\"layerName\"\r\n                        title={this.props.layer.title}\r\n                        tabIndex='1'\r\n                    >\r\n                        {this.props.layer.name}\r\n                    </h4>\r\n                </div>\r\n\r\n            </li>,\r\n\r\n            <ModalPopup\r\n                key={2}\r\n                showPopup={this.props.layer.edited}\r\n                closePopup={this.props.onEscapeLayerEditForm}\r\n                header=\"Layer properties\"\r\n            >\r\n                <LayerEditForm\r\n                    layer={this.props.layer}\r\n                    onSubmitLayerEditForm={this.props.onSubmitLayerEditForm}\r\n                    onEscapeLayerEditForm={this.props.onEscapeLayerEditForm}\r\n                />\r\n            </ModalPopup>\r\n        ]\r\n    }\r\n}\r\n\r\nexport default LayerListElement;\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport LayerListToolbar from \"../../components/LayersList/LayerListToolbar/LayerListToolbar\";\r\nimport LayerListElement from '../../components/LayersList/LayerListElement/LayerListElement';\r\nimport * as actions from '../../store/actions/layersActions';\r\nimport { connect } from 'react-redux';\r\nimport styles from './LayersList.module.css';\r\n\r\nclass LayersList extends Component {\r\n    height = 0;\r\n\r\n    handleKeyDown = (e) => {\r\n        // e.stopPropagation();\r\n        // e.preventDefault();\r\n\r\n        if (e.target.parentElement.parentElement &&\r\n            e.target.parentElement.parentElement.parentElement &&\r\n            e.target.parentElement.parentElement.parentElement.id &&\r\n            e.target.parentElement.parentElement.parentElement.id === \"layersList\") {\r\n\r\n\r\n            switch (e.code) {\r\n                case \"ArrowRight\":\r\n                case \"ArrowDown\":\r\n                    this.props.setAffectedNextLayer();\r\n                    break;\r\n                case \"ArrowLeft\":\r\n                case \"ArrowUp\":\r\n                    this.props.setAffectedPrevLayer();\r\n                    break;\r\n                /* tab does not work properly\r\n            case \"Tab\":\r\n                if (e.shiftKey) {\r\n                    this.dispatch({\r\n                        type: ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED\r\n                    });\r\n                }\r\n                else {\r\n                    this.dispatch({\r\n                        type: ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED\r\n                    });\r\n                }\r\n                break;\r\n                */\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    onLayerListClicked = () => {\r\n        this.forceUpdate();\r\n    };\r\n\r\n    componentDidMount() {\r\n        // Keyboard event\r\n        // var _keydown = _.throttle(this.keydown, 100);\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n        // var _keyup = _.throttle(this.keyup, 500);\r\n        // document.addEventListener('keyup', this.handleKeyUp);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.height = this.refs.layersComponent.clientHeight;\r\n    }\r\n\r\n    render() {\r\n        const style = this.props.showLayerList ? styles[\"App-layers-displayed\"] : styles[\"App-layers\"];\r\n        return (\r\n            <div className={style}\r\n                 ref=\"layersComponent\"\r\n                 onClick={this.onLayerListClicked}\r\n            >\r\n                {/*<h5>Layers</h5>*/}\r\n                <LayerListToolbar\r\n                    onAddLayerButtonClicked={() => this.props.onAddLayerButtonClicked(this.props.stage)}\r\n                    onEditLayerButtonClicked={this.props.onEditLayerButtonClicked}\r\n                    onDeleteLayerButtonClicked={this.props.onDeleteLayerButtonClicked}\r\n                    onSortLayersButtonClicked={this.props.onSortLayersButtonClicked}\r\n                />\r\n                <ul id=\"layersList\"\r\n                    style={{maxHeight:0.82*(this.height-40)}}>\r\n                { this.props.layers.map((layer) =>\r\n                    <LayerListElement\r\n                        key={layer.name}\r\n                        layer={layer}\r\n                        onLayerClicked={() => this.props.onLayerClicked(layer)}\r\n                        onAffectedBoxClicked={(event) => this.props.onAffectedBoxClicked(event, layer)}\r\n                        onSubmitLayerEditForm={this.props.onSubmitLayerEditForm}\r\n                        onEscapeLayerEditForm={this.props.onEscapeLayerEditForm}\r\n                    />)\r\n                }\r\n                </ul>\r\n                {/*{addLayer}*/}\r\n            </div>\r\n        )\r\n\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        showLayerList: state.app.showLayerList         // on mobile device\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        onAddLayerButtonClicked: (stage) => dispatch(actions.addEmptyLayer(stage)),\r\n        onEditLayerButtonClicked: () => dispatch(actions.openAffectedLayerEditForm()),\r\n        onDeleteLayerButtonClicked: () => dispatch(actions.deleteAffectedLayer()),\r\n        onSortLayersButtonClicked: () => dispatch(actions.sortLayers()),\r\n        onLayerClicked: (layer) => dispatch(actions.toggleDisplayLayer(layer)),\r\n        onAffectedBoxClicked: (event, layer) => dispatch(actions.toggleAffectedLayer(event, layer)),\r\n        onSubmitLayerEditForm: (newLayer) => dispatch(actions.updateLayer(newLayer)),\r\n        onEscapeLayerEditForm: () => dispatch(actions.closeEditLayerForm()),\r\n        setAffectedNextLayer: () => dispatch(actions.setAffectedNextLayer()),\r\n        setAffectedPrevLayer: () => dispatch(actions.setAffectedPrevLayer())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LayersList);\r\n\r\n// export default LayersList;","/**\r\n * Created by alexanderbol on 06/05/2017.\r\n */\r\n\r\nimport React from 'react';\r\nimport styles from './AsideComponent.module.css';\r\n\r\nconst AsideComponent = () => {\r\n    return (\r\n        <aside className={styles[\"App-aside\"]}>\r\n            <h5>&nbsp;</h5>\r\n        </aside>\r\n    )\r\n};\r\n\r\nexport default AsideComponent;\r\n","import React from 'react';\r\nimport { connect } from \"react-redux\";\r\nimport * as ActionTypes from \"./store/actionTypes\";\r\nimport * as cloudActions from \"./store/actions/cloudStorageActions\";\r\nimport MainComponent from \"./containers/MainComponent/MainComponent\";\r\nimport LayersList from \"./containers/LayerList/LayersList\";\r\nimport AsideComponent from \"./components/Layout/AsideComponent/AsideComponent\";\r\n// import DocumentName from \"./components/MainComponent/DocumentName/DocumentName\";\r\n\r\nconst appBody = (props) => {\r\n    return (\r\n        <React.Fragment>\r\n            {/*<DocumentName name={props.document.name}*/}\r\n                          {/*username={props.username}*/}\r\n                          {/*updateDocumentName={props.updateDocumentName} />*/}\r\n            <div className=\"App-body\" onPaste={props.pasteDataFromBuffer}>\r\n                <MainComponent history={props.history}\r\n                               onManageCloudStorageButtonClicked={props.onManageCloudStorageButtonClicked}\r\n                />\r\n                <LayersList/>\r\n                <AsideComponent/>\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nconst mapStateToProps = ({cloudStorage, auth}) => {\r\n    return {\r\n        document: cloudStorage.document,\r\n        username: auth.username\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        pasteDataFromBuffer: (event) => dispatch({\r\n            type: ActionTypes.DATA_FROM_BUFFER_PASTED,\r\n            data: event.clipboardData\r\n        }),\r\n        updateDocumentName: (name) => dispatch(cloudActions.updateDocumentName(name))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(appBody);\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nimport React from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport classes from './HeaderComponent.module.css';\r\n// import Logo from './Logo/Logo';\r\n// import Navigation from './Navigation/Navigation';\r\n\r\nconst HeaderComponent = (props) => {\r\n    const style = props.location.pathname === \"/documents\" ?\r\n        classes[\"App-header-documents-page\"] :\r\n        classes[\"App-header\"];\r\n    return (\r\n        <header className={style}>\r\n            <h2>Debug Viewer</h2>\r\n        </header>\r\n    )\r\n};\r\n\r\nexport default withRouter(HeaderComponent);\r\n\r\n/*\r\n<header className={style}>\r\n    <Logo />\r\n    <Navigation isAuthenticated={props.isAuthenticated} />\r\n    {props.isAuthenticated ? <span>Hello {props.username}</span> : null}\r\n    {props.location.pathname === \"/documents\" ? <hr/> : null}\r\n</header>\r\n*/","import /*React,*/ {Component} from 'react';\r\nimport axios from \"axios\";\r\n\r\nimport Layers from \"../../models/layers\";\r\n// import {parseODB} from \"../../dataParsers/parserODB\";\r\nimport {parseTXT} from \"../../dataParsers/parseTXT\";\r\nimport Model from \"../../models/model\";\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport * as actions from '../../store/actions/appActions';\r\nimport { connect } from 'react-redux';\r\n\r\nclass Demo extends Component {\r\n    state={\r\n        done:false\r\n    };\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            let stage = this.props.stage;\r\n            let layers = this.props.layers;\r\n\r\n            // let url1 = \"https://gist.githubusercontent.com/alexbol99/e8ff96c445fc58da5d0f66ccf58d9282/raw/be4273f3b68b104e02f918495592d8308a066344/poly1.txt\";\r\n            // let url2 = \"https://gist.githubusercontent.com/alexbol99/b445045a8bbb41b4bde7724b5e474ddf/raw/705314f25757633c6a3d9199d5be101028ea0316/poly2.txt\";\r\n            // let url3 = \"https://gist.githubusercontent.com/alexbol99/715dc06c8295f90ef18385a0d8040d5c/raw/c95c46c0eae9069d004480ccd0ac80ca89e818f2/poly3.txt\";\r\n            // let url4 = \"https://gist.githubusercontent.com/alexbol99/1226284eb0c0ac3aa9c645d9f7849eb5/raw/a35baaadb8d9e5e0580d33cf4546bf0d05ad37dc/poly4.txt\";\r\n            let url234 = \"https://gist.githubusercontent.com/alexbol99/e570fe783be88b556f4ca4b332da73f7/raw/741c87a7ceccdeadd9fbbac05bdfda22ebe94927/poly234.txt\";\r\n\r\n            // axios(\"https://gist.githubusercontent.com/alexbol99/825fdf2dd508467cc852eb22aa36183d/raw/d10e853338afd8294eeb3ffdebe3bc380477a978/features\")\r\n\r\n            Promise.all([axios(url234)])\r\n                .then( (responses) => {\r\n                    for (let i=0; i < 1; i++) {\r\n                        let resp = responses[i];\r\n                        let layer = Layers.newLayer(stage, layers);\r\n                        layer.color = Layers.getNextColor(layers);\r\n                        layer.name = \"poly\";\r\n                        layer.title = \"\";\r\n                        layer.affected = false;\r\n                        layer.displayed = true;\r\n\r\n                        let job = parseTXT(layer.name, resp.data);\r\n\r\n                        for (let shape of job.shapes) {\r\n                            let model = new Model(shape, undefined, shape.label);\r\n                            layer.add(model);\r\n                        }\r\n\r\n                        this.props.panAndZoomToShape(stage, layer);\r\n                        this.props.addNewLayer(layer);\r\n                        this.props.asyncOperationEnded();\r\n                    }\r\n                })\r\n                .catch( error => {\r\n                    console.log(error);\r\n                    this.props.asyncOperationEnded();\r\n                });\r\n\r\n            this.setState({done:true});\r\n            this.props.asyncOperationStarted();\r\n        }\r\n    }\r\n    componentDidMount() {\r\n\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        panAndZoomToShape: (stage, layer) => dispatch({\r\n            type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n            stage: stage,\r\n            shape: layer\r\n        }),\r\n        addNewLayer: (layer) => dispatch({\r\n            type: ActionTypes.ADD_NEW_LAYER,\r\n            layer: layer\r\n        }),\r\n        asyncOperationStarted: () => dispatch(actions.asyncOperationStarted()),\r\n        asyncOperationEnded: () => dispatch(actions.asyncOperationEnded())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Demo);\r\n","import /*React,*/ {Component} from 'react';\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport { connect } from 'react-redux';\r\n\r\nclass SkeletonRecognition extends Component {\r\n    componentDidMount() {\r\n        this.props.applySkeletonRecognition();\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        applySkeletonRecognition: () => dispatch({type: ActionTypes.SKELETON_RECOGNITION_URI})\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(SkeletonRecognition);\r\n","import Flatten from \"@flatten-js/core\";\r\nimport {Vector, Segment, Arc, Line, Box, Polygon} from \"@flatten-js/core\";\r\n// let Flatten = require('flatten-js');\r\n\r\n// let {Vector, Segment, Arc, Line, Box, Polygon} = Flatten;\r\n\r\nclass CollisionDistance {\r\n    static apply(polygon1, polygon2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let edge of [...polygon2.edges]) {\r\n            let distance = CollisionDistance.edge2polygon(edge, polygon1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static edge2polygon(edge2, polygon1) {\r\n        let shapeBox = edge2.shape.box;\r\n        let box = new Box(\r\n            Number.NEGATIVE_INFINITY,\r\n            shapeBox.ymin,\r\n            Number.POSITIVE_INFINITY,\r\n            shapeBox.ymax\r\n        );\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let resp_edges =  polygon1.edges.search(box);\r\n        for (let edge1 of resp_edges) {\r\n            let distance;\r\n            if (edge1.shape instanceof Segment && edge2.shape instanceof Segment) {\r\n                distance = CollisionDistance.segment2segment(edge1.shape, edge2.shape);\r\n            }\r\n            else if (edge1.shape instanceof Arc && edge2.shape instanceof Segment) {\r\n                distance = CollisionDistance.segment2arc(edge2.shape, edge1.shape);\r\n            }\r\n            else if (edge1.shape instanceof Segment && edge2.shape instanceof Arc) {\r\n                distance = CollisionDistance.segment2arc(edge1.shape, edge2.shape);\r\n            }\r\n            else if (edge1.shape instanceof Arc && edge2.shape instanceof Arc) {\r\n                distance = CollisionDistance.arc2arc(edge1.shape, edge2.shape);\r\n            }\r\n\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static point2shape(point, shape) {\r\n        let line = new Line(point, new Vector(0,1));\r\n        let intersections = line.intersect(shape);          // segment or arc\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let ip of intersections) {\r\n            // eslint-disable-next-line\r\n            let [distance, shortest_segment] = point.distanceTo(ip);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static segment2segment(segment1, segment2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let point of segment1.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment2);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of segment2.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static segment2arc(segment, arc) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let v_s = new Vector(segment.start, segment.end);\r\n        v_s = v_s.normalize();\r\n\r\n        let v_n = [v_s.rotate90CCW().multiply(arc.r), v_s.rotate90CW().multiply(arc.r)];\r\n        let distance;\r\n\r\n        // Distance between tangent point and segment\r\n        for (let v of v_n) {\r\n            let tangent_point = arc.center.translate(v);  // tangent point in direction of the normal vector\r\n            if (tangent_point.on(arc)) {\r\n                distance = CollisionDistance.point2shape(tangent_point, segment);\r\n                if (distance < collision_distance) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let point of arc.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of segment.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static arc2arc(arc1, arc2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let distance;\r\n\r\n        // test translation of arc2.center to arc1 enlarged by r2\r\n        let arc_enlarged = arc1.clone();\r\n        arc_enlarged.r += arc2.r;\r\n        distance = CollisionDistance.point2shape(arc2.center, arc_enlarged);\r\n        if (distance < collision_distance) {\r\n            // additional check that transformed arc actually touching\r\n            // eslint-disable-next-line\r\n            let [dist_tmp, shortest_segment_tmp] =\r\n                arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n            if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n\r\n        // test translation of arc2.center to arc1 reduced by r2\r\n        if (Flatten.Utils.GE(arc1.r, arc2.r)) {\r\n            let arc_reduced = arc1.clone();\r\n            arc_reduced.r -= arc2.r;\r\n            distance = CollisionDistance.point2shape(arc2.center, arc_reduced);\r\n            if (distance < collision_distance) {\r\n                // additional check that transformed arc actually touching\r\n                // eslint-disable-next-line\r\n                let [dist_tmp, shortest_segment_tmp] =\r\n                    arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n                if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        // test translation of arc1.center to arc2 reduced by r1\r\n        if (Flatten.Utils.LT(arc1.r, arc2.r)) {\r\n            let arc_reduced = arc2.clone();\r\n            arc_reduced.r -= arc1.r;\r\n            distance = CollisionDistance.point2shape(arc1.center, arc_reduced);\r\n            if (distance < collision_distance) {\r\n                // additional check that transformed arc actually touching\r\n                // eslint-disable-next-line\r\n                let [dist_tmp, shortest_segment_tmp] =\r\n                    arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n                if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let point of arc1.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc2);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of arc2.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static translateArc(arc, vec) {\r\n        let arc_tmp = arc.clone();\r\n        arc_tmp.pc = arc_tmp.pc.translate(vec);\r\n        return arc_tmp;\r\n    }\r\n\r\n    static translate(polygon, vec) {\r\n        let newPolygon = new Polygon();\r\n        for (let face of polygon.faces) {\r\n            let shapes = [];\r\n            for (let edge of face) {\r\n                if (edge.shape instanceof Segment) {\r\n                    shapes.push(\r\n                        new Segment(edge.shape.ps.translate(vec), edge.shape.pe.translate(vec))\r\n                    )\r\n                }\r\n                else if (edge.shape instanceof  Arc) {\r\n                    let arc_trans = edge.shape.clone();\r\n                    arc_trans.pc = edge.shape.pc.translate(vec);\r\n                    shapes.push(arc_trans);\r\n                }\r\n            }\r\n            newPolygon.addFace(shapes);\r\n        }\r\n        return newPolygon;\r\n    }\r\n\r\n};\r\n\r\nCollisionDistance.Flatten = Flatten;\r\n\r\nexport default CollisionDistance;\r\n","import /*React,*/ {Component} from 'react';\r\nimport Flatten from '@flatten-js/core';\r\nimport CollisionDistance from \"../../models/collisionDistance\";\r\nimport axios from \"axios\";\r\nimport Layers from \"../../models/layers\";\r\n// import {Model} from \"../../models/model\";\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from \"../../store/actions/appActions\";\r\n\r\nlet {vector} = Flatten;\r\n\r\nclass CollisionDemo extends Component {\r\n    state={\r\n        done:false,\r\n        data:[]\r\n    };\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            let stage = this.props.stage;\r\n            let layers = this.props.layers;\r\n\r\n            let layer = Layers.newLayer(stage, layers);\r\n            layer.color = Layers.getNextColor(layers);\r\n            layer.name = \"collision_demo\";\r\n            layer.title = \"collision_demo\";\r\n            layer.affected = true;\r\n            layer.displayed = true;\r\n\r\n            axios(\"https://gist.githubusercontent.com/alexbol99/81893d40ec5eaa00d0336c35e069dd73/raw/b9328a4c6d7d6a44f375c68b4ec207690f40fd19/Block_53388_2parts_Cont.txt\")\r\n                .then( (resp) => {\r\n                    let parser = this.props.parser;\r\n                    let polygon1 = parser.parseToPolygon(resp.data);\r\n                    layer.add(polygon1);\r\n\r\n                    let vec = vector( 2*(polygon1.box.xmax - polygon1.box.xmin), 0 );\r\n                    let polygon2 = polygon1.translate(vec);\r\n                    layer.add(polygon2);\r\n\r\n                    let collision = CollisionDistance.apply(polygon2, polygon1);\r\n                    let polygon3 = polygon2.translate(vector(-collision, 0));\r\n                    layer.add(polygon3);\r\n\r\n                    // layers.push(layer);\r\n\r\n                    this.props.panAndZoomToShape(stage, layer);\r\n                    this.props.addNewLayer(layer);\r\n                    this.props.applyCollisionDemo();\r\n                    this.props.asyncOperationEnded();\r\n                });\r\n            this.setState({done:true});\r\n            this.props.asyncOperationStarted();\r\n        }\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        parser: state.app.parser\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        panAndZoomToShape: (stage, layer) => dispatch({\r\n            type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n            stage: stage,\r\n            shape: layer\r\n        }),\r\n        addNewLayer: (layer) => dispatch({\r\n            type: ActionTypes.ADD_NEW_LAYER,\r\n            layer: layer\r\n        }),\r\n        applyCollisionDemo: () => dispatch({\r\n            type: ActionTypes.COLLISION_DEMO_URI\r\n        }),\r\n        asyncOperationStarted: () => dispatch(actions.asyncOperationStarted()),\r\n        asyncOperationEnded: () => dispatch(actions.asyncOperationEnded())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CollisionDemo);\r\n","import React from 'react';\r\nimport Modal from '../Modal';\r\nimport classes from './Spinner.module.css';\r\n\r\nconst spinner = () => {\r\n    return (\r\n        <Modal>\r\n            <div className={classes.BackDrop} >\r\n                <div className={classes.Loader}>Loading ...</div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default spinner;","import * as actionTypes from '../actionTypes';\r\nimport axios from 'axios';\r\n\r\nconst apiKey = \"AIzaSyDMUAcjgolAlapdpFmPEz8SaId1DZw7MpQ\";\r\n\r\nexport const authStart = () => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_STARTED\r\n    }\r\n};\r\n\r\nexport const authSucceed = (token, userId, username=null) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_SUCCEED,\r\n        token,\r\n        userId,\r\n        username\r\n    }\r\n};\r\n\r\nexport const authFailed = (error) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_FAILED,\r\n        error\r\n    }\r\n};\r\n\r\nexport const authSetUsername = (username) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_SET_USERNAME,\r\n        username\r\n    }\r\n};\r\n\r\nexport const logout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('expirationDate');\r\n    localStorage.removeItem('userId');\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_LOGOUT\r\n    }\r\n};\r\n\r\nexport const checkAuthTimeout = (expirationTime) => {\r\n    return dispatch => {\r\n        setTimeout(() => {\r\n            const email = localStorage.getItem('email');\r\n            const password = localStorage.getItem('password');\r\n            if (email && password) {\r\n                dispatch(logIn(email, password))\r\n            }\r\n            else {\r\n                dispatch(logout())\r\n            }\r\n        }, expirationTime * 1000)\r\n    }\r\n};\r\n\r\nexport const logIn = (email, password) => {\r\n    return dispatch => {\r\n        dispatch(authStart());\r\n        const authData = {\r\n            email,\r\n            password,\r\n            returnSecureToken: true\r\n        };\r\n        localStorage.setItem('email', email);\r\n        localStorage.setItem('password', password);\r\n        const url = \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=\" + apiKey;\r\n        axios.post(url, authData)\r\n            .then(response => {\r\n                const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);\r\n                localStorage.setItem('token', response.data.idToken);\r\n                localStorage.setItem('expirationDate', expirationDate);\r\n                localStorage.setItem('userId', response.data.localId);\r\n\r\n                dispatch(authSucceed(response.data.idToken, response.data.localId));\r\n                dispatch(checkAuthTimeout(response.data.expiresIn));\r\n                const queryParams = '?auth=' + response.data.idToken + '&orderBy=\"userId\"&equalTo=\"' + response.data.localId + '\"';\r\n                return axios.get(\"https://debug-viewer.firebaseio.com/users.json\" + queryParams);\r\n            })\r\n            .then(response => {\r\n                if (Object.values(response.data.length > 0)) {\r\n                    const username = Object.values(response.data)[0].username;\r\n                    localStorage.setItem('username', username);\r\n                    dispatch(authSetUsername(Object.values(response.data)[0].username))\r\n                }\r\n            })\r\n            .catch(error => {\r\n                dispatch(authFailed(error.response.data.error))\r\n            })\r\n    }\r\n};\r\n\r\nexport const signUp = (username, email, password) => {\r\n    return dispatch => {\r\n        dispatch(authStart());\r\n        const authData = {\r\n            email,\r\n            password,\r\n            returnSecureToken: true\r\n        };\r\n        const url = \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=\" + apiKey;\r\n        axios.post(url, authData)\r\n            .then(response => {\r\n                const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);\r\n                localStorage.setItem('token', response.data.idToken);\r\n                localStorage.setItem('expirationDate', expirationDate);\r\n                localStorage.setItem('userId', response.data.localId);\r\n                localStorage.setItem('username', username);\r\n\r\n                dispatch(authSucceed(response.data.idToken, response.data.localId, username));\r\n                dispatch(checkAuthTimeout(response.data.expiresIn));\r\n\r\n                const user = {\r\n                    userId: response.data.localId,\r\n                    username: username\r\n                };\r\n                return axios.post(\"https://debug-viewer.firebaseio.com/users.json\", user);\r\n            })\r\n            .then(response => {\r\n                // do nothing\r\n            })\r\n            .catch(error => {\r\n                console.log(error.response.data.error);\r\n                dispatch(authFailed(error.response.data.error))\r\n            })\r\n    }\r\n};\r\n\r\nexport const authCheckState = () => {\r\n    return dispatch => {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n            dispatch(logout());\r\n        }\r\n        else {\r\n            const userId = localStorage.getItem('userId');\r\n            const username = localStorage.getItem('username');\r\n            const expirationDate = new Date(localStorage.getItem('expirationDate'));\r\n            if (expirationDate > new Date()) {\r\n                const timeLeft = expirationDate.getTime() - new Date().getTime()\r\n                dispatch(authSucceed(token, userId, username));\r\n                dispatch(checkAuthTimeout(timeLeft / 1000));\r\n            }\r\n            else {\r\n                dispatch(logout());\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n","import React, {Component} from 'react';\r\nimport {Route, Switch, withRouter} from 'react-router-dom';\r\n\r\nimport AppBody from './AppBody';\r\nimport HeaderComponent from './components/Layout/HeaderComponent/HeaderComponent';\r\n// import Signup from './containers/Auth/SignUp/Signup';\r\n// import Login from './containers/Auth/Login/Login';\r\n// import Logout from './containers/Auth/Logout';\r\nimport {connect} from 'react-redux';\r\n\r\nimport './App.css';\r\n\r\n// import CloudDocument from './components/Constructions/CloudDocument';\r\nimport Demo from './components/Constructions/Demo';\r\n// import BooleanTest from './components/Constructions/BooleanTest';\r\nimport SkeletonRecognition from './components/Constructions/SkeletonRecognition';\r\nimport CollisionDemo from \"./components/Constructions/CollisionDemo\";\r\nimport Spinner from \"./components/UI/Spinner/Spinner\";\r\n// import DocumentsComponent from \"./containers/DocumentsComponent/DocumentsComponent\";\r\nimport * as authActions from \"./store/actions/auth\";\r\n\r\nclass App extends Component {\r\n    componentDidMount() {\r\n        this.props.authCheckState();\r\n    }\r\n    componentDidUpdate() {\r\n        if (this.props.location.pathname === '/' && this.props.document.id !== undefined) {\r\n            this.props.history.push(\"/documents/\" + this.props.document.id)\r\n        }\r\n\r\n        // if (this.props.location.pathname.split('/').length > 2 &&\r\n        //     this.props.location.pathname.split('/')[2].length > 0 &&\r\n        //     this.props.document.id === undefined) {\r\n        //     this.props.history.push(\"/\");\r\n        // }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"App\">\r\n                <HeaderComponent\r\n                    title={this.props.title}\r\n                    version={this.props.version}\r\n                    isAuthenticated={this.props.isAuthenticated}\r\n                    username={this.props.username}\r\n                />\r\n\r\n                <AppBody/>\r\n\r\n                <Switch>\r\n                    {/*<Route path=\"/documents\" exact component={DocumentsComponent}/>*/}\r\n                    {/*<Route path=\"/signup\" component={Signup} />*/}\r\n                    {/*<Route path=\"/login\" component={Login} />*/}\r\n                    {/*<Route path=\"/logout\" component={Logout} />*/}\r\n\r\n                    <Route path=\"/demo\" exact component={Demo}/>\r\n                    {/*<Route path=\"/\" component={AppBody}/>*/}\r\n\r\n                    {/*<Route path=\"/documents/:id\" component={CloudDocument}/>*/}\r\n\r\n\r\n                    <Route path=\"/skeleton\" component={SkeletonRecognition}/>\r\n                    <Route path=\"/collision-distance\" component={CollisionDemo}/>\r\n\r\n                </Switch>\r\n\r\n                {this.props.showSpinner ? <Spinner/> : null}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({auth, app, cloudStorage}) => {\r\n    return {\r\n        title: app.title,\r\n        version: app.version,\r\n        showSpinner: app.showSpinner,\r\n        document: cloudStorage.document,\r\n        isAuthenticated: auth.token !== null,\r\n        username: auth.username\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        authCheckState: () => dispatch(authActions.authCheckState())\r\n    }\r\n};\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(App));\r\n\r\n/*\r\n                    <Route path=\"/boolean-test\" component={BooleanTest}/>\r\n */","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport {createStore, applyMiddleware, compose} from 'redux';\r\nimport {Provider} from 'react-redux';\r\nimport thunk from 'redux-thunk';\r\nimport {BrowserRouter} from 'react-router-dom';\r\n\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport reducer from './store/reducer';\r\nimport log from './middleware/log';\r\n// import readFiles from './middleware/readFiles';\r\nimport pasteData from './middleware/pasteData';\r\nimport stageController from './middleware/stageController';\r\nimport skeleton_recognition from './middleware/skeleton_recognition';\r\nimport App from \"./App\";\r\n\r\nimport './index.css';\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nconst store = createStore(reducer,\r\n    composeEnhancers(\r\n        applyMiddleware(log, pasteData, skeleton_recognition, stageController, thunk)\r\n    )\r\n);\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <BrowserRouter basename={process.env.PUBLIC_URL}>\r\n            <App/>\r\n        </BrowserRouter>\r\n    </Provider>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Button\":\"Button_Button__1wEe_\",\"IconTrigger\":\"Button_IconTrigger__2UBJg\",\"IconModeActive\":\"Button_IconModeActive__3BB17\",\"IconModeNotActive\":\"Button_IconModeNotActive__ekYF8\",\"DrawerButton\":\"Button_DrawerButton__3mmir\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"UploadPopup\":\"UploadPopup_UploadPopup__2OdfO\",\"fadeIn\":\"UploadPopup_fadeIn__1S7BJ\",\"UploadTarget\":\"UploadPopup_UploadTarget__3Q9VL\",\"UploadTargetDragLeave\":\"UploadPopup_UploadTargetDragLeave__39VIz\",\"UploadTargetDragOver\":\"UploadPopup_UploadTargetDragOver__1ADG3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer\":\"LayerListElement_Layer__TTm6c\",\"LayerSelectionBox\":\"LayerListElement_LayerSelectionBox__2y2BJ\",\"LayerSelectionMark\":\"LayerListElement_LayerSelectionMark__1YNk5\",\"LayerNameBox\":\"LayerListElement_LayerNameBox__rdxbt\",\"Layer-displayed\":\"LayerListElement_Layer-displayed__2ITp_\",\"Layer-undisplayed\":\"LayerListElement_Layer-undisplayed__v_ey_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ButtonSeparator\":\"ButtonSeparator_ButtonSeparator__1v1YA\",\"IconSeparator\":\"ButtonSeparator_IconSeparator__1F-6s\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-toolbar\":\"ToolbarComponent_App-toolbar__384Ol\",\"App-toolbar-units\":\"ToolbarComponent_App-toolbar-units__2xvim\",\"DrawerButton\":\"ToolbarComponent_DrawerButton__2XrL2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"BackDrop\":\"ModalPopup_BackDrop__38gqK\",\"ModalPopup\":\"ModalPopup_ModalPopup__tiHI3\",\"fadeIn\":\"ModalPopup_fadeIn__1kcV2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-layers\":\"LayersList_App-layers__W6LER\",\"App-layers-displayed\":\"LayersList_App-layers-displayed__vbZrT\",\"fadeIn\":\"LayersList_fadeIn__1Noko\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"HeaderComponent_App-header__3BtxE\",\"App-header-documents-page\":\"HeaderComponent_App-header-documents-page__cbwKd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"BackDrop\":\"Spinner_BackDrop__aToxg\",\"Loader\":\"Spinner_Loader__1wKrs\",\"load2\":\"Spinner_load2__o7gmt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-canvas\":\"CanvasComponent_App-canvas__1SRjy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-status-bar\":\"StatusComponent_App-status-bar__3yjbw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"LabelsLayer\":\"labelsLayer_LabelsLayer__13jtP\",\"LabelComponent\":\"labelsLayer_LabelComponent__1n-i4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"VertexLabel\":\"VertexLabel_VertexLabel__iBpcT\",\"fadeIn\":\"VertexLabel_fadeIn__2Bj9-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"AboutPopup\":\"AboutPopup_AboutPopup__3A-Ey\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"DownloadPopup\":\"DownloadPopup_DownloadPopup__3y--T\",\"fadeIn\":\"DownloadPopup_fadeIn__2guy3\",\"Open\":\"DownloadPopup_Open__1W2qy\",\"Close\":\"DownloadPopup_Close__2VKZE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Snackbar\":\"Snackbar_Snackbar__3lqm1\",\"fadeInOut\":\"Snackbar_fadeInOut__2XmEa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Main-content\":\"MainComponent_Main-content__1huDY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer-list-toolbar\":\"LayerListToolbar_Layer-list-toolbar__3h7SF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer-edit-form\":\"LayerEditForm_Layer-edit-form__3PKfb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-aside\":\"AsideComponent_App-aside__3lf4P\"};"],"sourceRoot":""}