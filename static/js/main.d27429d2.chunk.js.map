{"version":3,"sources":["serviceWorker.js","store/actionTypes.js","store/reducers/auth.js","models/createArcs.js","models/polygonOffset.js","models/job.js","dataParsers/parseFlighta.js","dataParsers/parser.js","store/reducers/app.js","models/model.js","models/layer.js","models/layers.js","store/reducers/layers.js","store/reducers/mouse.js","store/reducers/measureShapesTool.js","store/reducers/cloudStorage.js","store/reducers/upload.js","store/reducer.js","middleware/log.js","dataParsers/parseJSON.js","middleware/pasteData.js","middleware/stageController.js","middleware/skeleton_recognition.js","axios-database.js","store/actions/appActions.js","store/actions/layersActions.js","store/actions/cloudStorageActions.js","components/UI/Button/Button.js","components/UI/ButtonSeparator/ButtonSeparator.js","components/MainComponent/ToolbarComponent/ToolbarComponent.js","models/stage.js","store/actions/stageActions.js","components/MainComponent/CanvasComponent/CanvasComponent.js","components/Layout/StatusComponent/StatusComponent.js","components/MainComponent/GraphicsComponent/stageComponent.js","models/graphics.js","models/utils.js","components/MainComponent/GraphicsComponent/graphics/shapeComponent.js","components/MainComponent/GraphicsComponent/graphics/imageComponent.js","components/MainComponent/GraphicsComponent/layerComponent.js","components/MainComponent/GraphicsComponent/domelements/labelComponent.js","components/MainComponent/GraphicsComponent/LabelsLayerComponent/labelsLayerComponent.js","components/MainComponent/GraphicsComponent/domelements/VertexLabel/VertexLabel.js","components/MainComponent/GraphicsComponent/graphics/vertexComponent.js","components/MainComponent/GraphicsComponent/graphics/verticesComponent.js","components/MainComponent/GraphicsComponent/verticesLayerComponent.js","components/MainComponent/GraphicsComponent/layersComponent.js","tools/measurePointsTool.js","tools/measureShapesTool.js","tools/displayCoordsTool.js","components/UI/Modal.js","components/UI/ModalPopup/ModalPopup.js","components/AboutPopup/AboutPopup.js","dataParsers/createXML.js","components/DownloadPopup/DownloadPopup.js","components/UI/SnackbarRoot.js","components/UI/Snackbar/Snackbar.js","dataParsers/parserXML.js","dataParsers/parserODB.js","dataParsers/parsePGM.js","dataParsers/parseCSV.js","dataParsers/parseTXT.js","store/actions/upload.js","components/UploadPopup/UploadPopup.js","components/Constructions/CloudDocument.js","containers/MainComponent/MainComponent.js","components/LayersList/LayerListToolbar/LayerListToolbar.js","components/LayersList/LayerEditForm/LayerEditForm.js","components/LayersList/LayerListElement/LayerListElement.js","containers/LayerList/LayersList.js","components/Layout/AsideComponent/AsideComponent.js","AppBody.js","components/Layout/HeaderComponent/HeaderComponent.js","components/Constructions/Demo.js","components/Constructions/SkeletonRecognition.js","models/collisionDistance.js","components/Constructions/CollisionDemo.js","components/UI/Spinner/Spinner.js","store/actions/auth.js","App.js","index.js","components/UI/Button/Button.module.css","components/UploadPopup/UploadPopup.module.css","components/LayersList/LayerListElement/LayerListElement.module.css","components/UI/ButtonSeparator/ButtonSeparator.module.css","components/MainComponent/ToolbarComponent/ToolbarComponent.module.css","components/UI/ModalPopup/ModalPopup.module.css","containers/LayerList/LayersList.module.css","components/Layout/HeaderComponent/HeaderComponent.module.css","components/UI/Spinner/Spinner.module.css","components/MainComponent/CanvasComponent/CanvasComponent.module.css","components/Layout/StatusComponent/StatusComponent.module.css","components/MainComponent/GraphicsComponent/LabelsLayerComponent/labelsLayer.module.css","components/MainComponent/GraphicsComponent/domelements/VertexLabel/VertexLabel.module.css","components/AboutPopup/AboutPopup.module.css","components/DownloadPopup/DownloadPopup.module.css","components/UI/Snackbar/Snackbar.module.css","containers/MainComponent/MainComponent.module.css","components/LayersList/LayerListToolbar/LayerListToolbar.module.css","components/LayersList/LayerEditForm/LayerEditForm.module.css","components/Layout/AsideComponent/AsideComponent.module.css"],"names":["Boolean","window","location","hostname","match","NEW_STAGE_CREATED","STAGE_RESIZED","STAGE_UNMOUNTED","PAN_BY_DRAG_BUTTON_CLICKED","MEASURE_POINTS_BUTTON_PRESSED","MEASURE_SHAPES_BUTTON_PRESSED","TOGGLE_ABOUT_POPUP_CLICKED","TOGGLE_UNITS_CLICKED","TOGGLE_WIDTH_MODE_CLICKED","TOGGLE_DISPLAY_VERTICES_CLICKED","TOGGLE_DISPLAY_LABELS_CLICKED","TOGGLE_SHOW_LAYER_LIST_CLICKED","TOGGLE_DOWNLOAD_POPUP_CLICKED","TOGGLE_UPLOAD_POPUP_CLICKED","MOUSE_MOVED_ON_STAGE","MOUSE_DOWN_ON_STAGE","MOUSE_UP_ON_STAGE","MOUSE_WHEEL_MOVE_ON_STAGE","MOUSE_ROLL_OVER_SHAPE","MOUSE_ROLL_OUT_SHAPE","MOUSE_CLICKED_ON_SHAPE","PINCH_DOWN_ON_STAGE","PINCH_MOVED_ON_STAGE","PINCH_UP_ON_STAGE","PAN_AND_ZOOM_TO_SHAPE","ADD_LAYER_BUTTON_PRESSED","ADD_NEW_LAYER","DELETE_LAYER_BUTTON_PRESSED","SORT_LAYERS_BUTTON_PRESSED","TOGGLE_DISPLAY_LAYER_PRESSED","TOGGLE_AFFECTED_LAYER_PRESSED","OPEN_LAYER_EDIT_FORM_PRESSED","SUBMIT_LAYER_EDIT_FORM_PRESSED","ESCAPE_LAYER_EDIT_FORM_PRESSED","LAYERS_LIST_ARROW_DOWN_PRESSED","LAYERS_LIST_ARROW_UP_PRESSED","FILES_UPLOAD_COMPLETED","INITIALIZE_UPLOAD_STATE","DATA_FROM_BUFFER_PASTED","AABB_TREE_NEXT_LEVEL","SKELETON_RECOGNITION_URI","SKELETON_RECOGNITION_BUTTON_PRESSED","ASYNC_OPERATION_STARTED","ASYNC_OPERATION_ENDED","REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED","REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED","REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED","REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED","DELETE_DOCUMENT_FROM_DATABASE_SUCCEED","DOCUMENT_SELECTED_FROM_LIST","DOCUMENT_NAME_UPDATED","CLEAR_ALL_BUTTON_CLICKED","AUTHENTICATION_STARTED","AUTHENTICATION_SUCCEED","AUTHENTICATION_FAILED","AUTHENTICATION_LOGOUT","AUTHENTICATION_SET_USERNAME","initialState","token","userId","username","error","loading","auth","state","action","type","actionTypes","arcSE","center","start","end","counterClockwise","startAngle","vector","slope","endAngle","Utils","EQ","Math","PI","r","length","Arc","Flatten","BooleanOperations","BOOLEAN_UNION","unify","subtract","addToIntPoints","getSortedArray","splitByIntersections","removeNotRelevantChains","removeOldFaces","restoreFaces","offsetArc","arc","value","arc_cap1","arc_cap2","w","abs","polygon","Polygon","arc_outer","clone","sweep","arcStartSweep","arcEndSweep","arc_inner","undefined","pc","CW","CCW","Segment","addFace","faces","setArcLength","ips","Face","getSelfIntersections","edges","slice","edge_cap1","edge_cap2","int_points","pt","int_points_sorted","bv","OUTSIDE","int_point","edge_before","edge_after","INSIDE","num","next","prev","orientation","ORIENTATION","reverse","offsetSegment","seg","v_seg_unit","x","y","normalize","v_left","rotate90CCW","multiply","v_right","rotate90CW","seg_left","translate","seg_right","cap1","cap2","Job","this","filename","title","profiles","materials","shapes","b","Box","shape","merge","box","parseComplexShape","row_lines","loop_start","ps","pe","loop","poly","i","terms","split","point","parseInt","includes","segment","push","equalTo","parseToFlightaShapes","str","line","Parser","arrayOfLines","watchArray","substring","indexOf","parenth","isNaN","trim","Point","label","termArr","psArr","peArr","pcArr","Circle","pllArr","xmin","ymin","width","height","search","nedgesStr","nedges","j","parseToSegment","parseToArc","points","pointArr","parseToPoint","parseToCircle","parseToRectangle","parseToODBLine","parseToODBArc","parseToPolygon","size","parseToShapes","parseToPoints","unitsList","name","decimals","divisor","defaultAppState","version","process","build","units","parser","widthOn","displayVertices","displayLabels","measurePointsActive","zoomFactor","originX","originY","showAboutPopup","importDataToNewLayer","showSkeletonRecognitionButton","applySkeletonRecognition","stage","showSpinner","showLayerList","showDownloadPopup","showUploadPopup","app","ActionTypes","Object","assign","resolution","origin","curUnitsId","findIndex","newUnits","defaultStyle","strokeStyle","stroke","fill","alpha","Model","geom","style","model","Layer","color","displayed","edited","affected","layer","newShape","add","xmax","ymax","JSON","stringify","colors","Layers","layers","getNewName","defaultName","inc","comparator","find","lay","currentAffectedLayer","getAffected","col","index","l","newLayers","filter","getNextColor","sort","l1","l2","name1","toUpperCase","name2","map","toJSON","newLayer","affectedLayer","affectedLayerId","delete","setAffected","toggleDisplayed","setEdited","setNameAndTitle","nextLayer","newCurLayer","newNextLayer","defaultMouseState","startX","startY","touchPoints","mouse","x1","y1","x2","y2","defaultMeasureShapesTool","measureShapesActive","measureShapesFirstClick","hoveredShape","firstMeasuredShape","secondMeasuredShape","firstMeasuredLayer","secondMeasuredLayer","distance","shortestSegment","is_mobile","mobilecheck","measureShapesTool","shape1","shape2","Distance","documentDefaultState","id","owner","lastUpdated","cloudStorageDefaultState","document","documentsList","isUpToDate","stateDocumentsList","actionDocumentsList","keys","key","hasOwnProperty","cloudStorage","newList","defaultState","uploadStarted","uploadCompleted","uploadedFiles","upload","reducer","combineReducers","log","getState","dispatch","console","parseJSONShape","jsonShape","parseJSON","jsonArray","job","parse","e","Error","Array","faceArray","Image","uri","pasteData","data","items","getAsString","string","shapesArray","message","stageController","resize","panByMouseStart","dx","dy","panByMouseMove","panByMouseStop","panToCoordinate","zoomToLimits","bIn","delta","zoomByMouse","removeAllChildren","removeAllListeners","zoomByPinchStart","distStart","sqrt","ratio","zoomByPinchMove","zoomByPinchStop","Algorithmia","skeleton_recognition","currentLayer","input","nx","ny","client","algo","pipe","then","output","result","row","instance","axios","create","baseURL","setHomeView","asyncOperationStarted","asyncOperationEnded","addNewLayer","toggleDisplayLayer","deleteAllLayers","documents","values","fetchDocumentFromDatabase","layerActions","appActions","firstLayer","docUrl","geomUrl","Promise","all","get","responses","layerData","requestFetchDocumentFromDatabaseSucceed","catch","alert","addDocumentToDatabase","payload","history","post","response","layersJSON","geomPayload","registerDocumentAddedToDatabase","Date","now","updateDocumentInDatabase","put","url","geomId","reponse","button","props","iconStyle","classes","IconTrigger","active","IconModeActive","IconModeNotActive","buttonStyle","mobileOnly","onClick","className","iconName","buttonSeparator","ButtonSeparator","IconSeparator","ToolbarComponent","Button","onShowUploadPopupPressed","onLayerListButtonClicked","onSortLayersButtonClicked","onShowDownloadPopupPressed","onClearAllButtonClicked","onHomeButtonPressed","onPanByDragPressed","onMeasurePointsButtonPressed","onMeasureBetweenShapesButtonPressed","onToggleWidthModePressed","onToggleVerticesPressed","onToggleLabelsPressed","onSkeletonRecognitionButtonPressed","onUnitClicked","onShowAboutPopupPressed","Component","Stage","canvas","Touch","enable","mouseMoveOutside","enableMouseOver","clientWidth","clientHeight","oldOrigin","oldZoomFactor","pinchAnchorX","pinchAnchorY","pinchStarted","minX","C2W_X","minY","C2W_Y","maxX","maxY","addChild","scalar","scalingFactor","canvasX","canvasY","worldX","worldY","W2C_X","W2C_Y","newOrigin","deltaX","deltaY","curRatio","min","max","focusX","focusY","zoomIn","zoomOut","newFocusX","newFocusY","panBy","zoom","getContext","clearRect","CreatejsStage","handleMouseWheelMove","CanvasComponent","canvasElement","createRef","handleMouseMove","event","focus","nativeEvent","touches","clientX","target","offsetLeft","clientY","offsetTop","handlePinchMove","stageX","stageY","handleMouseDown","handlePinchDown","handleMouseUp","stopPropagation","preventDefault","handlePinchUp","handleMouseLeave","blur","body","handleMouseWheel","detail","wheelDelta","offsetX","offsetY","handleMouseWheelFox","layerX","layerY","current","on","addEventListener","passive","registerStage","tabIndex","ref","styles","connect","actions","StatusComponent","StageComponent","setTransform","update","onStageUnmounted","children","graphics","graphics_point","graphics_segment","graphics_arc","graphics_circle","graphics_box","graphics_polygon","radius","Graphics","beginFill","command","circle","drawCircle","ignoreScale","setStrokeStyle","beginStroke","moveTo","lineTo","endStroke","drawRect","setGraphicsEdge","edge","setGraphicsEdgeSegment","setGraphicsEdgeArc","setGraphicsFace","face","first","is_equal","obj1","obj2","equal","format","toFixed","ShapeComponent","params","handleMouseOver","onMouseOver","handleMouseOut","onMouseOut","handleClick","Shape","hovered","selected","aperture","isEmpty","redraw","nextProps","nextState","off","removeChild","clear","ImageComponent","bitmap","image","naturalWidth","naturalHeight","scaleX","scaleY","tx","ty","regX","regY","img","onload","Bitmap","onImageLoaded","setAttribute","src","loadImage","LayerComponent","forceUpdate","handleMouseRollOverShape","handleMouseRollOutShape","handleClickOnShape","labelComponent","left","top","position","LabelComponent","VertexLabel","vertex","VertexComponent","shadow","Shadow","setState","mouseEnabled","VerticesComponent","vertices","LayersComponent","MeasurePointsTool","measureCanvas","measureStage","endX","endY","measureStarted","cursor","draw","context","textX","textY","textWidth","backX","backY","pllX","pllY","W2C_Scalar","beginPath","rect","lineWidth","text","measurement","font","measureText","textAlign","fillStyle","globalAlpha","fillRect","textHeight","fillText","dist","removeAllEventListeners","mainCanvas","MeasureShapesTool","labelShape","Text","unscale","redrawLabel","DisplayCoordsTool","coordX","coordY","backgroundColor","opacity","margin","padding","modalRoot","getElementById","Modal","el","createElement","appendChild","ReactDOM","createPortal","ModalPopup","onBackDropClicked","ev","closePopup","handleKeyDown","code","elementDrag","dragX","dragY","element","closeDragElement","onmouseup","onmousemove","dragMouseDown","removeEventListener","showPopup","BackDrop","onMouseDown","header","AboutPopup","toggleAboutPopup","href","pointToXMLString","xw","startElement","writeAttribute","endElement","segmentToXMLString","arcToXMLString","round","circleToXMLString","polygonToXMlString","createXMLString","XMLWriter","startDocument","endDocument","toString","DownloadPopup","downloadData","xmlString","encodeURIComponent","download","snackbarRoot","SnackbarRoot","Snackbar","display","onAnimationEnd","parseEdges","edgesXML","from","getAttribute","parsePolygon","polygonsXML","islands","getElementsByTagName","holes","parseSegment","segmentXML","parseCurve","curveXML","parsePoint","pointXML","parseImage","imageXML","InchToPixels","Number","MilsToPixels","lines","end_of_face","parseLine","apertures","ap_value","parseArc","toPixels","micronToPixels","parseTXT","readAsText","reader","file","files","promise","resolve","reject","theFile","namesplitted","extension","xmlDoc","DOMParser","parseFromString","titles","firstChild","nodeValue","profilesXML","materialXML","segmentsXML","curvesXML","curve","pointsXML","imagesXML","parseXML","px","py","parseCSV","parseFlighta","substr","polarity","odbLine","odbArc","ap_key","parseODB","readAsImage","yStr","xStr","sizeX","readAsDataURL","readFile","FileReader","readFiles","promises","filesUploadCompleted","UploadPopup","inputElement","clipboardWindowRef","clipboardWindowWidth","clipboardWindowHeight","dragOver","clipboardData","openFilesButtonClicked","click","pasteHandler","onPaste","dropHandler","dataTransfer","kind","getAsFile","dragOverHandler","dragLeaveHandler","filesSelectedHandler","File","FileList","initUploadState","pX","pY","snackbarMessage","newFilesNum","UploadTarget","UploadTargetDragOver","UploadTargetDragLeave","paddingLeft","paddingRight","paddingTop","paddingBottom","onDrop","onDragOverCapture","onDragLeaveCapture","multiple","onChange","CloudDocument","done","cloudActions","MainComponent","onSaveDocumentButtonClicked","dataURL","toDataURL","toLocaleDateString","toLocaleTimeString","clearCurrentDocument","clearAllLayers","toggleWidthMode","toggleDisplayVertices","handlePaste","currentTarget","activeElement","tagName","pasteDataFromBuffer","onresize","resizeStage","handleKeyUp","displayCoordsTool","measurePointsTool","measuredLayersDisplayed","toggleUploadPopup","toggleLayerList","sortLayersList","toggleDownloadPopup","togglePanByDrag","toggleMeasureBetweenPoints","toggleMeasureBetweenShapes","toggleDisplayLabels","toggleUnits","destroyStage","path","component","ownProps","LayerListToolbar","onEditLayerButtonClicked","onDeleteLayerButtonClicked","LayerEditForm","onSubmitLayerEditForm","setFocus","onSubmit","onMouseMove","defaultValue","cols","rows","onEscapeLayerEditForm","parent","LayerListElement","nodeName","elem","refs","layerName","hex","g","percent","replace","rgba","bgcolor","layerNameOpacity","onLayerClicked","onDoubleClick","onLayerDoubleClicked","LayerSelectionBox","onAffectedBoxClicked","LayerSelectionMark","LayerNameBox","LayersList","parentElement","setAffectedNextLayer","setAffectedPrevLayer","onLayerListClicked","layersComponent","maxHeight","AsideComponent","updateDocumentName","Fragment","onManageCloudStorageButtonClicked","withRouter","pathname","Demo","resp","panAndZoomToShape","SkeletonRecognition","CollisionDistance","polygon1","polygon2","collision_distance","POSITIVE_INFINITY","edge2polygon","edge2","shapeBox","NEGATIVE_INFINITY","resp_edges","edge1","segment2segment","segment2arc","arc2arc","intersections","Line","Vector","intersect","ip","distanceTo","segment1","segment2","point2shape","v_s","v","tangent_point","arc1","arc2","arc_enlarged","translateArc","dist_tmp","EQ_0","GE","arc_reduced","LT","vec","arc_tmp","newPolygon","arc_trans","CollisionDemo","collision","apply","polygon3","applyCollisionDemo","spinner","Loader","authStart","authSucceed","authFailed","logout","localStorage","removeItem","checkAuthTimeout","expirationTime","setTimeout","email","getItem","password","logIn","authData","returnSecureToken","setItem","expirationDate","getTime","expiresIn","idToken","localId","queryParams","authSetUsername","App","authCheckState","isAuthenticated","AppBody","exact","Spinner","timeLeft","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","render","basename","navigator","serviceWorker","ready","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.d27429d2.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n\n              // Execute callback\n              if (config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nexport const NEW_STAGE_CREATED = \"NEW_STAGE_CREATED\";\r\nexport const STAGE_RESIZED = \"STAGE_RESIZED\";\r\nexport const NEW_SHAPE_PASTED = \"NEW_SHAPE_PASTED\";\r\nexport const CLEAR_ALL = \"CLEAR_ALL\";\r\nexport const STAGE_UNMOUNTED = \"STAGE_UNMOUNTED\";\r\n\r\n/** Toolbar buttons **/\r\nexport const PAN_BY_DRAG_BUTTON_CLICKED = \"PAN_BY_DRAG_BUTTON_CLICKED\";\r\n// export const SAVE_DOCUMENT_BUTTON_CLICKED = \"SAVE_DOCUMENT_BUTTON_CLICKED\";\r\nexport const MANAGE_CLOUD_STORAGE_BUTTON_CLICKED = \"MANAGE_CLOUD_STORAGE_BUTTON_CLICKED\";\r\n\r\nexport const MEASURE_POINTS_BUTTON_PRESSED = \"MEASURE_POINTS_BUTTON_PRESSED\";\r\nexport const MEASURE_SHAPES_BUTTON_PRESSED = \"MEASURE_SHAPES_BUTTON_PRESSED\";\r\nexport const TOGGLE_ABOUT_POPUP_CLICKED = \"TOGGLE_ABOUT_POPUP_CLICKED\";\r\n// export const CLOSE_ABOUT_POPUP_BUTTON_PRESSED = \"CLOSE_ABOUT_POPUP_BUTTON_PRESSED\";\r\nexport const TOGGLE_UNITS_CLICKED = \"TOGGLE_UNITS_CLICKED\";\r\nexport const TOGGLE_WIDTH_MODE_CLICKED = \"TOGGLE_WIDTH_MODE_CLICKED\";\r\nexport const TOGGLE_DISPLAY_VERTICES_CLICKED = \"TOGGLE_DISPLAY_VERTICES_CLICKED\";\r\nexport const TOGGLE_DISPLAY_LABELS_CLICKED = \"TOGGLE_DISPLAY_LABELS_CLICKED\";\r\nexport const TOGGLE_SHOW_LAYER_LIST_CLICKED = \"TOGGLE_SHOW_LAYER_LIST_CLICKED\";\r\nexport const TOGGLE_DOWNLOAD_POPUP_CLICKED = \"TOGGLE_DOWNLOAD_POPUP_CLICKED\";\r\nexport const TOGGLE_UPLOAD_POPUP_CLICKED=\"TOGGLE_UPLOAD_POPUP_CLICKED\";\r\n\r\nexport const MOUSE_MOVED_ON_STAGE = \"MOUSE_MOVED_ON_STAGE\";\r\nexport const MOUSE_DOWN_ON_STAGE = \"MOUSE_DOWN_ON_STAGE\";\r\nexport const MOUSE_UP_ON_STAGE = \"MOUSE_UP_ON_STAGE\";\r\nexport const MOUSE_WHEEL_MOVE_ON_STAGE = \"MOUSE_WHEEL_MOVE_ON_STAGE\";\r\n\r\nexport const MOUSE_ROLL_OVER_SHAPE = \"MOUSE_ROLL_OVER_SHAPE\";\r\nexport const MOUSE_ROLL_OUT_SHAPE = \"MOUSE_ROLL_OUT_SHAPE\";\r\nexport const MOUSE_CLICKED_ON_SHAPE = \"MOUSE_CLICKED_ON_SHAPE\";\r\n\r\nexport const PINCH_DOWN_ON_STAGE = \"PINCH_DOWN_ON_STAGE\";\r\nexport const PINCH_MOVED_ON_STAGE = \"PINCH_MOVED_ON_STAGE\";\r\nexport const PINCH_UP_ON_STAGE = \"PINCH_UP_ON_STAGE\";\r\n\r\n// export const HOME_BUTTON_CLICKED = \"HOME_BUTTON_CLICKED\";\r\nexport const PAN_TO_COORDINATE = \"PAN_TO_COORDINATE\";\r\nexport const PAN_AND_ZOOM_TO_SHAPE = \"PAN_AND_ZOOM_TO_SHAPE\";\r\n\r\nexport const LAYER_LIST_PANEL_PRESSED = \"LAYER_LIST_PANEL_PRESSED\";\r\nexport const ADD_LAYER_BUTTON_PRESSED = \"ADD_LAYER_BUTTON_PRESSED\";\r\nexport const ADD_NEW_LAYER = \"ADD_NEW_LAYER\";\r\nexport const DELETE_LAYER_BUTTON_PRESSED = \"DELETE_LAYER_BUTTON_PRESSED\";\r\nexport const SORT_LAYERS_BUTTON_PRESSED = \"SORT_LAYERS_BUTTON_PRESSED\";\r\nexport const CLEAN_AND_UPDATE_LAYERS = \"CLEAN_AND_UPDATE_LAYERS\";\r\n\r\nexport const TOGGLE_DISPLAY_LAYER_PRESSED = \"TOGGLE_DISPLAY_LAYER_PRESSED\";\r\nexport const TOGGLE_AFFECTED_LAYER_PRESSED=\"TOGGLE_AFFECTED_LAYER_PRESSED\";\r\nexport const OPEN_LAYER_EDIT_FORM_PRESSED = \"OPEN_LAYER_EDIT_FORM_PRESSED\";\r\nexport const SUBMIT_LAYER_EDIT_FORM_PRESSED = \"SUBMIT_LAYER_EDIT_FORM_PRESSED\";\r\nexport const ESCAPE_LAYER_EDIT_FORM_PRESSED = \"ESCAPE_LAYER_EDIT_FORM_PRESSED\";\r\n\r\nexport const LAYERS_LIST_ARROW_DOWN_PRESSED = \"LAYERS_LIST_ARROW_DOWN_PRESSED\";\r\nexport const LAYERS_LIST_ARROW_UP_PRESSED = \"LAYERS_LIST_ARROW_UP_PRESSED\";\r\n\r\n// export const TOGGLE_WATCH_EXPAND_CLICKED = \"TOGGLE_WATCH_EXPAND_CLICKED\";\r\n\r\n// export const FILENAME_LIST_SELECTED = \"FILENAME_LIST_SELECTED\";\r\nexport const FILES_UPLOAD_COMPLETED = \"FILES_UPLOAD_COMPLETED\";\r\nexport const INITIALIZE_UPLOAD_STATE = \"INITIALIZE_UPLOAD_STATE\";\r\nexport const DATA_FROM_BUFFER_PASTED = \"DATA_FROM_BUFFER_PASTED\";\r\n\r\n/** AABB Distance Measurement Demo **/\r\nexport const AABB_DEMO_URI = \"AABB_DEMO_URI\";\r\nexport const AABB_DEMO_NEXT_DIST_STEP = \"AABB_DEMO_NEXT_DIST_STEP\";\r\nexport const AABB_TREE_NEXT_LEVEL = \"AABB_TREE_NEXT_LEVEL\";\r\n\r\n/** Collision demo **/\r\nexport const COLLISION_DEMO_URI = \"COLLISION_DEMO_URI\";\r\nexport const COLLISION_DEMO_BUTTON_PRESSED = \"COLLISION_DEMO_BUTTON_PRESSED\";\r\n\r\n/** Skeleton recognition demo **/\r\nexport const SKELETON_RECOGNITION_URI = \"SKELETON_RECOGNITION_URI\";\r\nexport const SKELETON_RECOGNITION_BUTTON_PRESSED=\"SKELETON_RECOGNITION_BUTTON_PRESSED\";\r\n\r\nexport const ASYNC_OPERATION_STARTED = \"ASYNC_OPERATION_STARTED\";\r\nexport const ASYNC_OPERATION_ENDED = \"ASYNC_OPERATION_ENDED\";\r\n\r\n/** Documents list **/\r\nexport const REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED = \"REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED\";\r\nexport const REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED = \"REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED\";\r\nexport const REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED = \"REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED\";\r\nexport const REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED = \"REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED\";\r\nexport const DELETE_DOCUMENT_FROM_DATABASE_SUCCEED = \"DELETE_DOCUMENT_FROM_DATABASE_SUCCEED\";\r\nexport const DOCUMENT_SELECTED_FROM_LIST = \"DOCUMENT_SELECTED_FROM_LIST\";\r\nexport const DOCUMENT_NAME_UPDATED = \"DOCUMENT_NAME_UPDATED\";\r\nexport const CLEAR_ALL_BUTTON_CLICKED = \"CLEAR_ALL_BUTTON_CLICKED\";\r\n\r\n/* Authentication */\r\nexport const AUTHENTICATION_STARTED = \"AUTHENTICATION_STARTED\";\r\nexport const AUTHENTICATION_SUCCEED = \"AUTHENTICATION_SUCCEED\";\r\nexport const AUTHENTICATION_FAILED = \"AUTHENTICATION_FAILED\";\r\nexport const AUTHENTICATION_LOGOUT = \"AUTHENTICATION_LOGOUT\";\r\nexport const AUTHENTICATION_SET_USERNAME = \"AUTENTICATION_SET_USERNAME\";\r\n\r\n","import * as actionTypes from '../actionTypes';\r\n\r\nconst initialState = {\r\n    token: null,\r\n    userId: null,\r\n    username: null,\r\n    error: null,\r\n    loading: false\r\n};\r\n\r\nconst auth = (state=initialState, action) => {\r\n    switch (action.type) {\r\n        case actionTypes.AUTHENTICATION_STARTED:\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                loading: true\r\n            };\r\n        case actionTypes.AUTHENTICATION_SUCCEED:\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                token: action.token,\r\n                userId: action.userId,\r\n                username: action.username,\r\n                loading: false\r\n            };\r\n        case actionTypes.AUTHENTICATION_FAILED:\r\n            return {\r\n                ...state,\r\n                error: action.error,\r\n                token: null,\r\n                userId: null,\r\n                username: null,\r\n                loading: false\r\n            };\r\n        case actionTypes.AUTHENTICATION_LOGOUT:\r\n            return {\r\n                ...state,\r\n                token: null,\r\n                userId: null,\r\n                username: null\r\n            };\r\n        case actionTypes.AUTHENTICATION_SET_USERNAME:\r\n            return {\r\n                ...state,\r\n                username: action.username\r\n            };\r\n        default:\r\n            return state\r\n    }\r\n};\r\n\r\nexport default auth;","import {Utils, Arc, vector} from \"@flatten-js/core\";\r\n\r\nexport function arcSE(center, start, end, counterClockwise) {\r\n    let startAngle = vector(center,start).slope;\r\n    let endAngle = vector(center, end).slope;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, start).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\nexport function arcStartSweep(center, start, sweep, counterClockwise) {\r\n    let startAngle = vector(center,start).slope;\r\n    let endAngle = startAngle + sweep;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, start).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\nexport function arcEndSweep(center, end, sweep, counterClockwise) {\r\n    let endAngle = vector(center,end).slope;\r\n    let startAngle = endAngle - sweep;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, end).length;\r\n\r\n    return new Arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\n","\r\n/**\r\n * Created by Alex Bol on 12/02/2018.\r\n */\r\nimport {Segment, Arc, Polygon, Face} from \"@flatten-js/core\";\r\nimport {CW, CCW, INSIDE, OUTSIDE, ORIENTATION} from \"@flatten-js/core\";\r\nimport {vector} from \"@flatten-js/core\";\r\nimport Flatten from \"@flatten-js/core\";\r\nimport {arcSE, arcStartSweep, arcEndSweep} from \"./createArcs\";\r\n\r\nconst {unify, subtract, BOOLEAN_UNION} = Flatten.BooleanOperations;\r\nconst {addToIntPoints, getSortedArray, splitByIntersections} = Flatten.BooleanOperations;\r\nconst {removeNotRelevantChains, removeOldFaces, restoreFaces} = Flatten.BooleanOperations;\r\n\r\n/**\r\n * Offset polygon by given value\r\n * @param {Polygon} polygon - input polygon\r\n * @param {number} value - offset value, may be positive or negative\r\n * @returns {Polygon} offsetPolygon\r\n */\r\n\r\n/**\r\n *\r\n * @param polygon\r\n * @param value\r\n *\r\n */\r\nexport function offset(polygon, value) {\r\n    let w = value;\r\n\r\n    let edges = [...polygon.edges];\r\n    let offsetPolygon = polygon.clone();\r\n    let offsetEdge;\r\n\r\n    if (w !== 0) {\r\n\r\n        for (let edge of edges) {\r\n            if (edge.isSegment()) {\r\n                offsetEdge = offsetSegment(edge.shape, w);\r\n            }\r\n            else {\r\n                offsetEdge = offsetArc(edge.shape, w);\r\n            }\r\n\r\n            if (w > 0) {\r\n                offsetPolygon = unify(offsetPolygon, offsetEdge);\r\n            }\r\n            else {\r\n                offsetPolygon = subtract(offsetPolygon, offsetEdge);\r\n            }\r\n        }\r\n    }\r\n\r\n    return offsetPolygon;\r\n}\r\n\r\nexport function offsetArc(arc, value) {\r\n\r\n    let w = Math.abs(value);\r\n\r\n    // Define outline polygon\r\n    let polygon = new Polygon();\r\n    let arc_cap1,arc_cap2;\r\n\r\n    let arc_outer = arc.clone();\r\n    arc_outer.r = arc.r + w;\r\n\r\n    arc_cap1 = arcStartSweep(arc.end, arc_outer.end, Math.PI, arc.counterClockwise);\r\n    arc_cap2 = arcEndSweep(arc.start, arc_outer.start, Math.PI, arc.counterClockwise);\r\n\r\n    let arc_inner = undefined;\r\n    if (arc.r > w) {\r\n        arc_inner = new Arc(arc.pc, arc.r - w, arc.endAngle, arc.startAngle,\r\n            arc.counterClockwise === CW ? CCW : CW);\r\n    }\r\n    else {\r\n        // arc_inner = new Arc(arc.pc, w - arc.r, arc.startAngle, arc.endAngle, arc.counterClockwise);\r\n        arc_inner = new Segment(arc_cap1.end, arc_cap2.start);\r\n    }\r\n\r\n    polygon.addFace([arc_outer, arc_cap1, arc_inner, arc_cap2]);\r\n    [...polygon.faces][0].setArcLength();\r\n\r\n    // Create intersection points\r\n    let ips = Face.getSelfIntersections([...polygon.faces][0], polygon.edges, false);\r\n\r\n    // TODO: getSelfIntersections returns points with correspondent edges - avoid duplication\r\n    ips = ips.slice(0,ips.length/2);    // for now slice array to avoid duplication in points\r\n\r\n    let int_points = [];\r\n    let edge_cap1;\r\n    let edge_cap2;\r\n\r\n    edge_cap1 = [...polygon.edges][1];\r\n    edge_cap2 = [...polygon.edges][3];\r\n\r\n    for (let pt of ips) {\r\n        addToIntPoints(edge_cap1, pt, int_points);\r\n        addToIntPoints(edge_cap2, pt, int_points);\r\n    }\r\n\r\n    // Sort intersection points and insert them as new vertices\r\n    let int_points_sorted = getSortedArray(int_points);\r\n    splitByIntersections(polygon, int_points_sorted);\r\n\r\n\r\n    // Set BV flags\r\n    let bv = OUTSIDE;\r\n    for (let int_point of int_points_sorted) {\r\n        int_point.edge_before.bv = bv;\r\n        int_point.edge_after.bv = (bv === OUTSIDE ? INSIDE : OUTSIDE);\r\n        bv = int_point.edge_after.bv;   // invert flag on each iteration\r\n    }\r\n\r\n    // Remove inner \"chains\"\r\n    let op = BOOLEAN_UNION;\r\n    removeNotRelevantChains(polygon, op, int_points_sorted, true);\r\n\r\n    // return int_points_sorted;\r\n    // Swap links\r\n    let num = int_points.length;\r\n    if (num > 0) {\r\n        let edge_before;\r\n        let edge_after;\r\n        // 0 => 3\r\n        edge_before = int_points_sorted[0].edge_before;\r\n        edge_after = int_points_sorted[num-1].edge_after;\r\n        edge_before.next = edge_after;\r\n        edge_after.prev = edge_before;\r\n\r\n        // Fill in missed links in intersection points\r\n        int_points_sorted[0].edge_after = int_points_sorted[num-1].edge_after;\r\n        int_points_sorted[num-1].edge_before = int_points_sorted[0].edge_before;\r\n\r\n        if (num === 4) {\r\n            // 2 => 1\r\n            edge_before = int_points_sorted[2].edge_before;\r\n            edge_after = int_points_sorted[1].edge_after;\r\n            edge_before.next = edge_after;\r\n            edge_after.prev = edge_before;\r\n\r\n            // Fill in missed links in intersection points\r\n            int_points_sorted[2].edge_after = int_points_sorted[1].edge_after;\r\n            int_points_sorted[1].edge_before = int_points_sorted[2].edge_before;\r\n        }\r\n\r\n        // remove old faces\r\n        removeOldFaces(polygon, int_points);\r\n        // restore faces\r\n        restoreFaces(polygon, int_points, int_points);\r\n    }\r\n\r\n    let face0 = [...polygon.faces][0];\r\n    if (face0.orientation() === ORIENTATION.CCW) {\r\n        polygon.reverse();\r\n    }\r\n    return polygon;\r\n}\r\n\r\nexport function offsetSegment(seg, value) {\r\n    let w = Math.abs(value);\r\n\r\n    let polygon = new Polygon();\r\n    let v_seg = vector(seg.end.x-seg.start.x, seg.end.y-seg.start.y);\r\n    let v_seg_unit = v_seg.normalize();\r\n    let v_left = v_seg_unit.rotate90CCW().multiply(w);\r\n    let v_right = v_seg_unit.rotate90CW().multiply(w);\r\n    let seg_left = seg.translate(v_left);\r\n    let seg_right = seg.translate(v_right).reverse();\r\n    let cap1 = arcSE(seg.end, seg_left.end, seg_right.start, CW);\r\n    let cap2 = arcSE(seg.start, seg_right.end, seg_left.start, CW);\r\n\r\n    polygon.addFace([seg_left, cap1, seg_right, cap2]);\r\n    return polygon;\r\n}\r\n","import {Box} from '@flatten-js/core';\r\n\r\nexport class Job {\r\n    constructor() {\r\n        this.filename = \"\";\r\n        this.title = \"\";\r\n        this.profiles = [];   // array of FlattenJS Polygons\r\n        this.materials = [];  // array of FlattenJS Polygons\r\n        this.shapes = [];     // array of other FlattenJS shapes\r\n    }\r\n\r\n    get box() {\r\n        let b = new Box();\r\n        for (let shape of this.profiles) {\r\n            b.merge(shape.box);\r\n        }\r\n        for (let shape of this.materials) {\r\n            b.merge(shape.box);\r\n        }\r\n        for (let shape of this.shapes) {\r\n            b.merge(shape.box);\r\n        }\r\n        return b;\r\n    }\r\n}","import { Job } from '../models/job';\r\nimport {point, segment, arc, Polygon, Utils, vector} from '@flatten-js/core';\r\n\r\nfunction arcSE(center, start, end, counterClockwise) {\r\n    let startAngle = vector(center, start).slope;\r\n    let endAngle = vector(center, end).slope;\r\n    if (Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2 * Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(center, start).length;\r\n\r\n    return arc(center, r, startAngle, endAngle, counterClockwise);\r\n}\r\n\r\nfunction parseComplexShape(row_lines, start, end) {\r\n    let loop = [];\r\n    let loop_start;\r\n    let ps;\r\n    let pe;\r\n    let pc;\r\n    let shape;\r\n    let poly = new Polygon();\r\n\r\n    for (let i = start + 1; i < end; i++) {\r\n        let terms = row_lines[i].split(\" \");\r\n\r\n        if (terms[0] === \"A\") {\r\n            ps = point(parseInt(terms[5]), parseInt(terms[6]));\r\n            pe = point(parseInt(terms[7]), parseInt(terms[8]));\r\n            pc = point(parseInt(terms[9]), parseInt(terms[10]));\r\n            let counterClockwise = terms[12].includes(\"1\") ? true : false;\r\n            shape = arcSE(pc, ps, pe, counterClockwise);\r\n        } else if (terms[0] === \"L\") {\r\n            ps = point(parseInt(terms[1]), parseInt(terms[2]));\r\n            pe = point(parseInt(terms[3]), parseInt(terms[4]));\r\n            shape = segment(ps, pe);\r\n        }\r\n\r\n        if (loop.length === 0) {\r\n            loop_start = ps;\r\n        }\r\n\r\n        loop.push(shape);\r\n\r\n        if (pe.equalTo(loop_start)) {\r\n            poly.addFace(loop);\r\n            loop = [];\r\n        }\r\n    }\r\n\r\n    return poly;\r\n}\r\n\r\nexport function parseToFlightaShapes(str) {\r\n    let start = null;\r\n    let end = null;\r\n    let shapes = [];\r\n    let row_lines = str.match(/[^\\r\\n]+/g);\r\n    for (let i = 0; i < row_lines.length; i++) {\r\n        let line = row_lines[i].split(\" \");\r\n\r\n        if (line[0] === \"S\") {\r\n            start = i;\r\n            continue;\r\n        }\r\n\r\n        if (line[0] === \"E\" && start !== null) {\r\n            end = i;\r\n            let poly = parseComplexShape(row_lines, start, end);\r\n            start = null;\r\n            end = null;\r\n            shapes.push(poly)\r\n        }\r\n    }\r\n    return shapes;\r\n}\r\n\r\nexport function parseFlighta(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n    job.shapes = parseToFlightaShapes(str);\r\n    return job;\r\n}\r\n","/**\r\n * Created by alexanderbol on 01/05/2017.\r\n */\r\n\r\nimport {Point, Segment, Arc, Circle, Box, Polygon, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\nimport {offsetSegment, offsetArc} from \"../models/polygonOffset\";\r\nimport {parseToFlightaShapes} from \"./parseFlighta\";\r\n\r\n/*\r\nlet debug_str = `\r\n+\t\t[0]\t{nrec=27 nalloc=27 h_ind_id=-1 ...} mat_cont_hdr_struc\tmat_cont_struc\r\n+\t\t[1]\t{pmin=59146400,5973200 pmax=59606001,6438000} mat_cont_lim_struc\tmat_cont_struc\r\n+\t\t[2]\t{nedge=23 nalloc=25 ntop=2 ...} mat_cont_poly_struc\tmat_cont_struc\r\n+\t\t[3]\t{pmin=59146400,5973200 pmax=59606001,6438000} mat_cont_lim_struc\tmat_cont_struc\r\n+\t\t[4]\t{ps=59192738,6363124 pe=59216000,6372800 pc=59216000,6340000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[5]\t{ps=59216000,6372800 pe=59267652,6372800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[6]\t{ps=59267652,6372800 pe=59267652,6307200 pc=59360000,6340000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[7]\t{ps=59267652,6307200 pe=59229586,6307200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[8]\t{ps=59229586,6307200 pe=59212000,6289614} mat_seg_struc\tmat_cont_struc\r\n+\t\t[9]\t{ps=59212000,6289614 pe=59212000,6056386} mat_seg_struc\tmat_cont_struc\r\n+\t\t[10]\t{ps=59212000,6056386 pe=59229586,6038800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[11]\t{ps=59229586,6038800 pe=59469614,6038800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[12]\t{ps=59469614,6038800 pe=59487200,6056386} mat_seg_struc\tmat_cont_struc\r\n+\t\t[13]\t{ps=59487200,6056386 pe=59487200,6100500} mat_seg_struc\tmat_cont_struc\r\n+\t\t[14]\t{ps=59487200,6100500 pe=59434000,6180000 pc=59520000,6180000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[15]\t{ps=59434000,6180000 pe=59552800,6100500 pc=59520000,6180000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[16]\t{ps=59552800,6100500 pe=59552800,6042800} mat_seg_struc\tmat_cont_struc\r\n+\t\t[17]\t{ps=59552800,6042800 pe=59543124,6019538 pc=59520000,6042800 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[18]\t{ps=59543124,6019538 pe=59506462,5982876} mat_seg_struc\tmat_cont_struc\r\n+\t\t[19]\t{ps=59506462,5982876 pe=59483200,5973200 pc=59483200,6006000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[20]\t{ps=59483200,5973200 pe=59216000,5973200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[21]\t{ps=59216000,5973200 pe=59192738,5982876 pc=59216000,6006000 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[22]\t{ps=59192738,5982876 pe=59156076,6019538} mat_seg_struc\tmat_cont_struc\r\n+\t\t[23]\t{ps=59156076,6019538 pe=59146400,6042800 pc=59179200,6042800 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[24]\t{ps=59146400,6042800 pe=59146400,6303200} mat_seg_struc\tmat_cont_struc\r\n+\t\t[25]\t{ps=59146400,6303200 pe=59156076,6326462 pc=59179200,6303200 cw=1} mat_curve_struc\tmat_cont_struc\r\n+\t\t[26]\t{ps=59156076,6326462 pe=59192738,6363124} mat_seg_struc\tmat_cont_struc\r\n`;\r\n*/\r\n\r\n/*\r\n+\t\tcircle\t{pc=40445880,-10500080 r=41327880}\tmat_circle_struc\r\n+\t\tcircle\t{pc=38215880,-7700040 r=92456}\tmat_circle_struc\r\n+\t\trect\t{pll=38215880,-7700040 w=92456 h=50000}\tmat_rect_struc\r\n+\t\tshape1\t{type=512 s={...} }\t_mat_shape_struc\r\n+\t\tline\t{ps=-18423,529080 pe=1047776,480195 r=60000 cap=0}\tmat_line_struc\r\n+\t\tarc\t{ps=1001217,249728 pe=752127,51853 pc=853697,179712 cw=??? r=60000 cap=0}\tmat_arc_struc\r\n */\r\n\r\nexport class Parser {\r\n    parseToWatchArray(str) {\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n        let watchArray = [];\r\n        for (let line of arrayOfLines) {\r\n            watchArray.push(line.substring(line.indexOf('{')));\r\n        }\r\n        return watchArray;\r\n    }\r\n\r\n    parseToPoint(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let x, y;\r\n        // try to parse format: {p=7496986,-4460045}\r\n        x = parseInt(parenth.split('=')[1].split(',')[0],10);\r\n        y = parseInt(parenth.split('=')[1].split(',')[0],10);\r\n        if (isNaN(x) || isNaN(y)) {\r\n            // try to parse format: {x=7169200 y=3521200 }\r\n            x = parseInt(parenth.trim().split(' ')[0].split('=')[1],10);\r\n            y = parseInt(parenth.trim().split(' ')[1].split('=')[1],10);\r\n        }\r\n        //let pointArr = parenth.split('=')[1].split(',');\r\n        //let point = new Point(parseInt(pointArr[0],10), parseInt(pointArr[1],10));\r\n        let point = new Point(x,y);\r\n        point.label = line.split(/\\s+/)[1];\r\n        return point;\r\n    }\r\n\r\n    parseToSegment(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        return new Segment(ps, pe);\r\n    }\r\n\r\n    parseToArc(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let pcArr = termArr[2].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n\r\n        let cwStr = termArr[3].split('=')[1];\r\n        let counterClockwise = cwStr === '0' ? true : false;\r\n\r\n        let startAngle = vector(pc,ps).slope;\r\n        let endAngle = vector(pc, pe).slope;\r\n\r\n        if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n            // endAngle += 2*Math.PI;\r\n            endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n        }\r\n        let r = vector(pc, ps).length;\r\n\r\n        return new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n    }\r\n\r\n    parseToCircle(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let pcArr = termArr[0].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n        let r = parseInt(termArr[1].split('=')[1],10);\r\n        // let circle = new Circle(pc, r);\r\n        // let polygon = new Polygon();\r\n        // polygon.addFace(circle);\r\n        return new Circle(pc, r);;\r\n    }\r\n\r\n    parseToRectangle(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let pllArr = termArr[0].split('=')[1].split(',');\r\n        let xmin = parseInt(pllArr[0],10);\r\n        let ymin = parseInt(pllArr[1],10);\r\n        let width = parseInt(termArr[1].split('=')[1],10);\r\n        let height = parseInt(termArr[2].split('=')[1],10);\r\n\r\n        let box = new Box(xmin, ymin, xmin + width, ymin + height);\r\n        let polygon = new Polygon();\r\n        polygon.addFace(box);\r\n        return polygon;\r\n        // return new Box(xmin, ymin, xmin + width, ymin + height);\r\n    }\r\n\r\n    parseToODBLine(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let w = parseInt(termArr[2].split('=')[1],10);\r\n\r\n        let segment = new Segment(ps, pe);\r\n        let polygon = w > 0 ? offsetSegment(segment, w) : new Polygon();\r\n\r\n        return polygon;\r\n    }\r\n\r\n    parseToODBArc(line) {\r\n        let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n        let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n        let psArr = termArr[0].split('=')[1].split(',');\r\n        let ps = new Point(parseInt(psArr[0],10), parseInt(psArr[1],10));\r\n\r\n        let peArr = termArr[1].split('=')[1].split(',');\r\n        let pe = new Point(parseInt(peArr[0],10), parseInt(peArr[1],10));\r\n\r\n        let pcArr = termArr[2].split('=')[1].split(',');\r\n        let pc = new Point(parseInt(pcArr[0],10), parseInt(pcArr[1],10));\r\n\r\n        let cwStr = termArr[3].split('=')[1];\r\n        let counterClockwise = cwStr === '0' ? true : false;\r\n\r\n        let startAngle = vector(pc,ps).slope;\r\n        let endAngle = vector(pc, pe).slope;\r\n\r\n        if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n            // endAngle += 2*Math.PI;\r\n            endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n        }\r\n        let r = vector(pc, ps).length;\r\n\r\n        let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n        let w = parseInt(termArr[4].split('=')[1],10);\r\n\r\n        let polygon = w > 0 ? offsetArc(arc, w) : new Polygon();\r\n\r\n        return polygon;\r\n    }\r\n\r\n    parseToPolygon(str) {\r\n        let polygon = new Polygon();\r\n        // let mulitystr = debug_str;\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n\r\n        for (let i=0; i < arrayOfLines.length; i++) {\r\n            let line = arrayOfLines[i];\r\n            if (line.search('mat_cont_poly_struc') >= 0) {\r\n                let parenth = line.match(/\\{([^)]+)\\}/)[1];       // string inside {..}\r\n                let termArr = parenth.split(' ');                 // array of terms \"attr=value\"\r\n                let nedgesTerm = termArr[0];                      // \"nedge=nn\"\r\n                let nedgesStr = nedgesTerm.split('=')[1];\r\n                let nedges = parseInt(nedgesStr,10);\r\n\r\n                // Create new face from next #nedges of segments and arcs\r\n                let edges = [];\r\n                for (let j=i+2; j < i+2+nedges; j++) {\r\n                    line = arrayOfLines[j];\r\n                    // let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n                    // let termArr = parenth.split(' ');             // array of terms \"attr=value\"\r\n\r\n                    if (line.search('mat_seg_struc') >= 0) {\r\n                        let segment = this.parseToSegment(line);\r\n                        edges.push(segment);\r\n                    }\r\n                    else if (line.search('mat_curve_struc') >= 0) {\r\n                        let arc = this.parseToArc(line);\r\n                        edges.push(arc);\r\n                    }\r\n                }\r\n                polygon.addFace(edges);\r\n            }\r\n        }\r\n        return polygon;\r\n    }\r\n\r\n    parseToPoints(str) {\r\n        let points = [];\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n        for (let line of arrayOfLines) {\r\n            if (line.search('point_struc') >= 0) {\r\n                let parenth = line.match(/\\{([^)]+)\\}/)[1];   // string inside {..}\r\n                let pointArr = parenth.split('=')[1].split(',');\r\n                let point = new Point(parseInt(pointArr[0],10), parseInt(pointArr[1],10));\r\n                point.label = line.split(/\\s+/)[1];\r\n                points.push(point);\r\n            }\r\n        }\r\n        return points;\r\n    }\r\n\r\n    parseToShapes(str) {\r\n        let shapes = [];\r\n        let shape;\r\n        let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n\r\n        if (arrayOfLines[0].length === 1 && arrayOfLines[0] === \"N\") {\r\n            shapes = parseToFlightaShapes(str);\r\n            return shapes;\r\n        }\r\n\r\n        for (let line of arrayOfLines) {\r\n            if (line.search('point_struc') >= 0) {\r\n                shape = this.parseToPoint(line);\r\n            }\r\n            else if (line.search('_seg_struc') >= 0) {\r\n                shape = this.parseToSegment(line);\r\n            }\r\n            else if (line.search('_curve_struc') >= 0) {\r\n                shape = this.parseToArc(line);\r\n            }\r\n            else if (line.search('_circle_struc') >= 0) {\r\n                shape = this.parseToCircle(line);\r\n            }\r\n            else if (line.search('_rect_struc') >= 0) {\r\n                shape = this.parseToRectangle(line);\r\n            }\r\n            else if (line.search('_line_struc') >= 0) {\r\n                shape = this.parseToODBLine(line);\r\n            }\r\n            else if (line.search('_arc_struc') >= 0) {\r\n                shape = this.parseToODBArc(line);\r\n            }\r\n            shapes.push(shape);\r\n        }\r\n        return shapes;\r\n    }\r\n\r\n    parse(str) {\r\n        /* try polygon */\r\n        let polygon = this.parseToPolygon(str);\r\n        if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n            return [polygon];\r\n        }\r\n\r\n        /* try array of shapes excluding polygon or array of shapes in \"Flighta\" format */\r\n        let shapes = this.parseToShapes(str);\r\n        if (shapes.length > 0) {\r\n            return shapes;\r\n        }\r\n\r\n        /* try array of points */\r\n        let points = this.parseToPoints(str);\r\n        if (points.length > 0) {\r\n            return points;\r\n        }\r\n\r\n    }\r\n}\r\n\r\n","import * as ActionTypes from \"../actionTypes\";\r\nimport {Parser} from \"../../dataParsers/parser\";\r\n\r\nconst unitsList = [\r\n    {\r\n        name: \"pixels\",\r\n        decimals: 0,\r\n        divisor: 1\r\n    },\r\n    {\r\n        name: \"inch\",\r\n        decimals: 7,\r\n        divisor: 10160000\r\n    },\r\n    {\r\n        name: \"mm\",\r\n        decimals: 6,\r\n        divisor: 400000\r\n    }];\r\n\r\nconst defaultAppState = {\r\n    title: \"Debug Viewer\",\r\n    version: process.env.REACT_APP_VERSION,\r\n    build: \"\",\r\n    units: \"pixels\",\r\n    decimals: 0,\r\n    divisor: 1,\r\n    // bg: \"#F1F1F1\",\r\n    parser: new Parser(),\r\n    widthOn: true,\r\n    displayVertices: false,\r\n    displayLabels: true,\r\n    measurePointsActive: false,\r\n    zoomFactor: undefined,\r\n    originX: undefined,\r\n    originY: undefined,\r\n    showAboutPopup: false,\r\n    importDataToNewLayer: true,       // if false, import data to affected layer\r\n    showSkeletonRecognitionButton: false,\r\n    applySkeletonRecognition: false,\r\n    stage: null,\r\n    showSpinner: false,\r\n    showLayerList: false,\r\n    showDownloadPopup: false,\r\n    showUploadPopup: false,\r\n};\r\n\r\nconst app = (state = defaultAppState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.NEW_STAGE_CREATED:\r\n            return Object.assign({}, state, {\r\n                stage: action.stage,\r\n                zoomFactor: action.stage.zoomFactor * action.stage.resolution,\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y,\r\n            });\r\n\r\n        case ActionTypes.STAGE_UNMOUNTED:\r\n            return Object.assign({}, state, {\r\n                stage: null,\r\n                zoomFactor: undefined,\r\n                originX: undefined,\r\n                originY: undefined\r\n            });\r\n\r\n        case ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE:\r\n        case ActionTypes.PAN_AND_ZOOM_TO_SHAPE:\r\n        case ActionTypes.PINCH_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                zoomFactor: action.stage.zoomFactor * action.stage.resolution,\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y,\r\n            });\r\n        case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                originX: action.stage.origin.x,\r\n                originY: action.stage.origin.y\r\n            });\r\n        case ActionTypes.TOGGLE_UNITS_CLICKED:\r\n            let curUnitsId = unitsList.findIndex(units => state.units === units.name);\r\n            let newUnits = unitsList[(curUnitsId + 1) % 3];\r\n            return Object.assign({}, state, {\r\n                units: newUnits.name,\r\n                decimals: newUnits.decimals,\r\n                divisor: newUnits.divisor\r\n            });\r\n        case ActionTypes.TOGGLE_WIDTH_MODE_CLICKED:\r\n            return Object.assign({}, state, {\r\n                widthOn: !state.widthOn,\r\n                displayVertices: state.widthOn ? state.displayVertices : false\r\n            });\r\n        case ActionTypes.TOGGLE_DISPLAY_VERTICES_CLICKED:\r\n            if (state.displayVertices) {\r\n                return Object.assign({}, state, {\r\n                    displayVertices: false\r\n                });\r\n            }\r\n            else {\r\n                return Object.assign({}, state, {\r\n                    widthOn: false,\r\n                    displayVertices: true\r\n                });\r\n            }\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LABELS_CLICKED:\r\n            return Object.assign({}, state, {\r\n                displayLabels: !state.displayLabels\r\n            });\r\n\r\n        case ActionTypes.TOGGLE_ABOUT_POPUP_CLICKED:\r\n            return Object.assign({}, state, {\r\n                showAboutPopup: !state.showAboutPopup\r\n            });\r\n\r\n        // case ActionTypes.CLOSE_ABOUT_POPUP_BUTTON_PRESSED:\r\n        //     return Object.assign({}, state, {\r\n        //         showAboutPopup: false\r\n        //     });\r\n\r\n        case ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: false\r\n            });\r\n\r\n        case ActionTypes.MEASURE_POINTS_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: true\r\n            });\r\n        case ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                measurePointsActive: false\r\n            });\r\n        case ActionTypes.SKELETON_RECOGNITION_URI:\r\n            return Object.assign({}, state, {\r\n                showSkeletonRecognitionButton: true\r\n            });\r\n        case ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED:\r\n            return Object.assign({}, state, {\r\n                applySkeletonRecognition: true\r\n            });\r\n        case ActionTypes.ASYNC_OPERATION_STARTED:\r\n            return Object.assign({}, state, {\r\n                showSpinner: true\r\n            });\r\n        case ActionTypes.ASYNC_OPERATION_ENDED:\r\n            return Object.assign({}, state, {\r\n                showSpinner: false\r\n            });\r\n        case ActionTypes.AABB_TREE_NEXT_LEVEL:\r\n            return state;\r\n        case ActionTypes.TOGGLE_SHOW_LAYER_LIST_CLICKED:\r\n            return {\r\n                ...state,\r\n                showLayerList: !state.showLayerList\r\n            };\r\n        case ActionTypes.TOGGLE_DOWNLOAD_POPUP_CLICKED:\r\n            return {\r\n                ...state,\r\n                showDownloadPopup: !state.showDownloadPopup\r\n            };\r\n        case ActionTypes.TOGGLE_UPLOAD_POPUP_CLICKED:\r\n            return {\r\n                ...state,\r\n                showUploadPopup: !state.showUploadPopup\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default app;\r\n","\r\nlet defaultStyle = {\r\n    strokeStyle: 1,\r\n    stroke: \"#FF0303\",\r\n    fill: \"#FF0303\",\r\n    alpha: 1.0\r\n};\r\n\r\n/* Class Model represents data model that will be added to layer */\r\nclass Model {\r\n    constructor(geom = undefined, style = undefined, label = \"\") {\r\n        this.geom = geom;\r\n        this.style = style || defaultStyle;\r\n        this.label = label;\r\n    }\r\n\r\n    clone() {\r\n        let model = new Model(this.geom, this.style, this.label);\r\n        return Object.assign(model, this);\r\n    }\r\n\r\n    get box() {\r\n        return this.geom.box;\r\n    }\r\n/*\r\n    static transformPoint(pt, stage) {\r\n        return new Flatten.Point(stage.W2C_X(pt.x), stage.W2C_Y(pt.y));\r\n    }\r\n\r\n    static transformSegment(segment, stage) {\r\n        return new Flatten.Segment(\r\n            Model.transformPoint(segment.ps, stage),\r\n            Model.transformPoint(segment.pe, stage)\r\n        )\r\n    }\r\n\r\n    static transformArc(arc, stage) {\r\n        return new Flatten.Arc(\r\n            Model.transformPoint(arc.pc, stage),\r\n            stage.W2C_Scalar(arc.r),\r\n            arc.startAngle,\r\n            arc.endAngle,\r\n            arc.counterClockwise\r\n        )\r\n    }\r\n\r\n    static transformEdge(shape, stage) {\r\n        if (shape instanceof Flatten.Segment) {\r\n            return Model.transformSegment(shape, stage);\r\n        }\r\n        else if (shape instanceof Flatten.Arc) {\r\n            return Model.transformArc(shape, stage);\r\n        }\r\n    }\r\n\r\n    static transformFace(face, stage) {\r\n        // Get shapes of face as array\r\n        let shapes = [];\r\n        for (let edge of face) {\r\n            shapes.push(edge.shape);\r\n        }\r\n\r\n        // Transform array of edges\r\n        return shapes.map(shape => Model.transformEdge(shape, stage));\r\n    }\r\n\r\n    static transformPolygon(polygon, stage) {\r\n        let newPolygon = new Flatten.Polygon();\r\n        let shapes = [];\r\n        for (let face of polygon.faces) {\r\n            shapes = Model.transformFace(face, stage);\r\n            newPolygon.addFace(shapes);\r\n        }\r\n        return newPolygon;\r\n    }\r\n*/\r\n}\r\n\r\nexport default Model;","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Point, Box} from '@flatten-js/core';\r\n// import { Shape } from '../models/shape';\r\nimport Model from './model';\r\n\r\nclass Layer {\r\n    constructor(stage) {\r\n        // super();\r\n        // cannot define Layer as extension of PlanarSet due to bug in compiler ?\r\n        this.stage = stage;\r\n        this.shapes = [];         // new Flatten.PlanarSet();\r\n        this.name = \"\";\r\n        this.color = \"\";\r\n        this.title = \"\";\r\n        this.displayed = false;\r\n        this.edited = false;\r\n        this.affected = false;\r\n    }\r\n\r\n    clone() {\r\n        let layer = new Layer(this.stage);\r\n        return Object.assign(layer, this);\r\n    }\r\n\r\n    add(shape) {\r\n        if (shape instanceof Model) {\r\n            this.shapes.push(shape);       // add(shape)\r\n        }\r\n        else {\r\n            let geom = shape;\r\n            let newShape = new Model(geom, {}, shape.label) // , this.stage);\r\n            this.shapes.push(newShape);     // add(newShape);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    addShapesArray(shapes) {\r\n        for (let shape of shapes) {\r\n            this.add(shape);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    get box() {\r\n        let box = new Box();\r\n        for (let shape of this.shapes) {\r\n            box = box.merge(shape.geom instanceof Box ? shape.clone() : shape.box);\r\n        }\r\n        return box;\r\n    }\r\n\r\n    get center() {\r\n        let box = this.box;\r\n        return new Point((box.xmin + box.xmax)/2, (box.ymin + box.ymax)/2);\r\n    }\r\n\r\n    toggleDisplayed(color) {\r\n        let displayed = !this.displayed;\r\n        return Object.assign(this.clone(),\r\n            {\r\n                displayed : displayed,\r\n                color: color\r\n            });\r\n    }\r\n\r\n    setAffected(affected) {\r\n        this.affected = affected;\r\n        return this;\r\n        // return Object.assign(this.clone(),\r\n        //     {\r\n        //         affected : affected\r\n        //     });\r\n    }\r\n\r\n    setEdited(edited) {\r\n        return Object.assign(this.clone(),\r\n            {\r\n                edited : edited\r\n            });\r\n    }\r\n\r\n    setNameAndTitle(name,title) {\r\n        return Object.assign(this.clone(),\r\n            {\r\n                name : name,\r\n                title: title,\r\n                edited: false\r\n            });\r\n    }\r\n\r\n    setAlpha() {\r\n        for(let shape of this.shapes) {\r\n            shape.alpha = this.displayed ? 1 : 0;\r\n        }\r\n        return this.shapes;\r\n    }\r\n\r\n    // toggleExpanded(shapeToggle) {\r\n    //     for(let shape of this.shapes) {\r\n    //         if (shape === shapeToggle) {\r\n    //             shape.expanded = !shape.expanded;\r\n    //         }\r\n    //     }\r\n    //     return this;\r\n    // }\r\n\r\n    toJSON() {\r\n        return {\r\n            name: this.name,\r\n            title: this.title,\r\n            shapes: JSON.stringify(this.shapes, null, ' ')\r\n        };\r\n    }\r\n}\r\n\r\nexport default Layer;\r\n","/**\r\n * Created by alexanderbol on 20/04/2017.\r\n */\r\n\r\nimport Layer from '../models/layer';\r\n\r\nconst colors = [\r\n    \"#FF0303\",\r\n    \"#4AA403\",\r\n    \"#540080\",\r\n    \"#FFFF40\",\r\n    \"#FF0080\",\r\n    \"#AED424\",\r\n    \"#545400\",\r\n    \"#FFA980\",\r\n    \"#A95480\",\r\n    \"#A9A9FF\",\r\n    \"#00FF00\",\r\n    \"#FFEE76\",\r\n    \"#A40576\",\r\n    \"#4385C8\",\r\n    \"#1CC826\",\r\n    \"#BDBD00\",\r\n    \"#48316E\",\r\n    \"#14616E\",\r\n    \"#8040BD\",\r\n    \"#DC7676\",\r\n    \"#924845\",\r\n    \"#A90000\",\r\n    \"#FFA900\"\r\n];\r\n\r\nclass Layers {\r\n\r\n    static newLayer(stage, layers) {\r\n        let layer = new Layer(stage);\r\n        layer.name = Layers.getNewName(layers);\r\n        if (layers.length === 0) { // first layer\r\n            // layer.color = Layers.getNextColor(layers);\r\n            layer.displayed = false;\r\n            layer.affected = false;\r\n        }\r\n        return layer;\r\n    }\r\n\r\n    static get defaultName() {\r\n        return \"layer\";\r\n    }\r\n\r\n    static getNewName(layers) {\r\n        let name = Layers.defaultName;\r\n        let inc = 1;\r\n        let comparator = (layer) => layer.name === name;\r\n        while (layers.find(comparator) ) {\r\n            name = Layers.defaultName + inc;\r\n            inc++;\r\n        }\r\n        return name;\r\n    }\r\n\r\n    static getAffected(layers) {\r\n        return layers.find((lay) => lay.affected);\r\n    }\r\n\r\n    static setAffected(layers, layer) {\r\n        let currentAffectedLayer = Layers.getAffected(layers);\r\n        if (currentAffectedLayer) {\r\n            currentAffectedLayer.affected = false;\r\n        }\r\n        layer.affected = true;\r\n    }\r\n\r\n    static getNextColor(layers) {\r\n        let color = \"\";\r\n        for (let col of colors) {\r\n            if (!layers.find((layer) =>\r\n                layer.displayed && layer.color === col)) {\r\n                color = col;\r\n                break;\r\n            }\r\n        }\r\n        return color;\r\n    }\r\n\r\n    static delete(layers, layer) {\r\n        let index = layers.findIndex((l) => l === layer);\r\n        let newLayers = layers.filter(l => l !== layer);\r\n        if (index > 0) {\r\n            newLayers[index-1].affected = true;\r\n            if (newLayers[index-1].color === \"\") {\r\n                newLayers[index - 1].color = Layers.getNextColor(newLayers);\r\n            }\r\n            newLayers[index-1].displayed = true;\r\n        }\r\n        return newLayers;\r\n        // another option to delete from array:\r\n        // const newLayers = [...layers]\r\n        // return newLayers.splice( index, 1);\r\n    }\r\n\r\n    static sort(layers) {\r\n        let newLayers = layers.slice();\r\n        newLayers.sort( function(l1, l2) {\r\n            let name1 = l1.name.toUpperCase();\r\n            let name2 = l2.name.toUpperCase();\r\n            if (name1 < name2) {\r\n                return -1;\r\n            }\r\n            if (name1 > name2) {\r\n                return 1;\r\n            }\r\n            return 0;\r\n        });\r\n        return newLayers;\r\n    }\r\n\r\n    static toJSON(layers) {\r\n        return layers.map( layer => layer.toJSON() );\r\n    }\r\n}\r\n\r\nexport default Layers;","import * as ActionTypes from \"../actionTypes\";\r\nimport Layers from \"../../models/layers\";\r\n\r\nconst layers = (state = [], action) => {\r\n    let affectedLayer = state.find(layer => layer.affected);\r\n    let affectedLayerId = state.findIndex(layer => layer.affected);\r\n    let newLayer;\r\n\r\n    switch (action.type) {\r\n        case ActionTypes.ADD_LAYER_BUTTON_PRESSED:\r\n            newLayer = Layers.newLayer(action.stage, state);\r\n            return [...state, newLayer];\r\n\r\n        case ActionTypes.ADD_NEW_LAYER:\r\n            return [...state, action.layer];\r\n\r\n        case ActionTypes.DELETE_LAYER_BUTTON_PRESSED:\r\n            if (affectedLayer) {\r\n                return Layers.delete(state, affectedLayer);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        case ActionTypes.CLEAR_ALL_BUTTON_CLICKED:\r\n            return [];\r\n\r\n        case ActionTypes.SORT_LAYERS_BUTTON_PRESSED:\r\n            return Layers.sort(state);\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED:\r\n            let color = \"\";\r\n            if (!action.layer.displayed) {\r\n                color = Layers.getNextColor(state);\r\n                if (color === \"\") return;  // no free colors\r\n            }\r\n            return state.map((layer) => {\r\n                if (layer !== action.layer) {\r\n                    // if action.layer will be undisplayed,\r\n                    // it cannot become affected, then\r\n                    // keep affected on this layer\r\n                    if (action.layer.displayed) {\r\n                        return layer;\r\n                    }\r\n                    else {\r\n                        return layer.setAffected(false);\r\n                    }\r\n                }\r\n                else {\r\n                    let newLayer = layer.toggleDisplayed(color);\r\n                    newLayer.affected = newLayer.displayed;\r\n                    return newLayer;\r\n                }\r\n                // return layer.toggleDisplayed(color);\r\n            });\r\n\r\n        case ActionTypes.TOGGLE_AFFECTED_LAYER_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer !== action.layer) {\r\n                    return layer.setAffected(false);\r\n                }\r\n                else {\r\n                    return layer.setAffected(!layer.affected);\r\n                }\r\n            });\r\n\r\n        // case ActionTypes.NEW_SHAPE_PASTED:\r\n        //     return state.map((layer) => {\r\n        //         if (layer.affected) {\r\n        //             return layer.addShapesArray(action.shapesArray);\r\n        //         }\r\n        //         else {\r\n        //             return layer;\r\n        //         }\r\n        //     });\r\n\r\n        case ActionTypes.OPEN_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer !== affectedLayer) {\r\n                    return layer;\r\n                }\r\n                else {\r\n                    return layer.setEdited(true);\r\n                }\r\n            });\r\n\r\n        case ActionTypes.SUBMIT_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer.edited) {\r\n                    return layer.setNameAndTitle(action.newLayer.name, action.newLayer.title);\r\n                }\r\n                else {\r\n                    return layer;\r\n                }\r\n            });\r\n\r\n        case ActionTypes.ESCAPE_LAYER_EDIT_FORM_PRESSED:\r\n            return state.map((layer) => {\r\n                if (layer.edited) {             // !== action.layer) {\r\n                    return layer.setEdited(false);\r\n                }\r\n                else {\r\n                    return layer;\r\n                }\r\n            });\r\n\r\n        case ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED:\r\n            if (affectedLayerId === state.length - 1) {\r\n                return state;\r\n            }\r\n            else {\r\n\r\n                let nextLayer = state[affectedLayerId + 1];\r\n\r\n                return state.map(layer => {\r\n                    if (layer === affectedLayer) {\r\n                        let newCurLayer = layer.toggleDisplayed(\"\");\r\n                        newCurLayer.affected = false;\r\n                        return newCurLayer;\r\n                    }\r\n                    else if (layer === nextLayer) {\r\n                        let color = affectedLayer.color;\r\n                        let newNextLayer = layer.toggleDisplayed(color);\r\n                        newNextLayer.affected = true;\r\n                        return newNextLayer;\r\n                    }\r\n                    else {\r\n                        return layer;\r\n                    }\r\n                });\r\n            }\r\n\r\n        case ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED:\r\n            if (affectedLayerId === 0) {\r\n                return state;\r\n            }\r\n            else {\r\n                let nextLayer = state[affectedLayerId - 1];\r\n\r\n                return state.map(layer => {\r\n                    if (layer === affectedLayer) {\r\n                        let newCurLayer = layer.toggleDisplayed(\"\");\r\n                        newCurLayer.affected = false;\r\n                        return newCurLayer;\r\n                    }\r\n                    else if (layer === nextLayer) {\r\n                        let newNextLayer = layer.toggleDisplayed(affectedLayer.color);\r\n                        newNextLayer.displayed = true;\r\n                        newNextLayer.affected = true;\r\n                        return newNextLayer;\r\n                    }\r\n                    else {\r\n                        return layer;\r\n                    }\r\n                });\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default layers;","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst defaultMouseState = {\r\n    x: 0,\r\n    y: 0,\r\n    startX: undefined,\r\n    startY: undefined,\r\n    touchPoints: undefined\r\n};\r\n\r\nconst mouse = (state = defaultMouseState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                x: action.x,\r\n                y: action.y\r\n            });\r\n        case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                startX: action.x,\r\n                startY: action.y\r\n            });\r\n        case ActionTypes.MOUSE_UP_ON_STAGE:\r\n            return Object.assign({}, state, {\r\n                startX: undefined,\r\n                startY: undefined\r\n            });\r\n\r\n        case ActionTypes.PINCH_DOWN_ON_STAGE: {\r\n            return {\r\n                ...state,\r\n                touchPoints: [\r\n                    {x: action.x1, y: action.y1},\r\n                    {x: action.x2, y: action.y2}\r\n                ]\r\n            }\r\n        }\r\n        // case ActionTypes.PINCH_MOVED_ON_STAGE: {\r\n        //     return {\r\n        //         ...state,\r\n        //         touchPoints: [\r\n        //             {x: action.x1, y: action.y1},\r\n        //             {x: action.x2, y: action.y2}\r\n        //         ]\r\n        //     }\r\n        // }\r\n        case ActionTypes.PINCH_UP_ON_STAGE: {\r\n            return {\r\n                ...state,\r\n                touchPoints: undefined\r\n            }\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default mouse;","import * as ActionTypes from \"../actionTypes\";\r\nimport Flatten from \"@flatten-js/core\";\r\n\r\nconst defaultMeasureShapesTool = {\r\n    measureShapesActive: false,\r\n    measureShapesFirstClick: true,\r\n    hoveredShape: null,\r\n    firstMeasuredShape: null,\r\n    secondMeasuredShape: null,\r\n    firstMeasuredLayer: null,\r\n    secondMeasuredLayer: null,\r\n    distance: undefined,\r\n    shortestSegment: null\r\n};\r\n\r\nconst is_mobile = window.mobilecheck();\r\n\r\nconst measureShapesTool = (state = defaultMeasureShapesTool, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED:\r\n            return Object.assign({}, defaultMeasureShapesTool, {\r\n                measureShapesActive: true\r\n            });\r\n        case ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED:\r\n            return Object.assign({}, defaultMeasureShapesTool);\r\n\r\n        case ActionTypes.MEASURE_POINTS_BUTTON_PRESSED:\r\n            return Object.assign({}, defaultMeasureShapesTool);\r\n\r\n        case ActionTypes.MOUSE_ROLL_OVER_SHAPE:\r\n            return Object.assign({}, state, {\r\n                hoveredShape: state.measureShapesActive ? action.shape : null\r\n            });\r\n        case ActionTypes.MOUSE_ROLL_OUT_SHAPE:\r\n            return Object.assign({}, state, {\r\n                hoveredShape: null\r\n            });\r\n        case ActionTypes.MOUSE_CLICKED_ON_SHAPE:\r\n            if (!state.measureShapesActive) {\r\n                return state;\r\n            }\r\n            // measureShapesActive\r\n\r\n            if (state.measureShapesFirstClick) {\r\n                return Object.assign({}, state, {\r\n                    firstMeasuredShape: action.shape,\r\n                    firstMeasuredLayer: action.layer,\r\n                    secondMeasuredShape: null,\r\n                    secondMeasuredLayer: null,\r\n                    measureShapesFirstClick: false,\r\n                    distance: undefined,\r\n                    shortestSegment: null\r\n                })\r\n            }\r\n            else {    // second click\r\n                if (action.shape === state.firstMeasuredShape) {\r\n                    return state;  // second click on the same shape\r\n                }\r\n\r\n                let shape1 = state.firstMeasuredShape.geom;\r\n                let shape2 = action.shape.geom;\r\n                let distance, shortestSegment;\r\n                // if (shape1 instanceof Flatten.Polygon && shape2 instanceof Flatten.Polygon) {\r\n                //     [distance, shortestSegment] = Flatten.Distance.polygon2polygon(shape1, shape2);\r\n                // }\r\n                // else {\r\n                [distance, shortestSegment] = Flatten.Distance.distance(shape1, shape2);\r\n                // }\r\n\r\n\r\n                return Object.assign({}, state, {\r\n                    secondMeasuredShape: action.shape,\r\n                    secondMeasuredLayer: action.layer,\r\n                    measureShapesFirstClick: true,\r\n                    distance: distance,\r\n                    shortestSegment: shortestSegment\r\n                });\r\n            }\r\n        case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n            if (state.hoveredShape || is_mobile) {\r\n                return state\r\n            }\r\n            else {\r\n                return Object.assign({}, state, {\r\n                    measureShapesFirstClick: true,\r\n                    firstMeasuredShape: null,\r\n                    firstMeasuredLayer: null,\r\n                    secondMeasuredShape: null,\r\n                    secondMeasuredLayer: null,\r\n                    distance: undefined,\r\n                    shortestSegment: null\r\n                });\r\n            }\r\n\r\n        case ActionTypes.DELETE_LAYER_BUTTON_PRESSED:\r\n            if (action.layer === state.firstMeasuredLayer ||\r\n                action.layer === state.secondMeasuredLayer) {\r\n                return Object.assign({}, defaultMeasureShapesTool);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        case ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED:\r\n            if (action.layer.displayed &&\r\n                (action.layer === state.firstMeasuredLayer ||\r\n                    action.layer === state.secondMeasuredLayer)) {\r\n                return Object.assign({}, defaultMeasureShapesTool);\r\n            }\r\n            else {\r\n                return state;\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default measureShapesTool;","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst documentDefaultState = {\r\n    id: undefined,\r\n    name: \"\",\r\n    owner: \"Alex Bol\",\r\n    lastUpdated: undefined\r\n};\r\n\r\nconst cloudStorageDefaultState = {\r\n    document: documentDefaultState,\r\n    documentsList: {}\r\n};\r\n\r\nfunction isUpToDate(stateDocumentsList, actionDocumentsList) {\r\n    if (actionDocumentsList === null || actionDocumentsList === undefined)\r\n        return true;\r\n\r\n    if (Object.keys(stateDocumentsList).length !== Object.keys(actionDocumentsList).length)\r\n        return false;\r\n    for (let key in stateDocumentsList) {\r\n        if (!(actionDocumentsList.hasOwnProperty(key) && (stateDocumentsList[key].lastUpdated !== actionDocumentsList[key].lastUpdated))) {\r\n            return false\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nconst cloudStorage = (state = cloudStorageDefaultState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    id: action.id,\r\n                    name: action.name,\r\n                    owner: action.owner,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    id: action.id,\r\n                    name: action.name,\r\n                    owner: action.owner,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    ...state.document,\r\n                    lastUpdated: action.lastUpdated\r\n                }\r\n            };\r\n\r\n        case ActionTypes.DOCUMENT_NAME_UPDATED:\r\n            return {\r\n                ...state,\r\n                document: {\r\n                    ...state.document,\r\n                    name: action.name\r\n                }\r\n            };\r\n\r\n        case ActionTypes.DELETE_DOCUMENT_FROM_DATABASE_SUCCEED:\r\n            let { [action.id]: document, ...newList } = state.documentsList;\r\n            return {\r\n                ...state,\r\n                document: state.document.id === action.id ? documentDefaultState : state.document,\r\n                documentsList: newList\r\n            };\r\n\r\n        case ActionTypes.DOCUMENT_SELECTED_FROM_LIST:\r\n            return {\r\n                ...state,\r\n                document: action.document\r\n            };\r\n\r\n        case ActionTypes.CLEAR_ALL_BUTTON_CLICKED:\r\n            return {\r\n                ...state,\r\n                document: documentDefaultState\r\n            };\r\n\r\n        case ActionTypes.REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED:\r\n            return isUpToDate(state.documentsList, action.documentsList) ?\r\n                state :\r\n            {\r\n                ...state,\r\n                documentsList: action.documentsList\r\n            };\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport default cloudStorage","import * as ActionTypes from \"../actionTypes\";\r\n\r\nconst defaultState = {\r\n    uploadStarted:  false,\r\n    uploadCompleted: false,\r\n    uploadedFiles: []\r\n};\r\n\r\nconst upload = (state=defaultState, action) => {\r\n    switch (action.type) {\r\n        case ActionTypes.INITIALIZE_UPLOAD_STATE:\r\n            return defaultState;\r\n\r\n        case ActionTypes.FILES_UPLOAD_COMPLETED:\r\n            return {\r\n                ...state,\r\n                uploadCompleted: true,\r\n                uploadedFiles: action.uploadedFiles\r\n            };\r\n        default:\r\n            return state\r\n    }\r\n};\r\n\r\nexport default upload","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\n\r\nimport {combineReducers} from 'redux';\r\n\r\nimport auth from \"./reducers/auth\";\r\nimport app from \"./reducers/app\";\r\nimport layers from \"./reducers/layers\";\r\nimport mouse from \"./reducers/mouse\";\r\nimport measureShapesTool from \"./reducers/measureShapesTool\";\r\nimport cloudStorage from \"./reducers/cloudStorage\";\r\nimport upload from \"./reducers/upload\";\r\n\r\nconst reducer = combineReducers({\r\n    auth,\r\n    app,\r\n    layers,\r\n    upload,\r\n    cloudStorage,\r\n    measureShapesTool,\r\n    mouse\r\n});\r\n\r\nexport default reducer;\r\n","import * as ActionTypes from '../store/actionTypes';\r\n\r\nconst log = ({ getState, dispatch }) => next => action => {\r\n\r\n    if(action.type !== ActionTypes.MOUSE_MOVED_ON_STAGE) {\r\n        console.log('ACTION: ' + action.type, action);\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nexport default log;","// import { Job } from '../models/job';\r\nimport Flatten from '@flatten-js/core';\r\n\r\n// import Model from '../models/model';\r\nimport {Job} from \"../models/job\";\r\n\r\nFlatten.Image = class Image {\r\n    constructor() {\r\n        this.uri = \"\";\r\n        /**\r\n         * Center in world coordinates\r\n         * @type {Flatten.Point}\r\n         */\r\n        this.center = new Flatten.Point();\r\n        /**\r\n         * Width in world units (inch/mm)\r\n         */\r\n        this.width = 0;\r\n        /**\r\n         * Height in world units (inch/mm)\r\n         */\r\n        this.height = 0;\r\n    }\r\n    get box() {\r\n        return new Flatten.Box(\r\n            this.center.x - this.width/2,\r\n            this.center.y - this.height/2,\r\n            this.center.x + this.height/2,\r\n            this.center.y + this.height/2\r\n        );\r\n\r\n    }\r\n};\r\n\r\n// export function parseJSON(shapes) {\r\n//     let models = [];\r\n//     let geom;\r\n//     let model;\r\n//     for (let shape of JSON.parse(shapes)) {\r\n//         if (shape.geom instanceof Array) {      // TODO: add \"name\" to polygon stringified\r\n//             geom = new Flatten.Polygon();\r\n//             for (let faceArray of shape.geom) {\r\n//                 geom.addFace(faceArray);\r\n//             }\r\n//         }\r\n//         else if (shape.geom.uri) {\r\n//             geom = new Flatten.Image();\r\n//             geom.uri = shape.geom.uri;\r\n//             geom.center = shape.geom.center;\r\n//             geom.width = shape.geom.width;\r\n//             geom.height = shape.geom.height;\r\n//         }\r\n//         else {\r\n//             geom = Flatten[shape.geom.name](shape.geom);\r\n//         }\r\n//         model = new Model(geom, shape.style, shape.label);\r\n//         models.push(model);\r\n//     }\r\n//\r\n//     return models;\r\n// }\r\n\r\nfunction parseJSONShape(jsonShape) {\r\n    if (jsonShape.name === \"segment\") {\r\n        return new Flatten.Segment(jsonShape);\r\n    }\r\n\r\n    if (jsonShape.name === \"arc\") {\r\n        return new Flatten.Arc(jsonShape);\r\n    }\r\n\r\n    if (jsonShape.name === \"point\") {\r\n        return new Flatten.Point(jsonShape);\r\n    }\r\n}\r\n\r\nexport function parseJSON(filename=\"\", str) {\r\n    let job = new Job();\r\n\r\n    job.filename = filename;\r\n\r\n    let jsonArray;\r\n\r\n    try {\r\n        jsonArray = JSON.parse(str);\r\n    } catch (e) {\r\n        throw new Error(\"Illegal JSON string\")\r\n    }\r\n\r\n    if (jsonArray instanceof Array) {\r\n        try {\r\n            let polygon = new Flatten.Polygon();\r\n            for (let faceArray of jsonArray) {\r\n                polygon.addFace(faceArray);\r\n            }\r\n            job.shapes.push(polygon);\r\n        }\r\n        catch (e) {\r\n            for (let jsonShape of jsonArray) {\r\n                job.shapes.push( parseJSONShape(jsonShape) );\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        job.shapes.push( parseJSONShape(jsonArray) );\r\n    }\r\n\r\n    return job;\r\n}\r\n","import * as ActionTypes from \"../store/actionTypes\";\r\nimport Layers from \"../models/layers\";\r\nimport {parseJSON} from \"../dataParsers/parseJSON\";\r\n\r\nconst pasteData = ({ dispatch, getState }) => next => action => {\r\n\r\n    if (action.type !== ActionTypes.DATA_FROM_BUFFER_PASTED) {\r\n        return next(action);\r\n    }\r\n\r\n    let state = getState();\r\n    let stage = state.app.stage;\r\n    let layers = state.layers;\r\n    let parser = state.app.parser;\r\n\r\n    let layer = undefined;\r\n    if (state.app.importDataToNewLayer) {   // import data to new layer\r\n        layer = Layers.newLayer(stage, layers);\r\n        layers.push(layer);\r\n    }\r\n    else {                                  // import data to affected layer\r\n        layer = layers.find((lay) => lay.affected);\r\n        if (!layer) {                       // if no layer affected, add new\r\n            layer = Layers.newLayer(stage, layers);\r\n            layers.push(layer);\r\n        }\r\n    }\r\n\r\n    // Paste data from ClipBoard\r\n    for (let item of action.data.items) {\r\n        item.getAsString((string) => {\r\n            let shapesArray;\r\n\r\n            try {\r\n                let job = parseJSON(\"\",string);\r\n                shapesArray = job.shapes\r\n            } catch (e) {\r\n                console.log(e.message)\r\n                shapesArray = parser.parse(string);\r\n            }\r\n\r\n            // TODO: add something like poly.valid()\r\n\r\n            if (shapesArray.length > 0) {\r\n                for (let shape of shapesArray) {\r\n                    layer.add(shape);\r\n                }\r\n            }\r\n\r\n            if (layer.shapes.length > 0) {\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    shape: layer,\r\n                    stage: stage\r\n                });\r\n                dispatch({\r\n                    type: ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED,\r\n                    layer: layer\r\n                })\r\n            }\r\n\r\n        });\r\n\r\n        break;\r\n    }\r\n\r\n};\r\n\r\nexport default pasteData;\r\n","import * as ActionTypes from '../store/actionTypes';\r\n\r\nconst stageController = ({getState, dispatch}) => next => action => {\r\n\r\n    const mouse = getState().mouse;\r\n    let stage = action.stage;\r\n\r\n\r\n    if (stage) {\r\n        switch (action.type) {\r\n            case ActionTypes.STAGE_RESIZED:\r\n                stage.resize();\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_DOWN_ON_STAGE:\r\n                stage.panByMouseStart();\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_MOVED_ON_STAGE:\r\n                if (action.dx !== undefined && action.dy !== undefined) {\r\n                    stage.panByMouseMove(action.dx, action.dy);\r\n                }\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_UP_ON_STAGE:\r\n                stage.panByMouseStop();\r\n                break;\r\n\r\n            case ActionTypes.PAN_AND_ZOOM_TO_SHAPE:\r\n                let center = action.shape.center;\r\n                let box = action.shape.box;\r\n                if (isNaN(center.x) || isNaN(center.y)) return;\r\n                stage.panToCoordinate(center.x, center.y);\r\n                stage.zoomToLimits(box.xmax - box.xmin, box.ymax - box.ymin);\r\n                break;\r\n\r\n            case ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE:\r\n                let bIn = action.delta > 0;\r\n                // stage.zoomByMouse(action.x, action.y, bIn, 1 + Math.abs(action.delta)/100.);\r\n                stage.zoomByMouse(action.x, action.y, bIn, 1.2);\r\n                break;\r\n\r\n            case ActionTypes.CLEAR_ALL:\r\n                stage.removeAllChildren();\r\n                stage.removeAllListeners();\r\n                break;\r\n\r\n            case ActionTypes.PINCH_DOWN_ON_STAGE:\r\n                stage.zoomByPinchStart(action.x1, action.y1);\r\n                break;\r\n\r\n            case ActionTypes.PINCH_MOVED_ON_STAGE:\r\n                if (mouse.touchPoints) {\r\n                    let dx = mouse.touchPoints[0].x - mouse.touchPoints[1].x;\r\n                    let dy = mouse.touchPoints[0].y - mouse.touchPoints[1].y;\r\n                    let distStart = Math.sqrt(dx*dx + dy*dy);\r\n\r\n                    dx = action.x2 - action.x1;\r\n                    dy = action.y2 - action.y1;\r\n                    let distCurrent = Math.sqrt(dx*dx + dy*dy);\r\n                    let ratio = distCurrent / distStart;\r\n                    stage.zoomByPinchMove(action.x1, action.y1, ratio);\r\n                }\r\n                break;\r\n\r\n            case ActionTypes.PINCH_UP_ON_STAGE:\r\n                stage.zoomByPinchStop();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nexport default stageController;","import * as ActionTypes from '../store/actionTypes';\r\nimport Layers from \"../models/layers\";\r\nimport {point, arc, segment} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\nlet Algorithmia = window.Algorithmia;\r\n\r\n// function zoomHome(shape, stage) {\r\n//     let box = shape.box;\r\n//     let x = (box.xmin + box.xmax)/2;\r\n//     let y = (box.ymin + box.ymax)/2;\r\n//     stage.panToCoordinate(x, y);\r\n//     stage.zoomToLimits(box.xmax - box.xmin, box.ymax - box.ymin);\r\n// }\r\n\r\nconst skeleton_recognition = ({dispatch, getState}) => next => action => {\r\n\r\n    if (action.type === ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED) {\r\n\r\n        let state = getState();\r\n        let stage = state.app.stage;\r\n\r\n        let layers = state.layers;\r\n        let currentLayer = Layers.getAffected(layers);\r\n        let shapes = currentLayer.shapes;\r\n        let input = shapes.map(shape =>\r\n            [shape.geom.x / 400., shape.geom.y / 400., shape.geom.nx, shape.geom.ny]\r\n        );\r\n\r\n        let client = Algorithmia.client(\"simby4RUwqQmtMDaHAPj5wsQwlD1\");\r\n        let algorithm = \"alexbol99/SeketonRecognition\";\r\n\r\n        client.algo(algorithm)\r\n            .pipe(input)\r\n            .then(function (output) {\r\n                if (output.error) return console.error(\"error: \" + output.error);\r\n\r\n                let newLayer = Layers.newLayer(stage, layers);\r\n                newLayer.name = \"recognized\";\r\n                newLayer.title = \"recognized\";\r\n                // newLayer.displayed = true;\r\n\r\n                for (let row of output.result) {\r\n                    let shape;\r\n                    if (row[0] instanceof Array && row[0].length === 2) {\r\n                        let pc = point(row[0][0] * 400, row[0][1] * 400);\r\n                        let r = row[1] * 400;\r\n                        /********center radius startAng endAng **********/\r\n                        shape = arc(pc, r, row[2], row[3], Flatten.CCW)\r\n                    }\r\n                    else {\r\n                        shape = segment(\r\n                            point(row[0] * 400, row[1] * 400),\r\n                            point(row[2] * 400, row[3] * 400))\r\n                    }\r\n                    if (row[4]) {\r\n                        shape.label = row[4]\r\n                    }\r\n                    newLayer.add(shape)\r\n                }\r\n                layers.push(newLayer);\r\n\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    stage: stage,\r\n                    shape: currentLayer\r\n                })\r\n            });\r\n    }\r\n\r\n    return next(action);\r\n};\r\n\r\n\r\nexport default skeleton_recognition;\r\n","import axios from 'axios';\r\n\r\nconst instance = axios.create({\r\n    baseURL: \"https://debug-viewer.firebaseio.com/\"\r\n});\r\n\r\nexport default instance;\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const resizeStage = () => {\r\n    return {\r\n        type: ActionTypes.STAGE_RESIZED\r\n    }\r\n};\r\n\r\nexport const destroyStage = () => {\r\n    return {\r\n        type: ActionTypes.STAGE_UNMOUNTED\r\n    }\r\n};\r\n\r\nexport const toggleUnits = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_UNITS_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleWidthMode = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_WIDTH_MODE_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDisplayVertices = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_VERTICES_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDisplayLabels = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_LABELS_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleAboutPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_ABOUT_POPUP_CLICKED\r\n    }\r\n};\r\n\r\n// export const closeAboutPopup = () => {\r\n//     return {\r\n//         type: ActionTypes.CLOSE_ABOUT_POPUP_BUTTON_PRESSED\r\n//     }\r\n// };\r\n\r\nexport const toggleMeasureBetweenPoints = () => {\r\n    return {\r\n        type: ActionTypes.MEASURE_POINTS_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\nexport const toggleMeasureBetweenShapes = () => {\r\n    return {\r\n        type: ActionTypes.MEASURE_SHAPES_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\nexport const applySkeletonRecognition = () => {\r\n    return {\r\n        type: ActionTypes.SKELETON_RECOGNITION_BUTTON_PRESSED\r\n    }\r\n};\r\n\r\n// export const handleFileSelect = (files, stage, layers) => {\r\n//     return {\r\n//         type: ActionTypes.FILENAME_LIST_SELECTED,\r\n//         files,\r\n//         stage,\r\n//         layers\r\n//     }\r\n// };\r\n\r\nexport const setHomeView = (stage, shape) => {\r\n    return {\r\n        type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n        stage,\r\n        shape\r\n    }\r\n};\r\n\r\nexport const togglePanByDrag = () => {\r\n    return {\r\n        type: ActionTypes.PAN_BY_DRAG_BUTTON_CLICKED\r\n    }\r\n};\r\n\r\nexport const handleMouseRollOverShape = (shape) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_ROLL_OVER_SHAPE,\r\n        shape\r\n    }\r\n};\r\n\r\nexport const handleMouseRollOutShape = () => {\r\n    return {\r\n        type: ActionTypes.MOUSE_ROLL_OUT_SHAPE\r\n    }\r\n};\r\n\r\nexport const handleClickOnShape = (shape, layer) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_CLICKED_ON_SHAPE,\r\n        shape,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const asyncOperationStarted = () => {\r\n    return {\r\n        type: ActionTypes.ASYNC_OPERATION_STARTED\r\n    }\r\n};\r\n\r\nexport const asyncOperationEnded = () => {\r\n    return {\r\n        type: ActionTypes.ASYNC_OPERATION_ENDED\r\n    }\r\n};\r\n\r\nexport const openDocumentOnCloud = () => {\r\n    return {\r\n        type: ActionTypes.MANAGE_CLOUD_STORAGE_BUTTON_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleLayerList = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_SHOW_LAYER_LIST_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleDownloadPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DOWNLOAD_POPUP_CLICKED\r\n    }\r\n};\r\n\r\nexport const toggleUploadPopup = () => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_UPLOAD_POPUP_CLICKED\r\n    }\r\n};\r\n\r\nexport const pasteDataFromBuffer = (clipboardData) => {\r\n    return {\r\n        type: ActionTypes.DATA_FROM_BUFFER_PASTED,\r\n        data: clipboardData\r\n    }\r\n};\r\n\r\n\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const addEmptyLayer = (stage) => {\r\n    return {\r\n        type: ActionTypes.ADD_LAYER_BUTTON_PRESSED,\r\n        stage: stage\r\n    }\r\n};\r\n\r\nexport const addNewLayer = (layer) => {\r\n    return {\r\n        type: ActionTypes.ADD_NEW_LAYER,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const deleteAffectedLayer = () => {\r\n    return {\r\n        type: ActionTypes.DELETE_LAYER_BUTTON_PRESSED\r\n    };\r\n};\r\n\r\nexport const sortLayers = () => {\r\n    return {\r\n        type: ActionTypes.SORT_LAYERS_BUTTON_PRESSED\r\n    };\r\n};\r\n\r\nexport const toggleDisplayLayer = (layer) => {\r\n    return {\r\n        type: ActionTypes.TOGGLE_DISPLAY_LAYER_PRESSED,\r\n        layer\r\n    }\r\n};\r\n\r\nexport const toggleAffectedLayer = (event, layer) => {\r\n    event.stopPropagation();\r\n    return {\r\n        type: ActionTypes.TOGGLE_AFFECTED_LAYER_PRESSED,\r\n        layer: layer\r\n    };\r\n};\r\n\r\nexport const updateLayer = (newLayer) => {\r\n    return {\r\n        type: ActionTypes.SUBMIT_LAYER_EDIT_FORM_PRESSED,\r\n        newLayer: newLayer\r\n    };\r\n};\r\n\r\nexport const closeEditLayerForm = () => {\r\n    return {\r\n        type: ActionTypes.ESCAPE_LAYER_EDIT_FORM_PRESSED\r\n    };\r\n};\r\n\r\nexport const openAffectedLayerEditForm = () => {\r\n    return {\r\n        type: ActionTypes.OPEN_LAYER_EDIT_FORM_PRESSED,\r\n    }\r\n};\r\n\r\nexport const setAffectedNextLayer = () => {\r\n    return {\r\n        type: ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED\r\n    }\r\n};\r\n\r\nexport const setAffectedPrevLayer = () => {\r\n    return {\r\n        type: ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED\r\n    }\r\n};\r\n\r\nexport const deleteAllLayers = () => {\r\n    return {\r\n        type: ActionTypes.CLEAR_ALL_BUTTON_CLICKED,\r\n    }\r\n}\r\n\r\n\r\n\r\n","import * as ActionTypes from \"../actionTypes\";\r\nimport axios from \"../../axios-database\";\r\nimport * as appActions from \"../actions/appActions\";\r\nimport * as layerActions from '../../store/actions/layersActions';\r\nimport Layer from \"../../models/layer\";\r\nimport {parseJSON} from \"../../dataParsers/parseJSON\";\r\nimport Layers from \"../../models/layers\";\r\n\r\nconst defaultName = \"document\";\r\n\r\nexport const getNewName = (documents) => {\r\n    let name = defaultName;\r\n    let inc = 1;\r\n    let comparator = (document) => document.name === name;\r\n    while (Object.values(documents).find(comparator)) {\r\n        name = defaultName + inc;\r\n        inc++;\r\n    }\r\n    return name;\r\n};\r\n\r\nexport const registerDocumentAddedToDatabase = (id, lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_ADD_DOCUMENT_TO_DATABASE_SUCCEED,\r\n        id: id,\r\n        lastUpdated: lastUpdated\r\n    }\r\n};\r\n\r\nexport const updateDocumentTimeStamp = (lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_UPDATE_DOCUMENT_IN_DATABASE_SUCCEED,\r\n        lastUpdated: lastUpdated\r\n    }\r\n};\r\n\r\nexport const updateDocumentName = (name) => {\r\n    return {\r\n        type: ActionTypes.DOCUMENT_NAME_UPDATED,\r\n        name\r\n    }\r\n};\r\n\r\nexport const clearCurrentDocument = () => {\r\n    return {\r\n        type: ActionTypes.CLEAR_ALL_BUTTON_CLICKED,\r\n    }\r\n};\r\n\r\nexport const updateCurrentDocument = (document) => {\r\n    return {\r\n        type: ActionTypes.DOCUMENT_SELECTED_FROM_LIST,\r\n        document\r\n    }\r\n};\r\n\r\nexport const requestFetchDocumentFromDatabaseSucceed = (id, name, owner, lastUpdated) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_FETCH_DOCUMENT_FROM_DATABASE_SUCCEED,\r\n        id,\r\n        name,\r\n        owner,\r\n        lastUpdated\r\n    }\r\n};\r\n\r\nexport const deleteDocumentFromDatabaseSucceed = (id) => {\r\n    return {\r\n        type: ActionTypes.DELETE_DOCUMENT_FROM_DATABASE_SUCCEED,\r\n        id\r\n    }\r\n};\r\n\r\nexport const requestFetchDocumentsFromDatabaseSucceed = (documentsList) => {\r\n    return {\r\n        type: ActionTypes.REQUEST_FETCH_DOCUMENTS_FROM_DATABASE_SUCCEED,\r\n        documentsList\r\n    }\r\n};\r\n\r\nexport const fetchDocumentsFromDatabase = (token, userId) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        const queryParams = '?auth=' + token + '&orderBy=\"userId\"&equalTo=\"' + userId + '\"';\r\n        const url = '/documents.json' + queryParams;\r\n        axios.get(url)\r\n            .then(response => {\r\n                dispatch(requestFetchDocumentsFromDatabaseSucceed(response.data));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const deleteDocumentFromDatabase = (id) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        const url = '/documents/' + id + '.json';\r\n        axios.delete(url)\r\n            .then (response => {\r\n                // query geom by \"id\"\r\n                const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n                const url = '/geom.json' + queryParams;\r\n                return axios.get(url)\r\n            })\r\n            .then (response => {\r\n                const geomId = Object.keys(response.data)[0];\r\n                return axios.delete(`/geom/${geomId}.json`)\r\n            })\r\n            .then(response => {\r\n                dispatch(deleteDocumentFromDatabaseSucceed(id));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const fetchDocumentFromDatabase = (stage, id) => {\r\n    return dispatch => {\r\n        dispatch(layerActions.deleteAllLayers());\r\n        dispatch(appActions.asyncOperationStarted());\r\n        let name = \"\";\r\n        let lastUpdated = undefined;\r\n        let owner = \"Alex Bol\";\r\n        let firstLayer = undefined;\r\n\r\n        const docUrl = '/documents/' + id + '.json';\r\n        const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n        const geomUrl = '/geom.json' + queryParams;\r\n        Promise.all([axios.get(docUrl),axios.get(geomUrl)])\r\n            .then( responses => {\r\n                name = responses[0].data.name;\r\n                lastUpdated = responses[0].data.lastUpdated;\r\n\r\n                for (let layerData of Object.values(responses[1].data)[0].layers) {\r\n                    let layer = new Layer();\r\n                    layer.shapes = parseJSON(layerData.shapes);\r\n                    layer.name = layerData.name;\r\n\r\n                    if (!firstLayer) firstLayer = layer;\r\n                    dispatch(layerActions.addNewLayer(layer));\r\n                    dispatch(layerActions.toggleDisplayLayer(layer));\r\n                }\r\n                dispatch(requestFetchDocumentFromDatabaseSucceed(id, name, owner, lastUpdated));\r\n                dispatch(appActions.setHomeView(stage, firstLayer));\r\n                // dispatch(layerActions.toggleDisplayLayer(firstLayer));\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const addDocumentToDatabase = (payload, layers, history) => {\r\n    return dispatch => {\r\n        let id = undefined;\r\n        dispatch(appActions.asyncOperationStarted());\r\n        axios.post('/documents.json', payload)\r\n            .then(response => {\r\n                id = response.data.name;\r\n                let layersJSON = Layers.toJSON(layers);\r\n                let geomPayload = {\r\n                    id: id,\r\n                    layers: layersJSON\r\n                };\r\n                return axios.post('/geom.json', geomPayload)\r\n            })\r\n            .then(response => {\r\n                dispatch(registerDocumentAddedToDatabase(id, Date.now()));\r\n                dispatch(appActions.asyncOperationEnded());\r\n\r\n                // update url\r\n                history.push('/documents/' + id);\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const updateDocumentInDatabase = (id, payload, layers) => {\r\n    return dispatch => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n        // update documents header\r\n        axios.put(`/documents/${id}.json`, payload)\r\n            .then(response => {\r\n                dispatch(updateDocumentTimeStamp(Date.now()));\r\n                // dispatch(appActions.asyncOperationEnded());\r\n\r\n                // query geom by \"id\"\r\n                const queryParams = '?orderBy=\"id\"&equalTo=\"' + id + '\"';\r\n                const url = '/geom.json' + queryParams;\r\n                return axios.get(url)\r\n            })\r\n            .then( response => {\r\n                let layersJSON = Layers.toJSON(layers);\r\n                let geomPayload = {\r\n                    id: id,\r\n                    layers: layersJSON\r\n                };\r\n                let geomId = Object.keys(response.data)[0];  // response.data.name;\r\n                return axios.put(`/geom/${geomId}.json`, geomPayload)\r\n            })\r\n            .then( reponse => {\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\n\r\n\r\n","import FontAwesome from \"react-fontawesome\";\r\nimport classes from \"./Button.module.css\";\r\n\r\nconst button = (props) => {\r\n    let iconStyle;\r\n    switch (props.type) {\r\n        case \"trigger\":\r\n            iconStyle = classes.IconTrigger;\r\n            break;\r\n        case \"mode\":\r\n            iconStyle = props.active ? classes.IconModeActive : classes.IconModeNotActive;\r\n            break;\r\n        default:\r\n            iconStyle = classes.IconTrigger;\r\n            break;\r\n    }\r\n    // eslint-disable-next-line\r\n    let buttonStyle = props.mobileOnly ? classes[\"Button\",\"DrawerButton\"] : classes[\"Button\"];\r\n    return (\r\n        <button title={props.title} onClick={props.onClick} className={buttonStyle}>\r\n            <FontAwesome\r\n                name={props.iconName}\r\n                size='2x'\r\n                className={iconStyle}\r\n            />\r\n        </button>\r\n    );\r\n};\r\n\r\nexport default button;","import FontAwesome from \"react-fontawesome\";\r\nimport classes from \"./ButtonSeparator.module.css\";\r\n\r\nconst buttonSeparator = () => {\r\n    return (\r\n        <div className={classes.ButtonSeparator}>\r\n            <FontAwesome\r\n                name='ellipsis-v'\r\n                size='2x'\r\n                className={classes.IconSeparator}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default buttonSeparator;","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport Button from '../../../components/UI/Button/Button';\r\nimport Separator from '../../../components/UI/ButtonSeparator/ButtonSeparator';\r\n\r\nimport classes from './ToolbarComponent.module.css';\r\nimport '@fortawesome/fontawesome-free/css/all.css';\r\n\r\nclass ToolbarComponent extends Component {\r\n    // openJobButtonClicked = () => this.refs.browseFiles.click();\r\n\r\n    render() {\r\n        return (\r\n            <div className={classes[\"App-toolbar\"]}>\r\n                {/*<h4>Toolbar</h4>*/}\r\n                <Button type=\"trigger\" title=\"Open files\" iconName='folder-open'\r\n                        onClick={this.props.onShowUploadPopupPressed}\r\n                />\r\n\r\n                {/*<input style={{fontSize: 16, marginTop: 5, marginBottom: 5, display: \"none\"}}*/}\r\n                       {/*type=\"file\" id=\"browseFiles\" ref=\"browseFiles\" name=\"files[]\" multiple*/}\r\n                       {/*onChange={this.props.onFileSelected}*/}\r\n                {/*/>*/}\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"Show/hide layers\" iconName='layer-group'\r\n                        onClick={this.props.onLayerListButtonClicked} />\r\n\r\n                {/*<Button type=\"trigger\" title=\"Save document on cloud\" iconName='save'*/}\r\n                        {/*onClick={this.props.onSaveDocumentButtonClicked}*/}\r\n                {/*/>*/}\r\n\r\n                <Button type=\"trigger\" title=\"Sort layers\" iconName='sort-alpha-down'\r\n                            onClick={this.props.onSortLayersButtonClicked}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Download layers\" iconName='file-download'\r\n                        onClick={this.props.onShowDownloadPopupPressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Delete all layers\" iconName='broom'\r\n                            onClick={this.props.onClearAllButtonClicked}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"Zoom and pan to home view\" iconName='home'\r\n                        onClick={this.props.onHomeButtonPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"mode\" title=\"Pan by drag\" iconName='arrows-alt'\r\n                        active={!this.props.measurePointsActive}\r\n                        onClick={this.props.onPanByDragPressed}\r\n                />\r\n\r\n                <Button type=\"mode\" title=\"Measure distance between points\" iconName='drafting-compass'\r\n                        active={this.props.measurePointsActive}\r\n                        onClick={this.props.onMeasurePointsButtonPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"Measure distance between selected shapes\" iconName='ruler'\r\n                        onClick={this.props.onMeasureBetweenShapesButtonPressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display solid or wire\" iconName='fill-drip'\r\n                        onClick={this.props.onToggleWidthModePressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display vertices on/off\" iconName='draw-polygon'\r\n                        onClick={this.props.onToggleVerticesPressed}\r\n                />\r\n\r\n                <Button type=\"trigger\" title=\"Display labels on/off\" iconName='tag'\r\n                        onClick={this.props.onToggleLabelsPressed}\r\n                />\r\n\r\n                {this.props.showSkeletonRecognitionButton ? (\r\n                    <Button type=\"trigger\" title=\"Skeleton Recognition Demo\" iconName='tree'\r\n                            onClick={this.props.onSkeletonRecognitionButtonPressed}\r\n                    />\r\n                ) : null}\r\n\r\n                <Separator/>\r\n\r\n                <button className={classes[\"App-toolbar-units\"]}\r\n                        onClick={this.props.onUnitClicked}\r\n                >\r\n                    {this.props.units}\r\n                </button>\r\n\r\n                <Separator/>\r\n\r\n                <Button type=\"trigger\" title=\"About\" iconName='info'\r\n                        onClick={this.props.onShowAboutPopupPressed}\r\n                />\r\n\r\n                <Separator/>\r\n\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ToolbarComponent;\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\nimport {Box} from '@flatten-js/core';\r\nimport { Stage as CreatejsStage, Touch } from \"@createjs/easeljs\";\r\n\r\nclass Stage extends CreatejsStage {\r\n    constructor(canvas) {\r\n        super(canvas);\r\n\r\n        Touch.enable(this);\r\n        this.mouseMoveOutside = false;   // true;\r\n        // this.enableDOMEvents(false);\r\n        this.enableMouseOver(20);\r\n\r\n        if (this.canvas.clientWidth > 0 && this.canvas.clientHeight > 0) {\r\n            this.canvas.width = this.canvas.clientWidth;\r\n            this.canvas.height = this.canvas.clientHeight;\r\n            // this.updateViewport(this.canvas.width, this.canvas.height);\r\n        }\r\n        this.origin = {x: this.canvas.width / 2, y: this.canvas.height / 2};\r\n        this.resolution = 0.00001;          // MM 2 Pixels when zoomFactor = 1;\r\n        this.zoomFactor = 1.0;\r\n\r\n        this.oldOrigin = {x: undefined, y: undefined};   // used by pan\r\n        // used by zoom by pinch\r\n        this.oldZoomFactor = undefined;\r\n        this.pinchAnchorX = undefined;\r\n        this.pinchAnchorY = undefined;\r\n        this.pinchStarted = false;\r\n    }\r\n\r\n    get box() {\r\n        let minX = this.C2W_X(0);\r\n        let minY = this.C2W_Y(this.canvas.height);\r\n        let maxX = this.C2W_X(this.canvas.width);\r\n        let maxY = this.C2W_Y(0);\r\n\r\n        return ( new Box(minX, minY, maxX, maxY) );\r\n    }\r\n\r\n    clone() {\r\n        let stage = new Stage(this.canvas);\r\n        return Object.assign(stage, this);\r\n    }\r\n\r\n    add(shape) {\r\n        this.addChild(shape);\r\n        return this;\r\n    }\r\n\r\n    scalingFactor() {\r\n        return this.resolution * this.zoomFactor;\r\n    }\r\n\r\n    C2W_Scalar(scalar) {\r\n        return (scalar / this.scalingFactor());\r\n    }\r\n\r\n    W2C_Scalar(scalar) {\r\n        return (this.scalingFactor() * scalar);\r\n    }\r\n\r\n    C2W_X(canvasX) {\r\n        return ((canvasX - this.origin.x) / this.scalingFactor());\r\n    }\r\n\r\n    C2W_Y(canvasY) {\r\n        return ((this.origin.y - canvasY) / this.scalingFactor());\r\n    }\r\n\r\n    W2C_X(worldX) {\r\n        return (this.scalingFactor() * worldX + this.origin.x);\r\n    }\r\n\r\n    W2C_Y(worldY) {\r\n        return (this.origin.y - this.scalingFactor() * worldY);\r\n    }\r\n\r\n    W2C(point) {\r\n        return {x: this.W2C_X(point.x), y: this.W2C_Y(point.y)}\r\n    }\r\n\r\n    panTo(newOrigin) {\r\n        this.origin = {x: newOrigin.x, y: newOrigin.y}\r\n    }\r\n\r\n    panBy(deltaX, deltaY) {\r\n        this.origin = {\r\n            x: this.origin.x + deltaX,\r\n            y: this.origin.y + deltaY\r\n        }\r\n    }\r\n\r\n    // zoom by 10% each time\r\n    zoomIn(ratio) {\r\n        let curRatio = ratio || 1.1;\r\n        this.zoomFactor = Math.min(10000000, curRatio * this.zoomFactor);\r\n    }\r\n\r\n    zoomOut(ratio) {\r\n        let curRatio = ratio || 1.1;\r\n        this.zoomFactor = Math.max(0.001, this.zoomFactor / curRatio);\r\n    }\r\n\r\n    // ZoomIn/Out + \"Focus follows mouse\"\r\n    zoom(focusX, focusY, bIn, ratio) {\r\n        let worldX = this.C2W_X(focusX);    // world coordinate of mouse focus before zoom\r\n        let worldY = this.C2W_Y(focusY);\r\n\r\n        bIn ? this.zoomIn(ratio) : this.zoomOut(ratio);\r\n\r\n        let newFocusX = this.W2C_X(worldX); // canvas coordinate after zoom\r\n        let newFocusY = this.W2C_Y(worldY);\r\n\r\n        this.panBy(focusX - newFocusX, focusY - newFocusY);\r\n\r\n        return [newFocusX, newFocusY];\r\n    }\r\n\r\n    zoomByMouse(focusX, focusY, bIn, ratio) {\r\n        this.zoom(focusX, focusY, bIn, ratio);\r\n    }\r\n\r\n    zoomToLimits(width, height) {\r\n        // prevent zero division in case of single point box\r\n        if (width === 0) width = 400000;\r\n        if (height === 0) height = 400000;\r\n        let resolution = Math.min(this.canvas.width / (1.1*width), this.canvas.height / (1.1*height));\r\n        let zoomFactor = resolution / this.resolution;\r\n        let ratio = zoomFactor / this.zoomFactor;\r\n        let bIn = true; //ratio > 1;\r\n\r\n        let focusX = this.canvas.width/2;\r\n        let focusY = this.canvas.height/2;\r\n        this.zoom(focusX, focusY, bIn, ratio);\r\n    }\r\n\r\n    resize() {\r\n        // this.origin.x = this.canvas.width / 2;\r\n        // this.origin.y = this.canvas.height / 2;\r\n        if (this.canvas.clientWidth > 0 && this.canvas.clientHeight > 0) {\r\n            this.canvas.width = this.canvas.clientWidth;\r\n            this.canvas.height = this.canvas.clientHeight;\r\n        }\r\n    }\r\n\r\n    // drawSomething() {\r\n    //     let shape = new Shape();\r\n    //     shape.graphics.beginFill('red').drawRect(0, 0, 20, 20);\r\n    //     this.addChild(shape);\r\n    //     this.update();\r\n    // }\r\n\r\n    panByMouseStart() {\r\n        this.oldOrigin.x = this.origin.x;\r\n        this.oldOrigin.y = this.origin.y;\r\n        this.zoomByPinchStop();\r\n    }\r\n\r\n    panByMouseMove(dx, dy) {\r\n        if (this.pinchStarted) return;\r\n        if (dx !== undefined && dy !== undefined &&\r\n            this.oldOrigin.x !== undefined && this.oldOrigin.y !== undefined) {\r\n            this.origin = {\r\n                    x: this.oldOrigin.x + dx,\r\n                    y: this.oldOrigin.y + dy\r\n                };\r\n        }\r\n    }\r\n\r\n    panByMouseStop() {\r\n        this.oldOrigin.x = undefined;\r\n        this.oldOrigin.y = undefined;\r\n    }\r\n\r\n    panToCoordinate(x, y) {\r\n        let canvasX = this.W2C_X(x);\r\n        let canvasY = this.W2C_Y(y);\r\n\r\n        let dx = this.canvas.width / 2 - canvasX;\r\n        let dy = this.canvas.height / 2 - canvasY;\r\n        this.panBy(dx, dy);\r\n    }\r\n\r\n    zoomByPinchStart(canvasX, canvasY) {\r\n        this.oldZoomFactor = this.zoomFactor;\r\n        this.pinchAnchorX = this.C2W_X(canvasX);\r\n        this.pinchAnchorY = this.C2W_Y(canvasY);\r\n        this.pinchStarted = true;\r\n        this.panByMouseStop();\r\n    }\r\n\r\n    zoomByPinchMove(canvasX, canvasY, ratio) {\r\n        this.zoomFactor = ratio * this.oldZoomFactor;\r\n        this.origin = {\r\n            x: canvasX - this.scalingFactor() * this.pinchAnchorX,\r\n            y: canvasY + this.scalingFactor() * this.pinchAnchorY\r\n        }\r\n    }\r\n\r\n    zoomByPinchStop() {\r\n        this.oldZoomFactor = undefined;\r\n        this.pinchAnchorX = undefined;\r\n        this.pinchAnchorY = undefined;\r\n        this.pinchStarted = false;\r\n    }\r\n\r\n    clear() {\r\n        this.canvas.getContext('2d').clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n}\r\n\r\nexport default Stage;\r\n","import * as ActionTypes from '../actionTypes';\r\n\r\nexport const registerStage = (stage) => {\r\n    return {\r\n        type: ActionTypes.NEW_STAGE_CREATED,\r\n        stage: stage\r\n    }\r\n};\r\n\r\nexport const handleMouseDown = (stage, x, y) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_DOWN_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y\r\n    }\r\n};\r\n\r\nexport const handleMouseUp = (stage, x, y) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_UP_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y\r\n    }\r\n};\r\n\r\nexport const handleMouseMove = (stage, x, y, dx, dy) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_MOVED_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y,\r\n        dx: dx,\r\n        dy: dy\r\n    }\r\n};\r\n\r\nexport const handleMouseWheelMove = (stage, x, y, delta) => {\r\n    return {\r\n        type: ActionTypes.MOUSE_WHEEL_MOVE_ON_STAGE,\r\n        stage: stage,\r\n        x: x,\r\n        y: y,\r\n        delta: delta\r\n    }\r\n};\r\n\r\nexport const handlePinchDown = (stage, touchPoints) => {\r\n    return {\r\n        type: ActionTypes.PINCH_DOWN_ON_STAGE,\r\n        stage: stage,\r\n        x1: touchPoints[0].x,\r\n        y1: touchPoints[0].y,\r\n        x2: touchPoints[1].x,\r\n        y2: touchPoints[1].y\r\n    }\r\n};\r\n\r\nexport const handlePinchMove = (stage, touchPoints) => {\r\n    return {\r\n        type: ActionTypes.PINCH_MOVED_ON_STAGE,\r\n        stage: stage,\r\n        x1: touchPoints[0].x,\r\n        y1: touchPoints[0].y,\r\n        x2: touchPoints[1].x,\r\n        y2: touchPoints[1].y\r\n    }\r\n};\r\n\r\nexport const handlePinchUp = (stage) => {\r\n    return {\r\n        type: ActionTypes.PINCH_UP_ON_STAGE,\r\n        stage\r\n    }\r\n};\r\n\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport {Component, createRef} from 'react';\r\nimport styles from \"./CanvasComponent.module.css\";\r\nimport Stage from '../../../models/stage';\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from '../../../store/actions/stageActions';\r\n\r\nclass CanvasComponent extends Component {\r\n    canvasElement = createRef();\r\n\r\n    handleMouseMove = (event) => {\r\n        this.props.stage.canvas.focus();\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseMove(\r\n                this.props.stage,\r\n                event.stageX,\r\n                event.stageY,\r\n                this.props.mouse.startX ? event.stageX - this.props.mouse.startX : undefined,\r\n                this.props.mouse.startY ? event.stageY - this.props.mouse.startY : undefined\r\n            );\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            let touchPoints = [\r\n                {\r\n                    x: event.nativeEvent.touches[0].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[0].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n                {\r\n                    x: event.nativeEvent.touches[1].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[1].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n            ];\r\n            this.props.handlePinchMove(this.props.stage, touchPoints);\r\n        }\r\n\r\n        // if (this.props.stage.pinchStarted) {\r\n        //     this.props.handleSecondTouchMove(this.props.stage, event.stageX, event.stageY);\r\n        // }\r\n        // else {\r\n        //     this.props.handleMouseMove(\r\n        //         this.props.stage,\r\n        //         event.stageX,\r\n        //         event.stageY,\r\n        //         this.props.mouse.startX ? event.stageX - this.props.mouse.startX : undefined,\r\n        //         this.props.mouse.startY ? event.stageY - this.props.mouse.startY : undefined\r\n        //     );\r\n        // }\r\n    };\r\n\r\n    handleMouseDown = (event) => {\r\n        // if (event.pointerID === -1 || event.pointerID === 0) {\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseDown(this.props.stage, event.stageX, event.stageY);\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            let touchPoints = [\r\n                {\r\n                    x: event.nativeEvent.touches[0].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[0].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n                {\r\n                    x: event.nativeEvent.touches[1].clientX - event.nativeEvent.target.offsetLeft,\r\n                    y: event.nativeEvent.touches[1].clientY - event.nativeEvent.target.offsetTop\r\n                },\r\n            ];\r\n            this.props.handlePinchDown(this.props.stage, touchPoints);\r\n        }\r\n    };\r\n\r\n    handleMouseUp = (event) => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        if (!event.nativeEvent.touches || event.nativeEvent.touches.length === 1) {\r\n            this.props.handleMouseUp(this.props.stage);\r\n        }\r\n        else if (event.nativeEvent.touches && event.nativeEvent.touches.length === 2) {\r\n            this.props.handlePinchUp(this.props.stage);\r\n        }\r\n    };\r\n\r\n    handleMouseLeave = (event) => {   // nothing works except click\r\n        this.props.stage.canvas.blur();\r\n        document.body.focus();\r\n    };\r\n\r\n    handleMouseWheel = (event) => {\r\n        /*event.preventDefault();*/\r\n\r\n        let delta = event.detail || event.wheelDelta;\r\n        if (delta !== 0) {\r\n            this.props.handleMouseWheelMove(this.props.stage, event.offsetX, event.offsetY, delta);\r\n        }\r\n    };\r\n\r\n    handleMouseWheelFox = (event) => {\r\n        /*event.preventDefault();*/\r\n        if (event.detail !== 0) {\r\n            this.props.handleMouseWheelMove(this.props.stage, event.layerX, event.layerY, -event.detail);\r\n        }\r\n    };\r\n\r\n    // handlePaste = (event) => {\r\n    //     let a = event;\r\n    // }\r\n\r\n    componentDidMount() {\r\n        let stage = new Stage(this.canvasElement.current);\r\n\r\n        stage.on(\"stagemousedown\", this.handleMouseDown);\r\n        stage.on(\"stagemousemove\", this.handleMouseMove);\r\n        stage.on(\"stagemouseup\", this.handleMouseUp);\r\n        stage.on(\"mouseleave\", this.handleMouseLeave);\r\n        stage.canvas.addEventListener(\"mousewheel\", this.handleMouseWheel, {passive: true});\r\n        stage.canvas.addEventListener(\"DOMMouseScroll\", this.handleMouseWheelFox, {passive: true});\r\n        // stage.canvas.addEventListener(\"paste\", this.handlePaste);\r\n\r\n        this.props.registerStage(stage);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <canvas\r\n                tabIndex=\"1\"\r\n                ref={this.canvasElement}\r\n                id=\"mainCanvas\"\r\n                className={styles[\"App-canvas\"]}\r\n                width=\"100\"\r\n                height=\"100\"\r\n            >\r\n            </canvas>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        stage: state.app.stage,\r\n        mouse: state.mouse\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        registerStage: (stage) => dispatch(actions.registerStage(stage)),\r\n        handleMouseDown: (stage, x, y) => dispatch(actions.handleMouseDown(stage, x, y)),\r\n        handleMouseUp: (stage, x, y) => dispatch(actions.handleMouseUp(stage, x, y)),\r\n        handleMouseMove: (stage, x, y, dx, dy) => dispatch(actions.handleMouseMove(stage, x, y, dx, dy)),\r\n        handleMouseWheelMove: (stage, x, y, delta) => dispatch(actions.handleMouseWheelMove(stage, x, y, delta)),\r\n        handlePinchDown: (stage, touchPoints) => dispatch(actions.handlePinchDown(stage, touchPoints)),\r\n        handlePinchMove: (stage, touchPoints) => dispatch(actions.handlePinchMove(stage, touchPoints)),\r\n        handlePinchUp: (stage) => dispatch(actions.handlePinchUp(stage))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CanvasComponent);\r\n","/**\r\n * Created by alexanderbol on 17/06/2017.\r\n */\r\nimport styles from './StatusComponent.module.css';\r\n\r\nconst StatusComponent = () => {\r\n    return (\r\n        <div className={styles[\"App-status-bar\"]}>\r\n            <div>\r\n                <h5>\r\n                    &nbsp;\r\n                </h5>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default StatusComponent;","import {Component, Fragment} from 'react';\r\n// import Utils from \"../utils\";\r\n\r\nclass StageComponent extends Component {\r\n    // shouldComponentUpdate useless because always returns \"true\",\r\n    // Don't know why, maybe because of children?\r\n    // ----------------------------------------------------------\r\n    // shouldComponentUpdate(nextProps, nextState) {\r\n    //     if (Utils.is_equal(this.props, nextProps)) {\r\n    //         return false;\r\n    //     }\r\n    //     return true;\r\n    // }\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.stage.canvas && this.props.stage.canvas.getContext('2d')) {\r\n\r\n            let origin = this.props.stage.origin;\r\n            let zoomFactor = this.props.stage.zoomFactor*this.props.stage.resolution;\r\n            this.props.stage.setTransform(origin.x, origin.y, zoomFactor, -zoomFactor);\r\n\r\n            this.props.stage.update();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.onStageUnmounted();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Fragment>\r\n                {this.props.children}\r\n            </Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default StageComponent;","import {Point, Segment, Circle, Arc, Polygon, Box} from '@flatten-js/core';\r\nimport {Graphics} from '@createjs/easeljs';\r\n\r\n/* Provide conversion methods from FlattenJS objects to CreateJS Graphics */\r\nexport function graphics(shape, style = undefined) {\r\n    if (shape instanceof Point) {\r\n        return graphics_point(shape, style);\r\n    }\r\n    if (shape instanceof Segment) {\r\n        return graphics_segment(shape, style);\r\n    }\r\n    if (shape instanceof Arc) {\r\n        return graphics_arc(shape, style);\r\n    }\r\n    if (shape instanceof Circle) {\r\n        return graphics_circle(shape, style);\r\n    }\r\n    if (shape instanceof Box) {\r\n        return graphics_box(shape, style);\r\n    }\r\n    if (shape instanceof Polygon) {\r\n        return graphics_polygon(shape, style);\r\n    }\r\n    return null;\r\n}\r\n\r\n// Point.prototype.graphics = function(style) {\r\nfunction graphics_point(point, style) {\r\n    let radius = (style && style.radius) ? style.radius : 3;\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    let graphics = new Graphics();\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.circle = graphics.drawCircle(point.x, point.y, radius).command;\r\n    return graphics;\r\n};\r\n\r\n// Segment.prototype.graphics = function(style) {\r\nfunction graphics_segment(segment, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle !== undefined ? style.strokeStyle : 2;\r\n    let ignoreScale = style && style.ignoreScale !== undefined ? style.ignoreScale : true;\r\n    let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    return graphics\r\n        .setStrokeStyle(strokeStyle,1,0,10,ignoreScale)\r\n        .beginStroke(stroke)\r\n        .moveTo(segment.ps.x, segment.ps.y)\r\n        .lineTo(segment.pe.x, segment.pe.y)\r\n        .endStroke();\r\n};\r\n\r\n// Arc.prototype.graphics = function(style) {\r\nfunction graphics_arc(arc, style) {\r\n    // let startAngle = 2 * Math.PI - this.startAngle;\r\n    // let endAngle =  2 * Math.PI - this.endAngle;\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 2;\r\n    let ignoreScale = style && style.ignoreScale !== undefined ? style.ignoreScale : true;\r\n    let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    return graphics\r\n        .setStrokeStyle(strokeStyle,1,0,10,ignoreScale)\r\n        .beginStroke(stroke)\r\n        .arc(arc.pc.x, arc.pc.y, arc.r, arc.startAngle, arc.endAngle, !arc.counterClockwise)\r\n        .endStroke();\r\n};\r\n\r\n// Circle.prototype.graphics = function(style) {\r\nfunction graphics_circle(circle, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    // let stroke = style && style.stroke ? style.stroke : \"black\";\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.drawCircle(circle.pc.x, circle.pc.y, circle.r);\r\n    return graphics;\r\n};\r\n\r\n\r\nfunction graphics_box(box, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n    graphics.drawRect(box.xmin, box.ymin, box.xmax-box.xmin, box.ymax-box.ymin);\r\n    return graphics;\r\n};\r\n\r\nfunction setGraphicsEdgeSegment(graphics, segment) {\r\n    graphics.lineTo(segment.pe.x, segment.pe.y);\r\n}\r\n\r\nfunction setGraphicsEdgeArc(graphics, arc) {\r\n    // let startAngle = 2 * Math.PI - arc.startAngle;\r\n    // let endAngle = 2 * Math.PI - arc.endAngle;\r\n    graphics.arc(arc.pc.x, arc.pc.y, arc.r, arc.startAngle, arc.endAngle, !arc.counterClockwise);\r\n}\r\n\r\nfunction setGraphicsEdge(graphics, edge) {\r\n    if (edge.shape instanceof Segment) {\r\n        setGraphicsEdgeSegment(graphics, edge.shape);\r\n    }\r\n    else if (edge.shape instanceof Arc) {\r\n        setGraphicsEdgeArc(graphics, edge.shape);\r\n    }\r\n}\r\n\r\nfunction setGraphicsFace(graphics, face) {\r\n    let ps = face.first.start;\r\n    graphics.moveTo(ps.x, ps.y);\r\n\r\n    for (let edge of face) {\r\n        setGraphicsEdge(graphics, edge);\r\n    }\r\n}\r\n\r\n// Polygon.prototype.graphics = function(style) {\r\nfunction graphics_polygon(polygon, style) {\r\n    let graphics = new Graphics();\r\n    let strokeStyle = style && style.strokeStyle ? style.strokeStyle : 1;\r\n    let stroke = style && style.stroke ? style.stroke : \"#FF0303\";\r\n    let fill = style && style.fill ? style.fill : \"#FF0303\";\r\n    graphics.setStrokeStyle(strokeStyle,0,0,10,true);\r\n    graphics.stroke = graphics.beginStroke(stroke).command;\r\n    graphics.fill = graphics.beginFill(fill).command;\r\n\r\n    for (let face of polygon.faces) {\r\n        setGraphicsFace(graphics, face);\r\n    }\r\n\r\n    graphics.endStroke();\r\n    return graphics;\r\n};\r\n\r\n","export const is_equal = (obj1, obj2) => {\r\n    let equal = true;\r\n    for (let key of Object.keys(obj2)) {\r\n        if (obj2[key] !== obj1[key]) {\r\n            equal = false;\r\n            break;\r\n        }\r\n    }\r\n    return equal;\r\n};\r\n\r\nexport const format = (num, divisor, decimals) => {\r\n    return (num/divisor).toFixed(decimals);\r\n};\r\n","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Shape} from '@createjs/easeljs';\r\nimport {graphics} from '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\n\r\nexport class ShapeComponent extends Component {\r\n    constructor(params) {\r\n        super();\r\n        this.shape = new Shape();\r\n        params.stage.addChild(this.shape);\r\n    }\r\n\r\n    handleMouseOver = (event) => {\r\n        this.props.onMouseOver(this.props.model);\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        this.props.onMouseOut();\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        this.props.onClick(this.props.model, this.props.layer);\r\n    };\r\n\r\n    redraw() {\r\n        // Draw shape\r\n        let stage = this.props.stage;\r\n        let color = (this.props.hovered || this.props.selected) ? \"black\" : this.props.color;\r\n        let alpha = (this.props.hovered || this.props.selected) ? 1.0 : 0.6;\r\n        let widthOn = this.props.widthOn;\r\n\r\n        let strokeStyle = this.props.model.geom.aperture ? this.props.model.geom.aperture : undefined;\r\n        let fill = widthOn ? this.props.color : \"white\";\r\n\r\n        if (this.shape.graphics.isEmpty()) {\r\n            this.shape.graphics = graphics(this.props.model.geom,{\r\n                strokeStyle: strokeStyle,\r\n                ignoreScale: true,\r\n                stroke: color,\r\n                fill: fill,\r\n                radius: 3. / (stage.zoomFactor * stage.resolution)\r\n            });\r\n\r\n            // this.skeletonShape = new Shape();\r\n            // this.skeletonShape.graphics = this.props.model.geom.graphics({\r\n            //     strokeStyle: 1,\r\n            //     ignoreScale: true,\r\n            //     stroke: color,\r\n            //     fill: fill,\r\n            //     radius: 3. / (stage.zoomFactor * stage.resolution)\r\n            // });\r\n            // this.skeletonShape.alpha = 1;\r\n            // this.props.stage.addChild(this.skeletonShape);\r\n        }\r\n        else {\r\n            if (this.shape.graphics.stroke) this.shape.graphics.stroke.style = color;\r\n            if (this.shape.graphics.fill) this.shape.graphics.fill.style = fill;\r\n            if (this.shape.graphics.circle) this.shape.graphics.circle.radius =\r\n                3. / (stage.zoomFactor * stage.resolution);\r\n        }\r\n        this.shape.alpha = this.props.displayed ? alpha : 0.0;\r\n\r\n        // let box = this.props.model.geom.box;\r\n        // this.shape.cache(box.xmin, box.ymin, box.xmax - box.xmin, box.ymax - box.ymin);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.shape.on(\"mouseover\", this.handleMouseOver);\r\n        this.shape.on(\"mouseout\", this.handleMouseOut);\r\n        this.shape.on(\"click\", this.handleClick);\r\n\r\n        // this.shape.mouseEnabled = false;\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.shape.off(\"mouseover\", this.handleMouseOver);\r\n        this.shape.off(\"mouseout\", this.handleMouseOut);\r\n        this.shape.off(\"click\", this.handleClick);\r\n        this.props.stage.removeChild(this.shape);\r\n        this.shape.graphics.clear();\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Bitmap} from '@createjs/easeljs';\r\nimport '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\n// import storage from '../../../../firebase-storage';\r\n\r\nexport class ImageComponent extends Component {\r\n    handleMouseOver = (event) => {\r\n        this.props.onMouseOver(this.props.model);\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        this.props.onMouseOut();\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        this.props.onClick(this.props.model, this.props.layer);\r\n    };\r\n\r\n    redraw() {\r\n        if (!this.bitmap) return;\r\n        // Draw shape\r\n        let alpha = 1; // (this.props.hovered || this.props.selected) ? 1.0 : 0.6;\r\n        this.bitmap.alpha = this.props.displayed ? alpha : 0.0;\r\n\r\n        let width = this.props.model.geom.width;\r\n        let ratio = this.bitmap.image.naturalWidth/this.bitmap.image.naturalHeight;\r\n        this.props.model.geom.height = this.props.model.geom.width / ratio;\r\n        let scaleX = width/this.bitmap.image.naturalWidth; // 1. / (stage.zoomFactor * stage.resolution);\r\n        let scaleY = width/(this.bitmap.image.naturalHeight*ratio);\r\n        let tx = this.props.model.geom.center.x; // stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n        let ty = this.props.model.geom.center.y; // -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n\r\n        this.bitmap.setTransform(tx, ty, scaleX, -scaleY);\r\n\r\n        this.bitmap.regX = this.bitmap.image.naturalWidth/2;\r\n        this.bitmap.regY = this.bitmap.image.naturalHeight/2;\r\n\r\n        // let box = this.state.polygon.geom.box;\r\n        // this.shape.cache(box.xmin, box.ymin, box.xmax - box.xmin, box.ymax - box.ymin);\r\n    }\r\n\r\n    loadImage() {\r\n        const img = new Image();\r\n\r\n        img.onload = () => {\r\n            // img.crossOrigin=\"Anonymous\";\r\n            this.bitmap = new Bitmap(img);\r\n            this.props.stage.addChild(this.bitmap);\r\n\r\n            // this.bitmap.on(\"mouseover\", this.handleMouseOver);\r\n            // this.bitmap.on(\"mouseout\", this.handleMouseOut);\r\n            // this.bitmap.on(\"click\", this.handleClick);\r\n\r\n            // this.shape.mouseEnabled = false;\r\n            this.redraw();\r\n\r\n            this.props.onImageLoaded(this.props.model, this.props.layer, img);\r\n        };\r\n        img.setAttribute('crossOrigin', 'anonymous'); // works for me\r\n\r\n        // Create a reference from a Google Cloud Storage URI\r\n        //const ref = storage.refFromURL(this.props.model.geom.uri);\r\n\r\n        // ref.getDownloadURL()\r\n        //    .then( url => {\r\n        //\r\n        //         img.src = url;\r\n        //     })\r\n        //     .catch( error => console.log(error))\r\n\r\n        img.src = this.props.model.geom.uri;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.loadImage()\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // this.bitmap.off(\"mouseover\", this.handleMouseOver);\r\n        // this.bitmap.off(\"mouseout\", this.handleMouseOut);\r\n        // this.bitmap.off(\"click\", this.handleClick);\r\n\r\n        this.props.stage.removeChild(this.bitmap);\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n","import {Component} from 'react';\r\nimport {ShapeComponent} from './graphics/shapeComponent';\r\nimport {ImageComponent} from \"./graphics/imageComponent\";\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from \"../../../store/actions/appActions\";\r\n\r\nclass LayerComponent extends Component {\r\n    onImageLoaded = (model, layer, image) => {\r\n        this.props.setHomeView(this.props.stage, this.props.layer);\r\n        this.forceUpdate();       // ??? unclear why on Home button click not updated\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            this.props.layer.shapes.map((shape, index) => {\r\n                return shape.geom.uri ? (\r\n                    <ImageComponent\r\n                        key={index}\r\n                        stage={this.props.stage}\r\n                        layer={this.props.layer}\r\n                        model={shape}\r\n                        displayed={this.props.layer.displayed}\r\n                        hovered={shape === this.props.hoveredShape}\r\n                        selected={\r\n                            shape === this.props.firstMeasuredShape ||\r\n                            shape === this.props.secondMeasuredShape\r\n                        }\r\n                        color={this.props.layer.color}\r\n                        widthOn={this.props.widthOn}\r\n                        displayLabels={this.props.displayLabels}\r\n                        zoomFactor={this.props.zoomFactor}\r\n                        onMouseOver={this.props.onMouseOver}\r\n                        onMouseOut={this.props.onMouseOut}\r\n                        onClick={this.props.onClick}\r\n                        onImageLoaded={this.onImageLoaded}\r\n                    />\r\n                    ) : (\r\n                    <ShapeComponent\r\n                        key={index}\r\n                        stage={this.props.stage}\r\n                        layer={this.props.layer}\r\n                        model={shape}\r\n                        displayed={this.props.layer.displayed}\r\n                        hovered={shape === this.props.hoveredShape}\r\n                        selected={\r\n                            shape === this.props.firstMeasuredShape ||\r\n                            shape === this.props.secondMeasuredShape\r\n                        }\r\n                        color={this.props.layer.color}\r\n                        widthOn={this.props.widthOn}\r\n                        displayVertices={this.props.displayVertices}\r\n                        zoomFactor={this.props.zoomFactor}\r\n                        onMouseOver={this.props.handleMouseRollOverShape}\r\n                        onMouseOut={this.props.handleMouseRollOutShape}\r\n                        onClick={this.props.handleClickOnShape}\r\n                    /> )\r\n                }\r\n            )\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        layers: state.layers,\r\n        displayVertices: state.app.displayVertices,\r\n        displayLabels: state.app.displayLabels,\r\n        widthOn: state.app.widthOn,\r\n        zoomFactor: state.app.zoomFactor,\r\n        units: state.app.units,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n        measurePointsActive: state.app.measurePointsActive,\r\n        showAboutPopup: state.app.showAboutPopup,\r\n        showDownloadPopup: state.app.showDownloadPopup,\r\n        showUploadPopup: state.app.showUploadPopup,\r\n        measureShapesTool: state.measureShapesTool,\r\n        hoveredShape: state.measureShapesTool.hoveredShape,\r\n        firstMeasuredShape: state.measureShapesTool.firstMeasuredShape,\r\n        secondMeasuredShape: state.measureShapesTool.secondMeasuredShape\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        setHomeView: (stage, shape) => dispatch(actions.setHomeView(stage, shape)),\r\n        handleMouseRollOverShape: (shape) => dispatch(actions.handleMouseRollOverShape(shape)),\r\n        handleMouseRollOutShape: () => dispatch(actions.handleMouseRollOutShape()),\r\n        handleClickOnShape: (shape, layer) => dispatch(actions.handleClickOnShape(shape, layer)),\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LayerComponent);\r\n","import classes from '../LabelsLayerComponent/labelsLayer.module.css';\r\n\r\nconst labelComponent = ( {stage, shape} ) => {\r\n    let center = shape.geom.center || shape.geom;  // Point has no method center\r\n    let left = stage.canvas.offsetLeft + stage.W2C_X(center.x) + 6;\r\n    let top = stage.canvas.offsetTop + stage.W2C_Y(center.y) - 4;\r\n    let inside = left > stage.canvas.offsetLeft && left < stage.canvas.offsetLeft + stage.canvas.width &&\r\n        top > stage.canvas.offsetTop && top < stage.canvas.offsetTop + stage.canvas.height;\r\n\r\n    return inside ? (\r\n        <div style={{position:\"absolute\", left:left+\"px\", top: top+\"px\"}} className={classes.LabelComponent}>\r\n            <h5>{shape.label}</h5>\r\n        </div>\r\n    ) : null;\r\n};\r\n\r\nexport default labelComponent;","import LabelComponent from '../domelements/labelComponent';\r\nimport { connect } from \"react-redux\";\r\n\r\nconst labelsLayerComponent = (props) => {\r\n\r\n    return (props.layer.displayed && props.displayLabels) ? (\r\n        props.layer.shapes.map((shape, index) => {\r\n                return (shape.label && shape.label.trim() !== \"\") ? (\r\n                    <LabelComponent\r\n                        key={index}\r\n                        stage={props.stage}\r\n                        shape={shape}\r\n                        zoomFactor={props.zoomFactor}\r\n                        originX={props.originX}\r\n                        originY={props.originY}\r\n                    />) : null;\r\n            }\r\n        )\r\n    ) : null;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        displayLabels: state.app.displayLabels,\r\n        zoomFactor: state.app.zoomFactor,\r\n        originX: state.app.originX,\r\n        originY: state.app.originY\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {return {}};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(labelsLayerComponent);\r\n","import {format} from \"../../../../../models/utils\";\r\nimport classes from './VertexLabel.module.css';\r\n\r\nconst VertexLabel = (props) => {\r\n    let stage = props.stage;\r\n    let left = stage.canvas.offsetLeft + stage.W2C_X(props.vertex.x) + 6;\r\n    let top = stage.canvas.offsetTop + stage.W2C_Y(props.vertex.y) - 10;\r\n    // let inside = left > stage.canvas.offsetLeft && left < stage.canvas.offsetLeft + stage.canvas.width &&\r\n    //     top > stage.canvas.offsetTop && top < stage.canvas.offsetTop + stage.canvas.height;\r\n    let x = format(props.vertex.x, props.divisor, props.decimals);\r\n    let y = format(props.vertex.y, props.divisor, props.decimals);\r\n\r\n    return (\r\n        <div className={classes.VertexLabel} style={{left:left, top:top}}>\r\n            <h5>\r\n                x={x} y={y}\r\n            </h5>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default VertexLabel;","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Shape, Shadow} from '@createjs/easeljs';\r\nimport {graphics} from '../../../../models/graphics';\r\nimport {is_equal} from '../../../../models/utils';\r\nimport VertexLabel from '../domelements/VertexLabel/VertexLabel';\r\n\r\nclass VertexComponent extends Component {\r\n    constructor(props) {\r\n        super();\r\n        this.shape = new Shape();\r\n        props.stage.addChild(this.shape);\r\n\r\n        this.state = {\r\n            hovered: false\r\n        }\r\n    }\r\n\r\n    handleMouseOver = (event) => {\r\n        // this.props.onMouseOver(this.props.model);\r\n        this.shape.shadow = new Shadow(this.props.color, 0, 0, 10);\r\n        this.setState({hovered:true})\r\n    };\r\n\r\n    handleMouseOut = (event) => {\r\n        // this.props.onMouseOut();\r\n        this.shape.shadow = null;\r\n        this.setState({hovered:false})\r\n    };\r\n\r\n    handleClick = (event) => {\r\n        // this.props.onClick(this.props.model, this.props.layer);\r\n        console.log(this.props.vertex);\r\n    };\r\n\r\n    redraw() {\r\n        let stage = this.props.stage;\r\n        let stroke = this.props.color;\r\n        let fill = this.props.color;\r\n        let alpha = 1.0;\r\n\r\n\r\n        if (this.shape.graphics.isEmpty()) {\r\n            this.shape.graphics = graphics(this.props.vertex,\r\n                {\r\n                    stroke: stroke,     // this.props.color,\r\n                    fill: fill,\r\n                    radius: 3. / (stage.zoomFactor * stage.resolution)\r\n                });\r\n        }\r\n        else {\r\n            this.shape.graphics.circle.radius = 3. / (stage.zoomFactor * stage.resolution);\r\n            this.shape.graphics.fill.style = fill;\r\n        }\r\n        this.shape.alpha = alpha;\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.shape.on(\"mouseover\", this.handleMouseOver);\r\n        this.shape.on(\"mouseout\", this.handleMouseOut);\r\n        this.shape.on(\"click\", this.handleClick);\r\n\r\n        this.shape.mouseEnabled = true;\r\n\r\n        this.redraw();\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        if (is_equal(this.props, nextProps) && is_equal(this.state, nextState)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.redraw();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.shape.off(\"mouseover\", this.handleMouseOver);\r\n        this.shape.off(\"mouseout\", this.handleMouseOut);\r\n        this.shape.off(\"click\", this.handleClick);\r\n\r\n        this.props.stage.removeChild(this.shape);\r\n        this.shape.graphics.clear();\r\n    }\r\n\r\n    render() {\r\n        return this.state.hovered ? (\r\n            <VertexLabel\r\n                stage={this.props.stage}\r\n                vertex={this.props.vertex}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n            />\r\n            ) : null;\r\n    }\r\n}\r\n\r\nexport default VertexComponent;","/**\r\n * Created by alexanderbol on 19/06/2017.\r\n */\r\nimport VertexComponent from './vertexComponent';\r\n\r\nconst VerticesComponent = (props) => {\r\n\r\n    return props.model.geom.vertices ?\r\n        props.model.geom.vertices.map((vertex, index) =>\r\n            <VertexComponent key={index}\r\n                             stage={props.stage}\r\n                             vertex={vertex}\r\n                             color={props.color}\r\n                             divisor={props.divisor}\r\n                             decimals={props.decimals}\r\n                             zoomFactor={props.zoomFactor}\r\n                             originX={props.originX}\r\n                             originY={props.originY}\r\n            />\r\n        ) : null;\r\n\r\n}\r\n\r\nexport default VerticesComponent;","import VerticesComponent from './graphics/verticesComponent';\r\nimport { connect } from \"react-redux\";\r\n\r\nconst verticesLayerComponent = (props) => {\r\n    return (props.layer.displayed && props.displayVertices) ? (\r\n        props.layer.shapes.map((shape, index) =>\r\n            <VerticesComponent\r\n                key={index}\r\n                stage={props.stage}\r\n                model={shape}\r\n                color={props.layer.color}\r\n                divisor={props.divisor}\r\n                decimals={props.decimals}\r\n                zoomFactor={props.zoomFactor}\r\n                originX={props.originX}\r\n                originY={props.originY}\r\n            />\r\n        )\r\n    ) : null;\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        displayVertices: state.app.displayVertices,\r\n        zoomFactor: state.app.zoomFactor,\r\n        originX: state.app.originX,\r\n        originY: state.app.originY,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {return {}};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(verticesLayerComponent);\r\n","import {Component, Fragment} from 'react';\r\nimport LayerComponent from \"./layerComponent\";\r\nimport LabelsLayerComponent from \"./LabelsLayerComponent/labelsLayerComponent\";\r\nimport VerticesLayerComponent from './verticesLayerComponent';\r\n// import Layers from \"../../../models/layers\";\r\n\r\nclass LayersComponent extends Component {\r\n    componentDidMount() {\r\n        // if (this.props.layers.length > 0 && this.props.stage) {\r\n        //     let affectedLayer = Layers.getAffected(this.props.layers);\r\n        //     if (affectedLayer) {\r\n        //         this.props.setHomeView(this.props.stage, affectedLayer);\r\n        //     }\r\n        // }\r\n    }\r\n    render() {\r\n        return this.props.layers.map((layer) =>\r\n            <Fragment key={layer.name}>\r\n\r\n                <LayerComponent layer={layer} />\r\n\r\n                <LabelsLayerComponent layer={layer} />\r\n\r\n                <VerticesLayerComponent layer={layer} />\r\n            </Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default LayersComponent;\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport {Component, createRef} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport Stage from \"../models/stage\";\r\nimport * as actions from '../store/actions/stageActions';\r\n\r\nclass MeasurePointsTool extends Component {\r\n    measureCanvas = createRef();\r\n    measureStage = null;\r\n\r\n    state = {\r\n        startX: undefined,\r\n        startY: undefined,\r\n        endX: undefined,\r\n        endY: undefined,\r\n        measureStarted: false\r\n    };\r\n\r\n    handleMouseDown = (event) => {\r\n        event.preventDefault();\r\n\r\n        this.measureStage.clear();\r\n\r\n        if (this.state.measureStarted) {   // second click - clear measurement\r\n            this.setState({\r\n                startX: undefined,\r\n                startY: undefined,\r\n                endX: undefined,\r\n                endY: undefined,\r\n                measureStarted: false\r\n            });\r\n            this.measureStage.canvas.style.cursor = \"auto\";\r\n        }\r\n        else {                       // first click - start measurment\r\n            this.setState({\r\n                startX: this.measureStage.C2W_X(event.stageX),\r\n                startY: this.measureStage.C2W_Y(event.stageY),\r\n                measureStarted: true\r\n            });\r\n            this.measureStage.canvas.style.cursor = \"crosshair\";\r\n        }\r\n    };\r\n\r\n    handleMouseMove = (event) => {\r\n        if (this.state.measureStarted) {\r\n            this.setState({\r\n                endX: this.measureStage.C2W_X(event.stageX),\r\n                endY: this.measureStage.C2W_Y(event.stageY)\r\n            })\r\n        }\r\n    };\r\n\r\n    handleMouseUp = (event) => {\r\n    }\r\n\r\n    handleMouseWheel = (event) => {\r\n        event.preventDefault();\r\n\r\n        let delta = event.detail || event.wheelDelta;\r\n        if (delta !== 0) {\r\n            // this.props.onMouseWheelMove(event.offsetX, event.offsetY, delta);\r\n            this.props.handleMouseWheelMove(this.props.stage, event.offsetX, event.offsetY, delta);\r\n\r\n            this.draw();\r\n        }\r\n    };\r\n\r\n    handleMouseWheelFox = (event) => {\r\n        event.preventDefault();\r\n\r\n        if (event.detail !== 0) {\r\n            // this.props.onMousewheelMove(event.layerX, event.layerY, -event.detail);\r\n            this.props.handleMouseWheelMove(this.props.stage, event.layerX, event.layerY, -event.detail);\r\n\r\n            this.draw();\r\n        }\r\n    };\r\n\r\n    draw() {\r\n        // let canvas = this.measureCanvas.current;\r\n        let stage = this.measureStage; // this.props.stage;\r\n        let canvas = stage.canvas;\r\n        let context = canvas.getContext('2d');\r\n\r\n        this.measureStage.origin = this.props.stage.origin;\r\n        this.measureStage.resolution = this.props.stage.resolution;\r\n        this.measureStage.zoomFactor = this.props.stage.zoomFactor;\r\n\r\n        this.measureStage.clear();\r\n\r\n        // Draw rectangle\r\n        let pllX = Math.min(stage.W2C_X(this.state.startX), stage.W2C_X(this.state.endX));\r\n        let pllY = Math.min(stage.W2C_Y(this.state.startY), stage.W2C_Y(this.state.endY));\r\n        let width = Math.abs(stage.W2C_Scalar(this.state.startX - this.state.endX));\r\n        let height = Math.abs(stage.W2C_Scalar(this.state.startY - this.state.endY));\r\n\r\n        context.beginPath();\r\n        context.rect(pllX, pllY, width, height);\r\n\r\n        // Draw segment\r\n        context.moveTo(stage.W2C_X(this.state.startX), stage.W2C_Y(this.state.startY));\r\n        context.lineTo(stage.W2C_X(this.state.endX), stage.W2C_Y(this.state.endY));\r\n\r\n        context.lineWidth = 1;\r\n        context.strokeStyle = 'black';\r\n        context.stroke();\r\n\r\n        // Draw text\r\n        let textX, textY, textHeight, textWidth;\r\n        let backX, backY;                      // background rectangle\r\n        let text = this.measurement();\r\n\r\n        context.font = \"12pt Arial\";\r\n\r\n        textHeight = 12;\r\n        /* font size*/\r\n        textWidth = context.measureText(text).width;\r\n\r\n        // Rectangle to the right of current point, text aligned left\r\n        if (Math.abs(stage.W2C_X(this.state.endX) - pllX) <= 2) {\r\n            context.textAlign = \"left\";\r\n            textX = pllX + 3;\r\n            backX = pllX;\r\n        }\r\n        // Rectangle to the left of current point, text aligned right\r\n        else {\r\n            context.textAlign = \"right\";\r\n            textX = pllX + width - 3;\r\n            backX = textX - textWidth - 3;\r\n        }\r\n\r\n        if (Math.abs(stage.W2C_Y(this.state.endY) - pllY) <= 2) {\r\n            textY = pllY - 3;\r\n        }\r\n        else {\r\n            textY = pllY + height + textHeight + 3;\r\n        }\r\n        backY = textY - textHeight - 3;\r\n\r\n        context.fillStyle = 'white';\r\n        context.globalAlpha = 0.4;\r\n        context.fillRect(backX, backY, textWidth + 6, textHeight + 6);\r\n\r\n        context.fillStyle = \"black\";\r\n        context.globalAlpha = 1;\r\n        context.fillText(this.measurement(), textX, textY);\r\n    }\r\n\r\n    measurement() {\r\n        let dx = this.state.endX - this.state.startX;\r\n        let dy = this.state.endY - this.state.startY;\r\n        let dist = Math.sqrt(dx * dx + dy * dy);\r\n        let message = \"DX=\" + this.format(dx) + \",DY=\" + this.format(dy) + \",D=\" + this.format(dist);\r\n        return message;\r\n    }\r\n\r\n    format(num) {\r\n        return (num / this.props.divisor).toFixed(this.props.decimals);\r\n    }\r\n\r\n    componentDidMount() {\r\n        // let canvas = this.measureCanvas.current;\r\n        this.measureStage = new Stage(this.measureCanvas.current);\r\n        this.measureStage.origin = this.props.stage.origin;\r\n        this.measureStage.resolution = this.props.stage.resolution;\r\n        this.measureStage.zoomFactor = this.props.stage.zoomFactor;\r\n\r\n        this.measureStage.on(\"stagemousedown\", this.handleMouseDown);\r\n        this.measureStage.on(\"stagemousemove\", this.handleMouseMove);\r\n        this.measureStage.on(\"stagemouseup\", this.handleMouseUp);\r\n\r\n        this.measureStage.canvas.addEventListener(\"mousewheel\", this.handleMouseWheel);\r\n        this.measureStage.canvas.addEventListener(\"DOMMouseScroll\", this.handleMouseWheelFox);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.measureStarted) {\r\n            this.draw();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.measureStage.clear();\r\n        this.measureStage.removeAllChildren();\r\n        this.measureStage.removeAllEventListeners();\r\n    }\r\n\r\n    render() {\r\n        let mainCanvas = this.props.stage.canvas;\r\n        let width = mainCanvas.width;\r\n        let height = mainCanvas.height;\r\n        let top = mainCanvas.offsetTop;\r\n        let left = mainCanvas.offsetLeft;\r\n        return (\r\n            <canvas tabIndex=\"1\" ref={this.measureCanvas}\r\n                    width={width}\r\n                    height={height}\r\n                    style={{position: 'absolute', top: top, left: left}}\r\n            >\r\n            </canvas>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({app}) => {\r\n    return {\r\n        stage: app.stage,\r\n        divisor: app.divisor,\r\n        decimals: app.decimals\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        handleMouseWheelMove: (stage, x, y, delta) => dispatch(actions.handleMouseWheelMove(stage, x, y, delta))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MeasurePointsTool);\r\n","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Shape, Text} from '@createjs/easeljs';\r\nimport {graphics} from '../models/graphics';\r\n\r\nclass MeasureShapesTool extends Component {\r\n    constructor(params) {\r\n        super();\r\n        this.segment = new Shape();\r\n        params.stage.addChild(this.segment);\r\n\r\n        this.labelShape = new Text();\r\n        this.labelShape.x = 0;\r\n        this.labelShape.y = 0;\r\n        params.stage.addChild(this.labelShape);\r\n\r\n        // var html = document.createElement('div');\r\n        // html.innerText = \"\"; // params.model.label;\r\n        // html.style.position = \"absolute\";\r\n        // html.style.top = 0;\r\n        // html.style.left = 0;\r\n        //\r\n        // document.body.appendChild(html);\r\n        // this.labelShape = new createjs.DOMElement(html);\r\n        // params.stage.addChild(this.labelShape);\r\n    }\r\n\r\n    // redrawLabel() {\r\n    //     if (!this.labelShape) return;\r\n    //\r\n    //     let stage = this.props.stage;\r\n    //\r\n    //     this.labelShape.htmlElement.style.display = \"block\";\r\n    //\r\n    //     let box = this.props.shortestSegment.box;\r\n    //     let point = {x: (box.xmin + box.xmax) / 2, y: (box.ymin + box.ymax) / 2};\r\n    //     let dx = 6. / (stage.zoomFactor * stage.resolution);\r\n    //     let dy = 4. / (stage.zoomFactor * stage.resolution);\r\n    //\r\n    //     this.labelShape.htmlElement.style.font = \"16px Arial\";\r\n    //     this.labelShape.htmlElement.innerText = this.props.shortestSegment.length;\r\n    //\r\n    //     let unscale = 1. / (stage.zoomFactor * stage.resolution);\r\n    //     let tx = stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n    //     let ty = -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n    //     this.labelShape.setTransform(tx, ty, unscale, -unscale);\r\n    // }\r\n\r\n    format(num) {\r\n        return (num/this.props.divisor).toFixed(this.props.decimals);\r\n    }\r\n\r\n    redrawLabel() {\r\n        if (!this.labelShape) return;\r\n\r\n        let stage = this.props.stage;\r\n\r\n        let box = this.props.shortestSegment.box;\r\n        let point = {x: (box.xmin + box.xmax) / 2, y: (box.ymin + box.ymax) / 2};\r\n        let dx = 6. / (stage.zoomFactor * stage.resolution);\r\n        let dy = 4. / (stage.zoomFactor * stage.resolution);\r\n\r\n        if (box.ymin === box.ymax) {\r\n            dx = 0;\r\n            dy = -dy;\r\n        }\r\n\r\n        // this.labelShape.htmlElement.style.display = \"block\";\r\n        // this.labelShape.htmlElement.style.font = \"16px Arial\";\r\n        // this.labelShape.htmlElement.innerText = this.props.shortestSegment.length;\r\n\r\n        this.labelShape.text = this.format(this.props.shortestSegment.length);\r\n\r\n        let fontSize = 14.; // / (stage.zoomFactor * stage.resolution);\r\n        this.labelShape.font = `${fontSize}px Arial`;\r\n\r\n        let unscale = 1. / (stage.zoomFactor * stage.resolution);\r\n        // let tx = stage.canvas.offsetLeft / (stage.zoomFactor * stage.resolution) + point.x + dx;\r\n        // let ty = -stage.canvas.offsetTop / (stage.zoomFactor * stage.resolution) + point.y + dy;\r\n        let tx = point.x + dx;\r\n        let ty = point.y + dy;\r\n        this.labelShape.setTransform(tx, ty, unscale, -unscale);\r\n    }\r\n\r\n    draw() {\r\n        if (this.props.shortestSegment) {\r\n            this.segment.graphics = graphics(this.props.shortestSegment);\r\n            this.redrawLabel();\r\n        }\r\n    }\r\n    componentDidMount() {\r\n        this.draw();\r\n    }\r\n    componentDidUpdate() {\r\n        this.segment.graphics.clear();\r\n        if (this.props.firstMeasuredShape && this.props.secondMeasuredShape &&\r\n            this.props.firstMeasuredLayer.displayed &&\r\n            this.props.secondMeasuredLayer.displayed) {\r\n\r\n            this.draw();\r\n            this.redrawLabel();\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.stage.removeChild(this.segment);\r\n        this.segment.graphics.clear();\r\n        this.props.stage.removeChild(this.labelShape);\r\n        this.labelShape.text = \"\";\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport default MeasureShapesTool;","/**\r\n * Created by alexanderbol on 21/04/2017.\r\n */\r\nimport {format} from '../models/utils';\r\n\r\nconst DisplayCoordsTool = ({stage, coordX, coordY, divisor, decimals}) => {\r\n    let mainCanvas = stage.canvas;\r\n    let top = mainCanvas.offsetTop + 10;\r\n    let left = mainCanvas.width - 200; //  mainCanvas.offsetLeft + 10;\r\n    let x = stage.C2W_X(coordX);\r\n    let y = stage.C2W_Y(coordY);\r\n    return (\r\n        <div style={{position: 'absolute', top: top, left: left,\r\n            backgroundColor: 'white', opacity:0.8}}>\r\n            <h5 style={{margin: 0, padding: 3}}>\r\n                X: {format(x,divisor,decimals)} Y: {format(y,divisor,decimals)}\r\n            </h5>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default DisplayCoordsTool;\r\n","import {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nconst modalRoot = document.getElementById('modal-root');\r\n\r\n// A Modal component that is an abstraction around the portal API.\r\nclass Modal extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        // Create a div that we'll render the modal into. Because each\r\n        // Modal component has its own element, we can render multiple\r\n        // modal components into the modal container.\r\n        this.el = document.createElement('div');\r\n    }\r\n\r\n    componentDidMount() {\r\n        // Append the element into the DOM on mount. We'll render\r\n        // into the modal container element (see the HTML tab).\r\n        modalRoot.appendChild(this.el);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        // Remove the element from the DOM when we unmount\r\n        modalRoot.removeChild(this.el);\r\n    }\r\n\r\n    render() {\r\n        // Use a portal to render the children into the element\r\n        return ReactDOM.createPortal(\r\n            // Any valid React child: JSX, strings, arrays, etc.\r\n            this.props.children,\r\n            // A DOM element\r\n            this.el,\r\n        );\r\n    }\r\n}\r\n\r\nexport default Modal;","import {Component} from 'react';\r\nimport Modal from '../Modal';\r\nimport classes from './ModalPopup.module.css';\r\n\r\nclass ModalPopup extends Component {\r\n    offsetX;\r\n    offsetY;\r\n    dragX;\r\n    dragY;\r\n\r\n    onBackDropClicked = (ev) => {\r\n        if (ev.target.id === \"backDrop\") {\r\n            this.props.closePopup();\r\n        }\r\n    };\r\n\r\n    handleKeyDown = (ev) => {\r\n        if (ev.code === \"Escape\") {\r\n            this.props.closePopup();\r\n        }\r\n    };\r\n\r\n    elementDrag = (ev) => {\r\n        ev = ev || window.event;\r\n        // calculate the new cursor position:\r\n        this.offsetX = this.dragX - ev.clientX;\r\n        this.offsetY = this.dragY - ev.clientY;\r\n        this.dragX = ev.clientX;\r\n        this.dragY = ev.clientY;\r\n        // set the element's new position:\r\n        let element = ev.target;\r\n        element.style.top = (element.offsetTop - this.offsetY) + \"px\";\r\n        element.style.left = (element.offsetLeft - this.offsetX) + \"px\";\r\n    };\r\n\r\n    closeDragElement = (ev) => {\r\n        /* stop moving when mouse button is released:*/\r\n        ev.target.onmouseup = null;\r\n        ev.target.onmousemove = null;\r\n    };\r\n\r\n    dragMouseDown = (ev) => {\r\n        ev = ev || window.event;\r\n        // get the mouse cursor position at startup:\r\n        this.dragX = ev.clientX;\r\n        this.dragY = ev.clientY;\r\n        ev.target.onmouseup = this.closeDragElement;\r\n        // call a function whenever the cursor moves:\r\n        ev.target.onmousemove = this.elementDrag;\r\n    };\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('keydown', this.handleKeyDown);\r\n    }\r\n\r\n    render() {\r\n        return this.props.showPopup ? (\r\n            <Modal>\r\n                <div\r\n                    id=\"backDrop\"\r\n                    className={classes.BackDrop}\r\n                    onClick={this.onBackDropClicked}\r\n                >\r\n                    <div className={classes.ModalPopup}\r\n                         onMouseDown={this.dragMouseDown}\r\n                    >\r\n                        <header>{this.props.header}</header>\r\n                        {this.props.children}\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nexport default ModalPopup;\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nimport classes from './AboutPopup.module.css';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\n\r\nconst AboutPopup = (props) => {\r\n    return (\r\n        <ModalPopup\r\n            showPopup={props.showAboutPopup}\r\n            closePopup={props.toggleAboutPopup}\r\n            header=\"Info\"\r\n        >\r\n            <div className={classes.AboutPopup}>\r\n                <h2>{props.title} v{props.version}</h2>\r\n\r\n                <label>{`Build date: `}</label>\r\n                <span>02/10/2021</span>\r\n                <br/>\r\n\r\n                <label>{`Github depository: `}</label>\r\n                <a href=\"https://github.com/alexbol99/debug-viewer1\" >\r\n                    https://github.com/alexbol99/debug-viewer1\r\n                </a>\r\n                <br/>\r\n\r\n                <label>{`3d party graphics library: `}</label>\r\n                <a href=\"https://github.com/CreateJS/EaselJS/tree/2.0\" >\r\n                    https://github.com/CreateJS/EaselJS/tree/2.0\r\n                </a>\r\n                <br/>\r\n\r\n            </div>\r\n        </ModalPopup>\r\n\r\n    )\r\n};\r\n\r\nexport default AboutPopup;\r\n","import {Point, Segment, Arc, Circle, Box, Polygon} from \"@flatten-js/core\";\r\nimport {CW, ORIENTATION} from \"@flatten-js/core\";\r\n\r\nimport XMLWriter from \"xml-writer\";\r\n\r\nfunction pointToXMLString(xw, shape) {\r\n    xw.startElement('point');\r\n        xw.writeAttribute('x', shape.geom.x);\r\n        xw.writeAttribute('y', shape.geom.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction segmentToXMLString(xw, shape) {\r\n    xw.startElement('segment');\r\n        xw.writeAttribute('xs', shape.geom.ps.x);\r\n        xw.writeAttribute('ys', shape.geom.ps.y);\r\n        xw.writeAttribute('xe', shape.geom.pe.x);\r\n        xw.writeAttribute('ye', shape.geom.pe.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction arcToXMLString(xw, shape) {\r\n    xw.startElement('arc');\r\n        xw.writeAttribute('xs', Math.round(shape.geom.start.x));\r\n        xw.writeAttribute('ys', Math.round(shape.geom.start.y));\r\n        xw.writeAttribute('xe', Math.round(shape.geom.end.x));\r\n        xw.writeAttribute('ye', Math.round(shape.geom.end.y));\r\n        xw.writeAttribute('xc', shape.geom.center.x);\r\n        xw.writeAttribute('yc', shape.geom.center.y);\r\n        xw.writeAttribute('cw', shape.geom.counterClockwise === CW ? \"yes\" : \"no\");\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction circleToXMLString(xw, shape) {\r\n    xw.startElement('circle');\r\n        xw.writeAttribute('xc', shape.geom.center.x);\r\n        xw.writeAttribute('yc', shape.geom.center.y);\r\n        xw.writeAttribute('label', shape.label);\r\n    xw.endElement();\r\n}\r\n\r\nfunction boxToXMLString(xw, shape) {\r\n\r\n}\r\n\r\nfunction polygonToXMlString(xw, polygon) {\r\n    xw.startElement('profile');\r\n\r\n    for (let face of polygon.faces) {\r\n        if (face.orientation() === ORIENTATION.CW) {\r\n            xw.startElement('island');\r\n        }\r\n        else {\r\n            xw.startElement('hole');\r\n        }\r\n\r\n        xw.writeAttribute('n_edges', `${face.size}`);\r\n\r\n        for (let edge of face) {\r\n            xw.startElement('edge');\r\n            let shape = edge.shape;\r\n            if (shape instanceof Segment) {\r\n                xw.writeAttribute('type', 'segment');\r\n                xw.writeAttribute('xs', shape.ps.x);\r\n                xw.writeAttribute('ys', shape.ps.y);\r\n                xw.writeAttribute('xe', shape.pe.x);\r\n                xw.writeAttribute('ye', shape.pe.y);\r\n            } else if (edge.shape instanceof Arc) {\r\n                xw.writeAttribute('type', 'curve');\r\n                xw.writeAttribute('xs', Math.round(shape.start.x));\r\n                xw.writeAttribute('ys', Math.round(shape.start.y));\r\n                xw.writeAttribute('xe', Math.round(shape.end.x));\r\n                xw.writeAttribute('ye', Math.round(shape.end.y));\r\n                xw.writeAttribute('xc', shape.center.x);\r\n                xw.writeAttribute('yc', shape.center.y);\r\n                xw.writeAttribute('cw', shape.counterClockwise === CW ? \"yes\" : \"no\");\r\n            } else {\r\n                xw.writeAttribute('type', 'unknown');\r\n            }\r\n            xw.endElement();\r\n        }\r\n\r\n        xw.endElement();  // island or hole\r\n    }\r\n\r\n    xw.endElement();     // profile\r\n}\r\n\r\nexport function createXMLString(shapes) {\r\n    let xw = new XMLWriter(true);\r\n    xw.startDocument('1.0', 'UTF-8');\r\n\r\n    xw.startElement('shapes');\r\n    xw.startElement('title').text('test polygon in xml format').endElement();\r\n\r\n    for (let shape of shapes) {\r\n        if (shape.geom instanceof Point) {\r\n            pointToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Segment) {\r\n            segmentToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Arc) {\r\n            arcToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Circle) {\r\n            circleToXMLString(xw, shape);\r\n        }\r\n        else if (shape.geom instanceof Box) {\r\n            boxToXMLString(xw, shape)\r\n        }\r\n        else if (shape.geom instanceof Polygon) {\r\n            polygonToXMlString(xw, shape.geom);\r\n        }\r\n    }\r\n\r\n    xw.endDocument();\r\n    return xw.toString();\r\n}\r\n\r\n","import {Component} from 'react';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\nimport {createXMLString} from \"../../dataParsers/createXML\";\r\n\r\nimport classes from \"./DownloadPopup.module.css\";\r\n\r\nclass DownloadPopup extends Component {\r\n    render() {\r\n        let downloadData = this.props.showPopup ?\r\n            this.props.layers.map( layer => {\r\n            return layer.displayed ? {\r\n                filename: `${layer.name}.xml`,\r\n                xmlString: createXMLString(layer.shapes)\r\n            } : null\r\n        }) : [];\r\n        return this.props.showPopup && this.props.layers.length > 0 ? (\r\n            <ModalPopup\r\n                showPopup={this.props.showPopup}\r\n                closePopup={this.props.closePopup}\r\n                header=\"Download files\"\r\n            >\r\n                <div className={classes.DownloadPopup}>\r\n                    <h5>Click to the following links to start download</h5>\r\n                    <ul>\r\n\r\n                        {downloadData.map(data =>\r\n                            data === null ? null :\r\n                            <li key={data.filename}>\r\n                                <a href={'data:text/json;charset=utf-8,' + encodeURIComponent(data.xmlString)}\r\n                                   download={data.filename}>\r\n                                    {data.filename}\r\n                                </a>\r\n                            </li>\r\n                        )}\r\n\r\n                    </ul>\r\n                </div>\r\n            </ModalPopup>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nexport default DownloadPopup;\r\n","import {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nconst snackbarRoot = document.getElementById('snackbar-root');\r\n\r\nclass SnackbarRoot extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.el = document.createElement('div');\r\n    }\r\n\r\n    componentDidMount() {\r\n        snackbarRoot.appendChild(this.el);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        snackbarRoot.removeChild(this.el);\r\n    }\r\n\r\n    render() {\r\n        return ReactDOM.createPortal(\r\n            // Any valid React child: JSX, strings, arrays, etc.\r\n            this.props.children,\r\n            // A DOM element\r\n            this.el,\r\n        );\r\n    }\r\n}\r\n\r\nexport default SnackbarRoot;","import {Component} from 'react';\r\nimport SnackbarRoot from '../SnackbarRoot';\r\nimport classes from './Snackbar.module.css';\r\n\r\nclass Snackbar extends Component {\r\n    state = {\r\n        display: true\r\n    };\r\n\r\n    animationEndHandler() {\r\n        this.setState({\r\n            display: false\r\n        });\r\n        this.props.onAnimationEnd();\r\n    }\r\n\r\n    render() {\r\n        return ( this.state.display ?\r\n            <SnackbarRoot>\r\n                <div className={classes.Snackbar} onAnimationEnd={this.props.onAnimationEnd}>\r\n                    <h3>{this.props.message}</h3>\r\n                </div>\r\n            </SnackbarRoot> : null\r\n        )\r\n    }\r\n}\r\n\r\nexport default Snackbar;","import { Job } from '../models/job';\r\nimport {Point, Segment, Arc, Polygon, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\n\r\nFlatten.Image = class Image {\r\n    constructor() {\r\n        this.uri = \"\";\r\n        /**\r\n         * Center in world coordinates\r\n         * @type {Flatten.Point}\r\n         */\r\n        this.center = new Flatten.Point();\r\n        /**\r\n         * Width in world units (inch/mm)\r\n         */\r\n        this.width = 0;\r\n        /**\r\n         * Height in world units (inch/mm)\r\n         */\r\n        this.height = 0;\r\n    }\r\n    get box() {\r\n        return new Flatten.Box(\r\n            this.center.x - this.width/2,\r\n            this.center.y - this.height/2,\r\n            this.center.x + this.height/2,\r\n            this.center.y + this.height/2\r\n        );\r\n\r\n    }\r\n};\r\n\r\nfunction parseEdges(edgesXML) {\r\n    let edges = [];\r\n\r\n    for (let edge of Array.from(edgesXML)) {\r\n        let type = edge.getAttribute('type');\r\n\r\n        if (type === \"segment\") {\r\n            let ps = new Point(parseInt(edge.getAttribute('xs'),10), parseInt(edge.getAttribute('ys'),10));\r\n            let pe = new Point(parseInt(edge.getAttribute('xe'),10), parseInt(edge.getAttribute('ye'),10));\r\n\r\n            edges.push(new Segment(ps, pe));\r\n        }\r\n\r\n        if (type === \"curve\") {\r\n            let ps = new Point(parseInt(edge.getAttribute('xs'),10), parseInt(edge.getAttribute('ys'),10));\r\n            let pe = new Point(parseInt(edge.getAttribute('xe'),10), parseInt(edge.getAttribute('ye'),10));\r\n            let pc = new Point(parseInt(edge.getAttribute('xc'),10), parseInt(edge.getAttribute('yc'),10));\r\n\r\n            let counterClockwise = edge.getAttribute('cw') === 'no' ? true : false;\r\n\r\n            let startAngle = vector(pc,ps).slope;\r\n            let endAngle = vector(pc, pe).slope;\r\n\r\n            if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n                endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n            }\r\n\r\n            let r = vector(pc, ps).length;\r\n\r\n            edges.push(new Arc(pc, r, startAngle, endAngle, counterClockwise));\r\n        }\r\n    }\r\n\r\n    return edges;\r\n}\r\n\r\nfunction parsePolygon(polygonsXML) {\r\n    let polygon = new Polygon();\r\n\r\n    // let nedges = parseInt(profile.getAttribute(\"n_edges\"), 10);\r\n\r\n    // Augment Flatten object with style\r\n    let color = polygonsXML.getAttribute(\"color\");\r\n    polygon.style = {\r\n        stroke: color || undefined,\r\n        fill: color || undefined,\r\n        alpha: 1.0\r\n    };\r\n\r\n    // Augment Flatten object with label\r\n    let label = polygonsXML.getAttribute(\"label\");\r\n    polygon.label = label;\r\n\r\n    // Add islands\r\n    let islands = polygonsXML.getElementsByTagName('island');\r\n    for (let island of Array.from(islands)) {\r\n        let edgesXML = island.getElementsByTagName('edge');\r\n        polygon.addFace(parseEdges(edgesXML));\r\n    }\r\n\r\n    // Add holes\r\n    let holes = polygonsXML.getElementsByTagName('hole');\r\n    for (let hole of Array.from(holes)) {\r\n        let edgesXML = hole.getElementsByTagName('edge');\r\n        polygon.addFace(parseEdges(edgesXML));\r\n    }\r\n\r\n    return polygon;\r\n}\r\n\r\nfunction parseSegment(segmentXML) {\r\n    let ps = new Point(parseInt(segmentXML.getAttribute('xs'),10), parseInt(segmentXML.getAttribute('ys'),10));\r\n    let pe = new Point(parseInt(segmentXML.getAttribute('xe'),10), parseInt(segmentXML.getAttribute('ye'),10));\r\n\r\n    let segment = new Segment(ps, pe);\r\n\r\n    // Augment Flatten object with label property\r\n    let label = segmentXML.getAttribute(\"label\");\r\n    segment.label = label;\r\n\r\n    return segment;\r\n}\r\n\r\nfunction parseCurve(curveXML) {\r\n    let ps = new Point(parseInt(curveXML.getAttribute('xs'),10), parseInt(curveXML.getAttribute('ys'),10));\r\n    let pe = new Point(parseInt(curveXML.getAttribute('xe'),10), parseInt(curveXML.getAttribute('ye'),10));\r\n    let pc = new Point(parseInt(curveXML.getAttribute('xc'),10), parseInt(curveXML.getAttribute('yc'),10));\r\n\r\n    let counterClockwise = curveXML.getAttribute('cw') === 'no' ? true : false;\r\n\r\n    let startAngle = vector(pc,ps).slope;\r\n    let endAngle = vector(pc, pe).slope;\r\n\r\n    if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n        endAngle = counterClockwise ? endAngle + 2*Math.PI : endAngle - 2*Math.PI;\r\n    }\r\n\r\n    let r = vector(pc, ps).length;\r\n\r\n    let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n    // Augment Flatten object with label property\r\n    let label = curveXML.getAttribute(\"label\");\r\n    arc.label = label;\r\n\r\n    return arc;\r\n}\r\n\r\nfunction parsePoint(pointXML) {\r\n    let point = new Point(parseInt(pointXML.getAttribute('x'),10), parseInt(pointXML.getAttribute('y'),10));\r\n\r\n    // Augment Flatten object with label property\r\n    let label = pointXML.getAttribute(\"label\");\r\n    point.label = label;\r\n\r\n    return point;\r\n}\r\n\r\nfunction parseImage(imageXML) {\r\n    let img = new Flatten.Image();\r\n    img.center = new Point(parseInt(imageXML.getAttribute('xc'),10), parseInt(imageXML.getAttribute('yc'),10));\r\n    img.width = parseInt(imageXML.getAttribute('width'),10);\r\n    img.height = parseInt(imageXML.getAttribute('height'),10);\r\n    img.uri = imageXML.getAttribute('uri');\r\n    return img;\r\n}\r\n\r\nexport function parseXML(filename, str) {\r\n    let job = new Job();\r\n\r\n    job.filename = filename;\r\n\r\n    let parser = new DOMParser();\r\n    let xmlDoc = parser.parseFromString(str, \"text/xml\");\r\n\r\n    // Parse document title\r\n    let titles = xmlDoc.getElementsByTagName('title');\r\n    if (titles && titles.length > 0) {\r\n        job.title = titles[0].firstChild.nodeValue;          // take the first title if more than one\r\n    }\r\n\r\n    // Parse profiles and add polygons to the job\r\n    let profilesXML = xmlDoc.getElementsByTagName('profile');\r\n    for (let profileXML of Array.from(profilesXML)) {\r\n        let polygon = parsePolygon(profileXML);\r\n        job.profiles.push(polygon);\r\n    }\r\n\r\n    // Parse materials and add polygons to the job\r\n    let materialXML = xmlDoc.getElementsByTagName('material');\r\n    for (let shapeXML of Array.from(materialXML)) {\r\n        let polygon = parsePolygon(shapeXML);\r\n        job.materials.push(polygon);\r\n    }\r\n\r\n    // Parse segments\r\n    let segmentsXML = xmlDoc.getElementsByTagName('segment');\r\n    for (let segmentXML of Array.from(segmentsXML)) {\r\n        let segment = parseSegment(segmentXML);\r\n        job.shapes.push(segment);\r\n    }\r\n\r\n    // Parse segments\r\n    let curvesXML = xmlDoc.getElementsByTagName('curve');\r\n    for (let curveXML of Array.from(curvesXML)) {\r\n        let curve = parseCurve(curveXML);\r\n        job.shapes.push(curve);\r\n    }\r\n\r\n    // Parse points\r\n    let pointsXML = xmlDoc.getElementsByTagName('point');\r\n    for (let pointXML of Array.from(pointsXML)) {\r\n        let point = parsePoint(pointXML);\r\n        job.shapes.push(point);\r\n    }\r\n\r\n    // Parse images\r\n    let imagesXML = xmlDoc.getElementsByTagName('picture');\r\n    for (let imageXML of Array.from(imagesXML)) {\r\n        let image = parseImage(imageXML);\r\n        job.shapes.push(image);\r\n    }\r\n\r\n    return job;\r\n}\r\n","import { Job } from '../models/job';\r\nimport {Point, Segment, Arc, Polygon, Utils, vector} from '@flatten-js/core';\r\nimport Flatten from '@flatten-js/core';\r\n\r\nconst inch2pixels = 10160000;\r\nconst mils2pixels = 10160;\r\nfunction InchToPixels(str) {\r\n    return Math.round(Number(str)*inch2pixels,0);\r\n}\r\nfunction MilsToPixels(str) {\r\n    return Math.round(Number(str)*mils2pixels,0);\r\n}\r\n\r\nfunction parsePolygon(lines, start) {\r\n    let shapes = [];\r\n    let i = start;\r\n    let line = lines[i];\r\n    let terms = line.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe;\r\n    let pc;\r\n    let end_of_face = false;\r\n    while(true) {\r\n        line = lines[i];\r\n        terms = line.split(' ');\r\n        switch (terms[0]) {\r\n            case 'OS':\r\n                pe = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n                shapes.push( new Segment(ps, pe));\r\n\r\n                ps = pe.clone();\r\n                break;\r\n            case 'OC':\r\n                pe = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n                pc = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n\r\n                let cwStr = terms[5];\r\n                let counterClockwise = cwStr === 'Y' ? Flatten.CW : Flatten.CCW; /* sic ! */\r\n\r\n                let startAngle = vector(pc,ps).slope;\r\n                let endAngle = vector(pc, pe).slope;\r\n                if (Utils.EQ(startAngle, endAngle)) {\r\n                    endAngle += 2*Math.PI;\r\n                    counterClockwise = true;\r\n                }\r\n                let r = vector(pc, ps).length;\r\n\r\n                shapes.push(new Arc(pc, r, startAngle, endAngle, counterClockwise));\r\n\r\n                ps = pe.clone();\r\n                break;\r\n            case 'OE':\r\n                end_of_face = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (end_of_face) {\r\n            break;\r\n        }\r\n\r\n        i++;\r\n    }\r\n    return shapes;\r\n}\r\n\r\nfunction parseLine(str, apertures) {\r\n    let terms = str.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n    let segment = new Segment(ps, pe);\r\n    let ap_key = Number(terms[5]);\r\n    let ap_value = apertures[ap_key];\r\n    segment.aperture = ap_value;     // augmentation\r\n    return segment;\r\n}\r\n\r\nfunction parseArc(str, apertures) {\r\n    let terms = str.split(' ');\r\n    let ps = new Point( InchToPixels(terms[1]), InchToPixels(terms[2]) );\r\n    let pe = new Point( InchToPixels(terms[3]), InchToPixels(terms[4]) );\r\n    let pc = new Point( InchToPixels(terms[5]), InchToPixels(terms[6]) );\r\n\r\n    let cwStr = terms[10];\r\n    let counterClockwise = cwStr === 'Y' ? Flatten.CW : Flatten.CCW; /* sic ! */\r\n\r\n    let startAngle = vector(pc,ps).slope;\r\n    let endAngle = vector(pc, pe).slope;\r\n    if (Flatten.Utils.EQ(startAngle, endAngle)) {\r\n        endAngle += 2*Math.PI;\r\n        counterClockwise = true;\r\n    }\r\n    let r = vector(pc, ps).length;\r\n\r\n    let arc = new Arc(pc, r, startAngle, endAngle, counterClockwise);\r\n\r\n    let ap_key = Number(terms[7]);\r\n    let ap_value = apertures[ap_key];\r\n    arc.aperture = ap_value;     // augmentation\r\n\r\n    return arc;\r\n}\r\n\r\nexport function parseODB(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n    let polygon;\r\n\r\n    let apertures = [];\r\n\r\n    for (let i=0; i < arrayOfLines.length; i++) {\r\n        let line = arrayOfLines[i];\r\n        let terms = line.split(' ');\r\n\r\n        if (terms[0].substr(0,1) === '$') {\r\n            let ap_key = Number(terms[0].substr(1));\r\n            let ap_value = MilsToPixels(terms[1].substr(1));\r\n            apertures[ap_key] = ap_value;\r\n            continue;\r\n        }\r\n\r\n        switch (terms[0]) {\r\n            case 'S':                  // surface started\r\n                polygon = new Polygon();\r\n                let termArr = line.split(' ');\r\n                let polarity = termArr[1];      // consider later\r\n                polygon.polarity = polarity;\r\n                break;\r\n            case 'OB':                  // polygon started\r\n                let start = i;\r\n                let shapes = parsePolygon(arrayOfLines, start);\r\n                polygon.addFace(shapes);\r\n                i = start + shapes.length + 1;\r\n                break;\r\n            case 'SE':     // surface ended\r\n                job.shapes.push(polygon);\r\n                break;\r\n            case 'L':                  // line\r\n                let odbLine = parseLine(line, apertures);\r\n                job.shapes.push(odbLine);\r\n                break;\r\n            case 'A':                  // Arc\r\n                let odbArc = parseArc(line, apertures);\r\n                job.shapes.push(odbArc);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    return job;\r\n}","import {Point,Box} from '@flatten-js/core';\r\n\r\nconst pgmResolution = 25.500025;\r\nconst microns2pixels = 400;\r\n// const inch2pixels = 10160;\r\n// const offsetX = 12.322830;\r\n// const offsetY = 8.326776;\r\nconst sizeX = 3.0303;\r\n\r\nfunction toPixels(str) {\r\n    let num = Number(str);\r\n    return Math.round(num*pgmResolution*microns2pixels,0);\r\n}\r\n\r\nexport function parseImage(file) {\r\n    let image = {};          // TODO: to be Flatten.Image\r\n\r\n    let terms = file.name.split('_');\r\n    let yStr = terms[0].substr(1);\r\n    let xStr = terms[1] ? terms[1].substr(1) : undefined;\r\n\r\n    let x = isNaN(xStr) ? 0 : toPixels(xStr) + 90000;\r\n    let y = isNaN(yStr) ? 0 : toPixels(yStr) - 40000;\r\n\r\n    image.center = new Point(x,y);\r\n    image.width = sizeX*microns2pixels*1000;    // 2 mm\r\n    image.box = new Box(\r\n        image.center.x - image.width/2,\r\n        image.center.y - image.width/2,\r\n        image.center.x + image.width/2,\r\n        image.center.y + image.width/2,\r\n    );\r\n\r\n    return image;\r\n}","import { Job } from '../models/job';\r\nimport {point} from '@flatten-js/core';\r\n\r\nconst micron2pixels = 400;\r\nfunction micronToPixels(str) {\r\n    return Math.round(Number(str)*micron2pixels,0);\r\n}\r\n\r\nexport function parseCSV(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let arrayOfLines = str.match(/[^\\r\\n]+/g);\r\n\r\n    for (let i = 0; i < arrayOfLines.length; i++) {\r\n        let line = arrayOfLines[i];\r\n        let terms = line.split(',');\r\n\r\n        let px = micronToPixels(terms[0]);\r\n        let py = micronToPixels(terms[1]);\r\n        let nx = Number(terms[2]);\r\n        let ny = Number(terms[3]);\r\n        let shape = point(px,py);\r\n        shape.nx = nx;\r\n        shape.ny = ny;\r\n        job.shapes.push(shape)\r\n    }\r\n\r\n    return job\r\n}","import { Job } from '../models/job';\r\nimport {Parser} from './parser';\r\n\r\nexport function parseTXT(filename, str) {\r\n    let job = new Job();\r\n    job.filename = filename;\r\n\r\n    let parser = new Parser();\r\n\r\n    let shapesArray = parser.parse(str);\r\n\r\n    if (shapesArray.length > 0) {\r\n        for (let shape of shapesArray) {\r\n            job.shapes.push(shape)\r\n        }\r\n    }\r\n\r\n    return job\r\n}","import * as ActionTypes from \"../actionTypes\";\r\nimport * as appActions from \"../actions/appActions\";\r\nimport Layers from '../../models/layers';\r\nimport Model from \"../../models/model\";\r\nimport { parseXML } from '../../dataParsers/parserXML';\r\nimport { parseODB } from \"../../dataParsers/parserODB\";\r\nimport { parseImage } from \"../../dataParsers/parsePGM\";\r\nimport { parseCSV } from \"../../dataParsers/parseCSV\";\r\nimport { parseTXT } from \"../../dataParsers/parseTXT\";\r\nimport { parseJSON } from \"../../dataParsers/parseJSON\";\r\nimport { parseFlighta } from \"../../dataParsers/parseFlighta\";\r\n\r\n// Closure to capture file information and parameters\r\nconst readAsText = (reader, file, stage, layers, dispatch, files) => {\r\n\r\n    let promise = new Promise( (resolve, reject) => {\r\n        reader.onload = (function(theFile, stage, layers, dispatch, files, resolve, reject) {\r\n            return (event) => {\r\n                let string = event.target.result;\r\n\r\n                let namesplitted = theFile.name.split('.');\r\n                let extension = namesplitted[namesplitted.length-1];\r\n                let job;\r\n                if (extension === 'xml') {\r\n                    job = parseXML(theFile.name, string);\r\n                }\r\n                else if (extension === 'csv') {\r\n                    job = parseCSV(theFile.name, string);\r\n                }\r\n                else if (extension === 'txt') {\r\n                    job = parseTXT(theFile.name, string);\r\n                }\r\n                else if (extension === 'json') {\r\n                    job = parseJSON(theFile.name, string);\r\n                }\r\n                else {\r\n                    let arrayOfLines = string.match(/[^\\r\\n]+/g);\r\n                    if (arrayOfLines[0].length === 1 && arrayOfLines[0] === \"N\") {\r\n                        job = parseFlighta(theFile.name, string);\r\n                    }\r\n                    else {\r\n                        job = parseODB(theFile.name, string);\r\n                    }\r\n                }\r\n                let layer = Layers.newLayer(stage, layers);\r\n                if (theFile.name !== \"\") {\r\n                    layer.name = theFile.name;\r\n                }\r\n                layer.title = job.title;\r\n\r\n                for (let polygon of job.profiles) {\r\n                    if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n                        // let watch = undefined; //  parser.parseToWatchArray(string);\r\n                        // let shape = new Shape(polygon, stage, polygon.style, watch);\r\n                        let shape = new Model(polygon, undefined, polygon.label);\r\n\r\n                        layer.add(shape);\r\n                    }\r\n                }\r\n\r\n                for (let polygon of job.materials) {\r\n                    if (polygon.edges.size > 0 && polygon.faces.size > 0) {\r\n                        // let watch = undefined; //  parser.parseToWatchArray(string);\r\n                        // let shape = new Shape(polygon, stage, polygon.style, watch);\r\n                        let shape = new Model(polygon, undefined, polygon.label);\r\n\r\n                        layer.add(shape);\r\n                    }\r\n                }\r\n\r\n                for (let shape of job.shapes) {\r\n                    let model = new Model(shape, undefined, shape.label);\r\n                    layer.add(model);\r\n                }\r\n\r\n                // layers.push(layer);\r\n\r\n                if (theFile === files[0]) {\r\n                    Layers.setAffected(layers, layer);\r\n                    layer.color = Layers.getNextColor(layers);\r\n                    layer.displayed = true;\r\n                    dispatch({\r\n                        type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                        stage: stage,\r\n                        shape: layer\r\n                    });\r\n                }\r\n                dispatch({\r\n                    type: ActionTypes.ADD_NEW_LAYER,\r\n                    layer: layer\r\n                });\r\n\r\n                dispatch({\r\n                    type: ActionTypes.ASYNC_OPERATION_ENDED\r\n                });\r\n\r\n                resolve(true);\r\n            }\r\n        })(file, stage, layers, dispatch, files, resolve, reject);\r\n\r\n        reader.readAsText(file);\r\n    });\r\n\r\n\r\n    dispatch({\r\n        type: ActionTypes.ASYNC_OPERATION_STARTED\r\n    });\r\n\r\n    return promise\r\n};\r\n\r\nconst readAsImage = (reader, file, stage, layers, dispatch, files) => {\r\n    let promise = new Promise( (resolve, reject) => {\r\n        reader.addEventListener(\"load\", function () {\r\n            // let image = {};          // TODO: to be Flatten.Image\r\n            // image.uri = this.result;\r\n            // image.center = new Flatten.Point(0,0);\r\n            // image.width = 2*400000;    // 2 micron\r\n            // image.box = new Flatten.Box(\r\n            //     image.center.x - image.width/2,\r\n            //     image.center.y - image.width/2,\r\n            //     image.center.x + image.width/2,\r\n            //     image.center.y + image.width/2,\r\n            // );\r\n\r\n            let image = parseImage(file);\r\n            image.uri = this.result;\r\n\r\n            let model = new Model(image);\r\n\r\n            let layer = Layers.newLayer(stage, layers);\r\n            if (file.name !== \"\") {\r\n                layer.name = file.name;\r\n            }\r\n\r\n            layer.add(model);\r\n\r\n            // layers.push(layer);\r\n\r\n            if (file === files[0]) {\r\n                Layers.setAffected(layers, layer);\r\n                layer.color = Layers.getNextColor(layers);\r\n                layer.displayed = true;\r\n                dispatch({\r\n                    type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n                    stage: stage,\r\n                    shape: layer\r\n                });\r\n            }\r\n\r\n            dispatch({\r\n                type: ActionTypes.ADD_NEW_LAYER,\r\n                layer: layer\r\n            });\r\n\r\n            dispatch({\r\n                type: ActionTypes.ASYNC_OPERATION_ENDED\r\n            });\r\n\r\n            resolve(true);\r\n        }, false);\r\n\r\n        reader.readAsDataURL(file);\r\n    });\r\n\r\n    return promise;\r\n};\r\n\r\nconst readFile = (file, stage, layers, dispatch, files) => {\r\n    if (file.type !== \"\" &&\r\n        !(file.type.match('text.*') || file.type.match('application.*') ||\r\n            file.type.match('image.*')) ) return;   // validate type is text\r\n\r\n    let reader = new FileReader();\r\n\r\n    if (file.type.match('text.*') || file.type.match('application.*') || file.name.match('features*')) {\r\n        return readAsText(reader, file, stage, layers, dispatch, files);\r\n    }\r\n\r\n    else if (file.type.match('image.*')) {\r\n        return readAsImage(reader, file, stage, layers, dispatch, files);\r\n    }\r\n\r\n    return Promise.reject(\"not supported file\");\r\n};\r\n\r\nexport const readFiles = (files, stage, layers) => {\r\n    return (dispatch) => {\r\n        dispatch(appActions.asyncOperationStarted());\r\n\r\n        // Load and parse files\r\n        // in MS Edge FilesList is not array. It is indexable but not iterable\r\n        // for (let i=0; i < action.files.length; i++) {\r\n        //     readFile(action.files[i], stage, layers, dispatch, action.files);\r\n        // }\r\n        let promises = [];\r\n        for (let file of Array.from(files)) {\r\n            let promise = readFile(file, stage, layers, dispatch, files);\r\n            promises.push(promise);\r\n        }\r\n\r\n        return Promise.all(promises)\r\n            .then( (values) => {\r\n                dispatch(filesUploadCompleted(values));\r\n            })\r\n\r\n            .catch(error => {\r\n                alert(error.message);\r\n                dispatch(appActions.asyncOperationEnded());\r\n            })\r\n    }\r\n};\r\n\r\nexport const filesUploadCompleted = (values) => {\r\n    return {\r\n        type: ActionTypes.FILES_UPLOAD_COMPLETED,\r\n        uploadedFiles: values\r\n    }\r\n};\r\n\r\nexport const initUploadState = () => {\r\n    return {\r\n        type: ActionTypes.INITIALIZE_UPLOAD_STATE\r\n    }\r\n};\r\n\r\nexport default readFiles;\r\n\r\n","import {Component, createRef} from 'react';\r\nimport ModalPopup from \"../UI/ModalPopup/ModalPopup\";\r\nimport Snackbar from \"../UI/Snackbar/Snackbar\";\r\nimport { connect } from 'react-redux';\r\nimport classes from \"./UploadPopup.module.css\";\r\nimport * as actions from '../../store/actions/upload';\r\n\r\nclass UploadPopup extends Component {\r\n    inputElement = createRef();\r\n    clipboardWindowRef = createRef();\r\n\r\n    clipboardWindowWidth = 0;\r\n    clipboardWindowHeight = 0;\r\n\r\n    state = {\r\n        dragOver:false,\r\n        clipboardData: \"\"\r\n    };\r\n\r\n    openFilesButtonClicked = () => this.inputElement.current.click();\r\n\r\n    pasteHandler = (ev) => {\r\n        ev.stopPropagation();\r\n        this.props.onPaste(ev.clipboardData);\r\n        let item = ev.clipboardData.items[0];\r\n        item.getAsString( string =>\r\n            this.setState({\r\n                clipboardData: string\r\n            })\r\n        );\r\n    };\r\n\r\n    dropHandler = (ev) => {\r\n        // Prevent default behavior (Prevent file from being opened)\r\n        ev.preventDefault();\r\n\r\n        let files = [];\r\n\r\n        if (ev.dataTransfer.items) {\r\n            // Use DataTransferItemList interface to access the file(s)\r\n            for (let i = 0; i < ev.dataTransfer.items.length; i++) {\r\n                // If dropped items aren't files, reject them\r\n                if (ev.dataTransfer.items[i].kind === 'file') {\r\n                    let file = ev.dataTransfer.items[i].getAsFile();\r\n                    files.push(file);\r\n                }\r\n            }\r\n        } else {\r\n            // Use DataTransfer interface to access the file(s)\r\n            files = ev.dataTransfer.files;\r\n        }\r\n\r\n        this.props.readFiles(files, this.props.stage, this.props.layers);\r\n        // this.fileDropHandler(files);\r\n        this.setState({dragOver:false});\r\n    };\r\n\r\n    dragOverHandler = (ev) => {\r\n        // Prevent default behavior (Prevent file from being opened)\r\n        ev.preventDefault();\r\n        this.setState({dragOver:true})\r\n    };\r\n\r\n    dragLeaveHandler = (ev) => {\r\n        ev.preventDefault();\r\n        this.setState({dragOver:false})\r\n    };\r\n\r\n    filesSelectedHandler = (event) => {\r\n        if (!(File && FileReader && FileList)) return;\r\n        let files = event.target.files; // FileList object\r\n        this.props.readFiles(files, this.props.stage, this.props.layers);\r\n    };\r\n\r\n    closePopup = () => {\r\n        this.props.initUploadState();\r\n        this.props.closePopup();\r\n    };\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.uploadCompleted) {}\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.clipboardWindowWidth = this.clipboardWindowRef.current.clientWidth;\r\n        this.clipboardWindowHeight = this.clipboardWindowRef.current.clientHeight;\r\n    }\r\n\r\n    render() {\r\n        let pX = this.state.clipboardData === \"\" ? 30 : 0;\r\n        let pY = this.state.clipboardData === \"\" ? 60 : 0;\r\n        let snackbarMessage = \"\";\r\n\r\n        if (this.state.clipboardData !== \"\") snackbarMessage = \"Added 1 layer\";\r\n\r\n        if (this.props.uploadCompleted && this.props.uploadedFiles.length > 0) {\r\n            let newFilesNum = this.props.uploadedFiles.length;\r\n            if (newFilesNum === 1) snackbarMessage = \"1 layer added\";\r\n            if (newFilesNum > 1) snackbarMessage = `${newFilesNum} layers added`;\r\n        }\r\n\r\n        return this.props.showPopup ? (\r\n            <ModalPopup\r\n                showPopup={this.props.showPopup}\r\n                closePopup={this.closePopup}\r\n                header=\"Open files\"\r\n            >\r\n                <div className={classes.UploadPopup}>\r\n                    <div className={this.state.dragOver ?\r\n                        `${classes.UploadTarget} ${classes.UploadTargetDragOver}` :\r\n                        `${classes.UploadTarget} ${classes.UploadTargetDragLeave}`}\r\n                         style={{paddingLeft: pX, paddingRight: pX, paddingTop: pY, paddingBottom: pY}}\r\n                         onPaste={this.pasteHandler}\r\n                         onDrop={this.dropHandler}\r\n                         onDragOverCapture={this.dragOverHandler}\r\n                         onDragLeaveCapture={this.dragLeaveHandler}\r\n                         ref={this.clipboardWindowRef}\r\n                    >\r\n                        {\r\n                            this.state.clipboardData === \"\" ?\r\n                                <span>Drop files here</span> :\r\n                                <p style={{width:this.clipboardWindowWidth, height:this.clipboardWindowHeight}}>\r\n                                    {this.state.clipboardData}\r\n                                </p>\r\n                        }\r\n\r\n                    </div>\r\n\r\n                    <h2>or</h2>\r\n\r\n                    <button onClick={this.openFilesButtonClicked}>\r\n                        Use system Open Dialog\r\n                    </button>\r\n\r\n                    <input style={{display: \"none\"}}\r\n                           type=\"file\" ref={this.inputElement} name=\"files[]\" multiple\r\n                           onChange={this.filesSelectedHandler}\r\n                    />\r\n\r\n                    { snackbarMessage !== \"\" ?\r\n                        <Snackbar\r\n                            onAnimationEnd = {this.props.initUploadState}\r\n                            message={snackbarMessage} /> : null\r\n                    }\r\n\r\n                </div>\r\n            </ModalPopup>\r\n        ) : null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        uploadCompleted: state.upload.uploadCompleted,\r\n        uploadedFiles: state.upload.uploadedFiles\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        readFiles: (files, stage, layers) => dispatch(actions.readFiles(files, stage, layers)),\r\n        initUploadState: () => dispatch(actions.initUploadState())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UploadPopup);\r\n","import {Component} from 'react';\r\nimport { connect } from 'react-redux';\r\nimport * as cloudActions from '../../store/actions/cloudStorageActions';\r\n\r\nclass CloudDocument extends Component {\r\n    state={\r\n        done:false\r\n    };\r\n\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            this.props.fetchDocumentFromDatabase(this.props.stage, this.props.match.params.id);\r\n            this.setState({done:true});\r\n        }\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({app}) => {\r\n    return {\r\n        stage: app.stage,\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        fetchDocumentFromDatabase: (stage, id) => dispatch(cloudActions.fetchDocumentFromDatabase(stage, id)),\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CloudDocument);\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport {Route} from 'react-router-dom';\r\nimport { connect } from \"react-redux\";\r\n\r\nimport ToolbarComponent from '../../components/MainComponent/ToolbarComponent/ToolbarComponent';\r\nimport CanvasComponent from '../../components/MainComponent/CanvasComponent/CanvasComponent';\r\nimport StatusComponent from '../../components/Layout/StatusComponent/StatusComponent';\r\n\r\nimport StageComponent from \"../../components/MainComponent/GraphicsComponent/stageComponent\";\r\nimport LayersComponent from '../../components/MainComponent/GraphicsComponent/layersComponent';\r\n\r\nimport * as actions from '../../store/actions/appActions';\r\nimport * as layerActions from \"../../store/actions/layersActions\";\r\nimport * as cloudActions from '../../store/actions/cloudStorageActions';\r\n\r\nimport Layers from '../../models/layers';\r\nimport MeasurePointsTool from '../../tools/measurePointsTool';\r\nimport MeasureShapesTool from \"../../tools/measureShapesTool\";\r\nimport DisplayCoordsTool from \"../../tools/displayCoordsTool\";\r\n\r\nimport AboutPopup from \"../../components/AboutPopup/AboutPopup\";\r\nimport DownloadPopup from \"../../components/DownloadPopup/DownloadPopup\";\r\nimport UploadPopup from '../../components/UploadPopup/UploadPopup';\r\nimport CloudDocument from '../../components/Constructions/CloudDocument';\r\n\r\nimport styles from './MainComponent.module.css';\r\n\r\nclass MainComponent extends Component {\r\n    setHomeView = () => {\r\n        let layer = Layers.getAffected(this.props.layers);\r\n        if (!layer) return;\r\n        this.props.setHomeView(this.props.stage, layer);\r\n        this.forceUpdate();       // ??? unclear why on Home button click not updated\r\n    };\r\n\r\n    onSaveDocumentButtonClicked = () => {\r\n        if (this.props.layers.length === 0) return;   // nothing to save\r\n        // this.props.stage.img.crossOrigin=\"anonymous\";\r\n        let dataURL = null;\r\n        try {\r\n            dataURL = this.props.stage.toDataURL();\r\n        }\r\n        catch(e) {\r\n            console.log(e)\r\n        }\r\n        let payload = {\r\n            name: this.props.document.name === \"\" ?\r\n                cloudActions.getNewName(this.props.documentsList) : this.props.document.name,\r\n            dataURL: dataURL,\r\n            lastUpdated: new Date().toLocaleDateString() + \" \" + new Date().toLocaleTimeString(),\r\n            // token: this.props.token,\r\n            userId: this.props.userId\r\n        };\r\n\r\n        if (this.props.document.id) {\r\n            this.props.updateDocumentInDatabase(this.props.document.id, payload, this.props.layers);\r\n        }\r\n        else {\r\n            this.props.addDocumentToDatabase(payload, this.props.layers, this.props.history);\r\n        }\r\n    };\r\n\r\n    clearCurrentDocument = () => {\r\n        this.props.clearCurrentDocument();\r\n        this.props.clearAllLayers();\r\n        this.props.history?.push(\"/\");\r\n    };\r\n\r\n    handleKeyDown = (e) => {\r\n        // let ctrl = e.ctrlKey;\r\n        if (e.target.id !== \"mainCanvas\")\r\n            return;\r\n        switch (e.code) {\r\n            case \"KeyH\":\r\n                this.setHomeView();\r\n                break;\r\n\r\n            case \"KeyW\":\r\n                this.props.toggleWidthMode();     // toggle width On/Off in graphics model\r\n                break;\r\n\r\n            case \"KeyE\":\r\n                this.props.toggleDisplayVertices();  // toggle vertices On/Off\r\n                break;\r\n\r\n            case \"ArrowRight\":\r\n                break;\r\n\r\n            case \"ArrowLeft\":\r\n                break;\r\n            case \"ArrowUp\":\r\n                break;\r\n            case \"ArrowDown\":\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n\r\n    handlePaste = (event) => {\r\n        if (event.currentTarget.activeElement.tagName === 'CANVAS') {\r\n            event.stopPropagation();\r\n            this.props.pasteDataFromBuffer(event.clipboardData)\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.onresize = this.props.resizeStage;\r\n        // Keyboard event\r\n        // var _keydown = _.throttle(this.keydown, 100);\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n        // var _keyup = _.throttle(this.keyup, 500);\r\n        document.addEventListener('keyup', this.handleKeyUp);\r\n\r\n        document.addEventListener('paste', this.handlePaste);\r\n\r\n        // if (this.props.document.id === undefined) {\r\n        //     this.props.history.push(\"/\");\r\n        // }\r\n        // if (this.props.document.id !== undefined) {\r\n        //     this.props.history.push(\"/documents/\" + this.props.document.id)\r\n        // }\r\n    }\r\n\r\n    render() {\r\n        let displayCoordsTool = this.props.stage ? (\r\n            <DisplayCoordsTool\r\n                key=\"displayCoordinatedTool\"\r\n                stage={this.props.stage}\r\n                units={this.props.units}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n                coordX={this.props.mouse.x}\r\n                coordY={this.props.mouse.y}\r\n            />\r\n        ) : null;\r\n\r\n        let measurePointsTool = this.props.measurePointsActive ? <MeasurePointsTool /> : null;\r\n\r\n        let measuredLayersDisplayed = this.props.measureShapesTool.firstMeasuredShape &&\r\n            this.props.measureShapesTool.secondMeasuredShape &&\r\n            this.props.measureShapesTool.firstMeasuredLayer.displayed &&\r\n            this.props.measureShapesTool.secondMeasuredLayer.displayed;\r\n\r\n        let measureShapesTool = this.props.measureShapesTool.distance &&\r\n        this.props.measureShapesTool.shortestSegment && measuredLayersDisplayed ? (\r\n            <MeasureShapesTool\r\n                key=\"MeasureShapesTool\"\r\n                stage={this.props.stage}\r\n                firstMeasuredShape={this.props.measureShapesTool.firstMeasuredShape}\r\n                secondMeasuredShape={this.props.measureShapesTool.secondMeasuredShape}\r\n                firstMeasuredLayer={this.props.measureShapesTool.firstMeasuredLayer}\r\n                secondMeasuredLayer={this.props.measureShapesTool.secondMeasuredLayer}\r\n                distance={this.props.measureShapesTool.distance}\r\n                shortestSegment={this.props.measureShapesTool.shortestSegment}\r\n                divisor={this.props.divisor}\r\n                decimals={this.props.decimals}\r\n            />\r\n        ) : null;\r\n\r\n        return (\r\n            <main className={styles[\"Main-content\"]}>\r\n                <ToolbarComponent\r\n                    measurePointsActive={this.props.measurePointsActive}\r\n                    units={this.props.units}\r\n                    showSkeletonRecognitionButton={this.props.showSkeletonRecognitionButton}\r\n                    // onFileSelected={this.handleFileSelect}\r\n                    onShowUploadPopupPressed={this.props.toggleUploadPopup}\r\n\r\n                    onLayerListButtonClicked={this.props.toggleLayerList}\r\n                    onSortLayersButtonClicked={this.props.sortLayersList}\r\n                    onShowDownloadPopupPressed={this.props.toggleDownloadPopup}\r\n                    onClearAllButtonClicked={this.clearCurrentDocument}\r\n\r\n                    onHomeButtonPressed={this.setHomeView}\r\n                    onPanByDragPressed={this.props.togglePanByDrag}\r\n                    onMeasurePointsButtonPressed={this.props.toggleMeasureBetweenPoints}\r\n                    onMeasureBetweenShapesButtonPressed={this.props.toggleMeasureBetweenShapes}\r\n                    onToggleWidthModePressed={this.props.toggleWidthMode}\r\n                    onToggleVerticesPressed={this.props.toggleDisplayVertices}\r\n                    onToggleLabelsPressed={this.props.toggleDisplayLabels}\r\n                    onShowAboutPopupPressed={this.props.toggleAboutPopup}\r\n                    onSkeletonRecognitionButtonPressed={this.props.applySkeletonRecognition}\r\n                    onUnitClicked={this.props.toggleUnits}\r\n                    onSaveDocumentButtonClicked={this.onSaveDocumentButtonClicked}\r\n                />\r\n\r\n                <CanvasComponent />\r\n\r\n                {this.props.stage ? (\r\n                    <StageComponent\r\n                        stage={this.props.stage}\r\n                        onStageUnmounted={this.props.destroyStage}\r\n                    >\r\n                        <LayersComponent layers={this.props.layers}/>\r\n\r\n                        {displayCoordsTool}\r\n                        {measurePointsTool}\r\n                        {measureShapesTool}\r\n                    </StageComponent>) : null }\r\n\r\n                <StatusComponent />\r\n\r\n                { this.props.showAboutPopup ?\r\n                    <AboutPopup\r\n                        showAboutPopup={this.props.showAboutPopup}\r\n                        toggleAboutPopup={this.props.toggleAboutPopup}\r\n                        title={this.props.title}\r\n                        version={this.props.version}\r\n                        build={this.props.build}\r\n                    /> : null}\r\n\r\n\r\n                { this.props.showDownloadPopup ?\r\n                    <DownloadPopup\r\n                        showPopup={this.props.showDownloadPopup}\r\n                        closePopup={this.props.toggleDownloadPopup}\r\n                        title=\"Download document\"\r\n                        layers={this.props.layers}\r\n                    /> : null }\r\n\r\n                {this.props.showUploadPopup ?\r\n                    <UploadPopup\r\n                        showPopup={this.props.showUploadPopup}\r\n                        closePopup={this.props.toggleUploadPopup}\r\n                        title=\"Upload files\"\r\n                        onPaste={this.props.pasteDataFromBuffer}\r\n                    /> : null}\r\n\r\n                <Route path=\"/documents/:id\" component={CloudDocument}/>\r\n\r\n            </main>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        stage: state.app.stage,\r\n        title: state.app.title,\r\n        version: state.app.version,\r\n        build: state.app.build,\r\n        displayVertices: state.app.displayVertices,\r\n        displayLabels: state.app.displayLabels,\r\n        widthOn: state.app.widthOn,\r\n        zoomFactor: state.app.zoomFactor,\r\n        units: state.app.units,\r\n        showSkeletonRecognitionButton: state.app.showSkeletonRecognitionButton,\r\n        divisor: state.app.divisor,\r\n        decimals: state.app.decimals,\r\n        measurePointsActive: state.app.measurePointsActive,\r\n        showAboutPopup: state.app.showAboutPopup,\r\n        showDownloadPopup: state.app.showDownloadPopup,\r\n        showUploadPopup: state.app.showUploadPopup,\r\n        layers: state.layers,\r\n        mouse: state.mouse,\r\n        measureShapesTool: state.measureShapesTool,\r\n\r\n        document: state.cloudStorage.document,\r\n        documentsList: state.cloudStorage.documentsList,\r\n        // onManageCloudStorageButtonClicked: ownProps.onManageCloudStorageButtonClicked\r\n        token: state.auth.token,\r\n        userId: state.auth.userId\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        resizeStage: () => dispatch(actions.resizeStage()),\r\n        destroyStage: () => dispatch(actions.destroyStage()),\r\n        setHomeView: (stage, shape) => dispatch(actions.setHomeView(stage, shape)),\r\n        toggleUnits: () => dispatch(actions.toggleUnits()),\r\n        toggleWidthMode: () => dispatch(actions.toggleWidthMode()),\r\n        toggleDisplayVertices: () => dispatch(actions.toggleDisplayVertices()),\r\n        toggleDisplayLabels: () => dispatch(actions.toggleDisplayLabels()),\r\n        toggleAboutPopup: () => dispatch(actions.toggleAboutPopup()),\r\n        toggleMeasureBetweenPoints: () => dispatch(actions.toggleMeasureBetweenPoints()),\r\n        toggleMeasureBetweenShapes: () => dispatch(actions.toggleMeasureBetweenShapes()),\r\n        togglePanByDrag: () => dispatch(actions.togglePanByDrag()),\r\n        toggleLayerList: () => dispatch(actions.toggleLayerList()),\r\n        toggleDownloadPopup: () => dispatch(actions.toggleDownloadPopup()),\r\n        toggleUploadPopup: () => dispatch(actions.toggleUploadPopup()),\r\n        applySkeletonRecognition: () => dispatch(actions.applySkeletonRecognition()),\r\n        pasteDataFromBuffer: (clipboardData) => dispatch(actions.pasteDataFromBuffer(clipboardData)),\r\n\r\n        sortLayersList: () => dispatch(layerActions.sortLayers()),\r\n        clearAllLayers: () => dispatch(layerActions.deleteAllLayers()),\r\n\r\n        addDocumentToDatabase: (payload, layers, history) => dispatch(cloudActions.addDocumentToDatabase(payload, layers, history)),\r\n        updateDocumentInDatabase: (id, payload, layers) => dispatch(cloudActions.updateDocumentInDatabase(id, payload, layers)),\r\n        clearCurrentDocument: () => dispatch(cloudActions.clearCurrentDocument())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MainComponent);\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\nimport Button from \"../../UI/Button/Button\";\r\n\r\nimport styles from './LayerListToolbar.module.css';\r\nimport '@fortawesome/fontawesome-free/css/all.css';\r\n\r\nconst LayerListToolbar = (props) => {\r\n    return (\r\n        <div className={styles[\"Layer-list-toolbar\"]}>\r\n            <Button type=\"trigger\" title=\"Edit selected layer's name and info\" iconName='pencil-alt'\r\n                    onClick={props.onEditLayerButtonClicked}\r\n            />\r\n\r\n            <Button type=\"trigger\" title=\"Delete selected layer\" iconName='trash-alt'\r\n                    onClick={props.onDeleteLayerButtonClicked}\r\n            />\r\n\r\n\r\n            {/*<button title=\"Add layer\" onClick={props.onAddLayerButtonClicked}>*/}\r\n            {/*    <FontAwesome*/}\r\n            {/*        name='plus'*/}\r\n            {/*        size='2x'*/}\r\n            {/*        style={{color: \"grey\"}}*/}\r\n            {/*    />*/}\r\n            {/*</button>*/}\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default LayerListToolbar;\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nimport styles from './LayerEditForm.module.css';\r\n\r\nconst LayerEditForm = (props) => {\r\n    let onSubmitLayerEditForm = (ev) => {\r\n        if (!ev)\r\n            return false;\r\n        ev.stopPropagation();\r\n        ev.preventDefault();\r\n        let name = ev.currentTarget[0].value;\r\n        let title = ev.currentTarget[1].value;\r\n        let newLayer = Object.assign({}, props.layer, {\r\n            name: name,\r\n            title: title\r\n        });\r\n        props.onSubmitLayerEditForm(newLayer);\r\n        return false;\r\n    };\r\n\r\n    let setFocus = (ev) => {\r\n        ev.stopPropagation();\r\n        ev.target.focus();\r\n    };\r\n\r\n    let onCancelLayerEditForm = (ev) => {\r\n        props.onEscapeLayerEditForm();\r\n    };\r\n\r\n    let onMouseMoveHandler = (ev) => {\r\n        ev.stopPropagation();\r\n    };\r\n\r\n    return (\r\n        <form className={styles[\"Layer-edit-form\"]}\r\n              id=\"layerEditForm\"\r\n              action=\"\"\r\n              onSubmit={onSubmitLayerEditForm}\r\n              onMouseMove={onMouseMoveHandler}\r\n        >\r\n            <article>\r\n            <label>Name:</label>\r\n            <input type=\"text\" id=\"layer-name\" name=\"layerName\" defaultValue={props.layer.name}\r\n                   onClick={setFocus}  />\r\n            </article>\r\n            <article>\r\n            <label>Description:</label>\r\n            <textarea id=\"layer-title\" name=\"layerTitle\" cols=\"70\" rows=\"3\" defaultValue={props.layer.title}\r\n                      onClick={setFocus}>\r\n            </textarea>\r\n            </article>\r\n            <input type=\"submit\" style={{display:\"none\"}}/>\r\n            <button onClick={onCancelLayerEditForm}>Cancel</button>\r\n            <button onClick={(ev) => onSubmitLayerEditForm(ev.target.parent)}>OK</button>\r\n        </form>\r\n    )\r\n};\r\n\r\nexport default LayerEditForm;\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport ModalPopup from \"../../UI/ModalPopup/ModalPopup\";\r\nimport LayerEditForm from \"../LayerEditForm/LayerEditForm\";\r\nimport styles from './LayerListElement.module.css';\r\n\r\nclass LayerListElement extends Component {\r\n    componentDidUpdate() {\r\n        if (document.activeElement.nodeName === \"CANVAS\")\r\n            return;\r\n        let elem = this.refs.layerName;\r\n        if (this.props.layer.affected) {\r\n            elem.focus();\r\n        }\r\n    }\r\n\r\n    rgba(hex, opacity) {\r\n        let r, g, b, percent;\r\n        if (hex) {\r\n            hex = hex.replace('#', '');\r\n            r = parseInt(hex.substring(0, 2), 16);\r\n            g = parseInt(hex.substring(2, 4), 16);\r\n            b = parseInt(hex.substring(4, 6), 16);\r\n            percent = opacity;\r\n        }\r\n        else {\r\n            r = 147;\r\n            g = 128;\r\n            b = 108;\r\n            percent = 0;\r\n        }\r\n        let result = `rgba(${r},${g},${b},${percent / 100})`;\r\n\r\n        return result;\r\n    }\r\n\r\n    render() {\r\n        // let style = this.props.layer.displayed ?\r\n        //     styleSheet.displayed : styleSheet.undisplayed;\r\n\r\n        let displayed = this.props.layer.displayed ? \"Layer-displayed\" : \"Layer-undisplayed\";\r\n        let color = displayed ? this.rgba(this.props.layer.color, 100) : this.rgba();\r\n        let bgcolor = displayed ? this.rgba(this.props.layer.color, 30) : this.rgba();\r\n        let alpha = this.props.layer.affected ? 1 : 0;\r\n        let layerNameOpacity = this.props.layer.shapes.length === 0 ? 0.6 : 1.0;\r\n        return [\r\n            <li key={1}\r\n                className={styles.Layer}\r\n                onClick={this.props.onLayerClicked}\r\n                onDoubleClick={this.props.onLayerDoubleClicked}>\r\n\r\n                <div className={styles.LayerSelectionBox}\r\n                     onClick={this.props.onAffectedBoxClicked}\r\n                >\r\n                    <h4 className={styles.LayerSelectionMark}\r\n                        style={{opacity: alpha, color: color}}>\r\n                        ✓\r\n                    </h4>\r\n                </div>\r\n\r\n                <div className={styles.LayerNameBox}\r\n                     style={{backgroundColor: bgcolor, opacity: layerNameOpacity}}>\r\n                    <h4 ref=\"layerName\"\r\n                        title={this.props.layer.title}\r\n                        tabIndex='1'\r\n                    >\r\n                        {this.props.layer.name}\r\n                    </h4>\r\n                </div>\r\n\r\n            </li>,\r\n\r\n            <ModalPopup\r\n                key={2}\r\n                showPopup={this.props.layer.edited}\r\n                closePopup={this.props.onEscapeLayerEditForm}\r\n                header=\"Layer properties\"\r\n            >\r\n                <LayerEditForm\r\n                    layer={this.props.layer}\r\n                    onSubmitLayerEditForm={this.props.onSubmitLayerEditForm}\r\n                    onEscapeLayerEditForm={this.props.onEscapeLayerEditForm}\r\n                />\r\n            </ModalPopup>\r\n        ]\r\n    }\r\n}\r\n\r\nexport default LayerListElement;\r\n","/**\r\n * Created by alexanderbol on 17/04/2017.\r\n */\r\n\r\nimport {Component} from 'react';\r\nimport LayerListToolbar from \"../../components/LayersList/LayerListToolbar/LayerListToolbar\";\r\nimport LayerListElement from '../../components/LayersList/LayerListElement/LayerListElement';\r\nimport * as actions from '../../store/actions/layersActions';\r\nimport { connect } from 'react-redux';\r\nimport styles from './LayersList.module.css';\r\n\r\nclass LayersList extends Component {\r\n    height = 0;\r\n\r\n    handleKeyDown = (e) => {\r\n        // e.stopPropagation();\r\n        // e.preventDefault();\r\n\r\n        if (e.target.parentElement.parentElement &&\r\n            e.target.parentElement.parentElement.parentElement &&\r\n            e.target.parentElement.parentElement.parentElement.id &&\r\n            e.target.parentElement.parentElement.parentElement.id === \"layersList\") {\r\n\r\n\r\n            switch (e.code) {\r\n                case \"ArrowRight\":\r\n                case \"ArrowDown\":\r\n                    this.props.setAffectedNextLayer();\r\n                    break;\r\n                case \"ArrowLeft\":\r\n                case \"ArrowUp\":\r\n                    this.props.setAffectedPrevLayer();\r\n                    break;\r\n                /* tab does not work properly\r\n            case \"Tab\":\r\n                if (e.shiftKey) {\r\n                    this.dispatch({\r\n                        type: ActionTypes.LAYERS_LIST_ARROW_UP_PRESSED\r\n                    });\r\n                }\r\n                else {\r\n                    this.dispatch({\r\n                        type: ActionTypes.LAYERS_LIST_ARROW_DOWN_PRESSED\r\n                    });\r\n                }\r\n                break;\r\n                */\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    onLayerListClicked = () => {\r\n        this.forceUpdate();\r\n    };\r\n\r\n    componentDidMount() {\r\n        // Keyboard event\r\n        // var _keydown = _.throttle(this.keydown, 100);\r\n        document.addEventListener('keydown', this.handleKeyDown);\r\n        // var _keyup = _.throttle(this.keyup, 500);\r\n        // document.addEventListener('keyup', this.handleKeyUp);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        this.height = this.refs.layersComponent.clientHeight;\r\n    }\r\n\r\n    render() {\r\n        const style = this.props.showLayerList ? styles[\"App-layers-displayed\"] : styles[\"App-layers\"];\r\n        return (\r\n            <div className={style}\r\n                 ref=\"layersComponent\"\r\n                 onClick={this.onLayerListClicked}\r\n            >\r\n                {/*<h5>Layers</h5>*/}\r\n                <LayerListToolbar\r\n                    // onAddLayerButtonClicked={() => this.props.onAddLayerButtonClicked(this.props.stage)}\r\n                    onEditLayerButtonClicked={this.props.onEditLayerButtonClicked}\r\n                    onDeleteLayerButtonClicked={this.props.onDeleteLayerButtonClicked}\r\n                    onSortLayersButtonClicked={this.props.onSortLayersButtonClicked}\r\n                />\r\n                <ul id=\"layersList\"\r\n                    style={{maxHeight:0.82*(this.height-40)}}>\r\n                { this.props.layers.map((layer) =>\r\n                    <LayerListElement\r\n                        key={layer.name}\r\n                        layer={layer}\r\n                        onLayerClicked={() => this.props.onLayerClicked(layer)}\r\n                        onAffectedBoxClicked={(event) => this.props.onAffectedBoxClicked(event, layer)}\r\n                        onSubmitLayerEditForm={this.props.onSubmitLayerEditForm}\r\n                        onEscapeLayerEditForm={this.props.onEscapeLayerEditForm}\r\n                    />)\r\n                }\r\n                </ul>\r\n                {/*{addLayer}*/}\r\n            </div>\r\n        )\r\n\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        showLayerList: state.app.showLayerList         // on mobile device\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        // onAddLayerButtonClicked: (stage) => dispatch(actions.addEmptyLayer(stage)),\r\n        onEditLayerButtonClicked: () => dispatch(actions.openAffectedLayerEditForm()),\r\n        onDeleteLayerButtonClicked: () => dispatch(actions.deleteAffectedLayer()),\r\n        // onSortLayersButtonClicked: () => dispatch(actions.sortLayers()),\r\n        onLayerClicked: (layer) => dispatch(actions.toggleDisplayLayer(layer)),\r\n        onAffectedBoxClicked: (event, layer) => dispatch(actions.toggleAffectedLayer(event, layer)),\r\n        onSubmitLayerEditForm: (newLayer) => dispatch(actions.updateLayer(newLayer)),\r\n        onEscapeLayerEditForm: () => dispatch(actions.closeEditLayerForm()),\r\n        setAffectedNextLayer: () => dispatch(actions.setAffectedNextLayer()),\r\n        setAffectedPrevLayer: () => dispatch(actions.setAffectedPrevLayer())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LayersList);\r\n\r\n// export default LayersList;\r\n","/**\r\n * Created by alexanderbol on 06/05/2017.\r\n */\r\nimport styles from './AsideComponent.module.css';\r\n\r\nconst AsideComponent = () => {\r\n    return (\r\n        <aside className={styles[\"App-aside\"]}>\r\n            <h5>&nbsp;</h5>\r\n        </aside>\r\n    )\r\n};\r\n\r\nexport default AsideComponent;\r\n","import React from 'react';\r\nimport { connect } from \"react-redux\";\r\nimport * as ActionTypes from \"./store/actionTypes\";\r\nimport * as cloudActions from \"./store/actions/cloudStorageActions\";\r\nimport MainComponent from \"./containers/MainComponent/MainComponent\";\r\nimport LayersList from \"./containers/LayerList/LayersList\";\r\nimport AsideComponent from \"./components/Layout/AsideComponent/AsideComponent\";\r\n// import DocumentName from \"./components/MainComponent/DocumentName/DocumentName\";\r\n\r\nconst appBody = (props) => {\r\n    return (\r\n        <React.Fragment>\r\n            {/*<DocumentName name={props.document.name}*/}\r\n                          {/*username={props.username}*/}\r\n                          {/*updateDocumentName={props.updateDocumentName} />*/}\r\n            <div className=\"App-body\" onPaste={props.pasteDataFromBuffer}>\r\n                <MainComponent history={props.history}\r\n                               onManageCloudStorageButtonClicked={props.onManageCloudStorageButtonClicked}\r\n                />\r\n                <LayersList/>\r\n                <AsideComponent/>\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n};\r\n\r\nconst mapStateToProps = ({cloudStorage, auth}) => {\r\n    return {\r\n        document: cloudStorage.document,\r\n        username: auth.username\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        pasteDataFromBuffer: (event) => dispatch({\r\n            type: ActionTypes.DATA_FROM_BUFFER_PASTED,\r\n            data: event.clipboardData\r\n        }),\r\n        updateDocumentName: (name) => dispatch(cloudActions.updateDocumentName(name))\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(appBody);\r\n","/**\r\n * Created by alexanderbol on 13/04/2017.\r\n */\r\nimport { withRouter } from 'react-router-dom';\r\nimport classes from './HeaderComponent.module.css';\r\n// import Logo from './Logo/Logo';\r\n// import Navigation from './Navigation/Navigation';\r\n\r\nconst HeaderComponent = (props) => {\r\n    const style = props.location.pathname === \"/documents\" ?\r\n        classes[\"App-header-documents-page\"] :\r\n        classes[\"App-header\"];\r\n    return (\r\n        <header className={style}>\r\n            {/*<h2>Debug Viewer</h2>*/}\r\n            <h2>{props.title}</h2>\r\n        </header>\r\n    )\r\n};\r\n\r\nexport default withRouter(HeaderComponent);\r\n\r\n/*\r\n<header className={style}>\r\n    <Logo />\r\n    <Navigation isAuthenticated={props.isAuthenticated} />\r\n    {props.isAuthenticated ? <span>Hello {props.username}</span> : null}\r\n    {props.location.pathname === \"/documents\" ? <hr/> : null}\r\n</header>\r\n*/\r\n","import {Component} from 'react';\r\nimport axios from \"axios\";\r\n\r\nimport Layers from \"../../models/layers\";\r\n// import {parseODB} from \"../../dataParsers/parserODB\";\r\nimport {parseTXT} from \"../../dataParsers/parseTXT\";\r\nimport Model from \"../../models/model\";\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport * as actions from '../../store/actions/appActions';\r\nimport { connect } from 'react-redux';\r\n\r\nclass Demo extends Component {\r\n    state={\r\n        done:false\r\n    };\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            let stage = this.props.stage;\r\n            let layers = this.props.layers;\r\n\r\n            // let url1 = \"https://gist.githubusercontent.com/alexbol99/e8ff96c445fc58da5d0f66ccf58d9282/raw/be4273f3b68b104e02f918495592d8308a066344/poly1.txt\";\r\n            // let url2 = \"https://gist.githubusercontent.com/alexbol99/b445045a8bbb41b4bde7724b5e474ddf/raw/705314f25757633c6a3d9199d5be101028ea0316/poly2.txt\";\r\n            // let url3 = \"https://gist.githubusercontent.com/alexbol99/715dc06c8295f90ef18385a0d8040d5c/raw/c95c46c0eae9069d004480ccd0ac80ca89e818f2/poly3.txt\";\r\n            // let url4 = \"https://gist.githubusercontent.com/alexbol99/1226284eb0c0ac3aa9c645d9f7849eb5/raw/a35baaadb8d9e5e0580d33cf4546bf0d05ad37dc/poly4.txt\";\r\n            let url234 = \"https://gist.githubusercontent.com/alexbol99/e570fe783be88b556f4ca4b332da73f7/raw/741c87a7ceccdeadd9fbbac05bdfda22ebe94927/poly234.txt\";\r\n\r\n            // axios(\"https://gist.githubusercontent.com/alexbol99/825fdf2dd508467cc852eb22aa36183d/raw/d10e853338afd8294eeb3ffdebe3bc380477a978/features\")\r\n\r\n            Promise.all([axios(url234)])\r\n                .then( (responses) => {\r\n                    for (let i=0; i < 1; i++) {\r\n                        let resp = responses[i];\r\n                        let layer = Layers.newLayer(stage, layers);\r\n                        layer.color = Layers.getNextColor(layers);\r\n                        layer.name = \"poly\";\r\n                        layer.title = \"\";\r\n                        layer.affected = false;\r\n                        layer.displayed = true;\r\n\r\n                        let job = parseTXT(layer.name, resp.data);\r\n\r\n                        for (let shape of job.shapes) {\r\n                            let model = new Model(shape, undefined, shape.label);\r\n                            layer.add(model);\r\n                        }\r\n\r\n                        this.props.panAndZoomToShape(stage, layer);\r\n                        this.props.addNewLayer(layer);\r\n                        this.props.asyncOperationEnded();\r\n                    }\r\n                })\r\n                .catch( error => {\r\n                    console.log(error);\r\n                    this.props.asyncOperationEnded();\r\n                });\r\n\r\n            this.setState({done:true});\r\n            this.props.asyncOperationStarted();\r\n        }\r\n    }\r\n    componentDidMount() {\r\n\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        panAndZoomToShape: (stage, layer) => dispatch({\r\n            type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n            stage: stage,\r\n            shape: layer\r\n        }),\r\n        addNewLayer: (layer) => dispatch({\r\n            type: ActionTypes.ADD_NEW_LAYER,\r\n            layer: layer\r\n        }),\r\n        asyncOperationStarted: () => dispatch(actions.asyncOperationStarted()),\r\n        asyncOperationEnded: () => dispatch(actions.asyncOperationEnded())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Demo);\r\n","import {Component} from 'react';\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport { connect } from 'react-redux';\r\n\r\nclass SkeletonRecognition extends Component {\r\n    componentDidMount() {\r\n        this.props.applySkeletonRecognition();\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        applySkeletonRecognition: () => dispatch({type: ActionTypes.SKELETON_RECOGNITION_URI})\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(SkeletonRecognition);\r\n","import Flatten from \"@flatten-js/core\";\r\nimport {Vector, Segment, Arc, Line, Box, Polygon} from \"@flatten-js/core\";\r\n// let Flatten = require('flatten-js');\r\n\r\n// let {Vector, Segment, Arc, Line, Box, Polygon} = Flatten;\r\n\r\nclass CollisionDistance {\r\n    static apply(polygon1, polygon2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let edge of [...polygon2.edges]) {\r\n            let distance = CollisionDistance.edge2polygon(edge, polygon1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static edge2polygon(edge2, polygon1) {\r\n        let shapeBox = edge2.shape.box;\r\n        let box = new Box(\r\n            Number.NEGATIVE_INFINITY,\r\n            shapeBox.ymin,\r\n            Number.POSITIVE_INFINITY,\r\n            shapeBox.ymax\r\n        );\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let resp_edges =  polygon1.edges.search(box);\r\n        for (let edge1 of resp_edges) {\r\n            let distance;\r\n            if (edge1.shape instanceof Segment && edge2.shape instanceof Segment) {\r\n                distance = CollisionDistance.segment2segment(edge1.shape, edge2.shape);\r\n            }\r\n            else if (edge1.shape instanceof Arc && edge2.shape instanceof Segment) {\r\n                distance = CollisionDistance.segment2arc(edge2.shape, edge1.shape);\r\n            }\r\n            else if (edge1.shape instanceof Segment && edge2.shape instanceof Arc) {\r\n                distance = CollisionDistance.segment2arc(edge1.shape, edge2.shape);\r\n            }\r\n            else if (edge1.shape instanceof Arc && edge2.shape instanceof Arc) {\r\n                distance = CollisionDistance.arc2arc(edge1.shape, edge2.shape);\r\n            }\r\n\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static point2shape(point, shape) {\r\n        let line = new Line(point, new Vector(0,1));\r\n        let intersections = line.intersect(shape);          // segment or arc\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let ip of intersections) {\r\n            // eslint-disable-next-line\r\n            let [distance, shortest_segment] = point.distanceTo(ip);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static segment2segment(segment1, segment2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        for (let point of segment1.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment2);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of segment2.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static segment2arc(segment, arc) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let v_s = new Vector(segment.start, segment.end);\r\n        v_s = v_s.normalize();\r\n\r\n        let v_n = [v_s.rotate90CCW().multiply(arc.r), v_s.rotate90CW().multiply(arc.r)];\r\n        let distance;\r\n\r\n        // Distance between tangent point and segment\r\n        for (let v of v_n) {\r\n            let tangent_point = arc.center.translate(v);  // tangent point in direction of the normal vector\r\n            if (tangent_point.on(arc)) {\r\n                distance = CollisionDistance.point2shape(tangent_point, segment);\r\n                if (distance < collision_distance) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let point of arc.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, segment);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of segment.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static arc2arc(arc1, arc2) {\r\n        let collision_distance = Number.POSITIVE_INFINITY;\r\n        let distance;\r\n\r\n        // test translation of arc2.center to arc1 enlarged by r2\r\n        let arc_enlarged = arc1.clone();\r\n        arc_enlarged.r += arc2.r;\r\n        distance = CollisionDistance.point2shape(arc2.center, arc_enlarged);\r\n        if (distance < collision_distance) {\r\n            // additional check that transformed arc actually touching\r\n            // eslint-disable-next-line\r\n            let [dist_tmp, shortest_segment_tmp] =\r\n                arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n            if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n\r\n        // test translation of arc2.center to arc1 reduced by r2\r\n        if (Flatten.Utils.GE(arc1.r, arc2.r)) {\r\n            let arc_reduced = arc1.clone();\r\n            arc_reduced.r -= arc2.r;\r\n            distance = CollisionDistance.point2shape(arc2.center, arc_reduced);\r\n            if (distance < collision_distance) {\r\n                // additional check that transformed arc actually touching\r\n                // eslint-disable-next-line\r\n                let [dist_tmp, shortest_segment_tmp] =\r\n                    arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n                if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        // test translation of arc1.center to arc2 reduced by r1\r\n        if (Flatten.Utils.LT(arc1.r, arc2.r)) {\r\n            let arc_reduced = arc2.clone();\r\n            arc_reduced.r -= arc1.r;\r\n            distance = CollisionDistance.point2shape(arc1.center, arc_reduced);\r\n            if (distance < collision_distance) {\r\n                // additional check that transformed arc actually touching\r\n                // eslint-disable-next-line\r\n                let [dist_tmp, shortest_segment_tmp] =\r\n                    arc1.distanceTo( CollisionDistance.translateArc(arc2, new Vector(-distance,0)));\r\n                if (Flatten.Utils.EQ_0(dist_tmp)) {\r\n                    collision_distance = distance;\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let point of arc1.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc2);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        for (let point of arc2.vertices) {\r\n            let distance = CollisionDistance.point2shape(point, arc1);\r\n            if (distance < collision_distance) {\r\n                collision_distance = distance;\r\n            }\r\n        }\r\n        return collision_distance;\r\n    }\r\n\r\n    static translateArc(arc, vec) {\r\n        let arc_tmp = arc.clone();\r\n        arc_tmp.pc = arc_tmp.pc.translate(vec);\r\n        return arc_tmp;\r\n    }\r\n\r\n    static translate(polygon, vec) {\r\n        let newPolygon = new Polygon();\r\n        for (let face of polygon.faces) {\r\n            let shapes = [];\r\n            for (let edge of face) {\r\n                if (edge.shape instanceof Segment) {\r\n                    shapes.push(\r\n                        new Segment(edge.shape.ps.translate(vec), edge.shape.pe.translate(vec))\r\n                    )\r\n                }\r\n                else if (edge.shape instanceof  Arc) {\r\n                    let arc_trans = edge.shape.clone();\r\n                    arc_trans.pc = edge.shape.pc.translate(vec);\r\n                    shapes.push(arc_trans);\r\n                }\r\n            }\r\n            newPolygon.addFace(shapes);\r\n        }\r\n        return newPolygon;\r\n    }\r\n\r\n};\r\n\r\nCollisionDistance.Flatten = Flatten;\r\n\r\nexport default CollisionDistance;\r\n","import {Component} from 'react';\r\nimport Flatten from '@flatten-js/core';\r\nimport CollisionDistance from \"../../models/collisionDistance\";\r\nimport axios from \"axios\";\r\nimport Layers from \"../../models/layers\";\r\n// import {Model} from \"../../models/model\";\r\nimport * as ActionTypes from \"../../store/actionTypes\";\r\nimport { connect } from \"react-redux\";\r\nimport * as actions from \"../../store/actions/appActions\";\r\n\r\nlet {vector} = Flatten;\r\n\r\nclass CollisionDemo extends Component {\r\n    state={\r\n        done:false,\r\n        data:[]\r\n    };\r\n    componentDidUpdate() {\r\n        if (this.props.stage && !this.state.done) {\r\n            let stage = this.props.stage;\r\n            let layers = this.props.layers;\r\n\r\n            let layer = Layers.newLayer(stage, layers);\r\n            layer.color = Layers.getNextColor(layers);\r\n            layer.name = \"collision_demo\";\r\n            layer.title = \"collision_demo\";\r\n            layer.affected = true;\r\n            layer.displayed = true;\r\n\r\n            axios(\"https://gist.githubusercontent.com/alexbol99/81893d40ec5eaa00d0336c35e069dd73/raw/b9328a4c6d7d6a44f375c68b4ec207690f40fd19/Block_53388_2parts_Cont.txt\")\r\n                .then( (resp) => {\r\n                    let parser = this.props.parser;\r\n                    let polygon1 = parser.parseToPolygon(resp.data);\r\n                    layer.add(polygon1);\r\n\r\n                    let vec = vector( 2*(polygon1.box.xmax - polygon1.box.xmin), 0 );\r\n                    let polygon2 = polygon1.translate(vec);\r\n                    layer.add(polygon2);\r\n\r\n                    let collision = CollisionDistance.apply(polygon2, polygon1);\r\n                    let polygon3 = polygon2.translate(vector(-collision, 0));\r\n                    layer.add(polygon3);\r\n\r\n                    // layers.push(layer);\r\n\r\n                    this.props.panAndZoomToShape(stage, layer);\r\n                    this.props.addNewLayer(layer);\r\n                    this.props.applyCollisionDemo();\r\n                    this.props.asyncOperationEnded();\r\n                });\r\n            this.setState({done:true});\r\n            this.props.asyncOperationStarted();\r\n        }\r\n    }\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        layers: state.layers,\r\n        stage: state.app.stage,\r\n        parser: state.app.parser\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        panAndZoomToShape: (stage, layer) => dispatch({\r\n            type: ActionTypes.PAN_AND_ZOOM_TO_SHAPE,\r\n            stage: stage,\r\n            shape: layer\r\n        }),\r\n        addNewLayer: (layer) => dispatch({\r\n            type: ActionTypes.ADD_NEW_LAYER,\r\n            layer: layer\r\n        }),\r\n        applyCollisionDemo: () => dispatch({\r\n            type: ActionTypes.COLLISION_DEMO_URI\r\n        }),\r\n        asyncOperationStarted: () => dispatch(actions.asyncOperationStarted()),\r\n        asyncOperationEnded: () => dispatch(actions.asyncOperationEnded())\r\n    }\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CollisionDemo);\r\n","import Modal from '../Modal';\r\nimport classes from './Spinner.module.css';\r\n\r\nconst spinner = () => {\r\n    return (\r\n        <Modal>\r\n            <div className={classes.BackDrop} >\r\n                <div className={classes.Loader}>Loading ...</div>\r\n            </div>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default spinner;","import * as actionTypes from '../actionTypes';\r\nimport axios from 'axios';\r\n\r\nconst apiKey = \"AIzaSyDMUAcjgolAlapdpFmPEz8SaId1DZw7MpQ\";\r\n\r\nexport const authStart = () => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_STARTED\r\n    }\r\n};\r\n\r\nexport const authSucceed = (token, userId, username=null) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_SUCCEED,\r\n        token,\r\n        userId,\r\n        username\r\n    }\r\n};\r\n\r\nexport const authFailed = (error) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_FAILED,\r\n        error\r\n    }\r\n};\r\n\r\nexport const authSetUsername = (username) => {\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_SET_USERNAME,\r\n        username\r\n    }\r\n};\r\n\r\nexport const logout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('expirationDate');\r\n    localStorage.removeItem('userId');\r\n    return {\r\n        type: actionTypes.AUTHENTICATION_LOGOUT\r\n    }\r\n};\r\n\r\nexport const checkAuthTimeout = (expirationTime) => {\r\n    return dispatch => {\r\n        setTimeout(() => {\r\n            const email = localStorage.getItem('email');\r\n            const password = localStorage.getItem('password');\r\n            if (email && password) {\r\n                dispatch(logIn(email, password))\r\n            }\r\n            else {\r\n                dispatch(logout())\r\n            }\r\n        }, expirationTime * 1000)\r\n    }\r\n};\r\n\r\nexport const logIn = (email, password) => {\r\n    return dispatch => {\r\n        dispatch(authStart());\r\n        const authData = {\r\n            email,\r\n            password,\r\n            returnSecureToken: true\r\n        };\r\n        localStorage.setItem('email', email);\r\n        localStorage.setItem('password', password);\r\n        const url = \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=\" + apiKey;\r\n        axios.post(url, authData)\r\n            .then(response => {\r\n                const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);\r\n                localStorage.setItem('token', response.data.idToken);\r\n                localStorage.setItem('expirationDate', expirationDate);\r\n                localStorage.setItem('userId', response.data.localId);\r\n\r\n                dispatch(authSucceed(response.data.idToken, response.data.localId));\r\n                dispatch(checkAuthTimeout(response.data.expiresIn));\r\n                const queryParams = '?auth=' + response.data.idToken + '&orderBy=\"userId\"&equalTo=\"' + response.data.localId + '\"';\r\n                return axios.get(\"https://debug-viewer.firebaseio.com/users.json\" + queryParams);\r\n            })\r\n            .then(response => {\r\n                if (Object.values(response.data.length > 0)) {\r\n                    const username = Object.values(response.data)[0].username;\r\n                    localStorage.setItem('username', username);\r\n                    dispatch(authSetUsername(Object.values(response.data)[0].username))\r\n                }\r\n            })\r\n            .catch(error => {\r\n                dispatch(authFailed(error.response.data.error))\r\n            })\r\n    }\r\n};\r\n\r\nexport const signUp = (username, email, password) => {\r\n    return dispatch => {\r\n        dispatch(authStart());\r\n        const authData = {\r\n            email,\r\n            password,\r\n            returnSecureToken: true\r\n        };\r\n        const url = \"https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=\" + apiKey;\r\n        axios.post(url, authData)\r\n            .then(response => {\r\n                const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);\r\n                localStorage.setItem('token', response.data.idToken);\r\n                localStorage.setItem('expirationDate', expirationDate);\r\n                localStorage.setItem('userId', response.data.localId);\r\n                localStorage.setItem('username', username);\r\n\r\n                dispatch(authSucceed(response.data.idToken, response.data.localId, username));\r\n                dispatch(checkAuthTimeout(response.data.expiresIn));\r\n\r\n                const user = {\r\n                    userId: response.data.localId,\r\n                    username: username\r\n                };\r\n                return axios.post(\"https://debug-viewer.firebaseio.com/users.json\", user);\r\n            })\r\n            .then(response => {\r\n                // do nothing\r\n            })\r\n            .catch(error => {\r\n                console.log(error.response.data.error);\r\n                dispatch(authFailed(error.response.data.error))\r\n            })\r\n    }\r\n};\r\n\r\nexport const authCheckState = () => {\r\n    return dispatch => {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n            dispatch(logout());\r\n        }\r\n        else {\r\n            const userId = localStorage.getItem('userId');\r\n            const username = localStorage.getItem('username');\r\n            const expirationDate = new Date(localStorage.getItem('expirationDate'));\r\n            if (expirationDate > new Date()) {\r\n                const timeLeft = expirationDate.getTime() - new Date().getTime()\r\n                dispatch(authSucceed(token, userId, username));\r\n                dispatch(checkAuthTimeout(timeLeft / 1000));\r\n            }\r\n            else {\r\n                dispatch(logout());\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n","import {Component} from 'react';\r\nimport {Route, Switch, withRouter} from 'react-router-dom';\r\n\r\nimport AppBody from './AppBody';\r\nimport HeaderComponent from './components/Layout/HeaderComponent/HeaderComponent';\r\n// import Signup from './containers/Auth/SignUp/Signup';\r\n// import Login from './containers/Auth/Login/Login';\r\n// import Logout from './containers/Auth/Logout';\r\nimport {connect} from 'react-redux';\r\n\r\nimport './App.css';\r\n\r\n// import CloudDocument from './components/Constructions/CloudDocument';\r\nimport Demo from './components/Constructions/Demo';\r\n// import BooleanTest from './components/Constructions/BooleanTest';\r\nimport SkeletonRecognition from './components/Constructions/SkeletonRecognition';\r\nimport CollisionDemo from \"./components/Constructions/CollisionDemo\";\r\nimport Spinner from \"./components/UI/Spinner/Spinner\";\r\n// import DocumentsComponent from \"./containers/DocumentsComponent/DocumentsComponent\";\r\nimport * as authActions from \"./store/actions/auth\";\r\n\r\nclass App extends Component {\r\n    componentDidMount() {\r\n        this.props.authCheckState();\r\n    }\r\n    componentDidUpdate() {\r\n        if (this.props.location.pathname === '/' && this.props.document.id !== undefined) {\r\n            this.props.history.push(\"/documents/\" + this.props.document.id)\r\n        }\r\n\r\n        // if (this.props.location.pathname.split('/').length > 2 &&\r\n        //     this.props.location.pathname.split('/')[2].length > 0 &&\r\n        //     this.props.document.id === undefined) {\r\n        //     this.props.history.push(\"/\");\r\n        // }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"App\">\r\n                <HeaderComponent\r\n                    title={this.props.title}\r\n                    version={this.props.version}\r\n                    isAuthenticated={this.props.isAuthenticated}\r\n                    username={this.props.username}\r\n                />\r\n\r\n                <AppBody/>\r\n\r\n                <Switch>\r\n                    {/*<Route path=\"/documents\" exact component={DocumentsComponent}/>*/}\r\n                    {/*<Route path=\"/signup\" component={Signup} />*/}\r\n                    {/*<Route path=\"/login\" component={Login} />*/}\r\n                    {/*<Route path=\"/logout\" component={Logout} />*/}\r\n\r\n                    <Route path=\"/demo\" exact component={Demo}/>\r\n                    {/*<Route path=\"/\" component={AppBody}/>*/}\r\n\r\n                    {/*<Route path=\"/documents/:id\" component={CloudDocument}/>*/}\r\n\r\n\r\n                    <Route path=\"/skeleton\" component={SkeletonRecognition}/>\r\n                    <Route path=\"/collision-distance\" component={CollisionDemo}/>\r\n\r\n                </Switch>\r\n\r\n                {this.props.showSpinner ? <Spinner/> : null}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = ({auth, app, cloudStorage}) => {\r\n    return {\r\n        title: app.title,\r\n        version: app.version,\r\n        showSpinner: app.showSpinner,\r\n        document: cloudStorage.document,\r\n        isAuthenticated: auth.token !== null,\r\n        username: auth.username\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        authCheckState: () => dispatch(authActions.authCheckState())\r\n    }\r\n};\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(App));\r\n\r\n/*\r\n                    <Route path=\"/boolean-test\" component={BooleanTest}/>\r\n */\r\n","import ReactDOM from 'react-dom';\r\nimport {createStore, applyMiddleware, compose} from 'redux';\r\nimport {Provider} from 'react-redux';\r\nimport thunk from 'redux-thunk';\r\nimport {BrowserRouter} from 'react-router-dom';\r\n\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport reducer from './store/reducer';\r\nimport log from './middleware/log';\r\n// import readFiles from './middleware/readFiles';\r\nimport pasteData from './middleware/pasteData';\r\nimport stageController from './middleware/stageController';\r\nimport skeleton_recognition from './middleware/skeleton_recognition';\r\nimport App from \"./App\";\r\n\r\nimport './index.css';\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nconst store = createStore(reducer,\r\n    composeEnhancers(\r\n        applyMiddleware(log, pasteData, skeleton_recognition, stageController, thunk)\r\n    )\r\n);\r\n\r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <BrowserRouter basename={process.env.PUBLIC_URL}>\r\n            <App/>\r\n        </BrowserRouter>\r\n    </Provider>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Button\":\"Button_Button__1fd6w\",\"IconTrigger\":\"Button_IconTrigger__1YVqB\",\"IconModeActive\":\"Button_IconModeActive__15bb6\",\"IconModeNotActive\":\"Button_IconModeNotActive__2jc-j\",\"DrawerButton\":\"Button_DrawerButton__3e-ya\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"UploadPopup\":\"UploadPopup_UploadPopup__3NN86\",\"fadeIn\":\"UploadPopup_fadeIn__1bvlt\",\"UploadTarget\":\"UploadPopup_UploadTarget__2n3zH\",\"UploadTargetDragLeave\":\"UploadPopup_UploadTargetDragLeave__9_UtP\",\"UploadTargetDragOver\":\"UploadPopup_UploadTargetDragOver__1G5lm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer\":\"LayerListElement_Layer__3uB4w\",\"LayerSelectionBox\":\"LayerListElement_LayerSelectionBox__LJsL5\",\"LayerSelectionMark\":\"LayerListElement_LayerSelectionMark__1bncI\",\"LayerNameBox\":\"LayerListElement_LayerNameBox__3rWlq\",\"Layer-displayed\":\"LayerListElement_Layer-displayed__3pM6C\",\"Layer-undisplayed\":\"LayerListElement_Layer-undisplayed__2tQ-G\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ButtonSeparator\":\"ButtonSeparator_ButtonSeparator__3-XVi\",\"IconSeparator\":\"ButtonSeparator_IconSeparator__4p5F4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-toolbar\":\"ToolbarComponent_App-toolbar__2CUOP\",\"App-toolbar-units\":\"ToolbarComponent_App-toolbar-units__1OW6t\",\"DrawerButton\":\"ToolbarComponent_DrawerButton__3zJL0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"BackDrop\":\"ModalPopup_BackDrop__2Rsnt\",\"ModalPopup\":\"ModalPopup_ModalPopup__3FWyH\",\"fadeIn\":\"ModalPopup_fadeIn__2rgNo\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-layers\":\"LayersList_App-layers__3WWBl\",\"App-layers-displayed\":\"LayersList_App-layers-displayed__3QHub\",\"fadeIn\":\"LayersList_fadeIn__1DCGf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"HeaderComponent_App-header__2nLSy\",\"App-header-documents-page\":\"HeaderComponent_App-header-documents-page__1321S\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"BackDrop\":\"Spinner_BackDrop__j0Bhc\",\"Loader\":\"Spinner_Loader__2drNv\",\"load2\":\"Spinner_load2__7xqSG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-canvas\":\"CanvasComponent_App-canvas__2QLQ9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-status-bar\":\"StatusComponent_App-status-bar__3JSna\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"LabelsLayer\":\"labelsLayer_LabelsLayer__3kpEF\",\"LabelComponent\":\"labelsLayer_LabelComponent__1-iQa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"VertexLabel\":\"VertexLabel_VertexLabel__1vMyK\",\"fadeIn\":\"VertexLabel_fadeIn__3FPfD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"AboutPopup\":\"AboutPopup_AboutPopup__190Fp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"DownloadPopup\":\"DownloadPopup_DownloadPopup__2CO2_\",\"fadeIn\":\"DownloadPopup_fadeIn__1XE8b\",\"Open\":\"DownloadPopup_Open__XFl6Y\",\"Close\":\"DownloadPopup_Close__1He2a\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Snackbar\":\"Snackbar_Snackbar__1jZD9\",\"fadeInOut\":\"Snackbar_fadeInOut__1-Ayc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Main-content\":\"MainComponent_Main-content__1r62J\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer-list-toolbar\":\"LayerListToolbar_Layer-list-toolbar__3-iCF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layer-edit-form\":\"LayerEditForm_Layer-edit-form__2QVCM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-aside\":\"AsideComponent_App-aside__n9B_T\"};"],"sourceRoot":""}